 AS V1.42 Beta [Bld 118] - source file mars.asm - page 1 - 2/19/2021 3:40:41


       1/       0 :                     ; ===========================================================================
       2/       0 :                     ; +-----------------------------------------------------------------+
       3/       0 :                     ; PROJECT SHINRINX
       4/       0 :                     ; 
       5/       0 :                     ; Started on 16/01/2020
       6/       0 :                     ; +-----------------------------------------------------------------+
       7/       0 :                     
       8/       0 :                     		include	"system/macros.asm"	; Assembler macros
(1)    1/       0 :                     ; ===========================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MACROS
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; --------------------------------------------------------
(1)    7/       0 :                     ; AS Main settings
(1)    8/       0 :                     ; --------------------------------------------------------
(1)    9/       0 :                     
(1)   10/       0 :                     		!org 0				; Start at 0
(1)   11/       0 :                     		cpu 		68000		; Current CPU is 68k, gets changed later
(1)   12/       0 :                     		padding		off		; Dont pad dc.b
(1)   13/       0 :                     		listing 	purecode	; Want listing file, but only the final code in expanded macros
(1)   14/       0 :                     		supmode 	on 		; Supervisor mode
(1)   15/       0 :                     		dottedstructs	off		; If needed
(1)   16/       0 :                     		page 		0
(1)   17/       0 :                     
(1)   18/       0 :                     ; ====================================================================
(1)   19/       0 :                     ; ---------------------------------------------
(1)   20/       0 :                     ; Functions
(1)   21/       0 :                     ; ---------------------------------------------
(1)   22/       0 :                     
(1)   23/       0 :                     doubleword 	function l,r,(l<<16&$FFFF0000|r&$FFFF)			; LLLL RRRR
(1)   24/       0 :                     mapsize		function l,r,(((l-1)/8)<<16&$FFFF0000|((r-1)/8)&$FFFF)	; for cells w/h use doubleword
(1)   25/       0 :                     locate		function a,b,c,(c&$FF)|(b<<8&$FF00)|(a<<16&$FF0000)	; VDP locate: Layer|X pos|Y pos for some video routines
(1)   26/       0 :                     
(1)   27/       0 :                     ; ====================================================================
(1)   28/       0 :                     ; ---------------------------------------------
(1)   29/       0 :                     ; Macros
(1)   30/       0 :                     ; ---------------------------------------------
(1)   31/       0 :                     
(1)   32/       0 :                     ; -------------------------------------
(1)   33/       0 :                     ; Reserve memory section
(1)   34/       0 :                     ; -------------------------------------
(1)   35/       0 :                     
(1)   36/       0 :                     struct		macro thisinput			; Reserve memory address
(1)   37/       0 :                     GLBL_LASTPC	set *
(1)   38/       0 :                     		dephase
(1)   39/       0 :                     GLBL_LASTORG	set *
(1)   40/       0 :                     		phase thisinput
(1)   41/       0 :                     		endm
(1)   42/       0 :                     		
(1)   43/       0 :                     ; -------------------------------------
(1)   44/       0 :                     ; Finish
(1)   45/       0 :                     ; -------------------------------------
(1)   46/       0 :                     
(1)   47/       0 :                     finish		macro				; Then finish custom struct.
(1)   48/       0 :                     		!org GLBL_LASTORG
(1)   49/       0 :                     		phase GLBL_LASTPC
(1)   50/       0 :                     		endm
(1)   51/       0 :                     
(1)   52/       0 :                     ; -------------------------------------
(1)   53/       0 :                     ; Custom ORG
(1)   54/       0 :                     ;
(1)   55/       0 :                     ; (from s2disasm)
(1)   56/       0 :                     ; -------------------------------------
(1)   57/       0 :                     
(1)   58/       0 : =$0                 paddingSoFar set 0
(1)   59/       0 :                     notZ80 function cpu,(cpu<>128)&&(cpu<>32988)
(1)   60/       0 :                     org macro address
(1)   61/       0 :                     	if notZ80(MOMCPU)
(1)   62/       0 :                     		if address < *
(1)   63/       0 :                     			error "too much stuff before org $\{address} ($\{(*-address)} bytes)"
(1)   64/       0 :                     		elseif address > *
(1)   65/       0 :                     paddingSoFar	set paddingSoFar + address - *
(1)   66/       0 :                     			!org address
(1)   67/       0 :                     		endif
(1)   68/       0 :                     	else
(1)   69/       0 :                     		if address < $
(1)   70/       0 :                     			error "too much stuff before org 0\{address}h (0\{($-address)}h bytes)"
(1)   71/       0 :                     		else
(1)   72/       0 :                     			while address > $
(1)   73/       0 :                     				db 0
(1)   74/       0 :                     			endm
(1)   75/       0 :                     		endif
(1)   76/       0 :                     	endif
(1)   77/       0 :                         endm
(1)   78/       0 :                     
       9/       0 :                     		include	"system/md/const.asm"	; MD and MARS Variables are located here
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MD/MARS shared constants
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; MD to MARS custom FIFO section
(1)    7/       0 : =$8                 MAX_MDTSKARG	equ 8			; MAX MD task arguments (LONGS)
(1)    8/       0 : =$10                MAX_MDTASKS	equ 16			; MAX requests from MD to here
(1)    9/       0 :                     
(1)   10/       0 :                     ; ====================================================================
(1)   11/       0 :                     ; ----------------------------------------------------------------
(1)   12/       0 :                     ; MD Video
(1)   13/       0 :                     ; ----------------------------------------------------------------
(1)   14/       0 :                     
(1)   15/       0 :                     ; ------------------------------------------------
(1)   16/       0 :                     ; vdp_ctrl READ bits
(1)   17/       0 :                     ; ------------------------------------------------
(1)   18/       0 :                     
(1)   19/       0 : =$2                 bitHint		equ 2
(1)   20/       0 : =$3                 bitVint		equ 3
(1)   21/       0 : =$1                 bitDma		equ 1
(1)   22/       0 :                     
(1)   23/       0 :                     ; ------------------------------------------------
(1)   24/       0 :                     ; VDP register variables
(1)   25/       0 :                     ; ------------------------------------------------
(1)   26/       0 :                     
(1)   27/       0 :                     ; Register $80
(1)   28/       0 : =$2                 HVStop		equ $02
(1)   29/       0 : =$10                HintEnbl	equ $10
(1)   30/       0 : =$1                 bitHVStop	equ 1
(1)   31/       0 : =$4                 bitHintEnbl	equ 4
(1)   32/       0 :                     
(1)   33/       0 :                     ; Register $81
(1)   34/       0 : =$40                DispEnbl 	equ $40
(1)   35/       0 : =$20                VintEnbl 	equ $20
(1)   36/       0 : =$10                DmaEnbl		equ $10
(1)   37/       0 : =$6                 bitDispEnbl	equ 6
(1)   38/       0 : =$5                 bitVintEnbl	equ 5
(1)   39/       0 : =$4                 bitDmaEnbl	equ 4
(1)   40/       0 : =$3                 bitV30		equ 3
(1)   41/       0 :                     
(1)   42/       0 :                     ; ====================================================================
(1)   43/       0 :                     ; --------------------------------------------------------
(1)   44/       0 :                     ; Contoller reading (call System_Input first)
(1)   45/       0 :                     ; --------------------------------------------------------
(1)   46/       0 :                     
(1)   47/       0 :                     ; call System_Input first, structure is below
(1)   48/       0 : =$FFFFFFFFFF..      Controller_1	equ RAM_InputData
(1)   49/       0 : =$FFFFFFFFFF..      Controller_2	equ RAM_InputData+sizeof_input
(1)   50/       0 :                     
(1)   51/       0 :                     ; full WORD
(1)   52/       0 : =$1                 JoyUp		equ $0001
(1)   53/       0 : =$2                 JoyDown		equ $0002
(1)   54/       0 : =$4                 JoyLeft		equ $0004
(1)   55/       0 : =$8                 JoyRight	equ $0008
(1)   56/       0 : =$10                JoyB		equ $0010
(1)   57/       0 : =$20                JoyC		equ $0020
(1)   58/       0 : =$40                JoyA		equ $0040
(1)   59/       0 : =$80                JoyStart	equ $0080
(1)   60/       0 : =$100               JoyZ		equ $0100
(1)   61/       0 : =$200               JoyY		equ $0200
(1)   62/       0 : =$400               JoyX		equ $0400
(1)   63/       0 : =$800               JoyMode		equ $0800
(1)   64/       0 :                     
(1)   65/       0 :                     ; right byte $00xx
(1)   66/       0 : =$0                 bitJoyUp	equ 0
(1)   67/       0 : =$1                 bitJoyDown	equ 1
(1)   68/       0 : =$2                 bitJoyLeft	equ 2
(1)   69/       0 : =$3                 bitJoyRight	equ 3
(1)   70/       0 : =$4                 bitJoyB		equ 4
(1)   71/       0 : =$5                 bitJoyC		equ 5
(1)   72/       0 : =$6                 bitJoyA		equ 6
(1)   73/       0 : =$7                 bitJoyStart	equ 7
(1)   74/       0 :                     
(1)   75/       0 :                     ; left byte $xx00
(1)   76/       0 : =$0                 bitJoyZ		equ 0
(1)   77/       0 : =$1                 bitJoyY		equ 1
(1)   78/       0 : =$2                 bitJoyX		equ 2
(1)   79/       0 : =$3                 bitJoyMode	equ 3
(1)   80/       0 :                     
(1)   81/       0 :                     ; ====================================================================
(1)   82/       0 :                     ; --------------------------------------------------------
(1)   83/       0 :                     ; Settings
(1)   84/       0 :                     ; --------------------------------------------------------
(1)   85/       0 :                     
(1)   86/       0 : =$FFFF8800          MDRAM_START	equ $FFFF8800		; Start of working MD RAM (below it is free for CODE or decompression output)
(1)   87/       0 : =$800               MAX_MDERAM	equ $800		; MAX RAM for current screen mode (title,menu,or gameplay...)
(1)   88/       0 : =$7FF               varNullVram	equ $7FF		; Used in some Video routines
(1)   89/       0 :                     
(1)   90/       0 :                     ; ====================================================================
(1)   91/       0 :                     ; ----------------------------------------------------------------
(1)   92/       0 :                     ; Structures
(1)   93/       0 :                     ; ----------------------------------------------------------------
(1)   94/       0 :                     
(1)   95/       0 :                     ; Controller buffer data (after calling System_Input)
(1)   96/       0 : (MACRO)             		struct 0
(1)   96/       0 : =$0                 GLBL_LASTPC     set *
(1)   96/       0 :                                     dephase
(1)   96/       0 : =$0                 GLBL_LASTORG    set *
(1)   96/       0 :                                     phase 0
(1)   97/       0 :                     pad_id		ds.b 1			; Controller ID
(1)   98/       1 :                     pad_ver		ds.b 1			; Controller type/revision: 0-3button 1-6button
(1)   99/       2 :                     on_hold		ds.w 1			; User HOLD bits
(1)  100/       4 :                     on_press	ds.w 1			; User PRESSED bits
(1)  101/       6 :                     sizeof_input	ds.l 0
(1)  102/       8 : (MACRO)             		finish
(1)  102/       0 :                                     !org GLBL_LASTORG
(1)  102/       0 :                                     phase GLBL_LASTPC
(1)  103/       0 :                     
(1)  104/       0 :                     ; ====================================================================
(1)  105/       0 :                     ; ----------------------------------------------------------------
(1)  106/       0 :                     ; System RAM
(1)  107/       0 :                     ; ----------------------------------------------------------------
(1)  108/       0 :                     
(1)  109/       0 : (MACRO)             		struct RAM_MdSystem
(1)  109/       0 : =$0                 GLBL_LASTPC     set *
(1)  109/       0 :                                     dephase
(1)  109/       0 : =$0                 GLBL_LASTORG    set *
(1)  109/FFFFFFFFFFFF9000 :                                     phase RAM_MDSYSTEM
(1)  110/FFFFFFFFFFFF9000 :                     RAM_InputData	ds.b sizeof_input*4		; Input data section
(1)  111/FFFFFFFFFFFF9018 :                     RAM_SaveData	ds.b $200			; Save data cache (if using SRAM)
(1)  112/FFFFFFFFFFFF9218 :                     RAM_MdMarsTskM	ds.l MAX_MDTSKARG*MAX_MDTASKS	; Queue task list for MASTER SH2
(1)  113/FFFFFFFFFFFF9418 :                     RAM_MdMarsTskS	ds.l MAX_MDTSKARG*MAX_MDTASKS	; Queue task list for SLAVE SH2
(1)  114/FFFFFFFFFFFF9618 :                     RAM_MdMarsTsSgl	ds.l MAX_MDTSKARG		; Single task request for 32X, shared for both Mst and Slv
(1)  115/FFFFFFFFFFFF9638 :                     RAM_FrameCount	ds.l 1				; Frame counter
(1)  116/FFFFFFFFFFFF963C :                     RAM_SysRandVal	ds.l 1				; Random value
(1)  117/FFFFFFFFFFFF9640 :                     RAM_SysRandSeed	ds.l 1				; Randomness seed
(1)  118/FFFFFFFFFFFF9644 :                     RAM_initflug	ds.l 1				; "INIT" flag
(1)  119/FFFFFFFFFFFF9648 :                     RAM_MdMarsTCntM	ds.w 1				; Counter for MASTER CPU's task list
(1)  120/FFFFFFFFFFFF964A :                     RAM_MdMarsTCntS	ds.w 1				; Counter for SLAVE CPU's task list
(1)  121/FFFFFFFFFFFF964C :                     RAM_FifoMarsWrt	ds.w 1				; mid-write flag
(1)  122/FFFFFFFFFFFF964E :                     RAM_SysFlags	ds.w 1				; Game engine flags (note: it's a byte)
(1)  123/FFFFFFFFFFFF9650 :                     RAM_MdMarsVInt	ds.w 3				; VBlank jump (JMP xxxx xxxx)
(1)  124/FFFFFFFFFFFF9656 :                     RAM_MdMarsHint	ds.w 3				; HBlank jump (JMP xxxx xxxx)
(1)  125/FFFFFFFFFFFF965C :                     sizeof_mdsys	ds.l 0
(1)  126/FFFFFFFFFFFF965C : (MACRO)             		finish
(1)  126/FFFFFFFFFFFF9000 :                                     !org GLBL_LASTORG
(1)  126/       0 :                                     phase GLBL_LASTPC
(1)  127/       0 :                     
(1)  128/       0 :                     ; ====================================================================
(1)  129/       0 :                     ; ----------------------------------------------------------------
(1)  130/       0 :                     ; Sound 68k RAM
(1)  131/       0 :                     ; ----------------------------------------------------------------
(1)  132/       0 :                     
(1)  133/       0 : (MACRO)             			struct RAM_MdSound
(1)  133/       0 : =$0                 GLBL_LASTPC     set *
(1)  133/       0 :                                     dephase
(1)  133/       0 : =$0                 GLBL_LASTORG    set *
(1)  133/FFFFFFFFFFFF965C :                                     phase RAM_MDSOUND
(1)  134/FFFFFFFFFFFF965C :                     RAM_SoundLastReg	ds.l 4
(1)  135/FFFFFFFFFFFF966C :                     sizeof_mdsnd		ds.l 0
(1)  136/FFFFFFFFFFFF966C : (MACRO)             			finish
(1)  136/FFFFFFFFFFFF965C :                                     !org GLBL_LASTORG
(1)  136/       0 :                                     phase GLBL_LASTPC
(1)  137/       0 :                     		
(1)  138/       0 :                     ; ====================================================================
(1)  139/       0 :                     ; ----------------------------------------------------------------
(1)  140/       0 :                     ; Video RAM
(1)  141/       0 :                     ; ----------------------------------------------------------------
(1)  142/       0 :                     
(1)  143/       0 : (MACRO)             		struct RAM_MdVideo
(1)  143/       0 : =$0                 GLBL_LASTPC     set *
(1)  143/       0 :                                     dephase
(1)  143/       0 : =$0                 GLBL_LASTORG    set *
(1)  143/FFFFFFFFFFFF966C :                                     phase RAM_MDVIDEO
(1)  144/FFFFFFFFFFFF966C :                     RAM_VidPrntVram	ds.w 1		; Default VRAM location for ASCII text used by Video_Print
(1)  145/FFFFFFFFFFFF966E :                     RAM_VidPrntList	ds.w 3*64	; Video_Print list: Address, Type
(1)  146/FFFFFFFFFFFF97EE :                     RAM_VdpRegs	ds.b 24		; VDP Register cache
(1)  147/FFFFFFFFFFFF9806 :                     sizeof_mdvid	ds.l 0
(1)  148/FFFFFFFFFFFF9808 : (MACRO)             		finish
(1)  148/FFFFFFFFFFFF966C :                                     !org GLBL_LASTORG
(1)  148/       0 :                                     phase GLBL_LASTPC
(1)  149/       0 :                     
(1)  150/       0 :                     ; ====================================================================
(1)  151/       0 :                     ; ----------------------------------------------------------------
(1)  152/       0 :                     ; MD RAM
(1)  153/       0 :                     ;
(1)  154/       0 :                     ; NOTE: If using MCD Uses $FFFD00-$FFFDFF, and
(1)  155/       0 :                     ; stack point is $FFFD00
(1)  156/       0 :                     ; ----------------------------------------------------------------
(1)  157/       0 :                     
(1)  158/       0 : (MACRO)             		struct MDRAM_START
(1)  158/       0 : =$0                 GLBL_LASTPC     set *
(1)  158/       0 :                                     dephase
(1)  158/       0 : =$0                 GLBL_LASTORG    set *
(1)  158/FFFFFFFFFFFF8800 :                                     phase MDRAM_START
(1)  168/FFFFFFFFFFFF8800 :                     RAM_ModeBuff	ds.b MAX_MDERAM			; Second pass: sizes are set
(1)  169/FFFFFFFFFFFF9000 :                     RAM_MdSystem	ds.b sizeof_mdsys-RAM_MdSystem
(1)  170/FFFFFFFFFFFF965C :                     RAM_MdSound	ds.b sizeof_mdsnd-RAM_MdSound
(1)  171/FFFFFFFFFFFF966C :                     RAM_MdVideo	ds.b sizeof_mdvid-RAM_MdVideo
(1)  172/FFFFFFFFFFFF9806 :                     RAM_ExRamSub	ds.w $300			; (MANUAL SIZE) DMA routines that set RV=1
(1)  173/FFFFFFFFFFFF9E06 :                     RAM_MdGlobal	ds.b sizeof_mdglbl-RAM_MdGlobal
(1)  174/FFFFFFFFFFFF8830 :                     sizeof_mdram	ds.l 0
(1)  176/FFFFFFFFFFFF8830 :                     
MD RAM ends at: FF8830
(1)  178/FFFFFFFFFFFF8830 :                     		message "MD RAM ends at: \{((sizeof_mdram)&$FFFFFF)}"
(1)  180/FFFFFFFFFFFF8830 : (MACRO)             		finish
(1)  180/FFFFFFFFFFFF8800 :                                     !org GLBL_LASTORG
(1)  180/       0 :                                     phase GLBL_LASTPC
(1)  181/       0 :                     
      10/       0 :                     		include	"system/md/map.asm"	; Genesis hardware map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Genesis / MegaDrive 68k map
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : =$200000            sys_exram	equ	$200000		; External RAM (Ex. Save data)
(1)    7/       0 : =$A00000            z80_cpu		equ	$A00000		; Z80 CPU, size: $2000
(1)    8/       0 : =$A04000            ym_ctrl_1	equ	$A04000		; YM2612 reg 1
(1)    9/       0 : =$A04001            ym_data_1	equ	$A04001		; YM2612 reg 2
(1)   10/       0 : =$A04002            ym_ctrl_2	equ	$A04002		; YM2612 reg 1
(1)   11/       0 : =$A04003            ym_data_2	equ	$A04003		; YM2612 reg 2
(1)   12/       0 : =$A10001            sys_io		equ	$A10001		; bits: OVRSEAS(7)|PAL(6)|DISK(5)|VER(3-0)
(1)   13/       0 : =$A10003            sys_data_1	equ	$A10003		; Port 1 DATA
(1)   14/       0 : =$A10005            sys_data_2	equ	$A10005		; Port 2 DATA
(1)   15/       0 : =$A10007            sys_data_3	equ	$A10007		; Modem DATA
(1)   16/       0 : =$A10009            sys_ctrl_1	equ	$A10009		; Port 1 CTRL
(1)   17/       0 : =$A1000B            sys_ctrl_2	equ	$A1000B		; Port 2 CTRL
(1)   18/       0 : =$A1000D            sys_ctrl_3	equ	$A1000D		; Modem CTRL
(1)   19/       0 : =$A14000            sys_tmss	equ	$A14000		; write "SEGA" here for ver > 0
(1)   20/       0 : =$A11100            z80_bus 	equ	$A11100		; only use bit 0 (bit 8 as WORD)
(1)   21/       0 : =$A11200            z80_reset	equ	$A11200		; WRITE only ($0000 reset/$0100 cancel)
(1)   22/       0 : =$A130EC            md_mars_id	equ	$A130EC		; MARS ID "MARS"
(1)   23/       0 : =$A130F1            md_bank_sram	equ	$A130F1		; Make SRAM visible at $200000
(1)   24/       0 : =$C00000            vdp_data	equ	$C00000		; video data port
(1)   25/       0 : =$C00004            vdp_ctrl	equ	$C00004		; video control port
(1)   26/       0 : =$C00011            psg_ctrl	equ	$C00011		; PSG control
(1)   27/       0 :                     
(1)   28/       0 :                     ; ----------------------------------------------------------------
(1)   29/       0 :                     ; Genesis / Mega drive Z80 map
(1)   30/       0 :                     ; ----------------------------------------------------------------
(1)   31/       0 :                     
(1)   32/       0 : =$4000              zym_ctrl_1	equ	$4000		; YM2612 reg 1
(1)   33/       0 : =$4001              zym_data_1	equ	$4001		; YM2612 reg 2
(1)   34/       0 : =$4002              zym_ctrl_2	equ	$4002		; YM2612 reg 1
(1)   35/       0 : =$4003              zym_data_2	equ	$4003		; YM2612 reg 2
(1)   36/       0 : =$6000              zbank		equ	$6000		; Z80 ROM BANK 24bits %XXXXXXXX X0000000 00000000
(1)   37/       0 : =$7F00              zvdp_data	equ	$7F00		; video data port
(1)   38/       0 : =$7F04              zvdp_ctrl	equ	$7F04		; video control port
(1)   39/       0 : =$7F11              zpsg_ctrl	equ	$7F11		; PSG control
(1)   40/       0 :                     
(1)   41/       0 :                     ; ----------------------------------------------------------------
(1)   42/       0 :                     ; 32X registers
(1)   43/       0 :                     ; ----------------------------------------------------------------
(1)   44/       0 :                     
(1)   45/       0 : =$A130EC            sysmars_ID	equ	$A130EC		; MARS ID "MARS" identifier
(1)   46/       0 : =$A15100            sysmars_reg	equ	$A15100		; MARS 32X registers section, see system/mars/map.asm for variables
(1)   47/       0 :                     
      11/       0 :                     		include	"system/mars/map.asm"	; MARS map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; SH2 MAP
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; --------------------------------------------------------
(1)    7/       0 :                     ; SH2 SIDE MAP
(1)    8/       0 :                     ; --------------------------------------------------------
(1)    9/       0 :                     
(1)   10/       0 : =$0                 CS0		equ	$00000000	; Boot rom & system registers
(1)   11/       0 : =$2000000           CS1		equ	$02000000	; ROM data (all 4MB), Locked if RV=1
(1)   12/       0 : =$4000000           CS2		equ	$04000000	; Framebuffer section
(1)   13/       0 : =$6000000           CS3		equ	$06000000	; SDRAM
(1)   14/       0 : =$20000000          TH		equ	$20000000	; Cache-thru OR|value
(1)   15/       0 : =$20004000          _sysreg		equ	$00004000|TH	; MARS System registers, for MD: sysmars_reg
(1)   16/       0 : =$20004100          _vdpreg		equ	$00004100|TH	; SuperVDP registers
(1)   17/       0 : =$20004200          _palette	equ	$00004200|TH	; Palette RAM for Pixel-Packed or RLE mode
(1)   18/       0 : =$24000000          _framebuffer:	equ	CS2|TH		; Framebuffer, first 240 are the linetable
(1)   19/       0 : =$24020000          _overwrite:	equ	CS2|TH+$20000	; Overwrite, $00-byte writes are ignored
(1)   20/       0 :                     
(1)   21/       0 :                     ; --------------------------------------------------------
(1)   22/       0 :                     ; Variables
(1)   23/       0 :                     ; --------------------------------------------------------
(1)   24/       0 :                     
(1)   25/       0 :                     ; ------------------------------------------------
(1)   26/       0 :                     ; System
(1)   27/       0 :                     ; ------------------------------------------------
(1)   28/       0 :                     
(1)   29/       0 :                     ; _sysreg
(1)   30/       0 : =$0                 adapter		equ	$00		; adapter control register
(1)   31/       0 : =$1                 intmask		equ	$01		; interrupts mask
(1)   32/       0 : =$2                 standby		equ	$02		; CMD interrupt request bit by MD side (slave|master)
(1)   33/       0 : =$5                 hcount		equ	$05		; H Counter
(1)   34/       0 : =$6                 dreqctl		equ	$06		; DREQ control
(1)   35/       0 : =$8                 dreqsource	equ	$08		; DREQ source address
(1)   36/       0 : =$C                 dreqdest	equ	$0C		; DREQ destination address
(1)   37/       0 : =$10                dreqlen		equ	$10		; DREQ length
(1)   38/       0 : =$12                dreqfifo	equ	$12		; DREQ FIFO
(1)   39/       0 : =$14                vresintclr	equ	$14		; VRES interrupt clear (non-zero write)
(1)   40/       0 : =$16                vintclr		equ	$16		; V interrupt clear (non-zero write)
(1)   41/       0 : =$18                hintclr		equ	$18		; H interrupt clear (non-zero write)
(1)   42/       0 : =$1A                cmdintclr	equ	$1a		; CMD interrupt clear (non-zero write)
(1)   43/       0 : =$1C                pwmintclr	equ	$1C		; PWM interrupt clear (non-zero write)
(1)   44/       0 : =$20                comm0		equ	$20		; Communication ports
(1)   45/       0 : =$22                comm2		equ	$22		; (If 2 CPUs either SH2 or 68K writes to
(1)   46/       0 : =$24                comm4		equ	$24		; the same location, it will freeze the
(1)   47/       0 : =$26                comm6		equ	$26		; system)
(1)   48/       0 : =$28                comm8		equ	$28		;
(1)   49/       0 : =$2A                comm10		equ	$2A		;
(1)   50/       0 : =$2C                comm12		equ	$2C		;
(1)   51/       0 : =$2E                comm14		equ	$2E		;
(1)   52/       0 : =$2F                comm15		equ	$2F		;
(1)   53/       0 : =$30                timerctl	equ	$30		; PWM Timer Control
(1)   54/       0 : =$31                pwmctl		equ	$31		; PWM Control
(1)   55/       0 : =$32                cycle		equ	$32		; PWM Cycle
(1)   56/       0 : =$34                lchwidth	equ	$34		; PWM L ch Width
(1)   57/       0 : =$36                rchwidth	equ	$36		; PWM R ch Width
(1)   58/       0 : =$38                monowidth	equ	$38		; PWM Monaural Width
(1)   59/       0 :                     
(1)   60/       0 :                     ; _sysreg
(1)   61/       0 :                     ; adapter
(1)   62/       0 : =$1                 CART		equ	%00000001	; CD or Cartridge
(1)   63/       0 : =$2                 ADEN		equ	%00000010	; MARS Enabled: No/Yes
(1)   64/       0 : =$80                FM		equ	%10000000	; SuperVDP permission: MD or SH
(1)   65/       0 :                     ; framectl
(1)   66/       0 : =$1                 FS		equ	%00000001	; Current framebuffer DRAM pixel data
(1)   67/       0 : =$2                 FEN		equ	%00000010	; Can write to Framebuffer: Yes/No
(1)   68/       0 :                     ; vdpsts
(1)   69/       0 : =$80                VBLK		equ	%10000000	; VBlank bit
(1)   70/       0 : =$40                HBLK		equ	%01000000	; HBlank bit
(1)   71/       0 : =$20                PEN		equ	%00100000	; Can write to Palette: Yes/No
(1)   72/       0 :                     ; intmask
(1)   73/       0 : =$8                 VIRQ_ON		equ	$08		; IRQ masks for IRQ mask register
(1)   74/       0 : =$4                 HIRQ_ON		equ	$04
(1)   75/       0 : =$2                 CMDIRQ_ON	equ	$02
(1)   76/       0 : =$1                 PWMIRQ_ON	equ	$01
(1)   77/       0 :                     
(1)   78/       0 :                     ; _vdpreg
(1)   79/       0 : =$0                 tvmode		equ	$00		; TV mode register
(1)   80/       0 : =$1                 bitmapmd	equ	$01		; Bitmap mode register
(1)   81/       0 : =$3                 shift		equ	$03		; Shift Control register
(1)   82/       0 : =$5                 filllength	equ	$05		; Auto Fill Length register
(1)   83/       0 : =$6                 fillstart	equ	$06		; Auto Fill Start Address register
(1)   84/       0 : =$8                 filldata	equ	$08		; Auto Fill Data register
(1)   85/       0 : =$A                 vdpsts		equ	$0a		; VDP Status register
(1)   86/       0 : =$B                 framectl	equ	$0b		; Frame Buffer Control register
(1)   87/       0 :                     
(1)   88/       0 :                     ; --------------------------------------------------------
(1)   89/       0 :                     ; SH2 Internal registers, independent for each CPU
(1)   90/       0 :                     ; --------------------------------------------------------
(1)   91/       0 :                     
(1)   92/       0 :                     ; DMA Channel 0: General data transfer
(1)   93/       0 :                     ; DMA Channel 1: PWM exclusive
(1)   94/       0 : =$FFFFFE00          _SERIAL		equ	$FFFFFE00	; Serial Control
(1)   95/       0 : =$FFFFFE10          _FRT		equ	$FFFFFE10	; Free run timer
(1)   96/       0 : =$0                 _TIER		equ	$00		; Timer interrupt enable register
(1)   97/       0 : =$1                 _TCSR		equ	$01		; Timer control & status register
(1)   98/       0 : =$2                 _FRC_H		equ	$02		; free running counter High
(1)   99/       0 : =$3                 _FRC_L		equ	$03		; free running counter Low
(1)  100/       0 : =$4                 _OCR_H		equ	$04		; Output compare register High
(1)  101/       0 : =$5                 _OCR_L		equ	$05		; Output compare register Low
(1)  102/       0 : =$6                 _TCR		equ	$06		; Timer control register
(1)  103/       0 : =$7                 _TOCR		equ	$07		; timer output compare control register
(1)  104/       0 : =$FFFFFE92          _CCR:		equ	$FFFFFE92
(1)  105/       0 : =$FFFFFF00          _JR		equ	$FFFFFF00	; DIVU (--- / val)
(1)  106/       0 : =$FFFFFF04          _HRL32		equ	$FFFFFF04	; DIVU (val / ---) or LOW Result if read
(1)  107/       0 : =$FFFFFF10          _HRH		equ	$FFFFFF10	; DIVU Result, HIGH
(1)  108/       0 : =$FFFFFF14          _HRL		equ	$FFFFFF14	; DIVU Result, LOW
(1)  109/       0 : =$FFFFFF80          _DMASOURCE0	equ	$FFFFFF80	; DMA source address 0
(1)  110/       0 : =$FFFFFF84          _DMADEST0	equ	$FFFFFF84	; DMA destination address 0
(1)  111/       0 : =$FFFFFF88          _DMACOUNT0	equ	$FFFFFF88	; DMA transfer count 0
(1)  112/       0 : =$FFFFFF8C          _DMACHANNEL0	equ	$FFFFFF8C	; DMA channel control 0
(1)  113/       0 : =$FFFFFF90          _DMASOURCE1	equ	$FFFFFF90	; DMA source address 1
(1)  114/       0 : =$FFFFFF94          _DMADEST1	equ	$FFFFFF94	; DMA destination address 1
(1)  115/       0 : =$FFFFFF98          _DMACOUNT1	equ	$FFFFFF98	; DMA transfer count 1
(1)  116/       0 : =$FFFFFF9C          _DMACHANNEL1	equ	$FFFFFF9C	; DMA channel control 1
(1)  117/       0 : =$FFFFFFA0          _DMAVECTORN0	equ	$FFFFFFA0	; DMA vector number N0
(1)  118/       0 : =$FFFFFFA4          _DMAVECTORE0	equ	$FFFFFFA4	; DMA vector number E0
(1)  119/       0 : =$FFFFFFA8          _DMAVECTORN1	equ	$FFFFFFA8	; DMA vector number N1
(1)  120/       0 : =$FFFFFFAC          _DMAVECTORE1	equ	$FFFFFFAC	; DMA vector number E1
(1)  121/       0 : =$FFFFFFB0          _DMAOPERATION	equ	$FFFFFFB0	; DMA operation
(1)  122/       0 : =$FFFFFFB4          _DMAREQACK0	equ	$FFFFFFB4	; DMA request/ack select control 0
(1)  123/       0 : =$FFFFFFB8          _DMAREQACK1	equ	$FFFFFFB8	; DMA request/ack select control 1
(1)  124/       0 :                     
      12/       0 :                     		
      13/       0 :                     ; ====================================================================
      14/       0 :                     ; ----------------------------------------------------------------
      15/       0 :                     ; Header
      16/       0 :                     ; ----------------------------------------------------------------
      17/       0 :                     
      18/       0 :                     		include	"system/head.asm"	; Header, contains 32X specific setup
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; ROM HEADER FOR 32X
(1)    4/       0 :                     ; 
(1)    5/       0 :                     ; These labels work even if the 32X isn't present
(1)    6/       0 :                     ; ----------------------------------------------------------------
(1)    7/       0 :                     
(1)    8/       0 : 0000 0000           		dc.l 0				; Stack point
(1)    9/       4 : 0000 03F0           		dc.l $3F0			; Entry point (always $3F0)
(1)   10/       8 : 0000 0930           		dc.l MD_ErrBus			; Bus error
(1)   11/       C : 0000 0930           		dc.l MD_ErrAddr			; Address error
(1)   12/      10 : 0000 0930           		dc.l MD_ErrIll			; ILLEGAL Instruction
(1)   13/      14 : 0000 0930           		dc.l MD_ErrZDiv			; Divide by 0
(1)   14/      18 : 0000 0930           		dc.l MD_ErrChk			; CHK Instruction
(1)   15/      1C : 0000 0930           		dc.l MD_ErrTrapV		; TRAPV Instruction
(1)   16/      20 : 0000 0930           		dc.l MD_ErrPrivl		; Privilege violation
(1)   17/      24 : 0000 0930           		dc.l MD_Trace			; Trace
(1)   18/      28 : 0000 0930           		dc.l MD_Line1010		; Line 1010 Emulator
(1)   19/      2C : 0000 0930           		dc.l MD_Line1111		; Line 1111 Emulator
(1)   20/      30 : 0000 0930           		dc.l MD_ErrorEx			; Error exception
(1)   21/      34 : 0000 0930           		dc.l MD_ErrorEx
(1)   22/      38 : 0000 0930           		dc.l MD_ErrorEx
(1)   23/      3C : 0000 0930           		dc.l MD_ErrorEx
(1)   24/      40 : 0000 0930           		dc.l MD_ErrorEx	
(1)   25/      44 : 0000 0930           		dc.l MD_ErrorEx
(1)   26/      48 : 0000 0930           		dc.l MD_ErrorEx
(1)   27/      4C : 0000 0930           		dc.l MD_ErrorEx
(1)   28/      50 : 0000 0930           		dc.l MD_ErrorEx
(1)   29/      54 : 0000 0930           		dc.l MD_ErrorEx
(1)   30/      58 : 0000 0930           		dc.l MD_ErrorEx
(1)   31/      5C : 0000 0930           		dc.l MD_ErrorEx
(1)   32/      60 : 0000 0930           		dc.l MD_ErrorEx		
(1)   33/      64 : 0000 0930           		dc.l MD_ErrorTrap
(1)   34/      68 : 0000 0930           		dc.l MD_ErrorTrap
(1)   35/      6C : 0000 0930           		dc.l MD_ErrorTrap
(1)   36/      70 : FFFF 9656           		dc.l RAM_MdMarsHInt		; RAM jump for HBlank (JMP xxxx xxxx)
(1)   37/      74 : 0000 0930           		dc.l MD_ErrorTrap
(1)   38/      78 : FFFF 9650           		dc.l RAM_MdMarsVInt		; RAM jump for VBlank (JMP xxxx xxxx)
(1)   39/      7C : 0000 0930           		dc.l MD_ErrorTrap
(1)   40/      80 : 0000 0930           		dc.l MD_ErrorTrap
(1)   41/      84 : 0000 0930           		dc.l MD_ErrorTrap
(1)   42/      88 : 0000 0930           		dc.l MD_ErrorTrap
(1)   43/      8C : 0000 0930           		dc.l MD_ErrorTrap
(1)   44/      90 : 0000 0930           		dc.l MD_ErrorTrap
(1)   45/      94 : 0000 0930           		dc.l MD_ErrorTrap
(1)   46/      98 : 0000 0930           		dc.l MD_ErrorTrap
(1)   47/      9C : 0000 0930           		dc.l MD_ErrorTrap
(1)   48/      A0 : 0000 0930           		dc.l MD_ErrorTrap
(1)   49/      A4 : 0000 0930           		dc.l MD_ErrorTrap
(1)   50/      A8 : 0000 0930           		dc.l MD_ErrorTrap
(1)   51/      AC : 0000 0930           		dc.l MD_ErrorTrap
(1)   52/      B0 : 0000 0930           		dc.l MD_ErrorTrap
(1)   53/      B4 : 0000 0930           		dc.l MD_ErrorTrap
(1)   54/      B8 : 0000 0930           		dc.l MD_ErrorTrap
(1)   55/      BC : 0000 0930           		dc.l MD_ErrorTrap
(1)   56/      C0 : 0000 0930           		dc.l MD_ErrorTrap
(1)   57/      C4 : 0000 0930           		dc.l MD_ErrorTrap
(1)   58/      C8 : 0000 0930           		dc.l MD_ErrorTrap
(1)   59/      CC : 0000 0930           		dc.l MD_ErrorTrap
(1)   60/      D0 : 0000 0930           		dc.l MD_ErrorTrap
(1)   61/      D4 : 0000 0930           		dc.l MD_ErrorTrap
(1)   62/      D8 : 0000 0930           		dc.l MD_ErrorTrap
(1)   63/      DC : 0000 0930           		dc.l MD_ErrorTrap
(1)   64/      E0 : 0000 0930           		dc.l MD_ErrorTrap
(1)   65/      E4 : 0000 0930           		dc.l MD_ErrorTrap
(1)   66/      E8 : 0000 0930           		dc.l MD_ErrorTrap
(1)   67/      EC : 0000 0930           		dc.l MD_ErrorTrap
(1)   68/      F0 : 0000 0930           		dc.l MD_ErrorTrap
(1)   69/      F4 : 0000 0930           		dc.l MD_ErrorTrap
(1)   70/      F8 : 0000 0930           		dc.l MD_ErrorTrap
(1)   71/      FC : 0000 0930           		dc.l MD_ErrorTrap
(1)   72/     100 : 5345 4741 2033 3258 		dc.b "SEGA 32X        "
                    2020 2020 2020 2020 
(1)   73/     110 : 2843 2947 4636 3420 		dc.b "(C)GF64 2021.???"
                    3230 3231 2E3F 3F3F 
(1)   74/     120 : 5072 6F79 6563 746F 		dc.b "Proyecto Chirinx                                "
                    2043 6869 7269 6E78 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
(1)   75/     150 : 5072 6F6A 6563 7420 		dc.b "Project Shinrinx                                "
                    5368 696E 7269 6E78 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
(1)   76/     180 : 474D 2048 4F4D 4542 		dc.b "GM HOMEBREW-00"
                    5245 572D 3030      
(1)   77/     18E : 0000                		dc.w 0
(1)   78/     190 : 4A36 2020 2020 2020 		dc.b "J6              "
                    2020 2020 2020 2020 
(1)   79/     1A0 : 0000 0000           		dc.l 0
(1)   80/     1A4 : 0014 000C           		dc.l ROM_END
(1)   81/     1A8 : 00FF 0000           		dc.l $FF0000
(1)   82/     1AC : 00FF FFFF           		dc.l $FFFFFF
(1)   83/     1B0 : 2020 2020           		dc.l $20202020		; dc.b "RA",$F8,$20
(1)   84/     1B4 : 2020 2020           		dc.l $20202020		; $200000
(1)   85/     1B8 : 2020 2020           		dc.l $20202020		; $203FFF
(1)   86/     1BC :                     		align $1F0
(1)   87/     1F0 : 5520 2020 2020 2020 		dc.b "U               "
                    2020 2020 2020 2020 
(1)   88/     200 :                     
(1)   89/     200 :                     ; ====================================================================
(1)   90/     200 :                     ; ----------------------------------------------------------------
(1)   91/     200 :                     ; Second header for 32X
(1)   92/     200 :                     ; 
(1)   93/     200 :                     ; These new jumps are for the 68K if the 32X is currently
(1)   94/     200 :                     ; active.
(1)   95/     200 :                     ; ----------------------------------------------------------------
(1)   96/     200 :                     
(1)   97/     200 : 4EF9 0088 0800      		jmp	($880000|MARS_Entry).l
(1)   98/     206 : 4EF9 0088 0930      		jmp	($880000|MD_ErrBus).l			; Bus error
(1)   99/     20C : 4EF9 0088 0930      		jmp	($880000|MD_ErrAddr).l			; Address error
(1)  100/     212 : 4EF9 0088 0930      		jmp	($880000|MD_ErrIll).l			; ILLEGAL Instruction
(1)  101/     218 : 4EF9 0088 0930      		jmp	($880000|MD_ErrZDiv).l			; Divide by 0
(1)  102/     21E : 4EF9 0088 0930      		jmp	($880000|MD_ErrChk).l			; CHK Instruction
(1)  103/     224 : 4EF9 0088 0930      		jmp	($880000|MD_ErrTrapV).l			; TRAPV Instruction
(1)  104/     22A : 4EF9 0088 0930      		jmp	($880000|MD_ErrPrivl).l			; Privilege violation
(1)  105/     230 : 4EF9 0088 0930      		jmp	($880000|MD_Trace).l			; Trace
(1)  106/     236 : 4EF9 0088 0930      		jmp	($880000|MD_Line1010).l			; Line 1010 Emulator
(1)  107/     23C : 4EF9 0088 0930      		jmp	($880000|MD_Line1111).l			; Line 1111 Emulator
(1)  108/     242 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l			; Error exception
(1)  109/     248 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l
(1)  110/     24E : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l
(1)  111/     254 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l
(1)  112/     25A : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l	
(1)  113/     260 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l
(1)  114/     266 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l
(1)  115/     26C : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l
(1)  116/     272 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l
(1)  117/     278 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l
(1)  118/     27E : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l
(1)  119/     284 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l
(1)  120/     28A : 4EF9 0088 0930      		jmp	($880000|MD_ErrorEx).l		
(1)  121/     290 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  122/     296 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  123/     29C : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  124/     2A2 : 4EF9 FFFF 9656      		jmp	(RAM_MdMarsHInt).l			; RAM jump for HBlank (JMP xxxx xxxx)
(1)  125/     2A8 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  126/     2AE : 4EF9 FFFF 9650      		jmp	(RAM_MdMarsVInt).l			; RAM jump for VBlank (JMP xxxx xxxx)
(1)  127/     2B4 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  128/     2BA : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  129/     2C0 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  130/     2C6 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  131/     2CC : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  132/     2D2 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  133/     2D8 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  134/     2DE : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  135/     2E4 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  136/     2EA : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  137/     2F0 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  138/     2F6 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  139/     2FC : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  140/     302 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  141/     308 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  142/     30E : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  143/     314 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  144/     31A : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  145/     320 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  146/     326 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  147/     32C : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  148/     332 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  149/     338 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  150/     33E : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  151/     344 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  152/     34A : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  153/     350 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  154/     356 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  155/     35C : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  156/     362 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  157/     368 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  158/     36E : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  159/     374 : 4EF9 0088 0930      		jmp	($880000|MD_ErrorTrap).l
(1)  160/     37A :                     
(1)  161/     37A :                     ; ----------------------------------------------------------------
(1)  162/     37A :                     
(1)  163/     37A :                     		align $3C0
(1)  164/     3C0 : 4D41 5253 2043 4845 		dc.b "MARS CHECK MODE "			; Module name
                    434B 204D 4F44 4520 
(1)  165/     3D0 : 0000 0000           		dc.l 0					; Version (always 0)
(1)  166/     3D4 : 0000 3C68           		dc.l MARS_RAMDATA			; Set to 0 if SH2 code points to ROM
(1)  167/     3D8 : 0000 0000           		dc.l 0					; No info, set to zero.
(1)  168/     3DC : 0001 1508           		dc.l MARS_RAMDATA_e-MARS_RAMDATA	; Set to 4 if SH2 code points to ROM
(1)  169/     3E0 : 0600 176C           		dc.l SH2_M_Entry			; Master SH2 PC (SH2 map area)
(1)  170/     3E4 : 0600 1920           		dc.l SH2_S_Entry			; Slave SH2 PC (SH2 map area)
(1)  171/     3E8 : 0600 0000           		dc.l SH2_Master				; Master SH2 default VBR (Vector table)
(1)  172/     3EC : 0600 0124           		dc.l SH2_Slave				; Slave SH2 default VBR (Vector table)
(1)  173/     3F0 :                     		binclude "system/mars/data/security.bin"
(1)  174/     800 :                     
(1)  175/     800 :                     ; ====================================================================
(1)  176/     800 :                     ; ----------------------------------------------------------------
(1)  177/     800 :                     ; Entry point, this must be located at $3F0
(1)  178/     800 :                     ; 
(1)  179/     800 :                     ; After the 32X's internal initialization finishes,
(1)  180/     800 :                     ; It returns the following stuff:
(1)  181/     800 :                     ; 
(1)  182/     800 :                     ; d0: %h0000000 rsc000ti
(1)  183/     800 :                     ; 	h - Cold start / Hot Start
(1)  184/     800 :                     ; 	r - SDRAM Self Check pass or error
(1)  185/     800 :                     ; 	s - Security check pass or error
(1)  186/     800 :                     ; 	c - Checksum pass or error
(1)  187/     800 :                     ; 	t - TV mode pass or error
(1)  188/     800 :                     ; 	i - MARS ID pass or error
(1)  189/     800 :                     ; 
(1)  190/     800 :                     ; d1: %m0000000 jdk0vvv
(1)  191/     800 :                     ; 	m - MARS TV mode
(1)  192/     800 :                     ; 	j - Country: Japan / Overseas
(1)  193/     800 :                     ; 	d - MD TV mode
(1)  194/     800 :                     ; 	k - DISK connected: Yes / No
(1)  195/     800 :                     ; 	v - Version
(1)  196/     800 :                     ; 
(1)  197/     800 :                     ; Carry flag: "MARS ID" and Self Check result
(1)  198/     800 :                     ; 	cc: Test passed
(1)  199/     800 :                     ; 	cs: Test failed
(1)  200/     800 :                     ; ----------------------------------------------------------------
(1)  201/     800 :                     
(1)  202/     800 :                     MARS_Entry:
(1)  203/     800 : 6500 0116           		bcs	.no_mars			; if Carry set, 32X is not present
(1)  204/     804 : 23FC 0000 0000 FFFF 		move.l	#0,(RAM_initflug).l		; Reset "INIT" flag
                    9644                
(1)  205/     80E : 0800 000F           		btst	#15,d0				; Soft reset?	
(1)  206/     812 : 676C                		beq.s	.init
(1)  207/     814 : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5		; a5 - MARS register
(1)  208/     81A : 0815 0000           		btst.b	#0,adapter(a5)			; 32X enabled?
(1)  209/     81E : 6652                		bne	.adapterenable			; If yes, start booting
(1)  210/     820 : 2B7C 0000 0000 0028 		move.l	#0,comm8(a5)			; If not, we can't use 32X or something went wrong
(1)  211/     828 : 41FA 0020           		lea	.ramcode(pc),a0			; Copy the adapter-retry code to RAM
(1)  212/     82C : 43F9 00FF 0000      		lea	($FF0000).l,a1			; and jump there.
(1)  213/     832 : 22D8                		move.l	(a0)+,(a1)+
(1)  214/     834 : 22D8                		move.l	(a0)+,(a1)+
(1)  215/     836 : 22D8                		move.l	(a0)+,(a1)+
(1)  216/     838 : 22D8                		move.l	(a0)+,(a1)+
(1)  217/     83A : 22D8                		move.l	(a0)+,(a1)+
(1)  218/     83C : 22D8                		move.l	(a0)+,(a1)+
(1)  219/     83E : 22D8                		move.l	(a0)+,(a1)+
(1)  220/     840 : 22D8                		move.l	(a0)+,(a1)+
(1)  221/     842 : 41F9 00FF 0000      		lea	($FF0000).l,a0
(1)  222/     848 : 4ED0                		jmp	(a0)
(1)  223/     84A :                     .ramcode:
(1)  224/     84A : 1ABC 0001           		move.b	#1,adapter(a5)			; Enable adapter.
(1)  225/     84E : 41FA 000A           		lea	.restarticd(pc),a0		; JUMP to the following code in
(1)  226/     852 : D1FC 0088 0000      		adda.l	#$880000,a0			; the new 68k location
(1)  227/     858 : 4ED0                		jmp	(a0)
(1)  228/     85A :                     .restarticd:
(1)  229/     85A : 4BF9 00A1 0000      		lea	($A10000).l,a5			; a5 - MD's I/O area base
(1)  230/     860 : 287C FFFF FFC0      		move.l	#-64,a4				; a4 - $FFFFFF9C
(1)  231/     866 : 3E3C 0F3C           		move.w	#3900,d7			; d7 - loop this many times
(1)  232/     86A : 43F9 0088 06E4      		lea	($880000+$6E4),a1		; Jump to ?res_wait (check ICD_MARS.PRG for detail)
(1)  233/     870 : 4ED1                		jmp	(a1)
(1)  234/     872 :                     .adapterenable:
(1)  235/     872 : 4BF9 00A1 5100      		lea	(sysmars_reg),a5
(1)  236/     878 : 0815 0001           		btst.b	#1,adapter(a5)			; SH2 Reset request?
(1)  237/     87C : 6640                		bne.s	.hotstart			; If not, we are on hotstart
(1)  238/     87E : 60DA                		bra.s	.restarticd
(1)  239/     880 :                     
(1)  240/     880 :                     ; ------------------------------------------------
(1)  241/     880 :                     ; Init
(1)  242/     880 :                     ; ------------------------------------------------
(1)  243/     880 :                     
(1)  244/     880 :                     .init:
(1)  245/     880 : 46FC 2700           		move.w	#$2700,sr			; Disable interrupts
(1)  246/     884 : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5
(1)  247/     88A : 2B7C 3638 5550 002C 		move.l	#"68UP",comm12(a5)		; comm12: Report to every CPU we are active.
(1)  248/     892 : 0CAD 4D5F 4F4B 0020 .wm:		cmp.l	#"M_OK",comm0(a5)		; SH2 Master active?
(1)  249/     89A : 66F6                		bne.s	.wm
(1)  250/     89C : 0CAD 535F 4F4B 0024 .ws:		cmp.l	#"S_OK",comm4(a5)		; SH2 Slave active?
(1)  251/     8A4 : 66F6                		bne.s	.ws
(1)  252/     8A6 : 7000                		moveq	#0,d0				; Reset comm values
(1)  253/     8A8 : 2B40 0020           		move.l	d0,comm0(a5)
(1)  254/     8AC : 2B40 0024           		move.l	d0,comm4(a5)
(1)  255/     8B0 : 2B40 002C           		move.l	d0,comm12(a5)
(1)  256/     8B4 : 23FC 494E 4954 FFFF 		move.l	#"INIT",(RAM_initflug).l	; Set "INIT" as our boot flag
                    9644                
(1)  257/     8BE :                     .hotstart:
(1)  258/     8BE : 0CB9 494E 4954 FFFF 		cmp.l	#"INIT",(RAM_initflug).l	; Did it write?
                    9644                
(1)  259/     8C8 : 66B6                		bne.s	.init				; If not, restart everything and try again.
(1)  260/     8CA :                     		
(1)  261/     8CA :                     	; Initialize Genesis
(1)  262/     8CA : 7000                		moveq	#0,d0				; Clear USP
(1)  263/     8CC : 2C40                		movea.l	d0,a6
(1)  264/     8CE : 4E66                		move.l	a6,usp
(1)  265/     8D0 : 3039 00C0 0004      .waitframe:	move.w	(vdp_ctrl).l,d0			; Wait a frame
(1)  266/     8D6 : 0800 0003           		btst	#bitVint,d0
(1)  267/     8DA : 67F4                		beq.s	.waitframe
(1)  268/     8DC : 23FC 8004 8144 00C0 		move.l	#$80048144,(vdp_ctrl).l		; Keep display
                    0004                
(1)  269/     8E6 : 41F9 00FF 0000      		lea	($FF0000),a0			; Clear RAM until $FFFF00
(1)  270/     8EC : 303C 3BFF           		move.w	#($F000/4)-1,d0
(1)  271/     8F0 :                     .clrram:
(1)  272/     8F0 : 4298                		clr.l	(a0)+
(1)  273/     8F2 : 51C8 FFFC           		dbf	d0,.clrram
(1)  274/     8F6 : 4CF9 7FFF 00FF 0000 		movem.l	($FF0000),d0-a6			; Clear registers (using zeros from RAM)
(1)  275/     8FE : 41FA 0032           		lea	Engine_Code(pc),a0		; Now copy ALL our 68k code to RAM, to prevent
(1)  276/     902 : 43F9 00FF 0000      		lea	($FF0000),a1			; BUS-fighthing the ROM area (speed-up purposes)
(1)  277/     908 : 303C 37CF           		move.w	#Engine_Code_end-Engine_Code/2,d0
(1)  278/     90C :                     .copyme:
(1)  279/     90C : 32D8                		move.w	(a0)+,(a1)+
(1)  280/     90E : 51C8 FFFC           		dbf	d0,.copyme
(1)  281/     912 : 4EF9 00FF 2E3E      		jmp	(MD_Main).l			; MD_Main located in ram
(1)  282/     918 :                     
(1)  283/     918 :                     ; ====================================================================
(1)  284/     918 :                     ; ----------------------------------------------------------------
(1)  285/     918 :                     ; If 32X is not detected... 
(1)  286/     918 :                     ; 
(1)  287/     918 :                     ; This only works in emulators, though.
(1)  288/     918 :                     ; ----------------------------------------------------------------
(1)  289/     918 :                     
(1)  290/     918 :                     .no_mars:
(1)  291/     918 : 46FC 2700           		move.w	#$2700,sr			; Disable interrupts
(1)  292/     91C : 23FC C000 0000 00C0 		move.l	#$C0000000,(vdp_ctrl).l		; VDP: Point to Color 0
                    0004                
(1)  293/     926 : 33FC 0E00 00C0 0000 		move.w	#$0E00,(vdp_data).l		; Write blue
(1)  294/     92E : 60FE                		bra.s	*				; Infinite loop.
(1)  295/     930 :                     
(1)  296/     930 :                     ; ====================================================================
(1)  297/     930 :                     ; ----------------------------------------------------------------
(1)  298/     930 :                     ; Error traps
(1)  299/     930 :                     ; ----------------------------------------------------------------
(1)  300/     930 :                     
(1)  301/     930 :                     MD_ErrBus:		; Bus error
(1)  302/     930 :                     MD_ErrAddr:		; Address error
(1)  303/     930 :                     MD_ErrIll:		; ILLEGAL Instruction
(1)  304/     930 :                     MD_ErrZDiv:		; Divide by 0
(1)  305/     930 :                     MD_ErrChk:		; CHK Instruction
(1)  306/     930 :                     MD_ErrTrapV:		; TRAPV Instruction
(1)  307/     930 :                     MD_ErrPrivl:		; Privilege violation
(1)  308/     930 :                     MD_Trace:		; Trace
(1)  309/     930 :                     MD_Line1010:		; Line 1010 Emulator
(1)  310/     930 :                     MD_Line1111:		; Line 1111 Emulator
(1)  311/     930 :                     MD_ErrorEx:		; Error exception
(1)  312/     930 :                     MD_ErrorTrap:
(1)  313/     930 : 4E73                		rte
(1)  314/     932 :                     
      19/     932 :                     
      20/     932 :                     ; ====================================================================
      21/     932 :                     ; ----------------------------------------------------------------
      22/     932 :                     ; 68K CODE Section
      23/     932 :                     ; 
      24/     932 :                     ; Stored on RAM to prevent BUS fighting (Kolibri-style)
      25/     932 :                     ; ----------------------------------------------------------------
      26/     932 :                     
      27/     932 :                     Engine_Code:
      28/  FF0000 :                     		phase $FF0000
      29/  FF0000 :                     ; --------------------------------------------------------
      30/  FF0000 :                     ; Include system features
      31/  FF0000 :                     ; --------------------------------------------------------
      32/  FF0000 :                     
      33/  FF0000 :                     		include	"system/md/system.asm"
(1)    1/  FF0000 :                     ; ====================================================================
(1)    2/  FF0000 :                     ; ----------------------------------------------------------------
(1)    3/  FF0000 :                     ; System
(1)    4/  FF0000 :                     ; ----------------------------------------------------------------
(1)    5/  FF0000 :                     
(1)    6/  FF0000 :                     ; --------------------------------------------------------
(1)    7/  FF0000 :                     ; Init System
(1)    8/  FF0000 :                     ; 
(1)    9/  FF0000 :                     ; Uses:
(1)   10/  FF0000 :                     ; a0-a2,d0-d1
(1)   11/  FF0000 :                     ; --------------------------------------------------------
(1)   12/  FF0000 :                     
(1)   13/  FF0000 :                     System_Init:
(1)   14/  FF0000 : 46FC 2700           		move.w	#$2700,sr		; Disable interrupts
(1)   15/  FF0004 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l	; Stop Z80
(1)   16/  FF000C :                     .wait:
(1)   17/  FF000C : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l		; Wait for it
(1)   18/  FF0014 : 66F6                		bne.s	.wait
(1)   19/  FF0016 : 7040                		moveq	#%01000000,d0		; Init ports, TH=1
(1)   20/  FF0018 : 13C0 00A1 0009      		move.b	d0,(sys_ctrl_1).l	; Controller 1
(1)   21/  FF001E : 13C0 00A1 000B      		move.b	d0,(sys_ctrl_2).l	; Controller 2
(1)   22/  FF0024 : 13C0 00A1 000D      		move.b	d0,(sys_ctrl_3).l	; Modem
(1)   23/  FF002A : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l		; Enable Z80
(1)   24/  FF0032 : 41F8 9000           		lea	(RAM_InputData),a0	; Clear input data buffer
(1)   25/  FF0036 : 323C 0006           		move.w	#sizeof_input-1/2,d1
(1)   26/  FF003A : 7000                		moveq	#0,d0
(1)   27/  FF003C :                     .clrinput:
(1)   28/  FF003C : 30FC 0000           		move.w	#0,(a0)+
(1)   29/  FF0040 : 51C9 FFFA           		dbf	d1,.clrinput
(1)   30/  FF0044 : 303C 4EF9           		move.w	#$4EF9,d0		; Set JMP opcode for the Hblank/VBlank jumps
(1)   31/  FF0048 : 33C0 FFFF 9650       		move.w	d0,(RAM_MdMarsVInt).l
(1)   32/  FF004E : 33C0 FFFF 9656      		move.w	d0,(RAM_MdMarsHInt).l
(1)   33/  FF0054 : 203C 5625 5769      		move.l	#$56255769,d0		; Set these random values
(1)   34/  FF005A : 223C 9511 6102      		move.l	#$95116102,d1
(1)   35/  FF0060 : 23C0 FFFF 963C      		move.l	d0,(RAM_SysRandVal).l
(1)   36/  FF0066 : 23C1 FFFF 9640      		move.l	d1,(RAM_SysRandSeed).l
(1)   37/  FF006C : 203C 00FF 0350      		move.l	#VInt_Default,d0	; Set default ints
(1)   38/  FF0072 : 223C 00FF 0368      		move.l	#Hint_Default,d1
(1)   39/  FF0078 : 6100 0140           		bsr	System_SetInts
(1)   40/  FF007C : 46FC 2000           		move.w	#$2000,sr		; Enable interrupts
(1)   41/  FF0080 : 4E75                		rts
(1)   42/  FF0082 :                     ; 		bra	System_SaveInit
(1)   43/  FF0082 :                     
(1)   44/  FF0082 :                     ; ====================================================================
(1)   45/  FF0082 :                     ; --------------------------------------------------------
(1)   46/  FF0082 :                     ; System_Input (VBLANK ONLY)
(1)   47/  FF0082 :                     ; 
(1)   48/  FF0082 :                     ; Uses:
(1)   49/  FF0082 :                     ; d4-d6,a4-a5
(1)   50/  FF0082 :                     ; --------------------------------------------------------
(1)   51/  FF0082 :                     
(1)   52/  FF0082 :                     ; TODO: check if it still required to turn OFF the Z80
(1)   53/  FF0082 :                     ; while reading input... It works fine on hardware though.
(1)   54/  FF0082 :                     
(1)   55/  FF0082 :                     System_Input:
(1)   56/  FF0082 :                     ; 		move.w	#$0100,(z80_bus).l	; Stop Z80
(1)   57/  FF0082 :                     .wait:
(1)   58/  FF0082 :                     ; 		btst	#0,(z80_bus).l		; Wait for it
(1)   59/  FF0082 :                     ; 		bne.s	.wait
(1)   60/  FF0082 : 49F9 00A1 0003      		lea	($A10003),a4
(1)   61/  FF0088 : 4BF8 9000           		lea	(RAM_InputData),a5
(1)   62/  FF008C : 6108                		bsr.s	.this_one
(1)   63/  FF008E : D8FC 0002           		adda	#2,a4
(1)   64/  FF0092 : DAFC 0006           		adda	#sizeof_input,a5
(1)   65/  FF0096 :                     ; 		bsr.s	.this_one
(1)   66/  FF0096 :                     ; 		move.w	#0,(z80_bus).l
(1)   67/  FF0096 :                     ; 		rts
(1)   68/  FF0096 :                     
(1)   69/  FF0096 :                     ; --------------------------------------------------------	
(1)   70/  FF0096 :                     ; Read port
(1)   71/  FF0096 :                     ; 
(1)   72/  FF0096 :                     ; a4 - Current port
(1)   73/  FF0096 :                     ; a5 - Output data
(1)   74/  FF0096 :                     ; --------------------------------------------------------
(1)   75/  FF0096 :                     
(1)   76/  FF0096 :                     .this_one:
(1)   77/  FF0096 : 6100 00D4           		bsr	.pick_id
(1)   78/  FF009A : 1A84                		move.b	d4,pad_id(a5)
(1)   79/  FF009C : B87C 000F           		cmp.w	#$F,d4
(1)   80/  FF00A0 : 670E                		beq.s	.exit
(1)   81/  FF00A2 : C87C 000F           		and.w	#$F,d4
(1)   82/  FF00A6 : D844                		add.w	d4,d4
(1)   83/  FF00A8 : 3A3B 400C           		move.w	.list(pc,d4.w),d5
(1)   84/  FF00AC : 4EFB 5008           		jmp	.list(pc,d5.w)
(1)   85/  FF00B0 :                     .exit:
(1)   86/  FF00B0 : 422D 0001           		clr.b	pad_ver(a5)
(1)   87/  FF00B4 : 4E75                		rts
(1)   88/  FF00B6 :                     
(1)   89/  FF00B6 :                     ; --------------------------------------------------------
(1)   90/  FF00B6 :                     ; Grab ID
(1)   91/  FF00B6 :                     ; --------------------------------------------------------
(1)   92/  FF00B6 :                     
(1)   93/  FF00B6 : FFFA                .list:		dc.w .exit-.list	; $0
(1)   94/  FF00B8 : FFFA                		dc.w .exit-.list
(1)   95/  FF00BA : FFFA                		dc.w .exit-.list
(1)   96/  FF00BC : FFFA                		dc.w .exit-.list
(1)   97/  FF00BE : FFFA                		dc.w .exit-.list	; $4
(1)   98/  FF00C0 : FFFA                		dc.w .exit-.list
(1)   99/  FF00C2 : FFFA                		dc.w .exit-.list
(1)  100/  FF00C4 : FFFA                		dc.w .exit-.list
(1)  101/  FF00C6 : FFFA                		dc.w .exit-.list	; $8
(1)  102/  FF00C8 : FFFA                		dc.w .exit-.list
(1)  103/  FF00CA : FFFA                		dc.w .exit-.list
(1)  104/  FF00CC : FFFA                		dc.w .exit-.list
(1)  105/  FF00CE : FFFA                		dc.w .exit-.list	; $C
(1)  106/  FF00D0 : 0020                		dc.w .id_0D-.list
(1)  107/  FF00D2 : FFFA                		dc.w .exit-.list
(1)  108/  FF00D4 : FFFA                		dc.w .exit-.list
(1)  109/  FF00D6 :                     
(1)  110/  FF00D6 :                     ; --------------------------------------------------------
(1)  111/  FF00D6 :                     ; ID $0D
(1)  112/  FF00D6 :                     ; 
(1)  113/  FF00D6 :                     ; Normal controller, Old or New
(1)  114/  FF00D6 :                     ; --------------------------------------------------------
(1)  115/  FF00D6 :                     
(1)  116/  FF00D6 :                     .id_0D:
(1)  117/  FF00D6 : 18BC 0040           		move.b	#$40,(a4)	; Show CB|RLDU
(1)  118/  FF00DA : 4E71                		nop
(1)  119/  FF00DC : 4E71                		nop
(1)  120/  FF00DE : 18BC 0000           		move.b	#$00,(a4)	; Show SA|RLDU
(1)  121/  FF00E2 : 4E71                		nop
(1)  122/  FF00E4 : 4E71                		nop
(1)  123/  FF00E6 : 18BC 0040           		move.b	#$40,(a4)	; Show CB|RLDU
(1)  124/  FF00EA : 4E71                		nop
(1)  125/  FF00EC : 4E71                		nop
(1)  126/  FF00EE : 18BC 0000           		move.b	#$00,(a4)	; Show SA|RLDU
(1)  127/  FF00F2 : 4E71                		nop
(1)  128/  FF00F4 : 4E71                		nop
(1)  129/  FF00F6 : 18BC 0040           		move.b	#$40,(a4)	; 6 button responds
(1)  130/  FF00FA : 4E71                		nop
(1)  131/  FF00FC : 4E71                		nop
(1)  132/  FF00FE : 1814                		move.b	(a4),d4		; Grab ??|MXYZ
(1)  133/  FF0100 : 18BC 0000            		move.b	#$00,(a4)
(1)  134/  FF0104 : 4E71                  		nop
(1)  135/  FF0106 : 4E71                  		nop
(1)  136/  FF0108 : 1C14                 		move.b	(a4),d6		; Type: $03 old, $0F new
(1)  137/  FF010A : 18BC 0040            		move.b	#$40,(a4)
(1)  138/  FF010E : 4E71                 		nop
(1)  139/  FF0110 : 4E71                 		nop
(1)  140/  FF0112 : CC7C 000F           		and.w	#$F,d6
(1)  141/  FF0116 : E44E                		lsr.w	#2,d6
(1)  142/  FF0118 : CC7C 0001           		and.w	#1,d6
(1)  143/  FF011C : 6716                		beq.s	.oldpad
(1)  144/  FF011E : 4604                		not.b	d4
(1)  145/  FF0120 : C87C 000F            		and.w	#%1111,d4
(1)  146/  FF0124 : 1A2D 0002           		move.b	on_hold(a5),d5
(1)  147/  FF0128 : B905                		eor.b	d4,d5
(1)  148/  FF012A : 1B44 0002           		move.b	d4,on_hold(a5)
(1)  149/  FF012E : CA04                		and.b	d4,d5
(1)  150/  FF0130 : 1B45 0004           		move.b	d5,on_press(a5)
(1)  151/  FF0134 :                     .oldpad:
(1)  152/  FF0134 : 1B46 0001           		move.b	d6,pad_ver(a5)
(1)  153/  FF0138 :                     		
(1)  154/  FF0138 : 18BC 0000           		move.b	#$00,(a4)	; Show SA??|RLDU
(1)  155/  FF013C : 4E71                		nop
(1)  156/  FF013E : 4E71                		nop
(1)  157/  FF0140 : 1814                		move.b	(a4),d4
(1)  158/  FF0142 : E50C                		lsl.b	#2,d4
(1)  159/  FF0144 : C83C 00C0           		and.b	#%11000000,d4
(1)  160/  FF0148 : 18BC 0040           		move.b	#$40,(a4)	; Show ??CB|RLDU
(1)  161/  FF014C : 4E71                		nop
(1)  162/  FF014E : 4E71                		nop
(1)  163/  FF0150 : 1A14                		move.b	(a4),d5
(1)  164/  FF0152 : CA3C 003F           		and.b	#%00111111,d5
(1)  165/  FF0156 : 8805                		or.b	d5,d4
(1)  166/  FF0158 : 4604                		not.b	d4
(1)  167/  FF015A : 1A2D 0003           		move.b	on_hold+1(a5),d5
(1)  168/  FF015E : B905                		eor.b	d4,d5
(1)  169/  FF0160 : 1B44 0003           		move.b	d4,on_hold+1(a5)
(1)  170/  FF0164 : CA04                		and.b	d4,d5
(1)  171/  FF0166 : 1B45 0005           		move.b	d5,on_press+1(a5)
(1)  172/  FF016A : 4E75                		rts
(1)  173/  FF016C :                     		
(1)  174/  FF016C :                     ; --------------------------------------------------------
(1)  175/  FF016C :                     ; Grab ID
(1)  176/  FF016C :                     ; --------------------------------------------------------
(1)  177/  FF016C :                     
(1)  178/  FF016C :                     .pick_id:
(1)  179/  FF016C : 7800                		moveq	#0,d4
(1)  180/  FF016E : 18BC 0070           		move.b	#%01110000,(a4)		; TH=1,TR=1,TL=1
(1)  181/  FF0172 : 4E71                		nop
(1)  182/  FF0174 : 4E71                		nop
(1)  183/  FF0176 : 610A                		bsr.s	.get_id
(1)  184/  FF0178 : 18BC 0030           		move.b	#%00110000,(a4)		; TH=0,TR=1,TL=1
(1)  185/  FF017C : 4E71                		nop
(1)  186/  FF017E : 4E71                		nop
(1)  187/  FF0180 : D844                		add.w	d4,d4
(1)  188/  FF0182 :                     .get_id:
(1)  189/  FF0182 : 1A14                		move.b	(a4),d5
(1)  190/  FF0184 : 1C05                		move.b	d5,d6
(1)  191/  FF0186 : CC3C 000C           		and.b	#$C,d6
(1)  192/  FF018A : 6702                		beq.s	.step_1
(1)  193/  FF018C : 5244                		addq.w	#1,d4
(1)  194/  FF018E :                     .step_1:
(1)  195/  FF018E : D844                		add.w	d4,d4
(1)  196/  FF0190 : 1C05                		move.b	d5,d6
(1)  197/  FF0192 : CC7C 0003           		and.w	#3,d6
(1)  198/  FF0196 : 6702                		beq.s	.step_2
(1)  199/  FF0198 : 5244                		addq.w	#1,d4
(1)  200/  FF019A :                     .step_2:
(1)  201/  FF019A : 4E75                		rts
(1)  202/  FF019C :                     		
(1)  203/  FF019C :                     ; 		moveq	#0,d0
(1)  204/  FF019C :                     ; 		bsr.s	System_ReadPad
(1)  205/  FF019C :                     ; 		lea	(RAM_Control+(16*4)),a5
(1)  206/  FF019C :                     ; 		moveq	#1,d0
(1)  207/  FF019C :                     ; 		bsr.s	System_ReadPad
(1)  208/  FF019C :                     ; 		
(1)  209/  FF019C :                     ; 		lea	($A10003).l,a6
(1)  210/  FF019C :                     ; 		lsl.w	#1,d0
(1)  211/  FF019C :                     ; 		add.w	d0,a6		; Add result to port
(1)  212/  FF019C :                     ; 		bsr.s	.srch_pad
(1)  213/  FF019C :                     ; 		move.b	d0,(a5)
(1)  214/  FF019C :                     ; 		move.w	#0,(z80_bus).l
(1)  215/  FF019C :                     ; 		rts
(1)  216/  FF019C :                     
(1)  217/  FF019C :                     ; --------------------------------------------------------
(1)  218/  FF019C :                     ; System_Random
(1)  219/  FF019C :                     ; 
(1)  220/  FF019C :                     ; Set random value
(1)  221/  FF019C :                     ; 
(1)  222/  FF019C :                     ; Output:
(1)  223/  FF019C :                     ; d0 | LONG
(1)  224/  FF019C :                     ; --------------------------------------------------------
(1)  225/  FF019C :                     
(1)  226/  FF019C :                     System_Random:
(1)  227/  FF019C : 2A38 9640           		move.l	(RAM_SysRandSeed),d5
(1)  228/  FF01A0 : 2838 963C           		move.l	(RAM_SysRandVal),d4
(1)  229/  FF01A4 : E39D                		rol.l	#1,d5
(1)  230/  FF01A6 : E284                		asr.l	#1,d4
(1)  231/  FF01A8 : D885                		add.l	d5,d4
(1)  232/  FF01AA : 23C5 FFFF 9640      		move.l	d5,(RAM_SysRandSeed).l
(1)  233/  FF01B0 : 23C4 FFFF 963C      		move.l	d4,(RAM_SysRandVal).l
(1)  234/  FF01B6 : 2004                		move.l	d4,d0
(1)  235/  FF01B8 : 4E75                		rts
(1)  236/  FF01BA :                     		
(1)  237/  FF01BA :                     ; --------------------------------------------------------
(1)  238/  FF01BA :                     ; System_SetInts
(1)  239/  FF01BA :                     ; 
(1)  240/  FF01BA :                     ; Set new interrputs
(1)  241/  FF01BA :                     ; 
(1)  242/  FF01BA :                     ; d0 | LONG - VBlank
(1)  243/  FF01BA :                     ; d1 | LONG - HBlank
(1)  244/  FF01BA :                     ;
(1)  245/  FF01BA :                     ; Uses:
(1)  246/  FF01BA :                     ; d4
(1)  247/  FF01BA :                     ; 
(1)  248/  FF01BA :                     ; Notes:
(1)  249/  FF01BA :                     ; setting 0 or negative number will ignore changes
(1)  250/  FF01BA :                     ; --------------------------------------------------------
(1)  251/  FF01BA :                     
(1)  252/  FF01BA :                     System_SetInts:
(1)  253/  FF01BA : 2800                		move.l	d0,d4
(1)  254/  FF01BC : 670E                		beq.s	.novint
(1)  255/  FF01BE : 6B0C                		bmi.s	.novint
(1)  256/  FF01C0 : 88BC 0088 0000      		or.l	#$880000,d4
(1)  257/  FF01C6 : 23C4 FFFF 9652       		move.l	d4,(RAM_MdMarsVInt+2).l
(1)  258/  FF01CC :                     .novint:
(1)  259/  FF01CC : 2801                		move.l	d1,d4
(1)  260/  FF01CE : 670E                		beq.s	.nohint
(1)  261/  FF01D0 : 6B0C                		bmi.s	.nohint
(1)  262/  FF01D2 : 88BC 0088 0000      		or.l	#$880000,d4
(1)  263/  FF01D8 : 23C4 FFFF 9658      		move.l	d4,(RAM_MdMarsHInt+2).l
(1)  264/  FF01DE :                     .nohint:
(1)  265/  FF01DE : 4E75                		rts
(1)  266/  FF01E0 :                     
(1)  267/  FF01E0 :                     ; --------------------------------------------------------
(1)  268/  FF01E0 :                     ; System_SaveInit
(1)  269/  FF01E0 :                     ; 
(1)  270/  FF01E0 :                     ; Init save data
(1)  271/  FF01E0 :                     ; 
(1)  272/  FF01E0 :                     ; Uses:
(1)  273/  FF01E0 :                     ; a4,d4-d5
(1)  274/  FF01E0 :                     ; --------------------------------------------------------
(1)  275/  FF01E0 :                     
(1)  276/  FF01E0 :                     ; TODO: Check if RV bit is required here...
(1)  277/  FF01E0 :                     System_SaveInit:
(1)  278/  FF01E0 : 13FC 0001 00A1 30F1 		move.b	#1,(md_bank_sram).l
(1)  279/  FF01E8 : 49F9 0020 0001      		lea	($200001).l,a4
(1)  280/  FF01EE : 7800                		moveq	#0,d4
(1)  281/  FF01F0 : 3A3C 1FFF           		move.w	#($4000/2)-1,d5
(1)  282/  FF01F4 :                     .initsave:
(1)  283/  FF01F4 : 1884                		move.b	d4,(a4)
(1)  284/  FF01F6 : D8FC 0002           		adda	#2,a4
(1)  285/  FF01FA : 51CD FFF8           		dbf	d5,.initsave
(1)  286/  FF01FE : 13FC 0000 00A1 30F1 		move.b	#0,(md_bank_sram).l
(1)  287/  FF0206 : 4E75                		rts
(1)  288/  FF0208 :                     
(1)  289/  FF0208 :                     ; --------------------------------------------------------
(1)  290/  FF0208 :                     ; System_VSync
(1)  291/  FF0208 :                     ; 
(1)  292/  FF0208 :                     ; Waits for VBlank manually
(1)  293/  FF0208 :                     ; 
(1)  294/  FF0208 :                     ; Uses:
(1)  295/  FF0208 :                     ; d4
(1)  296/  FF0208 :                     ; --------------------------------------------------------
(1)  297/  FF0208 :                     
(1)  298/  FF0208 :                     System_VSync:
(1)  299/  FF0208 : 3839 00C0 0004      		move.w	(vdp_ctrl),d4
(1)  300/  FF020E : 0804 0003           		btst	#bitVint,d4
(1)  301/  FF0212 : 67F4                		beq.s	System_VSync
(1)  302/  FF0214 : 6100 FE6C           		bsr	System_Input
(1)  303/  FF0218 : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_FrameCount).l
                    9638                
(1)  304/  FF0222 : 3839 00C0 0004      .inside:	move.w	(vdp_ctrl),d4
(1)  305/  FF0228 : 0804 0003           		btst	#bitVint,d4
(1)  306/  FF022C : 66F4                		bne.s	.inside
(1)  307/  FF022E : 4E75                		rts
(1)  308/  FF0230 :                     
(1)  309/  FF0230 :                     ; ====================================================================
(1)  310/  FF0230 :                     ; --------------------------------------------------------
(1)  311/  FF0230 :                     ; Routines to send task request from here to 32X
(1)  312/  FF0230 :                     ; 
(1)  313/  FF0230 :                     ; Uses comm8,comm10,comm12
(1)  314/  FF0230 :                     ; --------------------------------------------------------
(1)  315/  FF0230 :                     
(1)  316/  FF0230 :                     ; ------------------------------------------------
(1)  317/  FF0230 :                     ; Single call only
(1)  318/  FF0230 :                     ; ------------------------------------------------
(1)  319/  FF0230 :                     
(1)  320/  FF0230 :                     ; Add task to Master's queque
(1)  321/  FF0230 :                     System_MdMars_MstAddTask:
(1)  322/  FF0230 : 4DF8 9218           		lea	(RAM_MdMarsTskM).w,a6
(1)  323/  FF0234 : 4BF8 9648           		lea	(RAM_MdMarsTCntM).w,a5
(1)  324/  FF0238 : 6000 008E           		bra	sysMdMars_instask
(1)  325/  FF023C :                     
(1)  326/  FF023C :                     ; Add task to Slave's queque
(1)  327/  FF023C :                     System_MdMars_SlvAddTask:
(1)  328/  FF023C : 4DF8 9418           		lea	(RAM_MdMarsTskS).w,a6
(1)  329/  FF0240 : 4BF8 964A           		lea	(RAM_MdMarsTCntS).w,a5
(1)  330/  FF0244 : 6000 0082           		bra	sysMdMars_instask
(1)  331/  FF0248 :                     
(1)  332/  FF0248 :                     ; Single call for Master CPU
(1)  333/  FF0248 :                     System_MdMars_MstCall:
(1)  334/  FF0248 : 4DF8 9618           		lea	(RAM_MdMarsTsSgl),a6
(1)  335/  FF024C : 48D6 00FF           		movem.l	d0-d7,(a6)
(1)  336/  FF0250 : 3C3C 0020           		move.w	#(MAX_MDTSKARG*4),d6
(1)  337/  FF0254 : 7A00                		moveq	#0,d5
(1)  338/  FF0256 :                     .wait_m:
(1)  339/  FF0256 : 4E71                		nop
(1)  340/  FF0258 : 4E71                		nop
(1)  341/  FF025A : 1839 00A1 512E      		move.b	(sysmars_reg+comm14),d4
(1)  342/  FF0260 : C87C 0080           		and.w	#$80,d4
(1)  343/  FF0264 : 66F0                		bne.s	.wait_m
(1)  344/  FF0266 : 607E                		bra.s	sysMdMars_Transfer
(1)  345/  FF0268 :                     
(1)  346/  FF0268 :                     ; Single call for Slave CPU
(1)  347/  FF0268 :                     System_MdMars_SlvCall:
(1)  348/  FF0268 : 4DF8 9618           		lea	(RAM_MdMarsTsSgl),a6
(1)  349/  FF026C : 48D6 00FF           		movem.l	d0-d7,(a6)
(1)  350/  FF0270 : 3C3C 0020           		move.w	#(MAX_MDTSKARG*4),d6
(1)  351/  FF0274 : 7A01                		moveq	#1,d5
(1)  352/  FF0276 :                     .wait_s:
(1)  353/  FF0276 : 4E71                		nop
(1)  354/  FF0278 : 4E71                		nop
(1)  355/  FF027A : 1839 00A1 512F      		move.b	(sysmars_reg+comm15),d4
(1)  356/  FF0280 : C87C 0080           		and.w	#$80,d4
(1)  357/  FF0284 : 66F0                		bne.s	.wait_s
(1)  358/  FF0286 : 605E                		bra.s	sysMdMars_Transfer
(1)  359/  FF0288 :                     
(1)  360/  FF0288 :                     System_MdMars_MstSendAll:
(1)  361/  FF0288 : 4DF8 9218           		lea	(RAM_MdMarsTskM),a6
(1)  362/  FF028C : 4278 9648           		clr.w	(RAM_MdMarsTCntM).w
(1)  363/  FF0290 : 3C3C 0200           		move.w	#(MAX_MDTSKARG*MAX_MDTASKS*4),d6
(1)  364/  FF0294 : 7A00                		moveq	#0,d5
(1)  365/  FF0296 :                     .wait_m:
(1)  366/  FF0296 : 4E71                		nop
(1)  367/  FF0298 : 4E71                		nop
(1)  368/  FF029A : 1839 00A1 512E      		move.b	(sysmars_reg+comm14),d4
(1)  369/  FF02A0 : C87C 0080           		and.w	#$80,d4
(1)  370/  FF02A4 : 66F0                		bne.s	.wait_m
(1)  371/  FF02A6 : 603E                		bra.s	sysMdMars_Transfer
(1)  372/  FF02A8 :                     		
(1)  373/  FF02A8 :                     System_MdMars_SlvSendAll:
(1)  374/  FF02A8 : 4DF8 9418           		lea	(RAM_MdMarsTskS),a6
(1)  375/  FF02AC : 4278 964A           		clr.w	(RAM_MdMarsTCntS).w
(1)  376/  FF02B0 : 3C3C 0200           		move.w	#(MAX_MDTSKARG*MAX_MDTASKS*4),d6
(1)  377/  FF02B4 : 7A01                		moveq	#1,d5
(1)  378/  FF02B6 :                     .wait_s:
(1)  379/  FF02B6 : 4E71                		nop
(1)  380/  FF02B8 : 4E71                		nop
(1)  381/  FF02BA : 1839 00A1 512F      		move.b	(sysmars_reg+comm15),d4
(1)  382/  FF02C0 : C87C 0080           		and.w	#$80,d4
(1)  383/  FF02C4 : 66F0                		bne.s	.wait_s
(1)  384/  FF02C6 : 601E                		bra.s	sysMdMars_Transfer
(1)  385/  FF02C8 :                     
(1)  386/  FF02C8 :                     ; a6 - task pointer and args
(1)  387/  FF02C8 :                     ; a5 - task list counter
(1)  388/  FF02C8 :                     sysMdMars_instask:
(1)  389/  FF02C8 : 0C55 0200           		cmp.w	#(MAX_MDTSKARG*MAX_MDTASKS)*4,(a5)
(1)  390/  FF02CC : 6C16                		bge.s	.ran_out
(1)  391/  FF02CE : 31FC 0001 964C      		move.w	#1,(RAM_FifoMarsWrt).w
(1)  392/  FF02D4 : DCD5                		adda.w	(a5),a6
(1)  393/  FF02D6 : 48D6 00FF           		movem.l	d0-d7,(a6)				; Send variables to RAM
(1)  394/  FF02DA : 0655 0020           		add.w	#MAX_MDTSKARG*4,(a5)
(1)  395/  FF02DE : 31FC 0000 964C      		move.w	#0,(RAM_FifoMarsWrt).w
(1)  396/  FF02E4 :                     .ran_out:
(1)  397/  FF02E4 : 4E75                		rts
(1)  398/  FF02E6 :                     
(1)  399/  FF02E6 :                     ; a6 - Task list and args
(1)  400/  FF02E6 :                     ; d6 - Data size
(1)  401/  FF02E6 :                     ; d5 - CMD Interrupt bitset value (0-Master/1-Slave)
(1)  402/  FF02E6 :                     ; 
(1)  403/  FF02E6 :                     ; Test for comm14 or comm15
(1)  404/  FF02E6 :                     ; before calling here.
(1)  405/  FF02E6 :                     sysMdMars_Transfer:
(1)  406/  FF02E6 : 4BF9 00A1 5100      		lea	(sysmars_reg),a5
(1)  407/  FF02EC : 40C7                		move.w	sr,d7
(1)  408/  FF02EE : 46FC 2700           		move.w	#$2700,sr
(1)  409/  FF02F2 : 49ED 0028           		lea	comm8(a5),a4
(1)  410/  FF02F6 : 38BC 0201           		move.w	#$0201,(a4)		; MD ready | SH busy (init)
(1)  411/  FF02FA : 382D 0002           		move.w	standby(a5),d4		; SLAVE CMD interrupt
(1)  412/  FF02FE : 0BC4                		bset	d5,d4
(1)  413/  FF0300 : 3B44 0002           		move.w	d4,standby(a5)
(1)  414/  FF0304 : 382D 0002           .wait_cmd:	move.w	standby(a5),d4
(1)  415/  FF0308 : 0B04                		btst    d5,d4
(1)  416/  FF030A : 66F8                		bne.s   .wait_cmd
(1)  417/  FF030C :                     
(1)  418/  FF030C :                     .loop:
(1)  419/  FF030C : 0C2C 0002 0001      		cmpi.b	#2,1(a4)		; SH ready?
(1)  420/  FF0312 : 66F8                		bne.s	.loop
(1)  421/  FF0314 : 18BC 0001           		move.b	#1,(a4)			; MD is writing
(1)  422/  FF0318 : 4A46                		tst.w	d6
(1)  423/  FF031A : 6718                		beq.s	.exit
(1)  424/  FF031C : 2816                		move.l	(a6),d4
(1)  425/  FF031E : 429E                		clr.l	(a6)+
(1)  426/  FF0320 : 3944 0004           		move.w	d4,4(a4)
(1)  427/  FF0324 : 4844                		swap	d4
(1)  428/  FF0326 : 3944 0002           		move.w	d4,2(a4)
(1)  429/  FF032A : 18BC 0002           		move.b	#2,(a4)			; MD is free
(1)  430/  FF032E : 9C7C 0004           		sub.w	#4,d6
(1)  431/  FF0332 : 60D8                		bra.s	.loop
(1)  432/  FF0334 :                     .exit:	
(1)  433/  FF0334 : 18BC 0000           		move.b	#0,(a4)			; MD finished
(1)  434/  FF0338 : 46C7                		move.w	d7,sr
(1)  435/  FF033A :                     .mid_write:
(1)  436/  FF033A : 4E75                		rts
(1)  437/  FF033C :                     
(1)  438/  FF033C :                     ; ====================================================================
(1)  439/  FF033C :                     ; ----------------------------------------------------------------
(1)  440/  FF033C :                     ; Game modes
(1)  441/  FF033C :                     ; ----------------------------------------------------------------
(1)  442/  FF033C :                     
(1)  443/  FF033C :                     ; Initialize current screen mode
(1)  444/  FF033C :                     Mode_Init:
(1)  445/  FF033C : 6176                		bsr	Video_Clear
(1)  446/  FF033E : 49F8 8800           		lea	(RAM_ModeBuff),a4
(1)  447/  FF0342 : 3A3C 03FF           		move.w	#(MAX_MDERAM/2)-1,d5
(1)  448/  FF0346 : 7800                		moveq	#0,d4
(1)  449/  FF0348 :                     .clr:
(1)  450/  FF0348 : 38C4                		move.w	d4,(a4)+
(1)  451/  FF034A : 51CD FFFC           		dbf	d5,.clr
(1)  452/  FF034E : 4E75                		rts
(1)  453/  FF0350 :                     		
(1)  454/  FF0350 :                     ; ====================================================================
(1)  455/  FF0350 :                     ; ----------------------------------------------------------------
(1)  456/  FF0350 :                     ; Default interrupts
(1)  457/  FF0350 :                     ; ----------------------------------------------------------------
(1)  458/  FF0350 :                     
(1)  459/  FF0350 :                     ; --------------------------------------------------------
(1)  460/  FF0350 :                     ; VBlank
(1)  461/  FF0350 :                     ; --------------------------------------------------------
(1)  462/  FF0350 :                     
(1)  463/  FF0350 :                     VInt_Default:
(1)  464/  FF0350 : 48E7 FFFE           		movem.l	d0-a6,-(sp)
(1)  465/  FF0354 : 6100 FD2C           		bsr	System_Input
(1)  466/  FF0358 : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_FrameCount).l
                    9638                
(1)  467/  FF0362 : 4CDF 7FFF           		movem.l	(sp)+,d0-a6		
(1)  468/  FF0366 : 4E73                		rte
(1)  469/  FF0368 :                     
(1)  470/  FF0368 :                     ; --------------------------------------------------------
(1)  471/  FF0368 :                     ; HBlank
(1)  472/  FF0368 :                     ; --------------------------------------------------------
(1)  473/  FF0368 :                     
(1)  474/  FF0368 :                     HInt_Default:
(1)  475/  FF0368 : 4E73                		rte
(1)  476/  FF036A :                     		
(1)  477/  FF036A :                     ; ====================================================================
(1)  478/  FF036A :                     ; ----------------------------------------------------------------
(1)  479/  FF036A :                     ; System data
(1)  480/  FF036A :                     ; ----------------------------------------------------------------
(1)  481/  FF036A :                     
(1)  482/  FF036A :                     ; Stuff like Sinewave data for MD will go here.
(1)  483/  FF036A :                     
      34/  FF036A :                     		include	"system/md/video.asm"
(1)    1/  FF036A :                     ; ====================================================================
(1)    2/  FF036A :                     ; ----------------------------------------------------------------
(1)    3/  FF036A :                     ; MD Video
(1)    4/  FF036A :                     ; ----------------------------------------------------------------
(1)    5/  FF036A :                     
(1)    6/  FF036A :                     ; --------------------------------------------------------
(1)    7/  FF036A :                     ; Init Video
(1)    8/  FF036A :                     ; 
(1)    9/  FF036A :                     ; Uses:
(1)   10/  FF036A :                     ; a0-a2,d0-d1
(1)   11/  FF036A :                     ; --------------------------------------------------------
(1)   12/  FF036A :                     
(1)   13/  FF036A :                     Video_Init:		
(1)   14/  FF036A : 41F8 966C           		lea	(RAM_MdVideo),a0	; Clear RAM
(1)   15/  FF036E : 7000                		moveq	#0,d0
(1)   16/  FF0370 : 323C 0199           		move.w	#(sizeof_mdvid-RAM_MdVideo)-1,d1
(1)   17/  FF0374 :                     .clrram:
(1)   18/  FF0374 : 10C0                		move.b	d0,(a0)+
(1)   19/  FF0376 : 51C9 FFFC           		dbf	d1,.clrram
(1)   20/  FF037A :                     
(1)   21/  FF037A : 41FA 05B2           		lea	list_vdpregs(pc),a0	; Init registers
(1)   22/  FF037E : 43F8 97EE           		lea	(RAM_VdpRegs).w,a1
(1)   23/  FF0382 : 45F9 00C0 0004      		lea	(vdp_ctrl),a2
(1)   24/  FF0388 : 303C 8000           		move.w	#$8000,d0
(1)   25/  FF038C : 323C 0012           		move.w	#19-1,d1
(1)   26/  FF0390 :                     .loop:
(1)   27/  FF0390 : 1018                		move.b	(a0)+,d0
(1)   28/  FF0392 : 12C0                		move.b	d0,(a1)+
(1)   29/  FF0394 : 3480                		move.w	d0,(a2)
(1)   30/  FF0396 : D07C 0100           		add.w	#$100,d0
(1)   31/  FF039A : 51C9 FFF4           		dbf	d1,.loop
(1)   32/  FF039E :                     .exit:
(1)   33/  FF039E :                     
(1)   34/  FF039E :                     	; Transfer the DMA tasks to RAM
(1)   35/  FF039E :                     	; TODO: change this later, we are on RAM already...
(1)   36/  FF039E : 41FA 04AE           		lea	Video_RamCode(pc),a0
(1)   37/  FF03A2 : 43F8 9806           		lea	(RAM_ExRamSub).w,a1
(1)   38/  FF03A6 : 303C 006F           		move.w	#((Video_RamCode_e-Video_RamCode)/2)-1,d0
(1)   39/  FF03AA :                     .copy:
(1)   40/  FF03AA : 3218                		move.w	(a0)+,d1
(1)   41/  FF03AC : 32C1                		move.w	d1,(a1)+
(1)   42/  FF03AE : 51C8 FFFA           		dbf	d0,.copy
(1)   43/  FF03B2 : 4E75                		rts
(1)   44/  FF03B4 :                     
(1)   45/  FF03B4 :                     ; ====================================================================
(1)   46/  FF03B4 :                     ; ----------------------------------------------------------------
(1)   47/  FF03B4 :                     ; Video subroutines
(1)   48/  FF03B4 :                     ; ----------------------------------------------------------------
(1)   49/  FF03B4 :                     
(1)   50/  FF03B4 :                     ; --------------------------------------------------------
(1)   51/  FF03B4 :                     ; Video_Clear
(1)   52/  FF03B4 :                     ; 
(1)   53/  FF03B4 :                     ; Clear all video data
(1)   54/  FF03B4 :                     ; --------------------------------------------------------
(1)   55/  FF03B4 :                     
(1)   56/  FF03B4 :                     Video_Clear:
(1)   57/  FF03B4 : 303C 0000           		move.w	#0,d0			; Clear until $57F
(1)   58/  FF03B8 : 323C AFE0           		move.w	#$57F*$20,d1
(1)   59/  FF03BC : 343C 0000           		move.w	#0,d2
(1)   60/  FF03C0 : 6100 038C           		bsr	Video_Fill
(1)   61/  FF03C4 : 323C 0FFF           		move.w	#$FFF,d1		; FG/BG size
(1)   62/  FF03C8 : 1439 FFFF 97F0      		move.b	(RAM_VdpRegs+2).l,d2	; FG
(1)   63/  FF03CE : 0242 0038           		andi.w	#%111000,d2
(1)   64/  FF03D2 : E14A                		lsl.w	#8,d2
(1)   65/  FF03D4 : E54A                		lsl.w	#2,d2
(1)   66/  FF03D6 : 6100 0376           		bsr	Video_Fill
(1)   67/  FF03DA : 1439 FFFF 97F1      		move.b	(RAM_VdpRegs+3).l,d2	; BG
(1)   68/  FF03E0 : 0242 0007           		andi.w	#%000111,d2
(1)   69/  FF03E4 : E14A                		lsl.w	#8,d2
(1)   70/  FF03E6 : EB4A                		lsl.w	#5,d2
(1)   71/  FF03E8 : 6100 0364           		bsr	Video_Fill	
(1)   72/  FF03EC : 323C 0FFF           		move.w	#$FFF,d1		; WD Size
(1)   73/  FF03F0 : 1439 FFFF 97F2      		move.b	(RAM_VdpRegs+4).l,d2	; Window
(1)   74/  FF03F6 : 0242 003E           		andi.w	#%111110,d2
(1)   75/  FF03FA : E14A                		lsl.w	#8,d2
(1)   76/  FF03FC : E54A                		lsl.w	#2,d2
(1)   77/  FF03FE : 6000 034E           		bra	Video_Fill
(1)   78/  FF0402 :                     		
(1)   79/  FF0402 :                     ; ---------------------------------
(1)   80/  FF0402 :                     ; Video_Update
(1)   81/  FF0402 :                     ; 
(1)   82/  FF0402 :                     ; Copy our RAM reg settings to
(1)   83/  FF0402 :                     ; VDP from $80 to $90
(1)   84/  FF0402 :                     ; 
(1)   85/  FF0402 :                     ; Uses:
(1)   86/  FF0402 :                     ; d4-d5,a4-a5
(1)   87/  FF0402 :                     ; ---------------------------------
(1)   88/  FF0402 :                     
(1)   89/  FF0402 :                     Video_Update:
(1)   90/  FF0402 : 49F8 97EE           		lea	(RAM_VdpRegs).w,a4
(1)   91/  FF0406 : 4BF9 00C0 0004      		lea	(vdp_ctrl),a5
(1)   92/  FF040C : 383C 8000           		move.w	#$8000,d4
(1)   93/  FF0410 : 3A3C 0010           		move.w	#17-1,d5
(1)   94/  FF0414 :                     .loop:
(1)   95/  FF0414 : 181C                		move.b	(a4)+,d4
(1)   96/  FF0416 : 3A84                		move.w	d4,(a5)
(1)   97/  FF0418 : D87C 0100           		add.w	#$100,d4
(1)   98/  FF041C : 51CD FFF6           		dbf	d5,.loop
(1)   99/  FF0420 :                     .exit:
(1)  100/  FF0420 : 4E75                		rts
(1)  101/  FF0422 :                     		
(1)  102/  FF0422 :                     ; --------------------------------------------------------
(1)  103/  FF0422 :                     ; Video_LoadPal
(1)  104/  FF0422 :                     ; Load palette to VDP directly, waits VBLANK
(1)  105/  FF0422 :                     ; 
(1)  106/  FF0422 :                     ; Input:
(1)  107/  FF0422 :                     ; a0 - Palette data
(1)  108/  FF0422 :                     ; d0 - Start at
(1)  109/  FF0422 :                     ; d1 - Num of colors - 1
(1)  110/  FF0422 :                     ; 
(1)  111/  FF0422 :                     ; Uses:
(1)  112/  FF0422 :                     ; a4,d4
(1)  113/  FF0422 :                     ; 
(1)  114/  FF0422 :                     ; Note:
(1)  115/  FF0422 :                     ; It will show dots on screen
(1)  116/  FF0422 :                     ; --------------------------------------------------------
(1)  117/  FF0422 :                     
(1)  118/  FF0422 :                     Video_LoadPal:
(1)  119/  FF0422 : 49F9 00C0 0000      		lea	(vdp_data),a4
(1)  120/  FF0428 : 7800                		moveq	#0,d4
(1)  121/  FF042A : 3800                		move.w	d0,d4
(1)  122/  FF042C : D844                		add.w	d4,d4
(1)  123/  FF042E : 0044 C000           		ori.w	#$C000,d4
(1)  124/  FF0432 : 4844                		swap	d4
(1)  125/  FF0434 : 2944 0004           		move.l	d4,4(a4)
(1)  126/  FF0438 : 3801                		move.w	d1,d4
(1)  127/  FF043A : 3A2C 0004           .outv: 		move.w	4(a4),d5
(1)  128/  FF043E : 0805 0003           		btst	#bitVint,d5
(1)  129/  FF0442 : 67F6                		beq.s	.outv
(1)  130/  FF0444 :                     .loop:
(1)  131/  FF0444 : 3898                		move.w	(a0)+,(a4)
(1)  132/  FF0446 : 51CC FFFC           		dbf	d4,.loop
(1)  133/  FF044A : 4E75                		rts
(1)  134/  FF044C :                     		
(1)  135/  FF044C :                     ; --------------------------------------------------------
(1)  136/  FF044C :                     ; Video_LoadMap
(1)  137/  FF044C :                     ; 
(1)  138/  FF044C :                     ; Load map data, Horizontal order
(1)  139/  FF044C :                     ; 
(1)  140/  FF044C :                     ; a0 - Map data
(1)  141/  FF044C :                     ; d0 | LONG - 00|Layer|X|Y, locate(lyr,x,y)  
(1)  142/  FF044C :                     ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  143/  FF044C :                     ; d2 | WORD - VRAM
(1)  144/  FF044C :                     
(1)  145/  FF044C :                     ; Uses:
(1)  146/  FF044C :                     ; a4-a5,d4-d7
(1)  147/  FF044C :                     ; --------------------------------------------------------
(1)  148/  FF044C :                     
(1)  149/  FF044C :                     Video_LoadMap:
(1)  150/  FF044C : 49F9 00C0 0000      		lea	(vdp_data),a4
(1)  151/  FF0452 : 6100 025E           		bsr	vid_PickLayer
(1)  152/  FF0456 : 3A01                		move.w	d1,d5		; Start here
(1)  153/  FF0458 :                     .yloop:
(1)  154/  FF0458 : 4845                		swap	d5
(1)  155/  FF045A : 2944 0004           		move.l	d4,4(a4)
(1)  156/  FF045E : 2E01                		move.l	d1,d7
(1)  157/  FF0460 : 4847                		swap	d7
(1)  158/  FF0462 :                     .xloop:
(1)  159/  FF0462 : 3A18                		move.w	(a0)+,d5
(1)  160/  FF0464 : BA7C FFFF           		cmp.w	#-1,d5
(1)  161/  FF0468 : 6606                		bne.s	.nonull
(1)  162/  FF046A : 3A3C 07FF           		move.w	#varNullVram,d5
(1)  163/  FF046E : 6002                		bra.s	.cont
(1)  164/  FF0470 :                     .nonull:
(1)  165/  FF0470 : DA42                		add.w	d2,d5
(1)  166/  FF0472 :                     .cont:
(1)  167/  FF0472 : 4847                		swap	d7
(1)  168/  FF0474 : 1E39 FFFF 97FA      		move.b	(RAM_VdpRegs+$C).l,d7
(1)  169/  FF047A : CE7C 0006           		and.w	#%110,d7
(1)  170/  FF047E : BE7C 0006           		cmp.w	#%110,d7
(1)  171/  FF0482 : 660E                		bne.s	.nodble
(1)  172/  FF0484 : 3E05                		move.w	d5,d7
(1)  173/  FF0486 : E24F                		lsr.w	#1,d7
(1)  174/  FF0488 : CE7C 07FF           		and.w	#$7FF,d7
(1)  175/  FF048C : CA7C F800           		and.w	#$F800,d5
(1)  176/  FF0490 : 8A47                		or.w	d7,d5
(1)  177/  FF0492 :                     .nodble:
(1)  178/  FF0492 : 4847                		swap	d7
(1)  179/  FF0494 : 3885                		move.w	d5,(a4)
(1)  180/  FF0496 : 51CF FFCA           		dbf	d7,.xloop
(1)  181/  FF049A : D886                		add.l	d6,d4
(1)  182/  FF049C : 4845                		swap	d5
(1)  183/  FF049E : 51CD FFB8           		dbf	d5,.yloop
(1)  184/  FF04A2 : 4E75                		rts
(1)  185/  FF04A4 :                     
(1)  186/  FF04A4 :                     ; --------------------------------------------------------
(1)  187/  FF04A4 :                     ; Video_LoadMap_Vert
(1)  188/  FF04A4 :                     ; 
(1)  189/  FF04A4 :                     ; Load map data, Vertical order
(1)  190/  FF04A4 :                     ; 
(1)  191/  FF04A4 :                     ; a0 - Map data
(1)  192/  FF04A4 :                     ; d0 | LONG - 00|Lyr|X|Y,  locate(lyr,x,y)
(1)  193/  FF04A4 :                     ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  194/  FF04A4 :                     ; d2 | WORD - VRAM
(1)  195/  FF04A4 :                     
(1)  196/  FF04A4 :                     ; Uses:
(1)  197/  FF04A4 :                     ; a4-a5,d4-d7
(1)  198/  FF04A4 :                     ; --------------------------------------------------------
(1)  199/  FF04A4 :                     
(1)  200/  FF04A4 :                     Video_LoadMap_Vert:
(1)  201/  FF04A4 : 49F9 00C0 0000      		lea	(vdp_data),a4
(1)  202/  FF04AA : 6100 0206           		bsr	vid_PickLayer
(1)  203/  FF04AE : 2A01                		move.l	d1,d5		; Start here
(1)  204/  FF04B0 : 4845                		swap	d5
(1)  205/  FF04B2 :                     .xloop:
(1)  206/  FF04B2 : 4845                		swap	d5
(1)  207/  FF04B4 : 2F04                		move.l	d4,-(sp)
(1)  208/  FF04B6 : 3E01                		move.w	d1,d7
(1)  209/  FF04B8 : 0839 0002 FFFF 97FA 		btst	#2,(RAM_VdpRegs+$C).l
(1)  210/  FF04C0 : 6702                		beq.s	.yloop
(1)  211/  FF04C2 : E24F                		lsr.w	#1,d7
(1)  212/  FF04C4 :                     .yloop:
(1)  213/  FF04C4 : 2944 0004           		move.l	d4,4(a4)
(1)  214/  FF04C8 : 3A10                		move.w	(a0),d5
(1)  215/  FF04CA : BA7C FFFF           		cmp.w	#-1,d5
(1)  216/  FF04CE : 6606                		bne.s	.nonull
(1)  217/  FF04D0 : 3A3C 07FF           		move.w	#varNullVram,d5
(1)  218/  FF04D4 : 6002                		bra.s	.cont
(1)  219/  FF04D6 :                     .nonull:
(1)  220/  FF04D6 : DA42                		add.w	d2,d5
(1)  221/  FF04D8 :                     .cont:
(1)  222/  FF04D8 : 4847                		swap	d7
(1)  223/  FF04DA : D0FC 0002           		adda	#2,a0
(1)  224/  FF04DE : 0839 0002 FFFF 97FA 		btst	#2,(RAM_VdpRegs+$C).l
(1)  225/  FF04E6 : 6712                		beq.s	.nodble
(1)  226/  FF04E8 : D0FC 0002           		adda	#2,a0
(1)  227/  FF04EC : 3E05                		move.w	d5,d7
(1)  228/  FF04EE : E24F                		lsr.w	#1,d7
(1)  229/  FF04F0 : CE7C 07FF           		and.w	#$7FF,d7
(1)  230/  FF04F4 : CA7C F800           		and.w	#$F800,d5
(1)  231/  FF04F8 : 8A47                		or.w	d7,d5
(1)  232/  FF04FA :                     .nodble:
(1)  233/  FF04FA : 4847                		swap	d7
(1)  234/  FF04FC : 3885                		move.w	d5,(a4)
(1)  235/  FF04FE : D886                		add.l	d6,d4
(1)  236/  FF0500 : 51CF FFC2           		dbf	d7,.yloop
(1)  237/  FF0504 :                     .outdbl:
(1)  238/  FF0504 : 281F                		move.l	(sp)+,d4
(1)  239/  FF0506 : D8BC 0002 0000      		add.l	#$20000,d4
(1)  240/  FF050C : 4845                		swap	d5
(1)  241/  FF050E : 51CD FFA2           		dbf	d5,.xloop
(1)  242/  FF0512 : 4E75                		rts
(1)  243/  FF0514 :                     		
(1)  244/  FF0514 :                     ; --------------------------------------------------------
(1)  245/  FF0514 :                     ; Video_AutoMap_Vert
(1)  246/  FF0514 :                     ; 
(1)  247/  FF0514 :                     ; Make automatic map, Vertical order
(1)  248/  FF0514 :                     ; 
(1)  249/  FF0514 :                     ; MCD: Use this to make a virtual screen
(1)  250/  FF0514 :                     ; for Stamps
(1)  251/  FF0514 :                     ; 
(1)  252/  FF0514 :                     ; d0 | LONG - 00|Lyr|X|Y,  locate(lyr,x,y)
(1)  253/  FF0514 :                     ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  254/  FF0514 :                     ; d2 | WORD - VRAM
(1)  255/  FF0514 :                     
(1)  256/  FF0514 :                     ; Uses:
(1)  257/  FF0514 :                     ; a4-a5,d4-d7
(1)  258/  FF0514 :                     ; --------------------------------------------------------
(1)  259/  FF0514 :                     
(1)  260/  FF0514 :                     ; TODO: double interlace
(1)  261/  FF0514 :                     Video_AutoMap_Vert:
(1)  262/  FF0514 : 49F9 00C0 0000      		lea	(vdp_data),a4
(1)  263/  FF051A : 6100 0196           		bsr	vid_PickLayer
(1)  264/  FF051E : 3E02                		move.w	d2,d7		; Start here
(1)  265/  FF0520 : 2A01                		move.l	d1,d5
(1)  266/  FF0522 : 4845                		swap	d5
(1)  267/  FF0524 :                     .xloop:
(1)  268/  FF0524 : 4845                		swap	d5
(1)  269/  FF0526 : 2F04                		move.l	d4,-(sp)
(1)  270/  FF0528 : 3A01                		move.w	d1,d5
(1)  271/  FF052A : 0839 0002 FFFF 97FA 		btst	#2,(RAM_VdpRegs+$C).l
(1)  272/  FF0532 : 6702                		beq.s	.yloop
(1)  273/  FF0534 : E24D                		lsr.w	#1,d5
(1)  274/  FF0536 :                     .yloop:
(1)  275/  FF0536 : 2944 0004           		move.l	d4,4(a4)
(1)  276/  FF053A : 3887                		move.w	d7,(a4)
(1)  277/  FF053C : DE7C 0001           		add.w	#1,d7
(1)  278/  FF0540 : D886                		add.l	d6,d4
(1)  279/  FF0542 : 51CD FFF2           		dbf	d5,.yloop
(1)  280/  FF0546 :                     
(1)  281/  FF0546 : 281F                		move.l	(sp)+,d4
(1)  282/  FF0548 : D8BC 0002 0000      		add.l	#$20000,d4
(1)  283/  FF054E : 4845                		swap	d5
(1)  284/  FF0550 : 51CD FFD2           		dbf	d5,.xloop
(1)  285/  FF0554 : 4E75                		rts
(1)  286/  FF0556 :                     
(1)  287/  FF0556 :                     ; --------------------------------------------------------
(1)  288/  FF0556 :                     ; Video_PrintInit
(1)  289/  FF0556 :                     ; 
(1)  290/  FF0556 :                     ; Load palette and font for printing text
(1)  291/  FF0556 :                     ; --------------------------------------------------------
(1)  292/  FF0556 :                     
(1)  293/  FF0556 :                     Video_PrintInit:
(1)  294/  FF0556 : 41FA 03EA           		lea	ASCII_PAL(pc),a0
(1)  295/  FF055A : 7030                		moveq	#$30,d0
(1)  296/  FF055C : 323C 000F           		move.w	#$F,d1
(1)  297/  FF0560 : 6100 FEC0           		bsr	Video_LoadPal
(1)  298/  FF0564 : 203C 00FF 0962      		move.l	#ASCII_FONT,d0
(1)  299/  FF056A : 323C 1000           		move.w	#ASCII_FONT_e-ASCII_FONT,d1
(1)  300/  FF056E : 343C 6580           		move.w	#$580|$6000,d2
(1)  301/  FF0572 : 31C2 966C           		move.w	d2,(RAM_VidPrntVram).w
(1)  302/  FF0576 : 6000 02D0           		bra	Video_LoadArt
(1)  303/  FF057A :                     
(1)  304/  FF057A :                     ; --------------------------------------------------------
(1)  305/  FF057A :                     ; Video_Print
(1)  306/  FF057A :                     ; 
(1)  307/  FF057A :                     ; Prints string to layer
(1)  308/  FF057A :                     ; requires ASCII font
(1)  309/  FF057A :                     ; 
(1)  310/  FF057A :                     ; a0 - string data
(1)  311/  FF057A :                     ; d0 | LONG - 00|Lyr|X|Y, locate(lyr,x,y)
(1)  312/  FF057A :                     ; 
(1)  313/  FF057A :                     ; Notes:
(1)  314/  FF057A :                     ; "//b" - Show BYTE value
(1)  315/  FF057A :                     ; "//w" - Show WORD value
(1)  316/  FF057A :                     ; "//l" - Show LONG value
(1)  317/  FF057A :                     ;   $0A - Next line
(1)  318/  FF057A :                     ;   $00 - End of line
(1)  319/  FF057A :                     ; 
(1)  320/  FF057A :                     ; Uses:
(1)  321/  FF057A :                     ; a4-a6,d4-d7
(1)  322/  FF057A :                     ; --------------------------------------------------------
(1)  323/  FF057A :                     
(1)  324/  FF057A :                     Video_Print:
(1)  325/  FF057A :                     ; 		movem.l	d3-d7,-(sp)
(1)  326/  FF057A :                     ; 		movem.l	a4-a6,-(sp)
(1)  327/  FF057A :                     		
(1)  328/  FF057A : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  329/  FF0580 : 6100 0130           		bsr	vid_PickLayer
(1)  330/  FF0584 : 4BF8 966E           		lea	(RAM_VidPrntList),a5
(1)  331/  FF0588 :                     .newjump:
(1)  332/  FF0588 : 2D44 0004           		move.l	d4,4(a6)
(1)  333/  FF058C : 2A04                		move.l	d4,d5
(1)  334/  FF058E :                     .loop:
(1)  335/  FF058E : 1E18                		move.b	(a0)+,d7
(1)  336/  FF0590 : 6772                		beq	.exit
(1)  337/  FF0592 : 0C07 000A           		cmpi.b	#$A,d7			; $A - next line?
(1)  338/  FF0596 : 6718                		beq.s	.next
(1)  339/  FF0598 : 0C07 005C           		cmpi.b	#$5C,d7			; $27 ("\") special?
(1)  340/  FF059C : 6716                		beq.s	.special
(1)  341/  FF059E : 0247 00FF           		andi.w	#$FF,d7
(1)  342/  FF05A2 :                     .puttext:
(1)  343/  FF05A2 : DE78 966C           		add.w	(RAM_VidPrntVram).w,d7	; VRAM add
(1)  344/  FF05A6 : 3C87                		move.w	d7,(a6)
(1)  345/  FF05A8 : DABC 0002 0000      		add.l	#$20000,d5
(1)  346/  FF05AE : 60DE                		bra.s	.loop
(1)  347/  FF05B0 :                     ; Next line
(1)  348/  FF05B0 :                     .next:
(1)  349/  FF05B0 : D886                		add.l	d6,d4
(1)  350/  FF05B2 : 60D4                		bra.s	.newjump
(1)  351/  FF05B4 :                     
(1)  352/  FF05B4 :                     ; Specials
(1)  353/  FF05B4 :                     .special:
(1)  354/  FF05B4 : 1E18                		move.b	(a0)+,d7
(1)  355/  FF05B6 : 0C07 0062           		cmpi.b	#"b",d7
(1)  356/  FF05BA : 6712                		beq.s	.isbyte
(1)  357/  FF05BC : 0C07 0077           		cmpi.b	#"w",d7
(1)  358/  FF05C0 : 671E                		beq.s	.isword
(1)  359/  FF05C2 : 0C07 006C           		cmpi.b	#"l",d7
(1)  360/  FF05C6 : 672A                		beq.s	.islong
(1)  361/  FF05C8 : 3E3C 005C           		move.w	#"\\",d7			; nothing to do
(1)  362/  FF05CC : 60D4                		bra.s	.puttext
(1)  363/  FF05CE :                     		
(1)  364/  FF05CE :                     	; TEMPORAL VALUES
(1)  365/  FF05CE :                     .isbyte:
(1)  366/  FF05CE : 2AC5                		move.l	d5,(a5)+
(1)  367/  FF05D0 : 3AFC 0001           		move.w	#1,(a5)+
(1)  368/  FF05D4 : DABC 0004 0000      		add.l	#$40000,d5
(1)  369/  FF05DA : 2D45 0004           		move.l	d5,4(a6)
(1)  370/  FF05DE : 60AE                		bra	.loop
(1)  371/  FF05E0 :                     .isword:
(1)  372/  FF05E0 : 2AC5                		move.l	d5,(a5)+
(1)  373/  FF05E2 : 3AFC 0002           		move.w	#2,(a5)+
(1)  374/  FF05E6 : DABC 0008 0000      		add.l	#$80000,d5
(1)  375/  FF05EC : 2D45 0004           		move.l	d5,4(a6)
(1)  376/  FF05F0 : 609C                		bra	.loop
(1)  377/  FF05F2 :                     .islong:
(1)  378/  FF05F2 : 2AC5                		move.l	d5,(a5)+
(1)  379/  FF05F4 : 3AFC 0003           		move.w	#3,(a5)+
(1)  380/  FF05F8 : DABC 0010 0000      		add.l	#$100000,d5
(1)  381/  FF05FE : 2D45 0004           		move.l	d5,4(a6)
(1)  382/  FF0602 : 608A                		bra	.loop
(1)  383/  FF0604 :                     .exit:
(1)  384/  FF0604 :                     
(1)  385/  FF0604 :                     ; --------------------------------------------------------
(1)  386/  FF0604 :                     ; Print values
(1)  387/  FF0604 :                     ; 
(1)  388/  FF0604 :                     ; vvvv vvvv tttt
(1)  389/  FF0604 :                     ; v - vdp pos
(1)  390/  FF0604 :                     ; t - value type
(1)  391/  FF0604 :                     ; --------------------------------------------------------
(1)  392/  FF0604 :                     
(1)  393/  FF0604 : 7800                		moveq	#0,d4
(1)  394/  FF0606 : 7A00                		moveq	#0,d5
(1)  395/  FF0608 : 7C00                		moveq	#0,d6
(1)  396/  FF060A : 4BF8 966E           		lea	(RAM_VidPrntList),a5
(1)  397/  FF060E :                     .nextv:
(1)  398/  FF060E : 4A95                		tst.l	(a5)
(1)  399/  FF0610 : 6700 009E           		beq	.nothing
(1)  400/  FF0614 :                     
(1)  401/  FF0614 :                     	; grab value
(1)  402/  FF0614 : 7800                		moveq	#0,d4
(1)  403/  FF0616 : 1818                		move.b	(a0)+,d4
(1)  404/  FF0618 : E19C                		rol.l	#8,d4
(1)  405/  FF061A : 1818                		move.b	(a0)+,d4
(1)  406/  FF061C : E19C                		rol.l	#8,d4
(1)  407/  FF061E : 1818                		move.b	(a0)+,d4
(1)  408/  FF0620 : E19C                		rol.l	#8,d4
(1)  409/  FF0622 : 1818                		move.b	(a0)+,d4
(1)  410/  FF0624 : 2844                		movea.l	d4,a4
(1)  411/  FF0626 : 7800                		moveq	#0,d4
(1)  412/  FF0628 :                     
(1)  413/  FF0628 :                     	; get value
(1)  414/  FF0628 : 3C2D 0004           		move.w	4(a5),d6
(1)  415/  FF062C :                     		
(1)  416/  FF062C : BC7C 0001           		cmp.w	#1,d6		; byte?
(1)  417/  FF0630 : 660E                		bne.s	.vbyte
(1)  418/  FF0632 : 1814                		move.b	(a4),d4
(1)  419/  FF0634 : 2D55 0004           		move.l	(a5),4(a6)
(1)  420/  FF0638 : E91C                		rol.b	#4,d4
(1)  421/  FF063A : 6158                		bsr.s	.donibl
(1)  422/  FF063C : E91C                		rol.b	#4,d4
(1)  423/  FF063E : 6154                		bsr.s	.donibl
(1)  424/  FF0640 :                     .vbyte:
(1)  425/  FF0640 : BC7C 0002           		cmp.w	#2,d6		; word?
(1)  426/  FF0644 : 661C                		bne.s	.vword
(1)  427/  FF0646 : 1814                		move.b	(a4),d4
(1)  428/  FF0648 : E15C                		rol.w	#8,d4
(1)  429/  FF064A : 182C 0001           		move.b	1(a4),d4
(1)  430/  FF064E : 2D55 0004           		move.l	(a5),4(a6)
(1)  431/  FF0652 : E95C                		rol.w	#4,d4
(1)  432/  FF0654 : 613E                		bsr.s	.donibl
(1)  433/  FF0656 : E95C                		rol.w	#4,d4
(1)  434/  FF0658 : 613A                		bsr.s	.donibl
(1)  435/  FF065A : E95C                		rol.w	#4,d4
(1)  436/  FF065C : 6136                		bsr.s	.donibl
(1)  437/  FF065E : E95C                		rol.w	#4,d4
(1)  438/  FF0660 : 6132                		bsr.s	.donibl
(1)  439/  FF0662 :                     .vword:
(1)  440/  FF0662 : BC7C 0003           		cmp.w	#3,d6		; long?
(1)  441/  FF0666 : 6624                		bne.s	.vlong
(1)  442/  FF0668 : 1814                		move.b	(a4),d4
(1)  443/  FF066A : E19C                		rol.l	#8,d4
(1)  444/  FF066C : 182C 0001           		move.b	1(a4),d4
(1)  445/  FF0670 : E19C                		rol.l	#8,d4
(1)  446/  FF0672 : 182C 0002           		move.b	2(a4),d4
(1)  447/  FF0676 : E19C                		rol.l	#8,d4
(1)  448/  FF0678 : 182C 0003           		move.b	3(a4),d4
(1)  449/  FF067C : 2D55 0004           		move.l	(a5),4(a6)
(1)  450/  FF0680 : 3C3C 0007           		move.w	#7,d6
(1)  451/  FF0684 : E99C                .lngloop:	rol.l	#4,d4
(1)  452/  FF0686 : 610C                		bsr.s	.donibl
(1)  453/  FF0688 : 51CE FFFA           		dbf	d6,.lngloop
(1)  454/  FF068C :                     .vlong:
(1)  455/  FF068C : 429D                		clr.l	(a5)+
(1)  456/  FF068E : 425D                		clr.w	(a5)+
(1)  457/  FF0690 : 6000 FF7C           		bra	.nextv
(1)  458/  FF0694 :                     
(1)  459/  FF0694 :                     ; make nibble byte
(1)  460/  FF0694 :                     .donibl:
(1)  461/  FF0694 : 3A04                		move.w	d4,d5
(1)  462/  FF0696 : 0245 000F           		andi.w	#%1111,d5
(1)  463/  FF069A : BA3C 000A           		cmp.b	#$A,d5
(1)  464/  FF069E : 6D04                		blt.s	.lowr
(1)  465/  FF06A0 : DA3C 0007           		add.b	#7,d5
(1)  466/  FF06A4 :                     .lowr:
(1)  467/  FF06A4 : DA7C 0030           		add.w	#"0",d5
(1)  468/  FF06A8 : DA78 966C           		add.w	(RAM_VidPrntVram),d5
(1)  469/  FF06AC : 3C85                		move.w	d5,(a6)
(1)  470/  FF06AE : 4E75                		rts
(1)  471/  FF06B0 :                     ; exit
(1)  472/  FF06B0 :                     .nothing:
(1)  473/  FF06B0 :                     ; 		movem.l	(sp)+,a4-a6
(1)  474/  FF06B0 :                     ; 		movem.l	(sp)+,d3-d7
(1)  475/  FF06B0 : 4E75                		rts
(1)  476/  FF06B2 :                     
(1)  477/  FF06B2 :                     ; --------------------------------------------------------
(1)  478/  FF06B2 :                     ; Shared: pick layer / x pos / y pos and set size
(1)  479/  FF06B2 :                     ; --------------------------------------------------------
(1)  480/  FF06B2 :                     
(1)  481/  FF06B2 :                     vid_PickLayer:
(1)  482/  FF06B2 : 2C00                		move.l	d0,d6			; Pick layer
(1)  483/  FF06B4 : 4846                		swap	d6
(1)  484/  FF06B6 : 0806 0000           		btst	#0,d6
(1)  485/  FF06BA : 671E                		beq.s	.plawnd
(1)  486/  FF06BC : 1839 FFFF 97F2      		move.b	(RAM_VdpRegs+4).l,d4	; BG
(1)  487/  FF06C2 : 3A04                		move.w	d4,d5
(1)  488/  FF06C4 : E24D                		lsr.w	#1,d5
(1)  489/  FF06C6 : 0245 0003           		andi.w	#%11,d5
(1)  490/  FF06CA : 4844                		swap	d4
(1)  491/  FF06CC : 3805                		move.w	d5,d4
(1)  492/  FF06CE : 4844                		swap	d4
(1)  493/  FF06D0 : 0244 0001           		andi.w	#1,d4
(1)  494/  FF06D4 : E14C                		lsl.w	#8,d4
(1)  495/  FF06D6 : EB4C                		lsl.w	#5,d4
(1)  496/  FF06D8 : 6028                		bra.s	.golyr
(1)  497/  FF06DA :                     .plawnd:
(1)  498/  FF06DA : 1839 FFFF 97F0      		move.b	(RAM_VdpRegs+2).l,d4	; FG
(1)  499/  FF06E0 : 0806 0001           		btst	#1,d6
(1)  500/  FF06E4 : 6706                		beq.s	.nowd
(1)  501/  FF06E6 : 1839 FFFF 97F1      		move.b	(RAM_VdpRegs+3).l,d4	; WINDOW
(1)  502/  FF06EC :                     .nowd:		
(1)  503/  FF06EC : 3A04                		move.w	d4,d5
(1)  504/  FF06EE : E84D                		lsr.w	#4,d5
(1)  505/  FF06F0 : 0245 0003           		andi.w	#%11,d5
(1)  506/  FF06F4 : 4844                		swap	d4
(1)  507/  FF06F6 : 3805                		move.w	d5,d4
(1)  508/  FF06F8 : 4844                		swap	d4
(1)  509/  FF06FA : 0244 000E           		andi.w	#%00001110,d4
(1)  510/  FF06FE : E14C                		lsl.w	#8,d4
(1)  511/  FF0700 : E54C                		lsl.w	#2,d4
(1)  512/  FF0702 :                     .golyr:
(1)  513/  FF0702 : 0044 4000           		ori.w	#$4000,d4
(1)  514/  FF0706 : 3A00                		move.w	d0,d5			; Y start pos
(1)  515/  FF0708 : 0245 00FF           		andi.w	#$FF,d5			; Y only
(1)  516/  FF070C : ED4D                		lsl.w	#6,d5			
(1)  517/  FF070E : 1C38 97FE           		move.b	(RAM_VdpRegs+$10).w,d6
(1)  518/  FF0712 : 0246 0003           		andi.w	#%11,d6
(1)  519/  FF0716 : 670A                		beq.s	.thissz
(1)  520/  FF0718 : DA45                		add.w	d5,d5			; H64
(1)  521/  FF071A : 0246 0002           		andi.w	#%10,d6
(1)  522/  FF071E : 6702                		beq.s	.thissz
(1)  523/  FF0720 : DA45                		add.w	d5,d5			; H128		
(1)  524/  FF0722 :                     .thissz:
(1)  525/  FF0722 : D845                		add.w	d5,d4
(1)  526/  FF0724 : 3A00                		move.w	d0,d5
(1)  527/  FF0726 : 0245 FF00           		andi.w	#$FF00,d5		; X only
(1)  528/  FF072A : EE4D                		lsr.w	#7,d5
(1)  529/  FF072C : D845                		add.w	d5,d4			; X add
(1)  530/  FF072E : 4844                		swap	d4
(1)  531/  FF0730 : 7C00                		moveq	#0,d6
(1)  532/  FF0732 : 3C3C 0040           		move.w	#$40,d6			; Set jump size
(1)  533/  FF0736 : 1A38 97FE           		move.b	(RAM_VdpRegs+$10).w,d5
(1)  534/  FF073A : 0245 0003           		andi.w	#%11,d5
(1)  535/  FF073E : 670A                		beq.s	.thisszj
(1)  536/  FF0740 : DC46                		add.w	d6,d6			; H64
(1)  537/  FF0742 : 0245 0002           		andi.w	#%10,d5
(1)  538/  FF0746 : 6702                		beq.s	.thisszj
(1)  539/  FF0748 : DC46                		add.w	d6,d6			; H128		
(1)  540/  FF074A :                     .thisszj:
(1)  541/  FF074A : 4846                		swap	d6
(1)  542/  FF074C : 4E75                		rts
(1)  543/  FF074E :                     		
(1)  544/  FF074E :                     ; --------------------------------------------------------
(1)  545/  FF074E :                     ; Video_Fill
(1)  546/  FF074E :                     ; 
(1)  547/  FF074E :                     ; Fill data to VRAM
(1)  548/  FF074E :                     ;
(1)  549/  FF074E :                     ; d0 | WORD - Fill data
(1)  550/  FF074E :                     ; d1 | WORD - Size
(1)  551/  FF074E :                     ; d2 | WORD - VRAM
(1)  552/  FF074E :                     ; --------------------------------------------------------
(1)  553/  FF074E :                     
(1)  554/  FF074E :                     Video_Fill:
(1)  555/  FF074E : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)  556/  FF0754 :                     		
(1)  557/  FF0754 : 383C 8100           		move.w	#$8100,d4
(1)  558/  FF0758 : 1838 97EF           		move.b	(RAM_VdpRegs+1),d4
(1)  559/  FF075C : 08C4 0004           		bset	#bitDmaEnbl,d4
(1)  560/  FF0760 : 3884                		move.w	d4,(a4)
(1)  561/  FF0762 : 3814                .dmaw:		move.w	(a4),d4
(1)  562/  FF0764 : 0804 0001           		btst	#bitDma,d4
(1)  563/  FF0768 : 66F8                		bne.s	.dmaw
(1)  564/  FF076A : 38BC 8F01           		move.w	#$8F01,(a4)		; Increment $01
(1)  565/  FF076E :                     
(1)  566/  FF076E :                     	; SIZE
(1)  567/  FF076E : 3801                		move.w	d1,d4
(1)  568/  FF0770 : 2A3C 9400 9300      		move.l	#$94009300,d5
(1)  569/  FF0776 : E24C                		lsr.w	#1,d4
(1)  570/  FF0778 : 1A04                		move.b	d4,d5
(1)  571/  FF077A : 4845                		swap	d5
(1)  572/  FF077C : E04C                		lsr.w	#8,d4
(1)  573/  FF077E : 1A04                		move.b	d4,d5
(1)  574/  FF0780 : 4845                		swap	d5
(1)  575/  FF0782 : 2885                		move.l	d5,(a4)
(1)  576/  FF0784 : 38BC 9780           		move.w	#$9780,(a4)		; DMA Fill bit
(1)  577/  FF0788 :                     
(1)  578/  FF0788 :                     	; DESTINATION
(1)  579/  FF0788 : 2802                		move.l	d2,d4
(1)  580/  FF078A :                     ; 		lsl.w	#5,d4
(1)  581/  FF078A : 3A04                		move.w	d4,d5
(1)  582/  FF078C : 0245 3FFF           		andi.w	#$3FFF,d5
(1)  583/  FF0790 : 0045 4000           		ori.w	#$4000,d5
(1)  584/  FF0794 : 4845                		swap	d5
(1)  585/  FF0796 : 3A04                		move.w	d4,d5
(1)  586/  FF0798 : E04D                		lsr.w	#8,d5
(1)  587/  FF079A : EC4D                		lsr.w	#6,d5
(1)  588/  FF079C : 0245 0003           		andi.w	#%11,d5
(1)  589/  FF07A0 : 0045 0080           		ori.w	#$80,d5
(1)  590/  FF07A4 : 2885                		move.l	d5,(a4)
(1)  591/  FF07A6 : 3940 FFFC           		move.w	d0,-4(a4)
(1)  592/  FF07AA : 3814                .dmawe:		move.w	(a4),d4
(1)  593/  FF07AC : 0804 0001           		btst	#bitDma,d4
(1)  594/  FF07B0 : 66F8                		bne.s	.dmawe
(1)  595/  FF07B2 :                     
(1)  596/  FF07B2 : 38BC 8F02           		move.w	#$8F02,(a4)		; Increment $02
(1)  597/  FF07B6 : 383C 8100           		move.w	#$8100,d4
(1)  598/  FF07BA : 1838 97EF           		move.b	(RAM_VdpRegs+1),d4
(1)  599/  FF07BE : 3884                		move.w	d4,(a4)
(1)  600/  FF07C0 : 4E75                		rts
(1)  601/  FF07C2 :                     
(1)  602/  FF07C2 :                     ; --------------------------------------------------------
(1)  603/  FF07C2 :                     ; Video_Copy
(1)  604/  FF07C2 :                     ; 
(1)  605/  FF07C2 :                     ; Copy VRAM data to another location
(1)  606/  FF07C2 :                     ;
(1)  607/  FF07C2 :                     ; d0 | WORD - VRAM Source
(1)  608/  FF07C2 :                     ; d1 | WORD - Size
(1)  609/  FF07C2 :                     ; d2 | WORD - VRAM Destination
(1)  610/  FF07C2 :                     ; --------------------------------------------------------
(1)  611/  FF07C2 :                     
(1)  612/  FF07C2 :                     Video_Copy:
(1)  613/  FF07C2 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)  614/  FF07C8 :                     		
(1)  615/  FF07C8 : 383C 8100           		move.w	#$8100,d4
(1)  616/  FF07CC : 1838 97EF           		move.b	(RAM_VdpRegs+1),d4
(1)  617/  FF07D0 : 08C4 0004           		bset	#bitDmaEnbl,d4
(1)  618/  FF07D4 : 3884                		move.w	d4,(a4)
(1)  619/  FF07D6 : 3814                .dmaw:		move.w	(a4),d4
(1)  620/  FF07D8 : 0804 0001           		btst	#bitDma,d4
(1)  621/  FF07DC : 66F8                		bne.s	.dmaw
(1)  622/  FF07DE : 38BC 8F01           		move.w	#$8F01,(a4)		; Increment $01
(1)  623/  FF07E2 :                     
(1)  624/  FF07E2 :                     	; SIZE
(1)  625/  FF07E2 : 3801                		move.w	d1,d4
(1)  626/  FF07E4 : 2A3C 9400 9300      		move.l	#$94009300,d5
(1)  627/  FF07EA : E24C                		lsr.w	#1,d4
(1)  628/  FF07EC : 1A04                		move.b	d4,d5
(1)  629/  FF07EE : 4845                		swap	d5
(1)  630/  FF07F0 : E04C                		lsr.w	#8,d4
(1)  631/  FF07F2 : 1A04                		move.b	d4,d5
(1)  632/  FF07F4 : 4845                		swap	d5
(1)  633/  FF07F6 : 2885                		move.l	d5,(a4)
(1)  634/  FF07F8 :                     	
(1)  635/  FF07F8 :                     	; SOURCE
(1)  636/  FF07F8 : 2A3C 9600 9500      		move.l	#$96009500,d5
(1)  637/  FF07FE : 3800                		move.w	d0,d4
(1)  638/  FF0800 : 1A04                		move.b	d4,d5
(1)  639/  FF0802 : 4845                		swap	d5
(1)  640/  FF0804 : E04C                		lsr.w	#8,d4
(1)  641/  FF0806 : 1A04                		move.b	d4,d5
(1)  642/  FF0808 : 2885                		move.l	d5,(a4)
(1)  643/  FF080A : 38BC 97C0           		move.w	#$97C0,(a4)		; DMA Fill bit
(1)  644/  FF080E :                     		
(1)  645/  FF080E :                     	; DESTINATION
(1)  646/  FF080E : 2802                		move.l	d2,d4
(1)  647/  FF0810 :                     ; 		lsl.w	#5,d4
(1)  648/  FF0810 : 3A04                		move.w	d4,d5
(1)  649/  FF0812 : 0245 3FFF           		andi.w	#$3FFF,d5
(1)  650/  FF0816 : 0045 4000           		ori.w	#$4000,d5
(1)  651/  FF081A : 4845                		swap	d5
(1)  652/  FF081C : 3A04                		move.w	d4,d5
(1)  653/  FF081E : E04D                		lsr.w	#8,d5
(1)  654/  FF0820 : EC4D                		lsr.w	#6,d5
(1)  655/  FF0822 : 0245 0003           		andi.w	#%11,d5
(1)  656/  FF0826 : 0045 00C0           		ori.w	#$C0,d5
(1)  657/  FF082A : 2885                		move.l	d5,(a4)
(1)  658/  FF082C : 3940 FFFC           		move.w	d0,-4(a4)
(1)  659/  FF0830 : 3814                .dmawe:		move.w	(a4),d4
(1)  660/  FF0832 : 0804 0001           		btst	#bitDma,d4
(1)  661/  FF0836 : 66F8                		bne.s	.dmawe
(1)  662/  FF0838 :                     
(1)  663/  FF0838 : 38BC 8F02           		move.w	#$8F02,(a4)		; Increment $02
(1)  664/  FF083C : 383C 8100           		move.w	#$8100,d4
(1)  665/  FF0840 : 1838 97EF           		move.b	(RAM_VdpRegs+1),d4
(1)  666/  FF0844 : 3884                		move.w	d4,(a4)
(1)  667/  FF0846 : 4E75                		rts
(1)  668/  FF0848 :                     
(1)  669/  FF0848 :                     ; --------------------------------------------------------
(1)  670/  FF0848 :                     ; Video_LoadArt
(1)  671/  FF0848 :                     ; 
(1)  672/  FF0848 :                     ; notes below
(1)  673/  FF0848 :                     ; --------------------------------------------------------
(1)  674/  FF0848 :                     
(1)  675/  FF0848 :                     Video_LoadArt:
(1)  676/  FF0848 : 4EF9 FFFF 9806      		jmp	(RAM_ExRamSub).l	; (first routine)
(1)  677/  FF084E :                     
(1)  678/  FF084E :                     ; ====================================================================
(1)  679/  FF084E :                     ; --------------------------------------------------------
(1)  680/  FF084E :                     ; DMA ROM to VDP Transfers, sets RV=1
(1)  681/  FF084E :                     ; --------------------------------------------------------
(1)  682/  FF084E :                     
(1)  683/  FF084E :                     Video_RamCode:
(1)  684/  FF084E : 6000 000E           		bra.w	.load_art
(1)  685/  FF0852 : 6000 000A           		bra.w	.load_art
(1)  686/  FF0856 : 6000 0006           		bra.w	.load_art
(1)  687/  FF085A : 6000 0002           		bra.w	.load_art
(1)  688/  FF085E :                     
(1)  689/  FF085E :                     ; --------------------------------------------------------
(1)  690/  FF085E :                     ; Load graphics using DMA
(1)  691/  FF085E :                     ;
(1)  692/  FF085E :                     ; d0 | LONG - Art data
(1)  693/  FF085E :                     ; d1 | WORD - Size
(1)  694/  FF085E :                     ; d2 | WORD - VRAM (cell)
(1)  695/  FF085E :                     ; 
(1)  696/  FF085E :                     ; Uses:
(1)  697/  FF085E :                     ; d4-d5,a4
(1)  698/  FF085E :                     ;
(1)  699/  FF085E :                     ; NOTES:
(1)  700/  FF085E :                     ; RV bit must be set before starting DMA
(1)  701/  FF085E :                     ; --------------------------------------------------------
(1)  702/  FF085E :                     
(1)  703/  FF085E :                     .load_art:
(1)  704/  FF085E : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)  705/  FF0864 : 383C 8100           		move.w	#$8100,d4
(1)  706/  FF0868 : 1838 97EF           		move.b	(RAM_VdpRegs+1),d4
(1)  707/  FF086C : 08C4 0004           		bset	#bitDmaEnbl,d4
(1)  708/  FF0870 : 3884                		move.w	d4,(a4)
(1)  709/  FF0872 :                     
(1)  710/  FF0872 :                     	; SIZE
(1)  711/  FF0872 : 3801                		move.w	d1,d4
(1)  712/  FF0874 : 2A3C 9400 9300      		move.l	#$94009300,d5
(1)  713/  FF087A : E24C                		lsr.w	#1,d4
(1)  714/  FF087C : 1A04                		move.b	d4,d5
(1)  715/  FF087E : 4845                		swap	d5
(1)  716/  FF0880 : E04C                		lsr.w	#8,d4
(1)  717/  FF0882 : 1A04                		move.b	d4,d5
(1)  718/  FF0884 : 4845                		swap	d5
(1)  719/  FF0886 : 2885                		move.l	d5,(a4)
(1)  720/  FF0888 :                     
(1)  721/  FF0888 :                     	; SOURCE
(1)  722/  FF0888 : 2800                		move.l	d0,d4
(1)  723/  FF088A : E28C                  		lsr.l	#1,d4
(1)  724/  FF088C : 2A3C 9600 9500       		move.l	#$96009500,d5
(1)  725/  FF0892 : 1A04                 		move.b	d4,d5
(1)  726/  FF0894 : E08C                 		lsr.l	#8,d4
(1)  727/  FF0896 : 4845                 		swap	d5
(1)  728/  FF0898 : 1A04                 		move.b	d4,d5
(1)  729/  FF089A : 2885                 		move.l	d5,(a4)
(1)  730/  FF089C : 3A3C 9700            		move.w	#$9700,d5
(1)  731/  FF08A0 : E08C                 		lsr.l	#8,d4
(1)  732/  FF08A2 : 1A04                 		move.b	d4,d5
(1)  733/  FF08A4 : 3885                 		move.w	d5,(a4)
(1)  734/  FF08A6 :                      		
(1)  735/  FF08A6 :                     	; DESTINATION
(1)  736/  FF08A6 : 3802                		move.w	d2,d4
(1)  737/  FF08A8 : C87C 07FF           		and.w	#$7FF,d4
(1)  738/  FF08AC : EB4C                		lsl.w	#5,d4
(1)  739/  FF08AE : 3A04                		move.w	d4,d5
(1)  740/  FF08B0 : C8BC 0000 3FE0      		and.l	#$3FE0,d4
(1)  741/  FF08B6 : 0044 4000           		ori.w	#$4000,d4
(1)  742/  FF08BA : 3884                		move.w	d4,(a4)				; First write
(1)  743/  FF08BC : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Stop Z80
(1)  744/  FF08C4 : E04D                		lsr.w	#8,d5
(1)  745/  FF08C6 : EC4D                		lsr.w	#6,d5
(1)  746/  FF08C8 : 0245 0003           		andi.w	#%11,d5
(1)  747/  FF08CC : 0045 0080           		ori.w	#$80,d5
(1)  748/  FF08D0 :                     .wait:
(1)  749/  FF08D0 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for cpu
(1)  750/  FF08D8 : 66F6                		bne.s	.wait
(1)  751/  FF08DA : 2800                		move.l	d0,d4
(1)  752/  FF08DC : 4844                		swap	d4
(1)  753/  FF08DE : E04C                		lsr.w	#8,d4
(1)  754/  FF08E0 : B83C 00FF           		cmp.b	#$FF,d4
(1)  755/  FF08E4 : 6738                		beq.s	.from_ram
(1)  756/  FF08E6 : 3839 00A1 5106      		move.w	(sysmars_reg+dreqctl).l,d4	; Set RV=1
(1)  757/  FF08EC : 887C 0001           		or.w	#1,d4				; (68k ROM map moves to $000000)
(1)  758/  FF08F0 : 33C4 00A1 5106      		move.w	d4,(sysmars_reg+dreqctl).l	; Make sure SH2 isn't touching ROM
(1)  759/  FF08F6 : 3F05                 		move.w	d5,-(sp)
(1)  760/  FF08F8 : 389F                		move.w	(sp)+,(a4)			; Second write
(1)  761/  FF08FA : 3839 00A1 5106      		move.w	(sysmars_reg+dreqctl).l,d4	; Set RV=0
(1)  762/  FF0900 : C87C 00FE           		and.w	#%11111110,d4			; (68k ROM map returns to $880000)
(1)  763/  FF0904 : 33C4 00A1 5106      		move.w	d4,(sysmars_reg+dreqctl).l
(1)  764/  FF090A : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)  765/  FF0912 : 383C 8100           		move.w	#$8100,d4
(1)  766/  FF0916 : 1838 97EF           		move.b	(RAM_VdpRegs+1),d4
(1)  767/  FF091A : 3884                		move.w	d4,(a4)
(1)  768/  FF091C : 4E75                		rts
(1)  769/  FF091E :                     .from_ram:
(1)  770/  FF091E : 3F05                 		move.w	d5,-(sp)
(1)  771/  FF0920 : 389F                		move.w	(sp)+,(a4)			; Second write
(1)  772/  FF0922 : 383C 8100           		move.w	#$8100,d4
(1)  773/  FF0926 : 1838 97EF           		move.b	(RAM_VdpRegs+1),d4
(1)  774/  FF092A : 3884                		move.w	d4,(a4)
(1)  775/  FF092C : 4E75                		rts
(1)  776/  FF092E :                     		
(1)  777/  FF092E :                     ; --------------------------------------------------------
(1)  778/  FF092E :                     
(1)  779/  FF092E :                     Video_RamCode_e:
(1)  780/  FF092E :                     		align 2
(1)  781/  FF092E :                     
(1)  782/  FF092E :                     ; ====================================================================
(1)  783/  FF092E :                     ; --------------------------------------------------------
(1)  784/  FF092E :                     ; Video data
(1)  785/  FF092E :                     ; --------------------------------------------------------
(1)  786/  FF092E :                     
(1)  787/  FF092E :                     list_vdpregs:
(1)  788/  FF092E : 04                  		dc.b $04			; HBlank int off, HV Counter on
(1)  789/  FF092F : 44                  		dc.b $44			; Display ON, VBlank int off
(1)  790/  FF0930 : 30                  		dc.b (($C000)>>10)		; ForeGrd at VRAM $C000 (%00xxx000)
(1)  791/  FF0931 : 34                  		dc.b (($D000)>>10)		; Window  at VRAM $D000 (%00xxxxy0)
(1)  792/  FF0932 : 07                  		dc.b (($E000)>>13)		; BackGrd at VRAM $E000 (%00000xxx)
(1)  793/  FF0933 : 7C                  		dc.b (($F800)>>9)		; Sprites at VRAM $F800 (%0xxxxxxy)
(1)  794/  FF0934 : 00                  		dc.b $00			; Nothing
(1)  795/  FF0935 : 00                  		dc.b $00			; Background color: 0
(1)  796/  FF0936 : 00                  		dc.b $00			; Nothing
(1)  797/  FF0937 : 00                  		dc.b $00			; Nothing
(1)  798/  FF0938 : 00                  		dc.b $00			; HInt value
(1)  799/  FF0939 : 00                  		dc.b (%000|%00)			; No ExtInt, Scroll: VSCR:full HSCR:full
(1)  800/  FF093A : 81                  		dc.b $81			; H40, No shadow mode, Normal resolution
(1)  801/  FF093B : 3F                  		dc.b (($FC00)>>10)		; HScroll at VRAM $FC00 (%00xxxxxx)
(1)  802/  FF093C : 00                  		dc.b $00			; Nothing
(1)  803/  FF093D : 02                  		dc.b $02			; VDP Auto increment by $02
(1)  804/  FF093E : 01                  		dc.b (%00<<4)|%01		; Layer size: V32 H64
(1)  805/  FF093F : 00                  		dc.b $00
(1)  806/  FF0940 : 00                  		dc.b $00
(1)  807/  FF0941 :                     		align 2
(1)  808/  FF0942 :                     ASCII_PAL:	;binclude "engine/shared/ascii_pal.bin"
(1)  809/  FF0942 : 0000 0EEE 0CCC 0AAA 		dc.w $0000,$0EEE,$0CCC,$0AAA,$0888,$0444,$000E,$0008
                    0888 0444 000E 0008 
(1)  810/  FF0952 : 00EE 0088 00E0 0080 		dc.w $00EE,$0088,$00E0,$0080,$0E00,$0800,$0000,$0000
                    0E00 0800 0000 0000 
(1)  811/  FF0962 :                     ASCII_PAL_e:
(1)  812/  FF0962 :                     ASCII_FONT:	binclude "system/md/data/font.bin"
(1)  813/  FF1962 :                     ASCII_FONT_e:
(1)  814/  FF1962 :                     		align 2
(1)  815/  FF1962 :                     
      35/  FF1962 :                     		include	"system/md/sound.asm"
(1)    1/  FF1962 :                     ; ====================================================================
(1)    2/  FF1962 :                     ; ----------------------------------------------------------------
(1)    3/  FF1962 :                     ; MD Sound
(1)    4/  FF1962 :                     ; ----------------------------------------------------------------
(1)    5/  FF1962 :                     
(1)    6/  FF1962 :                     ; ====================================================================
(1)    7/  FF1962 :                     ; ----------------------------------------------------------------
(1)    8/  FF1962 :                     ; Subroutines
(1)    9/  FF1962 :                     ; ----------------------------------------------------------------
(1)   10/  FF1962 :                     
(1)   11/  FF1962 :                     ; --------------------------------------------------------
(1)   12/  FF1962 :                     ; Init Sound
(1)   13/  FF1962 :                     ; 
(1)   14/  FF1962 :                     ; Uses:
(1)   15/  FF1962 :                     ; a0-a1,d0-d1
(1)   16/  FF1962 :                     ; --------------------------------------------------------
(1)   17/  FF1962 :                     
(1)   18/  FF1962 :                     Sound_Init:
(1)   19/  FF1962 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Stop Z80
(1)   20/  FF196A : 13FC 0001 00A1 1200 		move.b	#1,(z80_reset).l		; Reset
(1)   21/  FF1972 :                     .wait:
(1)   22/  FF1972 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for it
(1)   23/  FF197A : 66F6                		bne.s	.wait
(1)   24/  FF197C : 41F9 00A0 0000      		lea	(z80_cpu).l,a0
(1)   25/  FF1982 : 303C 1FFF           		move.w	#$1FFF,d0
(1)   26/  FF1986 : 7200                		moveq	#0,d1
(1)   27/  FF1988 :                     .cleanup:
(1)   28/  FF1988 : 10C1                		move.b	d1,(a0)+
(1)   29/  FF198A : 51C8 FFFC           		dbf	d0,.cleanup
(1)   30/  FF198E : 41F9 00FF 1BCE      		lea	(Z80_CODE).l,a0			; Send sound code
(1)   31/  FF1994 : 43F9 00A0 0000      		lea	(z80_cpu).l,a1
(1)   32/  FF199A : 303C 126F           		move.w	#(Z80_CODE_END-Z80_CODE)-1,d0
(1)   33/  FF199E :                     .copy:
(1)   34/  FF199E : 12D8                		move.b	(a0)+,(a1)+
(1)   35/  FF19A0 : 51C8 FFFC           		dbf	d0,.copy
(1)   36/  FF19A4 : 13FC 0001 00A1 1200 		move.b	#1,(z80_reset).l		; Reset
(1)   37/  FF19AC : 4E71                		nop 
(1)   38/  FF19AE : 4E71                		nop 
(1)   39/  FF19B0 : 4E71                		nop 
(1)   40/  FF19B2 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)   41/  FF19BA : 4E75                		rts
(1)   42/  FF19BC :                     
(1)   43/  FF19BC :                     ; --------------------------------------------------------
(1)   44/  FF19BC :                     ; Sound_DMA_Pause
(1)   45/  FF19BC :                     ; 
(1)   46/  FF19BC :                     ; Call this before doing any DMA task
(1)   47/  FF19BC :                     ; --------------------------------------------------------
(1)   48/  FF19BC :                     
(1)   49/  FF19BC :                     Sound_DMA_Pause:
(1)   50/  FF19BC : 40E7                		move.w	sr,-(sp)
(1)   51/  FF19BE : 007C 0700           		or.w	#$700,sr
(1)   52/  FF19C2 :                     .retry:
(1)   53/  FF19C2 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Stop Z80
(1)   54/  FF19CA :                     .wait:
(1)   55/  FF19CA : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for it
(1)   56/  FF19D2 : 66F6                		bne.s	.wait
(1)   57/  FF19D4 : 13FC 0001 00A0 0D73 		move.b	#1,(z80_cpu+commZRomBlk)	; Tell Z80 we want the bus
(1)   58/  FF19DC : 1039 00A0 0D74      		move.b	(z80_cpu+commZRomRd),d0		; Get mid-read bit
(1)   59/  FF19E2 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l			; Resume Z80
(1)   60/  FF19EA : 4A00                		tst.b	d0
(1)   61/  FF19EC : 6708                		beq.s	.safe
(1)   62/  FF19EE : 7044                		moveq	#68,d0
(1)   63/  FF19F0 : 51C8 FFFE           		dbf	d0,*
(1)   64/  FF19F4 : 60CC                		bra.s	.retry
(1)   65/  FF19F6 :                     .safe:
(1)   66/  FF19F6 : 46DF                		move.w	(sp)+,sr
(1)   67/  FF19F8 : 4E75                		rts
(1)   68/  FF19FA :                     
(1)   69/  FF19FA :                     ; --------------------------------------------------------
(1)   70/  FF19FA :                     ; Sound_DMA_Resume
(1)   71/  FF19FA :                     ; 
(1)   72/  FF19FA :                     ; Call this after finishing DMA
(1)   73/  FF19FA :                     ; --------------------------------------------------------
(1)   74/  FF19FA :                     
(1)   75/  FF19FA :                     Sound_DMA_Resume:
(1)   76/  FF19FA : 40E7                		move.w	sr,-(sp)
(1)   77/  FF19FC : 007C 0700           		or.w	#$700,sr
(1)   78/  FF1A00 : 6140                		bsr	sndLockZ80
(1)   79/  FF1A02 : 13FC 0000 00A0 0D73 		move.b	#0,(z80_cpu+commZRomBlk)
(1)   80/  FF1A0A : 614A                		bsr	sndUnlockZ80
(1)   81/  FF1A0C : 46DF                		move.w	(sp)+,sr
(1)   82/  FF1A0E : 4E75                		rts
(1)   83/  FF1A10 :                     
(1)   84/  FF1A10 :                     ; --------------------------------------------------------
(1)   85/  FF1A10 :                     ; Sound_Request_Word
(1)   86/  FF1A10 :                     ; 
(1)   87/  FF1A10 :                     ; d0    - request id
(1)   88/  FF1A10 :                     ; d1-d5 - arguments
(1)   89/  FF1A10 :                     ; --------------------------------------------------------
(1)   90/  FF1A10 :                     
(1)   91/  FF1A10 :                     SoundReq_SetSample:
(1)   92/  FF1A10 : 6150                		bsr	sndReq_Enter
(1)   93/  FF1A12 : 3E3C 0021           		move.w	#$21,d7
(1)   94/  FF1A16 : 6100 0096           		bsr	sndReq_scmd
(1)   95/  FF1A1A : 2E00                		move.l	d0,d7
(1)   96/  FF1A1C : 6100 00A2           		bsr	sndReq_saddr
(1)   97/  FF1A20 : 2E01                		move.l	d1,d7
(1)   98/  FF1A22 : 6100 009C           		bsr	sndReq_saddr
(1)   99/  FF1A26 : 2E02                		move.l	d2,d7
(1)  100/  FF1A28 : 6100 0096           		bsr	sndReq_saddr
(1)  101/  FF1A2C : 2E03                		move.l	d3,d7
(1)  102/  FF1A2E : 6100 0094           		bsr	sndReq_sword
(1)  103/  FF1A32 : 6064                		bra 	sndReq_Exit
(1)  104/  FF1A34 :                     Sound_Request:
(1)  105/  FF1A34 : 612C                		bsr	sndReq_Enter
(1)  106/  FF1A36 : 3E00                		move.w	d0,d7
(1)  107/  FF1A38 : 6174                		bsr	sndReq_scmd
(1)  108/  FF1A3A : 2E01                		move.l	d1,d7
(1)  109/  FF1A3C : 6100 0086           		bsr	sndReq_sword
(1)  110/  FF1A40 : 6056                		bra 	sndReq_Exit
(1)  111/  FF1A42 :                     
(1)  112/  FF1A42 :                     ; ------------------------------------------------
(1)  113/  FF1A42 :                     ; Lock Z80, get bus
(1)  114/  FF1A42 :                     ; ------------------------------------------------
(1)  115/  FF1A42 :                     
(1)  116/  FF1A42 :                     sndLockZ80:
(1)  117/  FF1A42 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Stop Z80
(1)  118/  FF1A4A :                     .wait:
(1)  119/  FF1A4A : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for it
(1)  120/  FF1A52 : 66F6                		bne.s	.wait
(1)  121/  FF1A54 : 4E75                		rts
(1)  122/  FF1A56 :                     		
(1)  123/  FF1A56 :                     ; ------------------------------------------------
(1)  124/  FF1A56 :                     ; Unlock Z80, return bus
(1)  125/  FF1A56 :                     ; ------------------------------------------------
(1)  126/  FF1A56 :                     
(1)  127/  FF1A56 :                     sndUnlockZ80:
(1)  128/  FF1A56 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)  129/  FF1A5E : 4E75                		rts
(1)  130/  FF1A60 :                     sndSendCmd:
(1)  131/  FF1A60 : 4E75                		rts
(1)  132/  FF1A62 :                     
(1)  133/  FF1A62 :                     ; ------------------------------------------------
(1)  134/  FF1A62 :                     ; 68k-to-z80 Sound request
(1)  135/  FF1A62 :                     ; enter/exit routines
(1)  136/  FF1A62 :                     ; ------------------------------------------------
(1)  137/  FF1A62 :                     
(1)  138/  FF1A62 :                     sndReq_Enter:
(1)  139/  FF1A62 : 48F9 60C0 FFFF 965C 		movem.l	d6-d7/a5-a6,(RAM_SoundLastReg).l
(1)  140/  FF1A6A : 7C00                		moveq	#0,d6
(1)  141/  FF1A6C : 40C6                		move.w	sr,d6
(1)  142/  FF1A6E : 4846                		swap	d6
(1)  143/  FF1A70 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Stop Z80
(1)  144/  FF1A78 : 007C 0700           		or.w	#$0700,sr			; disable ints
(1)  145/  FF1A7C : 4BF9 00A0 0D72      		lea	(z80_cpu+commZWrite),a5		; a5 - commZWrite
(1)  146/  FF1A82 : 4DF9 00A0 0A00      		lea	(z80_cpu+commZfifo),a6		; a6 - fifo command list
(1)  147/  FF1A88 :                     .wait:
(1)  148/  FF1A88 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for Z80
(1)  149/  FF1A90 : 66F6                		bne.s	.wait
(1)  150/  FF1A92 : 1C15                		move.b	(a5),d6				; d6 - index fifo position
(1)  151/  FF1A94 : 4886                		ext.w	d6				; extend to 16 bits
(1)  152/  FF1A96 : 4E75                		rts
(1)  153/  FF1A98 :                     ; JUMP ONLY
(1)  154/  FF1A98 :                     sndReq_Exit:
(1)  155/  FF1A98 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)  156/  FF1AA0 : 4846                		swap	d6
(1)  157/  FF1AA2 : 46C6                		move.w	d6,sr
(1)  158/  FF1AA4 : 4CF9 60C0 FFFF 965C 		movem.l	(RAM_SoundLastReg).l,d6-d7/a5-a6
(1)  159/  FF1AAC : 4E75                		rts
(1)  160/  FF1AAE :                     		
(1)  161/  FF1AAE :                     ; ------------------------------------------------
(1)  162/  FF1AAE :                     ; Send request id and arguments
(1)  163/  FF1AAE :                     ;
(1)  164/  FF1AAE :                     ; Input:
(1)  165/  FF1AAE :                     ; d7 - byte to write
(1)  166/  FF1AAE :                     ; d6 - index pointer
(1)  167/  FF1AAE :                     ; a5 - commZWrite, update index
(1)  168/  FF1AAE :                     ; a6 - commZfifo command list
(1)  169/  FF1AAE :                     ; 
(1)  170/  FF1AAE :                     ; *** CALL sndReq_Enter FIRST ***
(1)  171/  FF1AAE :                     ; ------------------------------------------------
(1)  172/  FF1AAE :                     
(1)  173/  FF1AAE :                     sndReq_scmd:
(1)  174/  FF1AAE : 1DBC 00FF 6000      		move.b	#-1,(a6,d6.w)			; write command-start flag
(1)  175/  FF1AB4 : 5206                		addq.b	#1,d6				; next fifo pos
(1)  176/  FF1AB6 : 0206 003F           		andi.b	#$3F,d6
(1)  177/  FF1ABA : 600C                		bra.s	sndReq_sbyte
(1)  178/  FF1ABC :                     sndReq_slong:
(1)  179/  FF1ABC : 610A                		bsr	sndReq_sbyte
(1)  180/  FF1ABE : E09F                		ror.l	#8,d7
(1)  181/  FF1AC0 :                     sndReq_saddr:
(1)  182/  FF1AC0 : 6106                		bsr	sndReq_sbyte
(1)  183/  FF1AC2 : E09F                		ror.l	#8,d7
(1)  184/  FF1AC4 :                     sndReq_sword:
(1)  185/  FF1AC4 : 6102                		bsr	sndReq_sbyte
(1)  186/  FF1AC6 : E09F                		ror.l	#8,d7
(1)  187/  FF1AC8 :                     sndReq_sbyte:
(1)  188/  FF1AC8 : 1D87 6000           		move.b	d7,(a6,d6.w)			; write byte
(1)  189/  FF1ACC : 5206                		addq.b	#1,d6				; next fifo pos
(1)  190/  FF1ACE : 0206 003F           		andi.b	#$3F,d6
(1)  191/  FF1AD2 : 1A86                		move.b	d6,(a5)				; update commZWrite
(1)  192/  FF1AD4 : 4E75                		rts
(1)  193/  FF1AD6 :                     
(1)  194/  FF1AD6 :                     ; ====================================================================
(1)  195/  FF1AD6 :                     ; ----------------------------------------------------------------
(1)  196/  FF1AD6 :                     ; Z80 Code
(1)  197/  FF1AD6 :                     ; 
(1)  198/  FF1AD6 :                     ; GEMA sound driver, inspired by GEMS
(1)  199/  FF1AD6 :                     ; 
(1)  200/  FF1AD6 :                     ; WARNING: The sample playback is sync'd manually on every
(1)  201/  FF1AD6 :                     ; code change, DAC sample rate is 16000hz base
(1)  202/  FF1AD6 :                     ; ----------------------------------------------------------------
(1)  203/  FF1AD6 :                     
(1)  204/  FF1AD6 :                     		align $100
(1)  205/  FF1BCE :                     Z80_CODE:
(1)  206/  FF1BCE :                     		cpu Z80				; [AS] Set to Z80
(1)  207/       0 :                     		phase 0				; [AS] Reset PC to zero, for this section
(1)  208/       0 :                     
(1)  209/       0 :                     ; --------------------------------------------------------
(1)  210/       0 :                     ; Variables
(1)  211/       0 :                     ; --------------------------------------------------------
(1)  212/       0 :                     
(1)  213/       0 :                     ; To brute force DAC playback on/off
(1)  214/       0 : =8H                 zopcEx		equ	08h
(1)  215/       0 : =0H                 zopcNop		equ	00h
(1)  216/       0 : =C9H                zopcRet		equ 	0C9h
(1)  217/       0 : =D9H                zopcExx		equ	0D9h			; (dac_me ONLY)
(1)  218/       0 : =F5H                zopcPushAf	equ	0F5h			; (dac_fill ONLY)
(1)  219/       0 :                     
(1)  220/       0 :                     ; PSG control
(1)  221/       0 : =0H                 COM		equ	0
(1)  222/       0 : =4H                 LEV		equ	4
(1)  223/       0 : =8H                 ATK		equ	8
(1)  224/       0 : =CH                 DKY		equ	12
(1)  225/       0 : =10H                SLV		equ	16
(1)  226/       0 : =14H                RRT		equ	20
(1)  227/       0 : =18H                MODE		equ	24
(1)  228/       0 : =1CH                DTL		equ	28
(1)  229/       0 : =20H                DTH		equ	32
(1)  230/       0 : =24H                ALV		equ	36
(1)  231/       0 : =28H                FLG		equ	40
(1)  232/       0 :                     			      
(1)  233/       0 :                     ; --------------------------------------------------------
(1)  234/       0 :                     ; Macros
(1)  235/       0 :                     ; --------------------------------------------------------
(1)  236/       0 :                     
(1)  237/       0 :                     ; only uses A
(1)  238/       0 :                     dacStream	macro option
(1)  239/       0 :                     	if option==True
(1)  240/       0 :                     		ld	a,2Bh
(1)  241/       0 :                     		ld	(Zym_ctrl_1),a
(1)  242/       0 :                     		ld	a,80h
(1)  243/       0 :                     		ld	(Zym_data_1),a
(1)  244/       0 :                     		ld 	a,zopcExx
(1)  245/       0 :                     		ld	(dac_me),a
(1)  246/       0 :                     		ld 	a,zopcPushAf
(1)  247/       0 :                     		ld	(dac_fill),a
(1)  248/       0 :                     	else
(1)  249/       0 :                     		ld	a,2Bh
(1)  250/       0 :                     		ld	(Zym_ctrl_1),a
(1)  251/       0 :                     		ld	a,00h
(1)  252/       0 :                     		ld	(Zym_data_1),a
(1)  253/       0 :                     		ld 	a,zopcRet
(1)  254/       0 :                     		ld	(dac_me),a
(1)  255/       0 :                     		ld 	a,zopcRet
(1)  256/       0 :                     		ld	(dac_fill),a
(1)  257/       0 :                     	endif
(1)  258/       0 :                     		endm
(1)  259/       0 :                     		
(1)  260/       0 :                     ; ====================================================================
(1)  261/       0 :                     
(1)  262/       0 : F3                  		di				; Disable interrputs
(1)  263/       1 : ED 56               		im	1			; Interrupt mode 1
(1)  264/       3 : 31 00 20            		ld	sp,2000h		; Set stack at the end of Z80
(1)  265/       6 : 18 36               		jr	z80_init		; Jump to z80_init
(1)  266/       8 :                     		
(1)  267/       8 : 00 00               testval1	dw 0
(1)  268/       A : 00 00               testval2	dw 0
(1)  269/       C :                     
(1)  270/       C :                     ; --------------------------------------------------------
(1)  271/       C :                     ; Z80 Interrupt at 0038h
(1)  272/       C :                     ; 
(1)  273/       C :                     ; Requests a TICK
(1)  274/       C :                     ; --------------------------------------------------------
(1)  275/       C :                     
(1)  276/       C : (MACRO)             		org 0038h			; Align to 0038h
(1)  276/       C : 00                                                  db 0
(1)  276/       D : 00                                                  db 0
(1)  276/       E : 00                                                  db 0
(1)  276/       F : 00                                                  db 0
(1)  276/      10 : 00                                                  db 0
(1)  276/      11 : 00                                                  db 0
(1)  276/      12 : 00                                                  db 0
(1)  276/      13 : 00                                                  db 0
(1)  276/      14 : 00                                                  db 0
(1)  276/      15 : 00                                                  db 0
(1)  276/      16 : 00                                                  db 0
(1)  276/      17 : 00                                                  db 0
(1)  276/      18 : 00                                                  db 0
(1)  276/      19 : 00                                                  db 0
(1)  276/      1A : 00                                                  db 0
(1)  276/      1B : 00                                                  db 0
(1)  276/      1C : 00                                                  db 0
(1)  276/      1D : 00                                                  db 0
(1)  276/      1E : 00                                                  db 0
(1)  276/      1F : 00                                                  db 0
(1)  276/      20 : 00                                                  db 0
(1)  276/      21 : 00                                                  db 0
(1)  276/      22 : 00                                                  db 0
(1)  276/      23 : 00                                                  db 0
(1)  276/      24 : 00                                                  db 0
(1)  276/      25 : 00                                                  db 0
(1)  276/      26 : 00                                                  db 0
(1)  276/      27 : 00                                                  db 0
(1)  276/      28 : 00                                                  db 0
(1)  276/      29 : 00                                                  db 0
(1)  276/      2A : 00                                                  db 0
(1)  276/      2B : 00                                                  db 0
(1)  276/      2C : 00                                                  db 0
(1)  276/      2D : 00                                                  db 0
(1)  276/      2E : 00                                                  db 0
(1)  276/      2F : 00                                                  db 0
(1)  276/      30 : 00                                                  db 0
(1)  276/      31 : 00                                                  db 0
(1)  276/      32 : 00                                                  db 0
(1)  276/      33 : 00                                                  db 0
(1)  276/      34 : 00                                                  db 0
(1)  276/      35 : 00                                                  db 0
(1)  276/      36 : 00                                                  db 0
(1)  276/      37 : 00                                                  db 0
(1)  276/      38 :                     
(1)  277/      38 : ED 73 60 0D         		ld	(tickFlag),sp		; Use sp to set TICK request (Sets xx1F)
(1)  278/      3C : F3                  		di				; Disable interrupt until next request
(1)  279/      3D : C9                  		ret
(1)  280/      3E :                     
(1)  281/      3E :                     ; --------------------------------------------------------
(1)  282/      3E :                     ; Initilize
(1)  283/      3E :                     ; --------------------------------------------------------
(1)  284/      3E :                     
(1)  285/      3E :                     z80_init:
(1)  286/      3E : CD 81 01            		call	gema_init		; Initilize VBLANK sound driver
(1)  287/      41 :                     ; 		call	dac_play
(1)  288/      41 : FB                  		ei
(1)  289/      42 :                     		
(1)  290/      42 :                     ; --------------------------------------------------------
(1)  291/      42 :                     ; MAIN LOOP
(1)  292/      42 :                     ; --------------------------------------------------------
(1)  293/      42 :                     
(1)  294/      42 :                     drv_loop:
(1)  295/      42 : CD 18 05            		call	dac_me
(1)  296/      45 : CD 10 02            		call	check_tick		; Check for tick on VBlank
(1)  297/      48 : CD 2C 05            		call	dac_fill
(1)  298/      4B : CD 18 05            		call	dac_me
(1)  299/      4E :                     
(1)  300/      4E :                     	; Check for tick and tempo	
(1)  301/      4E : 06 00               		ld	b,0			; b - Reset current flags (beat|tick)
(1)  302/      50 : 3A 62 0D            		ld	a,(tickCnt)		
(1)  303/      53 : D6 01               		sub	1
(1)  304/      55 : 38 0B               		jr	c,.noticks
(1)  305/      57 : 32 62 0D            		ld	(tickCnt),a
(1)  306/      5A : CD 7C 03            		call	psg_env			; Do PSG effects
(1)  307/      5D : CD 10 02            		call	check_tick		; Check for another tick
(1)  308/      60 : 06 01               		ld 	b,1			; Set TICK (01b) flag
(1)  309/      62 :                     .noticks:
(1)  310/      62 : CD 18 05            		call	dac_me
(1)  311/      65 : 3A 66 0D            		ld	a,(sbeatAcc+1)		; check beat counter (scaled by tempo)
(1)  312/      68 : D6 01               		sub	1
(1)  313/      6A : 38 0E               		jr	c,.nobeats
(1)  314/      6C : 32 66 0D            		ld	(sbeatAcc+1),a		; 1/24 beat passed.
(1)  315/      6F : CB C8               		set	1,b			; Set BEAT (10b) flag
(1)  316/      71 : CD 18 05            		call	dac_me			; painful desync here, play 3 WAV bytes
(1)  317/      74 : CD 18 05            		call	dac_me
(1)  318/      77 : CD 18 05            		call	dac_me
(1)  319/      7A :                     .nobeats:
(1)  320/      7A : 78                  		ld	a,b
(1)  321/      7B : B7                  		or	a
(1)  322/      7C : 28 0F               		jr	z,.neithertick
(1)  323/      7E : CD 18 05            		call	dac_me
(1)  324/      81 : 32 67 0D            		ld	(currTickBits),a	; Save bits
(1)  325/      84 :                     ; 		call	doenvelope
(1)  326/      84 : CD 10 02            		call	check_tick
(1)  327/      87 :                     ; 		call	vtimer
(1)  328/      87 : CD 10 02            		call	check_tick
(1)  329/      8A :                     ; 		call	updseq
(1)  330/      8A : CD 10 02            		call	check_tick
(1)  331/      8D :                     ; 
(1)  332/      8D :                     .neithertick:
(1)  333/      8D :                     ; 		call	apply_bend
(1)  334/      8D :                     ; 		ld	b,7
(1)  335/      8D :                     ; 		djnz	$
(1)  336/      8D :                     ; 		call	dac_me
(1)  337/      8D :                     
(1)  338/      8D :                     .next_cmd:
(1)  339/      8D : 3A 72 0D            		ld	a,(commZWrite)
(1)  340/      90 : 47                  		ld	b,a
(1)  341/      91 : 3A 71 0D            		ld	a,(commZRead)
(1)  342/      94 : B8                  		cp	b
(1)  343/      95 : CA 42 00            		jp	z,drv_loop
(1)  344/      98 :                     
(1)  345/      98 :                     	; Get 0FFh (Start of command)
(1)  346/      98 : CD E7 01            		call	get_cmdbyte		; read cmd from CMDFIFO
(1)  347/      9B : FE FF               		cp	-1
(1)  348/      9D : C2 42 00            		jp	nz,drv_loop
(1)  349/      A0 : CD E7 01            		call	get_cmdbyte
(1)  350/      A3 : 87                  		add	a,a
(1)  351/      A4 : 21 B6 00            		ld	hl,.list
(1)  352/      A7 : 16 00               		ld	d,0
(1)  353/      A9 : 5F                  		ld	e,a
(1)  354/      AA : 19                  		add	hl,de
(1)  355/      AB : CD 18 05            		call	dac_me
(1)  356/      AE : CD 2C 05            		call	dac_fill
(1)  357/      B1 : 7E                  		ld	a,(hl)
(1)  358/      B2 : 23                  		inc	hl
(1)  359/      B3 : 66                  		ld	h,(hl)
(1)  360/      B4 : 6F                  		ld	l,a
(1)  361/      B5 : E9                  		jp	(hl)
(1)  362/      B6 :                     .list:
(1)  363/      B6 : FC 00               		dw .cmnd_0		; $00
(1)  364/      B8 : FC 00               		dw .cmnd_0
(1)  365/      BA : FC 00               		dw .cmnd_0
(1)  366/      BC : FC 00               		dw .cmnd_0
(1)  367/      BE : FC 00               		dw .cmnd_0		; $04
(1)  368/      C0 : FC 00               		dw .cmnd_0
(1)  369/      C2 : FC 00               		dw .cmnd_0
(1)  370/      C4 : FC 00               		dw .cmnd_0
(1)  371/      C6 : FC 00               		dw .cmnd_0		; $08
(1)  372/      C8 : FC 00               		dw .cmnd_0
(1)  373/      CA : FC 00               		dw .cmnd_0
(1)  374/      CC : FC 00               		dw .cmnd_0
(1)  375/      CE : FC 00               		dw .cmnd_0		; $0C
(1)  376/      D0 : FC 00               		dw .cmnd_0
(1)  377/      D2 : FC 00               		dw .cmnd_0
(1)  378/      D4 : FC 00               		dw .cmnd_0
(1)  379/      D6 : FC 00               		dw .cmnd_0		; $10
(1)  380/      D8 : FC 00               		dw .cmnd_0
(1)  381/      DA : FC 00               		dw .cmnd_0
(1)  382/      DC : FC 00               		dw .cmnd_0
(1)  383/      DE : FC 00               		dw .cmnd_0		; $14
(1)  384/      E0 : FC 00               		dw .cmnd_0
(1)  385/      E2 : FC 00               		dw .cmnd_0
(1)  386/      E4 : FC 00               		dw .cmnd_0
(1)  387/      E6 : FC 00               		dw .cmnd_0		; $18
(1)  388/      E8 : FC 00               		dw .cmnd_0
(1)  389/      EA : FC 00               		dw .cmnd_0
(1)  390/      EC : FC 00               		dw .cmnd_0
(1)  391/      EE : FC 00               		dw .cmnd_0		; $1C
(1)  392/      F0 : FC 00               		dw .cmnd_0
(1)  393/      F2 : FC 00               		dw .cmnd_0
(1)  394/      F4 : FC 00               		dw .cmnd_0
(1)  395/      F6 : FC 00               		dw .cmnd_0		; $20
(1)  396/      F8 : 01 01               		dw .cmnd_wav_set	; $21
(1)  397/      FA : 68 01               		dw .cmnd_wav_pitch	; $22	
(1)  398/      FC :                     
(1)  399/      FC :                     ; --------------------------------------------------------
(1)  400/      FC :                     ; Command list
(1)  401/      FC :                     ; --------------------------------------------------------
(1)  402/      FC :                     
(1)  403/      FC :                     .cmnd_0:
(1)  404/      FC : 18 FE               		jr	$
(1)  405/      FE : C3 8D 00            		jp	.next_cmd
(1)  406/     101 :                     
(1)  407/     101 :                     ; --------------------------------------------------------
(1)  408/     101 :                     ; $21 - change current wave pitch
(1)  409/     101 :                     ; --------------------------------------------------------
(1)  410/     101 :                     
(1)  411/     101 :                     .cmnd_wav_set:
(1)  412/     101 : DD 21 94 0E         		ld	ix,wave_Start
(1)  413/     105 : CD E7 01            		call	get_cmdbyte
(1)  414/     108 : DD 77 00            		ld	(ix),a
(1)  415/     10B : DD 23               		inc	ix
(1)  416/     10D : CD E7 01            		call	get_cmdbyte
(1)  417/     110 : DD 77 00            		ld	(ix),a
(1)  418/     113 : DD 23               		inc	ix
(1)  419/     115 : CD E7 01            		call	get_cmdbyte
(1)  420/     118 : DD 77 00            		ld	(ix),a
(1)  421/     11B : DD 23               		inc	ix
(1)  422/     11D :                     ; 
(1)  423/     11D : CD E7 01            		call	get_cmdbyte
(1)  424/     120 : DD 77 00            		ld	(ix),a
(1)  425/     123 : DD 23               		inc	ix
(1)  426/     125 : CD E7 01            		call	get_cmdbyte
(1)  427/     128 : DD 77 00            		ld	(ix),a
(1)  428/     12B : DD 23               		inc	ix
(1)  429/     12D : CD E7 01            		call	get_cmdbyte
(1)  430/     130 : DD 77 00            		ld	(ix),a
(1)  431/     133 : DD 23               		inc	ix
(1)  432/     135 :                     ; 		
(1)  433/     135 : CD E7 01            		call	get_cmdbyte
(1)  434/     138 : DD 77 00            		ld	(ix),a
(1)  435/     13B : DD 23               		inc	ix
(1)  436/     13D : CD E7 01            		call	get_cmdbyte
(1)  437/     140 : DD 77 00            		ld	(ix),a
(1)  438/     143 : DD 23               		inc	ix
(1)  439/     145 : CD E7 01            		call	get_cmdbyte
(1)  440/     148 : DD 77 00            		ld	(ix),a
(1)  441/     14B : DD 23               		inc	ix
(1)  442/     14D :                     
(1)  443/     14D : CD E7 01            		call	get_cmdbyte
(1)  444/     150 : DD 77 00            		ld	(ix),a
(1)  445/     153 : DD 23               		inc	ix
(1)  446/     155 : CD E7 01            		call	get_cmdbyte
(1)  447/     158 : DD 77 00            		ld	(ix),a
(1)  448/     15B : DD 23               		inc	ix
(1)  449/     15D :                     		
(1)  450/     15D : 3E 05               		ld	a,101b
(1)  451/     15F : DD 77 00            		ld	(ix),a
(1)  452/     162 :                     		
(1)  453/     162 : CD C2 04            		call	dac_play
(1)  454/     165 : C3 8D 00            		jp	.next_cmd
(1)  455/     168 :                     
(1)  456/     168 :                     ; --------------------------------------------------------
(1)  457/     168 :                     ; $22 - change current wave pitch
(1)  458/     168 :                     ; --------------------------------------------------------
(1)  459/     168 :                     
(1)  460/     168 :                     .cmnd_wav_pitch:
(1)  461/     168 : D9                  		exx
(1)  462/     169 : D5                  		push	de
(1)  463/     16A : D9                  		exx
(1)  464/     16B : E1                  		pop	hl
(1)  465/     16C : CD 18 05            		call	dac_me
(1)  466/     16F : CD E7 01            		call	get_cmdbyte	; $00xx
(1)  467/     172 : 5F                  		ld	e,a
(1)  468/     173 : CD E7 01            		call	get_cmdbyte	; $xx00
(1)  469/     176 : 57                  		ld	d,a
(1)  470/     177 : D5                  		push	de
(1)  471/     178 : CD 18 05            		call	dac_me
(1)  472/     17B : D9                  		exx
(1)  473/     17C : D1                  		pop	de
(1)  474/     17D : D9                  		exx
(1)  475/     17E : C3 42 00            		jp	drv_loop
(1)  476/     181 :                     		
(1)  477/     181 :                     ; ====================================================================
(1)  478/     181 :                     ; ----------------------------------------------------------------
(1)  479/     181 :                     ; Sound playback code
(1)  480/     181 :                     ; ----------------------------------------------------------------
(1)  481/     181 :                     
(1)  482/     181 :                     ; --------------------------------------------------------
(1)  483/     181 :                     ; Init sound engine
(1)  484/     181 :                     ; --------------------------------------------------------
(1)  485/     181 :                     
(1)  486/     181 :                     gema_init:
(1)  487/     181 : (MACRO)             		dacStream False
(1)  487/     181 : 3E 2B                               ld      a,2Bh
(1)  487/     183 : 32 00 40                            ld      (Zym_ctrl_1),a
(1)  487/     186 : 3E 00                               ld      a,00h
(1)  487/     188 : 32 01 40                            ld      (Zym_data_1),a
(1)  487/     18B : 3E C9                               ld      a,zopcRet
(1)  487/     18D : 32 18 05                            ld      (dac_me),a
(1)  487/     190 : 3E C9                               ld      a,zopcRet
(1)  487/     192 : 32 2C 05                            ld      (dac_fill),a
(1)  488/     195 : 3E 9F               		ld	a,09Fh
(1)  489/     197 : 32 11 7F            		ld	(Zpsg_ctrl),a
(1)  490/     19A : 3E BF               		ld	a,0BFh
(1)  491/     19C : 32 11 7F            		ld	(Zpsg_ctrl),a		
(1)  492/     19F : 3E DF               		ld	a,0DFh
(1)  493/     1A1 : 32 11 7F            		ld	(Zpsg_ctrl),a	
(1)  494/     1A4 : 3E FF               		ld	a,0FFh
(1)  495/     1A6 : 32 11 7F            		ld	(Zpsg_ctrl),a
(1)  496/     1A9 : 11 00 27            		ld	de,2700h
(1)  497/     1AC : CD AC 04            		call	SndDrv_FmSet_1
(1)  498/     1AF : 11 00 28            		ld	de,2800h
(1)  499/     1B2 : CD AC 04            		call	SndDrv_FmSet_1
(1)  500/     1B5 : 11 01 28            		ld	de,2801h
(1)  501/     1B8 : CD AC 04            		call	SndDrv_FmSet_1
(1)  502/     1BB : 11 02 28            		ld	de,2802h
(1)  503/     1BE : CD AC 04            		call	SndDrv_FmSet_1
(1)  504/     1C1 : 11 04 28            		ld	de,2804h
(1)  505/     1C4 : CD AC 04            		call	SndDrv_FmSet_1
(1)  506/     1C7 : 11 05 28            		ld	de,2805h
(1)  507/     1CA : CD AC 04            		call	SndDrv_FmSet_1
(1)  508/     1CD : 11 06 28            		ld	de,2806h
(1)  509/     1D0 : CD AC 04            		call	SndDrv_FmSet_1
(1)  510/     1D3 : 11 00 2B            		ld	de,2B00h
(1)  511/     1D6 : CD AC 04            		call	SndDrv_FmSet_1	
(1)  512/     1D9 : 21 00 09            		ld	hl,dWaveBuff			; Initilize WAVE FIFO
(1)  513/     1DC : 11 01 09            		ld	de,dWaveBuff+1
(1)  514/     1DF : 01 FF 00            		ld	bc,100h-1
(1)  515/     1E2 : 36 80               		ld	(hl),80h
(1)  516/     1E4 : ED B0               		ldir
(1)  517/     1E6 : C9                  		ret
(1)  518/     1E7 :                     		
(1)  519/     1E7 :                     ; ====================================================================
(1)  520/     1E7 :                     ; ----------------------------------------------------------------
(1)  521/     1E7 :                     ; Subroutines
(1)  522/     1E7 :                     ; ----------------------------------------------------------------
(1)  523/     1E7 :                     
(1)  524/     1E7 :                     get_cmdbyte:
(1)  525/     1E7 : C5                  		push	bc
(1)  526/     1E8 : D5                  		push	de
(1)  527/     1E9 : E5                  		push	hl
(1)  528/     1EA :                     .getcbytel:
(1)  529/     1EA : CD 18 05            		call	dac_me
(1)  530/     1ED : CD 2C 05            		call	dac_fill
(1)  531/     1F0 : 3A 72 0D            		ld	a,(commZWrite)
(1)  532/     1F3 : 47                  		ld	b,a
(1)  533/     1F4 : 3A 71 0D            		ld	a,(commZRead)
(1)  534/     1F7 : B8                  		cp	b
(1)  535/     1F8 : CA EA 01            		jp	z,.getcbytel		; wait for a command from 68k
(1)  536/     1FB : 06 00               		ld	b,0
(1)  537/     1FD : 4F                  		ld	c,a
(1)  538/     1FE : 21 00 0A            		ld	hl,commZfifo
(1)  539/     201 : CD 18 05            		call	dac_me
(1)  540/     204 : 09                  		add	hl,bc
(1)  541/     205 : 3C                  		inc	a
(1)  542/     206 : E6 3F               		and	3Fh			; limit to 64
(1)  543/     208 : 32 71 0D            		ld	(commZRead),a
(1)  544/     20B : 7E                  		ld	a,(hl)
(1)  545/     20C : E1                  		pop	hl
(1)  546/     20D : D1                  		pop	de
(1)  547/     20E : C1                  		pop	bc
(1)  548/     20F : C9                  		ret
(1)  549/     210 :                     			      
(1)  550/     210 :                     ; --------------------------------------------------------
(1)  551/     210 :                     ; check_tick
(1)  552/     210 :                     ; 
(1)  553/     210 :                     ; Checks if VBlank triggred a TICK (1/150)
(1)  554/     210 :                     ; --------------------------------------------------------
(1)  555/     210 :                     
(1)  556/     210 :                     check_tick:
(1)  557/     210 : F3                  		di				; Disable ints
(1)  558/     211 : F5                  		push	af
(1)  559/     212 : E5                  		push	hl
(1)  560/     213 : 21 61 0D            		ld	hl,tickFlag+1		; read last TICK flag
(1)  561/     216 : 7E                  		ld	a,(hl)			; non-zero value?
(1)  562/     217 : B7                  		or 	a
(1)  563/     218 : 28 1D               		jr	z,.ctnotick
(1)  564/     21A :                     
(1)  565/     21A :                     	; ints are disabled from here
(1)  566/     21A : 36 00               		ld	(hl),0			; Reset TICK flag
(1)  567/     21C : 23                  		inc	hl			; Move to tickCnt
(1)  568/     21D : 34                  		inc	(hl)			; and increment
(1)  569/     21E : CD 18 05            		call	dac_me
(1)  570/     221 : D5                  		push	de
(1)  571/     222 : 2A 65 0D            		ld	hl,(sbeatAcc)		; Increment subbeats
(1)  572/     225 : ED 5B 63 0D         		ld	de,(sbeatPtck)
(1)  573/     229 : CD 18 05            		call	dac_me
(1)  574/     22C : 19                  		add	hl,de
(1)  575/     22D : 22 65 0D            		ld	(sbeatAcc),hl
(1)  576/     230 : D1                  		pop	de
(1)  577/     231 : CD 18 05            		call	dac_me
(1)  578/     234 : CD 2C 05            		call	dac_fill
(1)  579/     237 :                     .ctnotick:
(1)  580/     237 : E1                  		pop	hl
(1)  581/     238 : F1                  		pop	af
(1)  582/     239 : FB                  		ei				; Enable ints again
(1)  583/     23A : C9                  		ret
(1)  584/     23B :                     
(1)  585/     23B :                     ; --------------------------------------------------------
(1)  586/     23B :                     ; set_tempo
(1)  587/     23B :                     ; 
(1)  588/     23B :                     ; Input:
(1)  589/     23B :                     ; a - Beats per minute
(1)  590/     23B :                     ;
(1)  591/     23B :                     ; Uses:
(1)  592/     23B :                     ; de,hl
(1)  593/     23B :                     ; --------------------------------------------------------
(1)  594/     23B :                     
(1)  595/     23B :                     set_tempo:
(1)  596/     23B : 11 DA 00            		ld	de,218
(1)  597/     23E : CD 4D 02            		call	do_multiply
(1)  598/     241 : AF                  		xor	a
(1)  599/     242 : CB 25               		sla	l
(1)  600/     244 : CB 14               		rl	h
(1)  601/     246 : 17                  		rla			; AH <- sbpt, 8 fracs
(1)  602/     247 : 6C                  		ld	l,h
(1)  603/     248 : 67                  		ld	h,a		; HL <- AH
(1)  604/     249 : 22 63 0D            		ld	(sbeatPtck),hl
(1)  605/     24C : C9                  		ret
(1)  606/     24D :                     
(1)  607/     24D :                     ; ---------------------------------------------
(1)  608/     24D :                     ; do_multiply
(1)  609/     24D :                     ; 
(1)  610/     24D :                     ; Input:
(1)  611/     24D :                     ; hl - Start from
(1)  612/     24D :                     ; de - Multply by this
(1)  613/     24D :                     ; ---------------------------------------------
(1)  614/     24D :                     
(1)  615/     24D :                     ; 			      ; GETPATPTR
(1)  616/     24D :                     ; 			      ; 		ld	HL,PATCHDATA
(1)  617/     24D :                     ; 	dc.b	$21,$86,$18
(1)  618/     24D :                     ; 			      ; 		ld	DE,39
(1)  619/     24D :                     ; 	dc.b	$11,$27,$00
(1)  620/     24D :                     ; 			      ; 		jr	MULADD
(1)  621/     24D :                     ; 	dc.b	$18,$03
(1)  622/     24D :                     
(1)  623/     24D :                     do_multiply:
(1)  624/     24D : 21 00 00            		ld	hl,0
(1)  625/     250 :                     .mul_add:
(1)  626/     250 : CB 3F               		srl	a
(1)  627/     252 : 30 01               		jr	nc,.mulbitclr
(1)  628/     254 : 19                  		add	hl,de
(1)  629/     255 :                     .mulbitclr:
(1)  630/     255 : C8                  		ret	z
(1)  631/     256 : CB 23               		sla	e		; if more bits still set in A, DE*=2 and loop
(1)  632/     258 : CB 12               		rl	d
(1)  633/     25A : 18 F4               		jr	.mul_add
(1)  634/     25C :                     
(1)  635/     25C :                     ; --------------------------------------------------------
(1)  636/     25C :                     
(1)  637/     25C : 00 00               CHBUFPTR	dw	0			; pointer to current channel's sequence buffer
(1)  638/     25E : 00 00               CHPATPTR	dw	0			; pointer to current channel's patch buffer
(1)  639/     260 :                     updseq:
(1)  640/     260 : DD 21 60 0A         		ld	ix,CCB
(1)  641/     264 : 21 60 0C            		ld	hl,CH0BUF
(1)  642/     267 : 22 5C 02            		ld	(CHBUFPTR),hl
(1)  643/     26A :                     ; 		ld 	hl,PATCHDATA
(1)  644/     26A : 22 5E 02            		ld	(CHPATPTR),hl
(1)  645/     26D : 3A 67 0D            		ld	a,(currTickBits)
(1)  646/     270 : 4F                  		ld	c,a
(1)  647/     271 : 3E 10               		ld	a,16
(1)  648/     273 : 06 00               		ld	b,0
(1)  649/     275 : 18 1A               		jr	.updseqloop1
(1)  650/     277 :                     .updseqloop:
(1)  651/     277 : CD 18 05            		call	dac_me
(1)  652/     27A : 11 20 00            		ld	de,32
(1)  653/     27D : DD 19               		add	ix,de
(1)  654/     27F : 2A 5C 02            		ld	hl,(CHBUFPTR)
(1)  655/     282 : 1E 10               		ld	e,16
(1)  656/     284 : 19                  		add	hl,de
(1)  657/     285 : 22 5C 02            		ld	(CHBUFPTR),hl
(1)  658/     288 : 2A 5E 02            		ld	hl,(CHPATPTR)
(1)  659/     28B : 1E 27               		ld	e,39
(1)  660/     28D : 19                  		add	hl,de
(1)  661/     28E : 22 5E 02            		ld	(CHPATPTR),hl
(1)  662/     291 :                     .updseqloop1:
(1)  663/     291 : DD CB 06 66         		bit	4,(IX+CCBFLAGS)				; paused or free?
(1)  664/     295 : 28 1A               		jr	z,.updseqloop2
(1)  665/     297 : DD CB 06 5E         		bit	3,(IX+CCBFLAGS)				; sfx tempo bit?
(1)  666/     29B : 20 06               		jr	nz,.updseqsfx
(1)  667/     29D : CB 49               		bit	1,c
(1)  668/     29F : 20 06               		jr	nz,.updseqdoit
(1)  669/     2A1 : 18 0E               		jr	.updseqloop2
(1)  670/     2A3 :                     .updseqsfx:
(1)  671/     2A3 : CB 41               		bit	0,c
(1)  672/     2A5 : 28 0A               		jr	z,.updseqloop2
(1)  673/     2A7 :                     .updseqdoit:
(1)  674/     2A7 : CD 18 05            		call	dac_me
(1)  675/     2AA : F5                  		push	af
(1)  676/     2AB : C5                  		push	bc
(1)  677/     2AC : CD 3E 05            		call	dac_refill
(1)  678/     2AF :                     ; 		call	sequencer
(1)  679/     2AF : C1                  		pop	bc
(1)  680/     2B0 : F1                  		pop	af
(1)  681/     2B1 :                     .updseqloop2:
(1)  682/     2B1 : 04                  		inc	b
(1)  683/     2B2 : 3D                  		dec	a
(1)  684/     2B3 : 20 C2               		jr	nz,.updseqloop
(1)  685/     2B5 : C9                  		ret
(1)  686/     2B6 :                     apply_bend:
(1)  687/     2B6 : C9                  		ret
(1)  688/     2B7 :                     
(1)  689/     2B7 :                     ; --------------------------------------------------------
(1)  690/     2B7 :                     ; transferRom
(1)  691/     2B7 :                     ; 
(1)  692/     2B7 :                     ; Transfer bytes from ROM to Z80
(1)  693/     2B7 :                     ; 
(1)  694/     2B7 :                     ; Input:
(1)  695/     2B7 :                     ; a  - Source ROM address $xx0000
(1)  696/     2B7 :                     ; bc - Byte count (0000h NOT allowed)
(1)  697/     2B7 :                     ; hl - Source ROM address $00xxxx
(1)  698/     2B7 :                     ; de - Destination address
(1)  699/     2B7 :                     ; 
(1)  700/     2B7 :                     ; Uses:
(1)  701/     2B7 :                     ; b, ix
(1)  702/     2B7 :                     ; 
(1)  703/     2B7 :                     ; Notes:
(1)  704/     2B7 :                     ; call dac_fill first if transfering data
(1)  705/     2B7 :                     ; other than WAV sample data, just to be safe
(1)  706/     2B7 :                     ; --------------------------------------------------------
(1)  707/     2B7 :                     
(1)  708/     2B7 :                     transferRom:
(1)  709/     2B7 : CD 18 05            		call	dac_me
(1)  710/     2BA : DD E5               		push	ix
(1)  711/     2BC : DD 21 73 0D         		ld	ix,commZRomBlk
(1)  712/     2C0 : 22 6F 0D            		ld	(x68ksrclsb),hl
(1)  713/     2C3 : CB BC               		res	7,h
(1)  714/     2C5 : 06 00               		ld	b,0
(1)  715/     2C7 : 0D                  		dec	c
(1)  716/     2C8 : 09                  		add	hl,bc
(1)  717/     2C9 : CB 7C               		bit	7,h
(1)  718/     2CB : 20 0B               		jr	nz,.double
(1)  719/     2CD : 2A 6F 0D            		ld	hl,(x68ksrclsb)		; single transfer
(1)  720/     2D0 : 0C                  		inc	c
(1)  721/     2D1 : 47                  		ld	b,a
(1)  722/     2D2 : CD FB 02            		call	.transfer
(1)  723/     2D5 : DD E1               		pop	ix
(1)  724/     2D7 : C9                  		ret
(1)  725/     2D8 :                     .double:
(1)  726/     2D8 : 47                  		ld	b,a			; double transfer
(1)  727/     2D9 : C5                  		push	bc
(1)  728/     2DA : E5                  		push	hl
(1)  729/     2DB : 79                  		ld	a,c
(1)  730/     2DC : 95                  		sub	a,l
(1)  731/     2DD : 4F                  		ld	c,a
(1)  732/     2DE : 2A 6F 0D            		ld	hl,(x68ksrclsb)
(1)  733/     2E1 : CD FB 02            		call	.transfer
(1)  734/     2E4 : E1                  		pop	hl
(1)  735/     2E5 : C1                  		pop	bc
(1)  736/     2E6 : 4D                  		ld	c,l
(1)  737/     2E7 : 0C                  		inc	c
(1)  738/     2E8 : 3A 70 0D            		ld	a,(x68ksrcmid)
(1)  739/     2EB : E6 80               		and	80h
(1)  740/     2ED : C6 80               		add	a,80h
(1)  741/     2EF : 67                  		ld	h,a
(1)  742/     2F0 : 2E 00               		ld	l,0
(1)  743/     2F2 : 30 01               		jr	nc,.x68knocarry
(1)  744/     2F4 : 04                  		inc	b
(1)  745/     2F5 :                     .x68knocarry:
(1)  746/     2F5 : CD FB 02            		call	.transfer
(1)  747/     2F8 : DD E1               		pop	ix
(1)  748/     2FA : C9                  		ret
(1)  749/     2FB :                     
(1)  750/     2FB :                     ; b  - Source ROM xx0000
(1)  751/     2FB :                     ;  c - Bytes to transfer (00h not allowed)
(1)  752/     2FB :                     ; hl - Source ROM 00xxxx
(1)  753/     2FB :                     ; de - Destination address
(1)  754/     2FB :                     ; 
(1)  755/     2FB :                     ; Uses:
(1)  756/     2FB :                     ; a
(1)  757/     2FB :                     .transfer:
(1)  758/     2FB : CD 18 05            		call	dac_me
(1)  759/     2FE : D5                  		push	de
(1)  760/     2FF : 11 00 60            		ld	de,6000h
(1)  761/     302 : 7C                  		ld	a,h
(1)  762/     303 : CB 07               		rlc	a
(1)  763/     305 : 12                  		ld	(de),a
(1)  764/     306 : 78                  		ld	a,b
(1)  765/     307 : 12                  		ld	(de),a
(1)  766/     308 : 1F                  		rra
(1)  767/     309 : 12                  		ld	(de),a
(1)  768/     30A : 1F                  		rra
(1)  769/     30B : 12                  		ld	(de),a
(1)  770/     30C : 1F                  		rra
(1)  771/     30D : CD 18 05            		call	dac_me
(1)  772/     310 : 12                  		ld	(de),a
(1)  773/     311 : 1F                  		rra
(1)  774/     312 : 12                  		ld	(de),a
(1)  775/     313 : 1F                  		rra
(1)  776/     314 : 12                  		ld	(de),a
(1)  777/     315 : 1F                  		rra
(1)  778/     316 : 12                  		ld	(de),a
(1)  779/     317 : 1F                  		rra
(1)  780/     318 : 12                  		ld	(de),a
(1)  781/     319 : D1                  		pop	de
(1)  782/     31A : CB FC               		set	7,h
(1)  783/     31C : CD 18 05            		call	dac_me
(1)  784/     31F :                     	; Transfer data in parts of 3bytes
(1)  785/     31F :                     	; while playing cache'd WAV in the process
(1)  786/     31F : 79                  		ld	a,c
(1)  787/     320 : 06 00               		ld	b,0
(1)  788/     322 : DD CB 01 C6         		set	0,(ix+1)	; Tell to 68k that we are reading from ROM
(1)  789/     326 : D6 03               		sub	a,3
(1)  790/     328 : 38 14               		jr	c,.x68klast
(1)  791/     32A :                     .x68kloop:
(1)  792/     32A : 0E 02               		ld	c,3-1
(1)  793/     32C : DD CB 00 46         		bit	0,(ix)		; If 68k requested ROM block from here
(1)  794/     330 : 20 20               		jr	nz,.x68klpwt
(1)  795/     332 :                     .x68klpcont:
(1)  796/     332 : ED B0               		ldir
(1)  797/     334 : 00                  		nop
(1)  798/     335 : CD 18 05            		call	dac_me
(1)  799/     338 : 00                  		nop
(1)  800/     339 : D6 02               		sub	a,3-1
(1)  801/     33B : D2 2A 03            		jp	nc,.x68kloop
(1)  802/     33E :                     ; last block
(1)  803/     33E :                     .x68klast:
(1)  804/     33E : C6 03               		add	a,3
(1)  805/     340 : 4F                  		ld	c,a
(1)  806/     341 : DD CB 00 46         		bit	0,(ix)		; If 68k requested ROM block from here
(1)  807/     345 : C2 67 03            		jp	nz,.x68klstwt
(1)  808/     348 :                     .x68klstcont:
(1)  809/     348 : ED B0               		ldir
(1)  810/     34A : CD 18 05            		call	dac_me
(1)  811/     34D : DD CB 01 86         		res	0,(ix+1)
(1)  812/     351 : C9                  		ret
(1)  813/     352 :                     
(1)  814/     352 :                     ; If 68k requests uses DMA
(1)  815/     352 :                     ; NOTE: This MIGHT cause the DAC to run out
(1)  816/     352 :                     ; of sample data
(1)  817/     352 :                     .x68klpwt:
(1)  818/     352 : DD CB 01 86         		res	0,(ix+1)		; Not reading ROM
(1)  819/     356 :                     .x68kpwtlp:
(1)  820/     356 : 00                  		nop
(1)  821/     357 : CD 18 05            		call	dac_me
(1)  822/     35A : 00                  		nop
(1)  823/     35B : DD CB 00 46         		bit	0,(ix)			; Is ROM free from 68K?
(1)  824/     35F : 20 F5               		jr	nz,.x68kpwtlp
(1)  825/     361 : DD CB 01 C6         		set	0,(ix+1)		; Reading ROM again.
(1)  826/     365 : 18 CB               		jr	.x68klpcont
(1)  827/     367 :                     ; Last write
(1)  828/     367 :                     .x68klstwt:
(1)  829/     367 : DD CB 01 86         		res	0,(ix+1)		; Not reading ROM
(1)  830/     36B :                     .x68klstwtlp:
(1)  831/     36B : 00                  		nop
(1)  832/     36C : CD 18 05            		call	dac_me
(1)  833/     36F : 00                  		nop
(1)  834/     370 : DD CB 00 46         		bit	0,(ix)			; Is ROM free from 68K?
(1)  835/     374 : 20 F5               		jr	nz,.x68klstwtlp
(1)  836/     376 : DD CB 01 C6         		set	0,(ix+1)		; Reading ROM again.
(1)  837/     37A : 18 CC               		jr	.x68klstcont
(1)  838/     37C :                     
(1)  839/     37C :                     ; ====================================================================
(1)  840/     37C :                     ; ----------------------------------------------------------------
(1)  841/     37C :                     ; Sound chip routines
(1)  842/     37C :                     ; ----------------------------------------------------------------
(1)  843/     37C :                     
(1)  844/     37C :                     ; --------------------------------------------------------
(1)  845/     37C :                     ; psg_env
(1)  846/     37C :                     ; 
(1)  847/     37C :                     ; Processes the PSG manuall to add effects
(1)  848/     37C :                     ; --------------------------------------------------------
(1)  849/     37C :                     
(1)  850/     37C :                     psg_env:
(1)  851/     37C : FD 21 75 0D         		ld	iy,psgcom
(1)  852/     380 : DD 21 DA 0D         		ld	ix,PSGVTBLTG3		; Byte for Unlocking PSG3
(1)  853/     384 : 21 11 7F            		ld	hl,Zpsg_ctrl
(1)  854/     387 : 16 80               		ld	d,80h			; PSG first ctrl command
(1)  855/     389 : 1E 04               		ld	e,4			; 4 channels
(1)  856/     38B :                     .vloop:
(1)  857/     38B : CD 18 05            		call	dac_me
(1)  858/     38E : FD 4E 00            		ld	c,(iy+COM)		; c - current command
(1)  859/     391 : FD 36 00 00         		ld	(iy+COM),0		; clear for the next one
(1)  860/     395 :                     	; bit 2 - stop sound
(1)  861/     395 : CB 51               		bit	2,c			; bit 2?
(1)  862/     397 : 28 15               		jr	z,.ckof
(1)  863/     399 : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(1)  864/     39D : FD 36 28 01         		ld	(iy+FLG),1		; and update
(1)  865/     3A1 : FD 36 18 00         		ld	(iy+MODE),0		; envelope off
(1)  866/     3A5 : 3E 01               		ld	a,1			; PSG Channel 3?
(1)  867/     3A7 : BB                  		cp	e
(1)  868/     3A8 : 20 04               		jr	nz,.ckof
(1)  869/     3AA : DD CB 00 AE         		res	5,(ix)			; Unlock PSG3
(1)  870/     3AE :                     .ckof:
(1)  871/     3AE :                     	; bit 1 - key off
(1)  872/     3AE : CB 49               		bit	1,c			; bit 1?
(1)  873/     3B0 : 28 0F               		jr      z,.ckon
(1)  874/     3B2 : FD 7E 18            		ld	a,(iy+MODE)		; envelope mode 0?
(1)  875/     3B5 : FE 00               		cp	0
(1)  876/     3B7 : 28 08               		jr	z,.ckon
(1)  877/     3B9 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1)  878/     3BD : FD 36 18 04         		ld	(iy+MODE),4		; set envelope mode 4
(1)  879/     3C1 :                     .ckon:
(1)  880/     3C1 :                     	; bit 0 - key on
(1)  881/     3C1 : CB 41               		bit	0,c			; bit 0?
(1)  882/     3C3 : 28 1A               		jr	z,.envproc
(1)  883/     3C5 : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(1)  884/     3C9 : FD 7E 1C            		ld	a,(iy+DTL)		; load frequency LSB or NOISE data
(1)  885/     3CC : B2                  		or	d			; OR with current channel
(1)  886/     3CD : 77                  		ld	(hl),a			; write it
(1)  887/     3CE : 3E 01               		ld	a,1			; NOISE channel?
(1)  888/     3D0 : BB                  		cp	e
(1)  889/     3D1 : 28 04               		jr	z,.nskip		; then don't write next one
(1)  890/     3D3 : FD 7E 20            		ld	a,(iy+DTH)		; Write PSG MSB frequency (1-3 only)
(1)  891/     3D6 : 77                  		ld	(hl),a
(1)  892/     3D7 :                     .nskip:
(1)  893/     3D7 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1)  894/     3DB : FD 36 18 01         		ld	(iy+MODE),1		; set to attack mode
(1)  895/     3DF :                     	
(1)  896/     3DF :                     	; ----------------------------
(1)  897/     3DF :                     	; Start processing
(1)  898/     3DF :                     	; current PSG channel
(1)  899/     3DF :                     	; ----------------------------
(1)  900/     3DF :                     .envproc:
(1)  901/     3DF : CD 18 05            		call	dac_me
(1)  902/     3E2 : FD 7E 18            		ld	a,(iy+MODE)
(1)  903/     3E5 : B7                  		or	a			; no modes
(1)  904/     3E6 : CA 6D 04            		jp	z,.vedlp
(1)  905/     3E9 :                     		
(1)  906/     3E9 :                     	; Attack mode
(1)  907/     3E9 : FE 01               		cp 	001b
(1)  908/     3EB : 20 26               		jr	nz,.chk2
(1)  909/     3ED :                     .mode1:
(1)  910/     3ED : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1)  911/     3F1 : FD 7E 04            		ld	a,(iy+LEV)		; a - current level (volume)
(1)  912/     3F4 : FD 46 24            		ld	b,(iy+ALV)		; b - attack level
(1)  913/     3F7 : FD 96 08            		sub	a,(iy+ATK)		; (attack rate) - (level)
(1)  914/     3FA : 38 0D               		jr	c,.atkend		; attack finished
(1)  915/     3FC : 28 0B               		jr	z,.atkend
(1)  916/     3FE : B8                  		cp	b			; check level
(1)  917/     3FF : 38 08               		jr	c,.atkend		; attack finished
(1)  918/     401 : 28 06               		jr	z,.atkend		
(1)  919/     403 : FD 77 04            		ld	(iy+LEV),a		; set new level
(1)  920/     406 : C3 6D 04            		jp	.vedlp
(1)  921/     409 :                     .atkend:
(1)  922/     409 : FD 70 04            		ld	(iy+LEV),b		; attack level = new level
(1)  923/     40C : FD 36 18 02         		ld	(iy+MODE),2		; set to decay mode
(1)  924/     410 : C3 6D 04            		jp	.vedlp
(1)  925/     413 :                     .chk2:
(1)  926/     413 :                     
(1)  927/     413 :                     	; Decay mode
(1)  928/     413 : FE 02               		cp	010b
(1)  929/     415 : C2 47 04            		jp	nz,.chk4
(1)  930/     418 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1)  931/     41C : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(1)  932/     41F : FD 46 10            		ld	b,(iy+SLV)		; b - Sustain
(1)  933/     422 : B8                  		cp	b
(1)  934/     423 : 38 0C               		jr	c,.dkadd		; if carry: add
(1)  935/     425 : 28 17               		jr	z,.dkyend		; if zero:  finish
(1)  936/     427 : FD 96 0C            		sub	(iy+DKY)		; substract decay rate
(1)  937/     42A : 38 12               		jr	c,.dkyend		; finish if wraped.
(1)  938/     42C : B8                  		cp	b			; compare level
(1)  939/     42D : 38 0F               		jr	c,.dkyend		; and finish
(1)  940/     42F : 18 08               		jr	.dksav
(1)  941/     431 :                     .dkadd:
(1)  942/     431 : FD 86 0C            		add	a,(iy+DKY)		;  (level) + (decay rate)
(1)  943/     434 : 38 08               		jr	c,.dkyend		; finish if wraped.
(1)  944/     436 : B8                  		cp	b			; compare level
(1)  945/     437 : 30 05               		jr	nc,.dkyend
(1)  946/     439 :                     .dksav:
(1)  947/     439 : FD 77 04            		ld	(iy+LEV),a		; save new level
(1)  948/     43C : 18 2F               		jr	.vedlp
(1)  949/     43E :                     .dkyend:
(1)  950/     43E : FD 70 04            		ld	(iy+LEV),b		; save sustain value
(1)  951/     441 : FD 36 18 03         		ld	(iy+MODE),3		; and set mode too.
(1)  952/     445 : 18 26               		jr	.vedlp
(1)  953/     447 :                     
(1)  954/     447 :                     	; Sustain phase
(1)  955/     447 :                     .chk4:
(1)  956/     447 : FE 04               		cp	100b
(1)  957/     449 : 20 22               		jr	nz,.vedlp
(1)  958/     44B : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1)  959/     44F : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(1)  960/     452 : FD 86 14            		add 	a,(iy+RRT)		; add Release Rate
(1)  961/     455 : 38 05               		jr	c,.killenv		; release done
(1)  962/     457 : FD 77 04            		ld	(iy+LEV),a		; set new Level
(1)  963/     45A : 18 11               		jr	.vedlp
(1)  964/     45C :                     .killenv:
(1)  965/     45C : FD 36 04 FF         		ld	(iy+LEV),-1		; Silence this channel
(1)  966/     460 : FD 36 18 00         		ld	(iy+MODE),0		; Reset mode
(1)  967/     464 : 3E 01               		ld	a,1			; PSG Channel 3?
(1)  968/     466 : BB                  		cp	e
(1)  969/     467 : 20 04               		jr	nz,.vedlp
(1)  970/     469 : DD CB 00 AE         		res	5,(ix)			; Unlock PSG3
(1)  971/     46D :                     .vedlp:
(1)  972/     46D : FD 23               		inc	iy			; next COM to check
(1)  973/     46F : 3E 20               		ld	a,20h			; next PSG channel
(1)  974/     471 : 82                  		add	a,d
(1)  975/     472 : 57                  		ld	d,a
(1)  976/     473 : 1D                  		dec	e
(1)  977/     474 : C2 8B 03            		jp	nz,.vloop
(1)  978/     477 :                     
(1)  979/     477 :                     	; ----------------------------
(1)  980/     477 :                     	; Set volumes
(1)  981/     477 : CD 18 05            		call	dac_me
(1)  982/     47A : FD 21 75 0D         		ld	iy,psgcom
(1)  983/     47E : DD 21 11 7F         		ld	ix,Zpsg_ctrl
(1)  984/     482 : 21 90 00            		ld	hl,90h		; Channel + volumeset bit
(1)  985/     485 : 11 20 00            		ld	de,20h		; next channel increment
(1)  986/     488 : 06 04               		ld	b,4
(1)  987/     48A :                     .nextpsg:
(1)  988/     48A : FD CB 28 46         		bit	0,(iy+FLG)	; PSG update?
(1)  989/     48E : 28 13               		jr	z,.flgoff
(1)  990/     490 : FD 36 28 00         		ld	(iy+FLG),0	; Reset until next one
(1)  991/     494 : FD 7E 04            		ld	a,(iy+LEV)	; a - Level
(1)  992/     497 : CB 3F               		srl	a		; (Level >> 4)
(1)  993/     499 : CB 3F               		srl	a
(1)  994/     49B : CB 3F               		srl	a
(1)  995/     49D : CB 3F               		srl	a
(1)  996/     49F : B5                  		or	l		; merge Channel bits
(1)  997/     4A0 : DD 77 00            		ld	(ix),a		; Write volume
(1)  998/     4A3 :                     .flgoff:
(1)  999/     4A3 : 19                  		add	hl,de		; next channel
(1) 1000/     4A4 : FD 23               		inc	iy		; next com
(1) 1001/     4A6 : 10 E2               		djnz	.nextpsg
(1) 1002/     4A8 : CD 18 05            		call	dac_me
(1) 1003/     4AB : C9                  		ret
(1) 1004/     4AC :                     
(1) 1005/     4AC :                     ; ---------------------------------------------
(1) 1006/     4AC :                     ; FM send registers
(1) 1007/     4AC :                     ; 
(1) 1008/     4AC :                     ; Input:
(1) 1009/     4AC :                     ; d - ctrl
(1) 1010/     4AC :                     ; e - data
(1) 1011/     4AC :                     ; c - channel
(1) 1012/     4AC :                     ; ---------------------------------------------
(1) 1013/     4AC :                     
(1) 1014/     4AC :                     SndDrv_FmSet_1:
(1) 1015/     4AC : 7A                  		ld	a,d
(1) 1016/     4AD : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 1017/     4B0 : 00                  		nop
(1) 1018/     4B1 : 7B                  		ld	a,e
(1) 1019/     4B2 : 32 01 40            		ld	(Zym_data_1),a
(1) 1020/     4B5 : 00                  		nop
(1) 1021/     4B6 : C9                  		ret
(1) 1022/     4B7 :                     
(1) 1023/     4B7 :                     SndDrv_FmSet_2:
(1) 1024/     4B7 : 7A                  		ld	a,d
(1) 1025/     4B8 : 32 02 40            		ld	(Zym_ctrl_2),a
(1) 1026/     4BB : 00                  		nop
(1) 1027/     4BC : 7B                  		ld	a,e
(1) 1028/     4BD : 32 03 40            		ld	(Zym_data_2),a
(1) 1029/     4C0 : 00                  		nop	
(1) 1030/     4C1 : C9                  		ret
(1) 1031/     4C2 :                     
(1) 1032/     4C2 :                     ; --------------------------------------------------------
(1) 1033/     4C2 :                     ; dac_play
(1) 1034/     4C2 :                     ; 
(1) 1035/     4C2 :                     ; Plays a new sample
(1) 1036/     4C2 :                     ; --------------------------------------------------------
(1) 1037/     4C2 :                     
(1) 1038/     4C2 :                     dac_play:
(1) 1039/     4C2 : F3                  		di
(1) 1040/     4C3 : (MACRO)             		dacStream False
(1) 1040/     4C3 : 3E 2B                               ld      a,2Bh
(1) 1040/     4C5 : 32 00 40                            ld      (Zym_ctrl_1),a
(1) 1040/     4C8 : 3E 00                               ld      a,00h
(1) 1040/     4CA : 32 01 40                            ld      (Zym_data_1),a
(1) 1040/     4CD : 3E C9                               ld      a,zopcRet
(1) 1040/     4CF : 32 18 05                            ld      (dac_me),a
(1) 1040/     4D2 : 3E C9                               ld      a,zopcRet
(1) 1040/     4D4 : 32 2C 05                            ld      (dac_fill),a
(1) 1041/     4D7 : D9                  		exx
(1) 1042/     4D8 : 01 09 00            		ld	bc,dWaveBuff>>8			; bc - WAVFIFO MSB
(1) 1043/     4DB : ED 5B 9D 0E         		ld	de,(wave_Pitch)			; de - Pitch
(1) 1044/     4DF : 21 00 00            		ld	hl,(dWaveBuff&0FFh)<<8		; hl - WAVFIFO LSB pointer (xx.00)
(1) 1045/     4E2 : D9                  		exx
(1) 1046/     4E3 : 2A 94 0E            		ld	hl,(wave_Start)
(1) 1047/     4E6 : 3A 96 0E            		ld 	a,(wave_Start+2)
(1) 1048/     4E9 : 22 68 0D            		ld	(dDacPntr),hl
(1) 1049/     4EC : 32 6A 0D            		ld	(dDacPntr+2),a
(1) 1050/     4EF : 2A 97 0E            		ld	hl,(wave_End)
(1) 1051/     4F2 : 3A 99 0E            		ld 	a,(wave_End+2)
(1) 1052/     4F5 : 22 6B 0D            		ld	(dDacCntr),hl
(1) 1053/     4F8 : 32 6D 0D            		ld	(dDacCntr+2),a
(1) 1054/     4FB : AF                  		xor	a
(1) 1055/     4FC : 32 6E 0D            		ld	(dDacFifoMid),a
(1) 1056/     4FF : CD 3A 05            		call	dac_firstfill
(1) 1057/     502 : (MACRO)             		dacStream True
(1) 1057/     502 : 3E 2B                               ld      a,2Bh
(1) 1057/     504 : 32 00 40                            ld      (Zym_ctrl_1),a
(1) 1057/     507 : 3E 80                               ld      a,80h
(1) 1057/     509 : 32 01 40                            ld      (Zym_data_1),a
(1) 1057/     50C : 3E D9                               ld      a,zopcExx
(1) 1057/     50E : 32 18 05                            ld      (dac_me),a
(1) 1057/     511 : 3E F5                               ld      a,zopcPushAf
(1) 1057/     513 : 32 2C 05                            ld      (dac_fill),a
(1) 1058/     516 : FB                  		ei
(1) 1059/     517 : C9                  		ret
(1) 1060/     518 :                     
(1) 1061/     518 :                     ; --------------------------------------------------------
(1) 1062/     518 :                     ; dac_me
(1) 1063/     518 :                     ; 
(1) 1064/     518 :                     ; Writes wave data to DAC using data stored on buffer.
(1) 1065/     518 :                     ; Call this routine every 6 or more lines of code
(1) 1066/     518 :                     ; (use any emu-debugger to check if it still plays
(1) 1067/     518 :                     ; at stable 16000hz)
(1) 1068/     518 :                     ;
(1) 1069/     518 :                     ; Input (EXX):
(1) 1070/     518 :                     ;  c - WAVEFIFO MSB
(1) 1071/     518 :                     ; de - Pitch (xx.00)
(1) 1072/     518 :                     ; h  - WAVEFIFO LSB (as xx.00)
(1) 1073/     518 :                     ; 
(1) 1074/     518 :                     ; Uses (EXX):
(1) 1075/     518 :                     ; b
(1) 1076/     518 :                     ; 
(1) 1077/     518 :                     ; *** self-modifiable code ***
(1) 1078/     518 :                     ; --------------------------------------------------------
(1) 1079/     518 :                     
(1) 1080/     518 : D9                  dac_me:		exx				; <-- self-changes between EXX(play) and RET(stop)
(1) 1081/     519 : 08                  		ex	af,af'
(1) 1082/     51A : 45                  		ld	b,l
(1) 1083/     51B : 3E 2A               		ld	a,2Ah
(1) 1084/     51D : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 1085/     520 : 6C                  		ld	l,h
(1) 1086/     521 : 61                  		ld	h,c
(1) 1087/     522 : 7E                  		ld	a,(hl)
(1) 1088/     523 : 32 01 40            		ld	(Zym_data_1),a
(1) 1089/     526 : 65                  		ld	h,l
(1) 1090/     527 : 68                  		ld	l,b
(1) 1091/     528 : 19                  		add	hl,de
(1) 1092/     529 : 08                  		ex	af,af'
(1) 1093/     52A : D9                  		exx
(1) 1094/     52B : C9                  		ret
(1) 1095/     52C :                     
(1) 1096/     52C :                     ; --------------------------------------------------------
(1) 1097/     52C :                     ; dac_fill
(1) 1098/     52C :                     ; 
(1) 1099/     52C :                     ; Refills a half of the WAVE FIFO data, automatic
(1) 1100/     52C :                     ; 
(1) 1101/     52C :                     ; *** self-modifiable code ***
(1) 1102/     52C :                     ; --------------------------------------------------------
(1) 1103/     52C :                     
(1) 1104/     52C : F5                  dac_fill:	push	af			; <-- self-changes between PUSH AF(play) and RET(stop)
(1) 1105/     52D : 3A 6E 0D            		ld	a,(dDacFifoMid)
(1) 1106/     530 : D9                  		exx
(1) 1107/     531 : AC                  		xor	h			; xx.00
(1) 1108/     532 : D9                  		exx
(1) 1109/     533 : E6 80               		and	80h
(1) 1110/     535 : C2 3E 05            		jp	nz,dac_refill
(1) 1111/     538 : F1                  		pop	af
(1) 1112/     539 : C9                  		ret
(1) 1113/     53A :                     ; first time
(1) 1114/     53A :                     dac_firstfill:
(1) 1115/     53A : CD 10 02            		call	check_tick
(1) 1116/     53D : F5                  		push	af
(1) 1117/     53E :                     
(1) 1118/     53E :                     ; If auto-fill is needed
(1) 1119/     53E :                     ; TODO: improve this.
(1) 1120/     53E :                     dac_refill:
(1) 1121/     53E : CD 18 05            		call	dac_me
(1) 1122/     541 : C5                  		push	bc
(1) 1123/     542 : D5                  		push	de
(1) 1124/     543 : E5                  		push	hl
(1) 1125/     544 : 3A 9F 0E            		ld	a,(wav_Flags)
(1) 1126/     547 : FE 07               		cp	111b
(1) 1127/     549 : D2 FF 05            		jp	nc,.FDF7
(1) 1128/     54C :                     
(1) 1129/     54C : 3A 6D 0D            		ld	a,(dDacCntr+2)
(1) 1130/     54F : 2A 6B 0D            		ld	hl,(dDacCntr)
(1) 1131/     552 : 01 80 00            		ld	bc,80h
(1) 1132/     555 : 37                  		scf
(1) 1133/     556 : 3F                  		ccf
(1) 1134/     557 : ED 42               		sbc	hl,bc
(1) 1135/     559 : DE 00               		sbc	a,0
(1) 1136/     55B : 32 6D 0D            		ld	(dDacCntr+2),a
(1) 1137/     55E : 22 6B 0D            		ld	(dDacCntr),hl
(1) 1138/     561 : 16 09               		ld	d,dWaveBuff>>8
(1) 1139/     563 : B7                  		or	a
(1) 1140/     564 : FA 8E 05            		jp	m,.FDF4DONE
(1) 1141/     567 :                     ; 		jr	c,.FDF4DONE
(1) 1142/     567 :                     ; 		jr	z,.FDF4DONE
(1) 1143/     567 :                     .keepcntr:
(1) 1144/     567 :                     
(1) 1145/     567 : 3A 6E 0D            		ld	a,(dDacFifoMid)
(1) 1146/     56A : 5F                  		ld	e,a
(1) 1147/     56B : C6 80               		add 	a,80h
(1) 1148/     56D : 32 6E 0D            		ld	(dDacFifoMid),a
(1) 1149/     570 : 2A 68 0D            		ld	hl,(dDacPntr)
(1) 1150/     573 : 3A 6A 0D            		ld	a,(dDacPntr+2)
(1) 1151/     576 : CD B7 02            		call	transferRom
(1) 1152/     579 : 2A 68 0D            		ld	hl,(dDacPntr)
(1) 1153/     57C : 3A 6A 0D            		ld	a,(dDacPntr+2)
(1) 1154/     57F : 01 80 00            		ld	bc,80h
(1) 1155/     582 : 09                  		add	hl,bc
(1) 1156/     583 : CE 00               		adc	a,0
(1) 1157/     585 : 22 68 0D            		ld	(dDacPntr),hl
(1) 1158/     588 : 32 6A 0D            		ld	(dDacPntr+2),a
(1) 1159/     58B : C3 13 06            		jp	.FDFreturn
(1) 1160/     58E :                     .FDF4DONE:
(1) 1161/     58E : 16 09               		ld	d,dWaveBuff>>8
(1) 1162/     590 : 3A 9F 0E            		ld	a,(wav_Flags)
(1) 1163/     593 : FE 05               		cp	101b
(1) 1164/     595 : CA B8 05            		jp	z,.FDF72
(1) 1165/     598 :                     		
(1) 1166/     598 : 7D                  		ld	a,l
(1) 1167/     599 : C6 80               		add	a,80h
(1) 1168/     59B : 4F                  		ld	c,a
(1) 1169/     59C : 06 00               		ld	b,0
(1) 1170/     59E : C5                  		push	bc
(1) 1171/     59F : 3A 6E 0D            		ld	a,(dDacFifoMid)
(1) 1172/     5A2 : 5F                  		ld	e,a
(1) 1173/     5A3 : C6 80               		add	a,80h
(1) 1174/     5A5 : 32 6E 0D            		ld	(dDacFifoMid),a
(1) 1175/     5A8 : C1                  		pop	bc			; C <- # just xfered
(1) 1176/     5A9 : 79                  		ld	a,c
(1) 1177/     5AA : B0                  		or	b
(1) 1178/     5AB : 28 52               		jr	z,.FDF7
(1) 1179/     5AD : 2A 68 0D            		ld	hl,(dDacPntr)
(1) 1180/     5B0 : 3A 6A 0D            		ld	a,(dDacPntr+2)
(1) 1181/     5B3 : CD B7 02            		call	transferRom
(1) 1182/     5B6 : 18 47               		jr	.FDF7
(1) 1183/     5B8 :                     .FDF72:
(1) 1184/     5B8 :                     
(1) 1185/     5B8 :                     	; loop sample
(1) 1186/     5B8 : C5                  		push	bc
(1) 1187/     5B9 : D5                  		push	de
(1) 1188/     5BA : 3A 9C 0E            		ld	a,(wave_Loop+2)
(1) 1189/     5BD : 4F                  		ld	c,a
(1) 1190/     5BE : ED 5B 9A 0E         		ld	de,(wave_Loop)
(1) 1191/     5C2 : 2A 94 0E            		ld	hl,(wave_Start)
(1) 1192/     5C5 : 3A 96 0E            		ld 	a,(wave_Start+2)
(1) 1193/     5C8 : 81                  		add	a,c
(1) 1194/     5C9 : 19                  		add	hl,de
(1) 1195/     5CA : CE 00               		adc	a,0
(1) 1196/     5CC : 22 68 0D            		ld	(dDacPntr),hl
(1) 1197/     5CF : 32 6A 0D            		ld	(dDacPntr+2),a
(1) 1198/     5D2 : 2A 97 0E            		ld	hl,(wave_End)
(1) 1199/     5D5 : 3A 99 0E            		ld 	a,(wave_End+2)
(1) 1200/     5D8 : 91                  		sub	a,c
(1) 1201/     5D9 : 37                  		scf
(1) 1202/     5DA : 3F                  		ccf
(1) 1203/     5DB : ED 52               		sbc	hl,de
(1) 1204/     5DD : DE 00               		sbc	a,0
(1) 1205/     5DF : 22 6B 0D            		ld	(dDacCntr),hl
(1) 1206/     5E2 : 32 6D 0D            		ld	(dDacCntr+2),a
(1) 1207/     5E5 : D1                  		pop	de
(1) 1208/     5E6 : C1                  		pop	bc
(1) 1209/     5E7 : 78                  		ld	a,b
(1) 1210/     5E8 : B1                  		or	c
(1) 1211/     5E9 : 28 28               		jr	z,.FDFreturn
(1) 1212/     5EB : 3A 6E 0D            		ld	a,(dDacFifoMid)
(1) 1213/     5EE : 5F                  		ld	e,a
(1) 1214/     5EF : C6 80               		add	a,80h
(1) 1215/     5F1 : 32 6E 0D            		ld	(dDacFifoMid),a
(1) 1216/     5F4 : 2A 68 0D            		ld	hl,(dDacPntr)
(1) 1217/     5F7 : 3A 6A 0D            		ld	a,(dDacPntr+2)
(1) 1218/     5FA : CD B7 02            		call	transferRom
(1) 1219/     5FD : 18 14               		jr	.FDFreturn
(1) 1220/     5FF :                     .FDF7:
(1) 1221/     5FF : (MACRO)             		dacStream False
(1) 1221/     5FF : 3E 2B                               ld      a,2Bh
(1) 1221/     601 : 32 00 40                            ld      (Zym_ctrl_1),a
(1) 1221/     604 : 3E 00                               ld      a,00h
(1) 1221/     606 : 32 01 40                            ld      (Zym_data_1),a
(1) 1221/     609 : 3E C9                               ld      a,zopcRet
(1) 1221/     60B : 32 18 05                            ld      (dac_me),a
(1) 1221/     60E : 3E C9                               ld      a,zopcRet
(1) 1221/     610 : 32 2C 05                            ld      (dac_fill),a
(1) 1222/     613 :                     .FDFreturn:
(1) 1223/     613 : E1                  		pop	hl
(1) 1224/     614 : D1                  		pop	de
(1) 1225/     615 : C1                  		pop	bc
(1) 1226/     616 : F1                  		pop	af
(1) 1227/     617 : C9                  		ret
(1) 1228/     618 :                     			      
(1) 1229/     618 :                     ; ====================================================================
(1) 1230/     618 :                     ; ----------------------------------------------------------------
(1) 1231/     618 :                     ; Tables
(1) 1232/     618 :                     ; ----------------------------------------------------------------
(1) 1233/     618 :                     
(1) 1234/     618 : 00 01               wavFreq_List:	dw 100h		; C-0
(1) 1235/     61A : 00 01               		dw 100h
(1) 1236/     61C : 00 01               		dw 100h
(1) 1237/     61E : 00 01               		dw 100h
(1) 1238/     620 : 00 01               		dw 100h
(1) 1239/     622 : 00 01               		dw 100h
(1) 1240/     624 : 00 01               		dw 100h	
(1) 1241/     626 : 00 01               		dw 100h
(1) 1242/     628 : 00 01               		dw 100h
(1) 1243/     62A : 00 01               		dw 100h
(1) 1244/     62C : 00 01               		dw 100h
(1) 1245/     62E : 00 01               		dw 100h
(1) 1246/     630 : 00 01               		dw 100h		; C-1
(1) 1247/     632 : 00 01               		dw 100h
(1) 1248/     634 : 00 01               		dw 100h
(1) 1249/     636 : 00 01               		dw 100h
(1) 1250/     638 : 00 01               		dw 100h
(1) 1251/     63A : 00 01               		dw 100h
(1) 1252/     63C : 00 01               		dw 100h	
(1) 1253/     63E : 00 01               		dw 100h
(1) 1254/     640 : 00 01               		dw 100h
(1) 1255/     642 : 00 01               		dw 100h
(1) 1256/     644 : 00 01               		dw 100h
(1) 1257/     646 : 00 01               		dw 100h
(1) 1258/     648 : 00 01               		dw 100h		; C-2
(1) 1259/     64A : 00 01               		dw 100h
(1) 1260/     64C : 00 01               		dw 100h
(1) 1261/     64E : 00 01               		dw 100h
(1) 1262/     650 : 00 01               		dw 100h
(1) 1263/     652 : 00 01               		dw 100h
(1) 1264/     654 : 00 01               		dw 100h
(1) 1265/     656 : 00 01               		dw 100h
(1) 1266/     658 : 00 01               		dw 100h
(1) 1267/     65A : 00 01               		dw 100h
(1) 1268/     65C : 00 01               		dw 100h
(1) 1269/     65E : 3B 00               		dw 03Bh
(1) 1270/     660 : 3E 00               		dw 03Eh		; C-3 5512
(1) 1271/     662 : 43 00               		dw 043h		; C#3
(1) 1272/     664 : 46 00               		dw 046h		; D-3
(1) 1273/     666 : 49 00               		dw 049h		; D#3
(1) 1274/     668 : 4E 00               		dw 04Eh		; E-3
(1) 1275/     66A : 54 00               		dw 054h		; F-3
(1) 1276/     66C : 58 00               		dw 058h		; F#3
(1) 1277/     66E : 5E 00               		dw 05Eh		; G-3 8363 -17
(1) 1278/     670 : 63 00               		dw 063h		; G#3
(1) 1279/     672 : 68 00               		dw 068h		; A-3
(1) 1280/     674 : 70 00               		dw 070h		; A#3
(1) 1281/     676 : 75 00               		dw 075h		; B-3
(1) 1282/     678 : 7F 00               		dw 07Fh		; C-4 11025 -12
(1) 1283/     67A : 88 00               		dw 088h		; C#4
(1) 1284/     67C : 8F 00               		dw 08Fh		; D-4
(1) 1285/     67E : 97 00               		dw 097h		; D#4
(1) 1286/     680 : A0 00               		dw 0A0h		; E-4
(1) 1287/     682 : AD 00               		dw 0ADh		; F-4
(1) 1288/     684 : B5 00               		dw 0B5h		; F#4
(1) 1289/     686 : C0 00               		dw 0C0h		; G-4
(1) 1290/     688 : CC 00               		dw 0CCh		; G#4
(1) 1291/     68A : D7 00               		dw 0D7h		; A-4
(1) 1292/     68C : E7 00               		dw 0E7h		; A#4
(1) 1293/     68E : F0 00               		dw 0F0h		; B-4
(1) 1294/     690 : 00 01               		dw 100h		; C-5 22050
(1) 1295/     692 : 10 01               		dw 110h		; C#5
(1) 1296/     694 : 20 01               		dw 120h		; D-5
(1) 1297/     696 : 2C 01               		dw 12Ch		; D#5
(1) 1298/     698 : 42 01               		dw 142h		; E-5
(1) 1299/     69A : 58 01               		dw 158h		; F-5
(1) 1300/     69C : 6A 01               		dw 16Ah		; F#5 32000 +6
(1) 1301/     69E : 7E 01               		dw 17Eh		; G-5
(1) 1302/     6A0 : 90 01               		dw 190h		; G#5
(1) 1303/     6A2 : AC 01               		dw 1ACh		; A-5
(1) 1304/     6A4 : C2 01               		dw 1C2h		; A#5
(1) 1305/     6A6 : E0 01               		dw 1E0h		; B-5
(1) 1306/     6A8 : F8 01               		dw 1F8h		; C-6 44100 +12
(1) 1307/     6AA : 10 02               		dw 210h		; C#6
(1) 1308/     6AC : 40 02               		dw 240h		; D-6
(1) 1309/     6AE : 60 02               		dw 260h		; D#6
(1) 1310/     6B0 : 80 02               		dw 280h		; E-6
(1) 1311/     6B2 : A0 02               		dw 2A0h		; F-6
(1) 1312/     6B4 : D0 02               		dw 2D0h		; F#6
(1) 1313/     6B6 : F8 02               		dw 2F8h		; G-6
(1) 1314/     6B8 : 20 03               		dw 320h		; G#6
(1) 1315/     6BA : 50 03               		dw 350h		; A-6
(1) 1316/     6BC : 80 03               		dw 380h		; A#6
(1) 1317/     6BE : C0 03               		dw 3C0h		; B-6
(1) 1318/     6C0 : 00 04               		dw 400h		; C-7 88200
(1) 1319/     6C2 : 00 01               		dw 100h
(1) 1320/     6C4 : 00 01               		dw 100h
(1) 1321/     6C6 : 00 01               		dw 100h
(1) 1322/     6C8 : 00 01               		dw 100h
(1) 1323/     6CA : 00 01               		dw 100h
(1) 1324/     6CC : 00 01               		dw 100h	
(1) 1325/     6CE : 00 01               		dw 100h
(1) 1326/     6D0 : 00 01               		dw 100h
(1) 1327/     6D2 : 00 01               		dw 100h
(1) 1328/     6D4 : 00 01               		dw 100h
(1) 1329/     6D6 : 00 01               		dw 100h	
(1) 1330/     6D8 : 00 01               		dw 100h		; C-8
(1) 1331/     6DA : 00 01               		dw 100h
(1) 1332/     6DC : 00 01               		dw 100h
(1) 1333/     6DE : 00 01               		dw 100h
(1) 1334/     6E0 : 00 01               		dw 100h
(1) 1335/     6E2 : 00 01               		dw 100h
(1) 1336/     6E4 : 00 01               		dw 100h	
(1) 1337/     6E6 : 00 01               		dw 100h
(1) 1338/     6E8 : 00 01               		dw 100h
(1) 1339/     6EA : 00 01               		dw 100h
(1) 1340/     6EC : 00 01               		dw 100h
(1) 1341/     6EE : 00 01               		dw 100h	
(1) 1342/     6F0 : 00 01               		dw 100h		; C-9
(1) 1343/     6F2 : 00 01               		dw 100h
(1) 1344/     6F4 : 00 01               		dw 100h
(1) 1345/     6F6 : 00 01               		dw 100h
(1) 1346/     6F8 : 00 01               		dw 100h
(1) 1347/     6FA : 00 01               		dw 100h
(1) 1348/     6FC : 00 01               		dw 100h	
(1) 1349/     6FE : 00 01               		dw 100h
(1) 1350/     700 : 00 01               		dw 100h
(1) 1351/     702 : 00 01               		dw 100h
(1) 1352/     704 : 00 01               		dw 100h
(1) 1353/     706 : 00 01               		dw 100h
(1) 1354/     708 :                     
(1) 1355/     708 : 84 02               fmFreq_List:	dw 644		; C-0
(1) 1356/     70A : A9 02               		dw 681
(1) 1357/     70C : D2 02               		dw 722
(1) 1358/     70E : FD 02               		dw 765
(1) 1359/     710 : 2A 03               		dw 810
(1) 1360/     712 : 5A 03               		dw 858
(1) 1361/     714 : 8E 03               		dw 910
(1) 1362/     716 : C4 03               		dw 964
(1) 1363/     718 : FD 03               		dw 1021
(1) 1364/     71A : 39 04               		dw 1081
(1) 1365/     71C : 7A 04               		dw 1146
(1) 1366/     71E : BE 04               		dw 1214
(1) 1367/     720 :                     
(1) 1368/     720 :                     psgFreq_List:
(1) 1369/     720 : FF FF               		dw -1		; C-0 $0
(1) 1370/     722 : FF FF               		dw -1
(1) 1371/     724 : FF FF               		dw -1
(1) 1372/     726 : FF FF               		dw -1
(1) 1373/     728 : FF FF               		dw -1
(1) 1374/     72A : FF FF               		dw -1
(1) 1375/     72C : FF FF               		dw -1
(1) 1376/     72E : FF FF               		dw -1
(1) 1377/     730 : FF FF               		dw -1
(1) 1378/     732 : FF FF               		dw -1
(1) 1379/     734 : FF FF               		dw -1
(1) 1380/     736 : FF FF               		dw -1
(1) 1381/     738 : FF FF               		dw -1		; C-1 $C
(1) 1382/     73A : FF FF               		dw -1
(1) 1383/     73C : FF FF               		dw -1
(1) 1384/     73E : FF FF               		dw -1
(1) 1385/     740 : FF FF               		dw -1
(1) 1386/     742 : FF FF               		dw -1
(1) 1387/     744 : FF FF               		dw -1
(1) 1388/     746 : FF FF               		dw -1
(1) 1389/     748 : FF FF               		dw -1
(1) 1390/     74A : FF FF               		dw -1
(1) 1391/     74C : FF FF               		dw -1
(1) 1392/     74E : FF FF               		dw -1
(1) 1393/     750 : FF FF               		dw -1		; C-2 $18
(1) 1394/     752 : FF FF               		dw -1
(1) 1395/     754 : FF FF               		dw -1
(1) 1396/     756 : FF FF               		dw -1
(1) 1397/     758 : FF FF               		dw -1
(1) 1398/     75A : FF FF               		dw -1
(1) 1399/     75C : FF FF               		dw -1
(1) 1400/     75E : FF FF               		dw -1
(1) 1401/     760 : FF FF               		dw -1
(1) 1402/     762 : FF FF               		dw -1
(1) 1403/     764 : FF FF               		dw -1
(1) 1404/     766 : FF FF               		dw -1
(1) 1405/     768 : FF FF               		dw -1		; C-3 $24
(1) 1406/     76A : FF FF               		dw -1
(1) 1407/     76C : FF FF               		dw -1
(1) 1408/     76E : FF FF               		dw -1
(1) 1409/     770 : FF FF               		dw -1
(1) 1410/     772 : FF FF               		dw -1
(1) 1411/     774 : FF FF               		dw -1
(1) 1412/     776 : FF FF               		dw -1
(1) 1413/     778 : FF FF               		dw -1
(1) 1414/     77A : F8 03               		dw 3F8h
(1) 1415/     77C : BF 03               		dw 3BFh
(1) 1416/     77E : 89 03               		dw 389h
(1) 1417/     780 : 56 03               		dw 356h		;C-4 30
(1) 1418/     782 : 26 03               		dw 326h
(1) 1419/     784 : F9 02               		dw 2F9h
(1) 1420/     786 : CE 02               		dw 2CEh
(1) 1421/     788 : A5 02               		dw 2A5h
(1) 1422/     78A : 80 02               		dw 280h
(1) 1423/     78C : 5C 02               		dw 25Ch
(1) 1424/     78E : 3A 02               		dw 23Ah
(1) 1425/     790 : 1A 02               		dw 21Ah
(1) 1426/     792 : FB 01               		dw 1FBh
(1) 1427/     794 : DF 01               		dw 1DFh
(1) 1428/     796 : C4 01               		dw 1C4h
(1) 1429/     798 : AB 01               		dw 1ABh		;C-5 3C
(1) 1430/     79A : 93 01               		dw 193h
(1) 1431/     79C : 7D 01               		dw 17Dh
(1) 1432/     79E : 67 01               		dw 167h
(1) 1433/     7A0 : 53 01               		dw 153h
(1) 1434/     7A2 : 40 01               		dw 140h
(1) 1435/     7A4 : 2E 01               		dw 12Eh
(1) 1436/     7A6 : 1D 01               		dw 11Dh
(1) 1437/     7A8 : 0D 01               		dw 10Dh
(1) 1438/     7AA : FE 00               		dw 0FEh
(1) 1439/     7AC : EF 00               		dw 0EFh
(1) 1440/     7AE : E2 00               		dw 0E2h
(1) 1441/     7B0 : D6 00               		dw 0D6h		;C-6 48
(1) 1442/     7B2 : C9 00               		dw 0C9h
(1) 1443/     7B4 : BE 00               		dw 0BEh
(1) 1444/     7B6 : B4 00               		dw 0B4h
(1) 1445/     7B8 : A9 00               		dw 0A9h
(1) 1446/     7BA : A0 00               		dw 0A0h
(1) 1447/     7BC : 97 00               		dw 97h
(1) 1448/     7BE : 8F 00               		dw 8Fh
(1) 1449/     7C0 : 87 00               		dw 87h
(1) 1450/     7C2 : 7F 00               		dw 7Fh
(1) 1451/     7C4 : 78 00               		dw 78h
(1) 1452/     7C6 : 71 00               		dw 71h
(1) 1453/     7C8 : 6B 00               		dw 6Bh		; C-7 54
(1) 1454/     7CA : 65 00               		dw 65h
(1) 1455/     7CC : 5F 00               		dw 5Fh
(1) 1456/     7CE : 5A 00               		dw 5Ah
(1) 1457/     7D0 : 55 00               		dw 55h
(1) 1458/     7D2 : 50 00               		dw 50h
(1) 1459/     7D4 : 4B 00               		dw 4Bh
(1) 1460/     7D6 : 47 00               		dw 47h
(1) 1461/     7D8 : 43 00               		dw 43h
(1) 1462/     7DA : 40 00               		dw 40h
(1) 1463/     7DC : 3C 00               		dw 3Ch
(1) 1464/     7DE : 39 00               		dw 39h
(1) 1465/     7E0 : 36 00               		dw 36h		; C-8 $60
(1) 1466/     7E2 : 33 00               		dw 33h
(1) 1467/     7E4 : 30 00               		dw 30h
(1) 1468/     7E6 : 2D 00               		dw 2Dh
(1) 1469/     7E8 : 2B 00               		dw 2Bh
(1) 1470/     7EA : 28 00               		dw 28h
(1) 1471/     7EC : 26 00               		dw 26h
(1) 1472/     7EE : 24 00               		dw 24h
(1) 1473/     7F0 : 22 00               		dw 22h
(1) 1474/     7F2 : 20 00               		dw 20h
(1) 1475/     7F4 : 1F 00               		dw 1Fh
(1) 1476/     7F6 : 1D 00               		dw 1Dh
(1) 1477/     7F8 : 1B 00               		dw 1Bh		; C-9 $6C
(1) 1478/     7FA : 1A 00               		dw 1Ah
(1) 1479/     7FC : 18 00               		dw 18h
(1) 1480/     7FE : 17 00               		dw 17h
(1) 1481/     800 : 16 00               		dw 16h
(1) 1482/     802 : 15 00               		dw 15h
(1) 1483/     804 : 13 00               		dw 13h
(1) 1484/     806 : 12 00               		dw 12h
(1) 1485/     808 : 11 00               		dw 11h
(1) 1486/     80A : 10 00                		dw 10h
(1) 1487/     80C : 09 00                		dw 9h
(1) 1488/     80E : 08 00                		dw 8h
(1) 1489/     810 : 00 00               		dw 0		; use +60 if using C-5 for tone 3 noise
(1) 1490/     812 :                     
(1) 1491/     812 :                     ; ====================================================================
(1) 1492/     812 :                     ; ----------------------------------------------------------------
(1) 1493/     812 :                     ; Z80 RAM
(1) 1494/     812 :                     ; ----------------------------------------------------------------
(1) 1495/     812 :                     
(1) 1496/     812 :                     ; ************************************* SEQUENCER CODE ***************************************
(1) 1497/     812 :                     ; 
(1) 1498/     812 :                     ; * CCB Entries:
(1) 1499/     812 :                     ; *		2,1,0	tag addr of 1st byte in 32-byte channel buffer
(1) 1500/     812 :                     ; *		5,4,3	addr of next byte to fetch
(1) 1501/     812 :                     ; *				so: 0 <= addr-tag <= 31 means hit in buffer
(1) 1502/     812 :                     ; *		6	flags
(1) 1503/     812 :                     ; *		8,7	timer (contains 0-ticks to delay)
(1) 1504/     812 :                     ; *		10,9	delay
(1) 1505/     812 :                     ; *		12,11	duration
(1) 1506/     812 :                     ; 
(1) 1507/     812 : =0H                 CCBTAGL		equ	0	; lsb of addr of 1st byte in 32-byte sequence buffer
(1) 1508/     812 : =1H                 CCBTAGM		equ	1	; mid of "
(1) 1509/     812 : =2H                 CCBTAGH		equ	2	; msb of "
(1) 1510/     812 : =3H                 CCBADDRL	equ	3	; lsb of addr of next byte to read from sequence
(1) 1511/     812 : =4H                 CCBADDRM	equ	4	; mid of "
(1) 1512/     812 : =5H                 CCBADDRH	equ	5	; msb of "
(1) 1513/     812 : =6H                 CCBFLAGS	equ	6	; 80 = sustain
(1) 1514/     812 :                     				; 40 = env retrigger
(1) 1515/     812 :                     				; 20 = lock (for 68k based sfx)
(1) 1516/     812 :                     				; 10 = running (not paused)
(1) 1517/     812 :                     				; 08 = use sfx (150 bpm) timebase
(1) 1518/     812 :                     				; 02 = muted (running, but not executing note ons)
(1) 1519/     812 :                     				; 01 = in use
(1) 1520/     812 : =7H                 CCBTIMERL	equ	7	; lsb of 2's comp, subbeat (1/24th) timer till next event
(1) 1521/     812 : =8H                 CCBTIMERH	equ	8	; msb of "
(1) 1522/     812 : =9H                 CCBDELL		equ	9	; lsb of registered subbeat delay value
(1) 1523/     812 : =AH                 CCBDELH		equ	10	; msb of "
(1) 1524/     812 : =BH                 CCBDURL		equ	11	; lsb of registered subbeat duration value
(1) 1525/     812 : =CH                 CCBDURH		equ	12	; msb of "
(1) 1526/     812 : =DH                 CCBPNUM		equ	13	; program number (patch)
(1) 1527/     812 : =EH                 CCBSNUM		equ	14	; sequence number (in sequence bank)
(1) 1528/     812 : =FH                 CCBVCHAN	equ	15	; MIDI channel number within sequence CCBSNUM
(1) 1529/     812 : =10H                CCBLOOP0	equ	16	; loop stack (counter, lsb of start addr, mid of start addr)
(1) 1530/     812 : =13H                CCBLOOP1	equ	19
(1) 1531/     812 : =16H                CCBLOOP2	equ	22
(1) 1532/     812 : =19H                CCBLOOP3	equ	25
(1) 1533/     812 : =1CH                CCBPRIO		equ	28	; priority (0 lowest, 127 highest)
(1) 1534/     812 : =1DH                CCBENV		equ	29	; envelope number
(1) 1535/     812 : =1EH                CCBATN		equ	30	; channel attenuation (0=loud, 127=quiet)
(1) 1536/     812 : =1FH                CCBy		equ	31
(1) 1537/     812 :                     
(1) 1538/     812 :                     ; --------------------------------------------------------
(1) 1539/     812 :                     ; Internal
(1) 1540/     812 :                     ; --------------------------------------------------------
(1) 1541/     812 :                     
(1) 1542/     812 :                     		align 100h
(1) 1543/     900 :                     dWaveBuff	ds 100h			; WAVE data buffer, updated by 128bytes
(1) 1544/     A00 :                     commZfifo	ds 64			; Buffer for command requests
(1) 1545/     A40 :                     
(1) 1546/     A40 :                     MBOXES		ds 32			; GEMS mailboxes
(1) 1547/     A60 :                     CCB		ds 512			; CCB - 512 bytes
(1) 1548/     C60 :                     CH0BUF		ds 256			; channel cache - 256 bytes
(1) 1549/     D60 :                     
(1) 1550/     D60 : 00 00               tickFlag	dw 0			; Tick flag (from VBlank), Use tickFlag+1 for reading/reseting
(1) 1551/     D62 : 00                  tickCnt		db 0			; Tick counter (KEEP THIS TAG AFTER tickFlag)
(1) 1552/     D63 : CC 00               sbeatPtck	dw 204			; sub beats per tick (8frac), default is 120bpm
(1) 1553/     D65 : 00 00               sbeatAcc	dw 0			; accumulates ^^ each tick to track sub beats
(1) 1554/     D67 : 00                  currTickBits	db 0			; (old: TBASEFLAGS)		      
(1) 1555/     D68 : 00 00 00            dDacPntr	db 0,0,0		; WAVE current ROM position
(1) 1556/     D6B : 00 00 00            dDacCntr	db 0,0,0		; WAVE length counter
(1) 1557/     D6E : 00                  dDacFifoMid	db 0			; WAVE current FIFO next halfway section
(1) 1558/     D6F : 00                  x68ksrclsb	db 0
(1) 1559/     D70 : 00                  x68ksrcmid	db 0
(1) 1560/     D71 : 00                  commZRead	db 0			; read pointer (here)
(1) 1561/     D72 : 00                  commZWrite	db 0			; cmd fifo wptr (from 68k)
(1) 1562/     D73 : 00                  commZRomBlk	db 0			; 68k ROM block flag
(1) 1563/     D74 : 00                  commZRomRd	db 0			; Z80 is reading ROM bit
(1) 1564/     D75 :                     
(1) 1565/     D75 : 00 00 00 00         psgcom		db 00h,00h,00h,00h	;  0 command 1 = key on, 2 = key off, 4 = stop snd
(1) 1566/     D79 : FF FF FF FF         psglev		db  -1, -1, -1, -1	;  4 output level attenuation (4 bit)
(1) 1567/     D7D : 00 00 00 00         psgatk		db 00h,00h,00h,00h	;  8 attack rate
(1) 1568/     D81 : 00 00 00 00         psgdec		db 00h,00h,00h,00h	; 12 decay rate
(1) 1569/     D85 : 00 00 00 00         psgslv		db 00h,00h,00h,00h	; 16 sustain level attenuation
(1) 1570/     D89 : 00 00 00 00         psgrrt		db 00h,00h,00h,00h	; 20 release rate
(1) 1571/     D8D : 00 00 00 00         psgenv		db 00h,00h,00h,00h	; 24 envelope mode 0 = off, 1 = attack, 2 = decay, 3 = sustain, 4
(1) 1572/     D91 : 00 00 00 00         psgdtl		db 00h,00h,00h,00h	; 28 tone bottom 4 bits, noise bits
(1) 1573/     D95 : 00 00 00 00         psgdth		db 00h,00h,00h,00h	; 32 tone upper 6 bits
(1) 1574/     D99 : 00 00 00 00         psgalv		db 00h,00h,00h,00h	; 36 attack level attenuation
(1) 1575/     D9D : 00 00 00 00         whdflg		db 00h,00h,00h,00h	; 40 flags to indicate hardware should be updated
(1) 1576/     DA1 :                     
(1) 1577/     DA1 :                     ; dynamic chip allocation
(1) 1578/     DA1 : 80 00 50 00 00 00   FMVTBL		db 080H,0,050H,0,0,0,0	; fm voice 0
                    00 
(1) 1579/     DA8 : 81 00 50 00 00 00   		db 081H,0,050H,0,0,0,0	; fm voice 1
                    00 
(1) 1580/     DAF : 84 00 50 00 00 00   		db 084H,0,050H,0,0,0,0	; fm voice 3
                    00 
(1) 1581/     DB6 : 85 00 50 00 00 00   		db 085H,0,050H,0,0,0,0	; fm voice 4
                    00 
(1) 1582/     DBD : 86 00 50 00 00 00   FMVTBLCH6	db 086H,0,050H,0,0,0,0	; fm voice 5 (FM or WAVE)
                    00 
(1) 1583/     DC4 : 82 00 50 00 00 00   FMVTBLCH3	db 082H,0,050H,0,0,0,0	; fm voice 2 (CH3 special)
                    00 
(1) 1584/     DCB : FF                  		db -1
(1) 1585/     DCC : 80 00 50 00 00 00   PSGVTBL		db 080H,0,050H,0,0,0,0	; normal type voice, number 0
                    00 
(1) 1586/     DD3 : 81 00 50 00 00 00   		db 081H,0,050H,0,0,0,0	; normal type voice, number 1
                    00 
(1) 1587/     DDA : 82 00 50 00 00 00   PSGVTBLTG3	db 082H,0,050H,0,0,0,0	; normal type voice, number 2
                    00 
(1) 1588/     DE1 : FF                  		db -1
(1) 1589/     DE2 : 83 00 50 00 00 00   PSGVTBLNG	db 083H,0,050H,0,0,0,0	; noise type voice, number 3
                    00 
(1) 1590/     DE9 : FF                  		db -1
(1) 1591/     DEA : 80 00 50 00 00 00   EXVTBLCD	db 080H,0,050h,0,0,0,0
                    00 
(1) 1592/     DF1 : 81 00 50 00 00 00   		db 081H,0,050h,0,0,0,0
                    00 
(1) 1593/     DF8 : 82 00 50 00 00 00   		db 082H,0,050h,0,0,0,0
                    00 
(1) 1594/     DFF : 83 00 50 00 00 00   		db 083H,0,050h,0,0,0,0
                    00 
(1) 1595/     E06 : 84 00 50 00 00 00   		db 084H,0,050h,0,0,0,0
                    00 
(1) 1596/     E0D : 85 00 50 00 00 00   		db 085H,0,050h,0,0,0,0
                    00 
(1) 1597/     E14 : 86 00 50 00 00 00   		db 086H,0,050h,0,0,0,0
                    00 
(1) 1598/     E1B : 87 00 50 00 00 00   		db 087H,0,050h,0,0,0,0
                    00 
(1) 1599/     E22 : FF                  		db -1
(1) 1600/     E23 : 80 00 50 00 00 00   EXVTBLMARS	db 080H,0,050h,0,0,0,0
                    00 
(1) 1601/     E2A : 81 00 50 00 00 00   		db 081H,0,050h,0,0,0,0
                    00 
(1) 1602/     E31 : 82 00 50 00 00 00   		db 082H,0,050h,0,0,0,0
                    00 
(1) 1603/     E38 : 83 00 50 00 00 00   		db 083H,0,050h,0,0,0,0
                    00 
(1) 1604/     E3F : 84 00 50 00 00 00   		db 084H,0,050h,0,0,0,0
                    00 
(1) 1605/     E46 : 85 00 50 00 00 00   		db 085H,0,050h,0,0,0,0
                    00 
(1) 1606/     E4D : 86 00 50 00 00 00   		db 086H,0,050h,0,0,0,0
                    00 
(1) 1607/     E54 : 87 00 50 00 00 00   		db 087H,0,050h,0,0,0,0
                    00 
(1) 1608/     E5B : 88 00 50 00 00 00   		db 088H,0,050h,0,0,0,0
                    00 
(1) 1609/     E62 : 89 00 50 00 00 00   		db 089H,0,050h,0,0,0,0
                    00 
(1) 1610/     E69 : 8A 00 50 00 00 00   		db 08AH,0,050h,0,0,0,0
                    00 
(1) 1611/     E70 : 8B 00 50 00 00 00   		db 08BH,0,050h,0,0,0,0
                    00 
(1) 1612/     E77 : 8C 00 50 00 00 00   		db 08CH,0,050h,0,0,0,0
                    00 
(1) 1613/     E7E : 8D 00 50 00 00 00   		db 08DH,0,050h,0,0,0,0
                    00 
(1) 1614/     E85 : 8E 00 50 00 00 00   		db 08EH,0,050h,0,0,0,0
                    00 
(1) 1615/     E8C : 8F 00 50 00 00 00   		db 08FH,0,050h,0,0,0,0
                    00 
(1) 1616/     E93 : FF                  		db -1
(1) 1617/     E94 :                     
(1) 1618/     E94 :                     ; --------------------------------------------------------
(1) 1619/     E94 :                     ; WAVE playback
(1) 1620/     E94 :                     ; 
(1) 1621/     E94 :                     ; START: 68k direct pointer ($00xxxxxx)
(1) 1622/     E94 :                     ;   END: sample length (endpointer-startpointer)
(1) 1623/     E94 :                     ;  LOOP: sample position
(1) 1624/     E94 :                     ; --------------------------------------------------------
(1) 1625/     E94 :                     
(1) 1626/     E94 : 54 80               wave_Start	dw TEST_WAV&0FFFFh
(1) 1627/     E96 : 91                  		db TEST_WAV>>16&0FFh
(1) 1628/     E97 : 00 00               wave_End	dw (TEST_WAV_E-TEST_WAV)&0FFFFh
(1) 1629/     E99 : 02                  		db (TEST_WAV_E-TEST_WAV)>>16
(1) 1630/     E9A : 00 00               wave_Loop	dw 0
(1) 1631/     E9C : 00                  		db 0
(1) 1632/     E9D : 00 01               wave_Pitch	dw 100h				; 01.00h
(1) 1633/     E9F : 05                  wav_Flags	db 101b				; WAVE playback flags (%1xx: 01 loop / 10 no loop)
(1) 1634/     EA0 :                     
(1) 1635/     EA0 :                     ; ====================================================================
(1) 1636/     EA0 :                     ; ----------------------------------------------------------------
(1) 1637/     EA0 :                     ; GAME MUSIC/SOUND DATA GOES HERE
(1) 1638/     EA0 :                     ; ----------------------------------------------------------------
(1) 1639/     EA0 :                     
(1) 1640/     EA0 :                     ; ----------------------------------------------------
(1) 1641/     EA0 :                     ; PSG Instruments
(1) 1642/     EA0 :                     ; ----------------------------------------------------
(1) 1643/     EA0 :                     
(1) 1644/     EA0 : 00                  PsgIns_00:	db 0
(1) 1645/     EA1 : FF                  		db -1
(1) 1646/     EA2 : 00 02 04 05 06      PsgIns_01:	db 0,2,4,5,6
(1) 1647/     EA7 : FF                  		db -1
(1) 1648/     EA8 : 00 0F               PsgIns_02:	db 0,15
(1) 1649/     EAA : FF                  		db -1
(1) 1650/     EAB : 00 00 01 01 02 02   PsgIns_03:	db 0,0,1,1,2,2,3,4,6,10,15
                    03 04 06 0A 0F 
(1) 1651/     EB6 : FF                  		db -1
(1) 1652/     EB7 : 00 02 04 06 0A      PsgIns_04:	db 0,2,4,6,10
(1) 1653/     EBC : FF                  		db -1	
(1) 1654/     EBD :                     		align 4
(1) 1655/     EC0 :                     		
(1) 1656/     EC0 :                     ; ----------------------------------------------------
(1) 1657/     EC0 :                     ; FM Instruments
(1) 1658/     EC0 :                     ; ----------------------------------------------------
(1) 1659/     EC0 :                     
(1) 1660/     EC0 :                     patch_Data	;ds 40h*16
(1) 1661/     EC0 :                     ; .gsx instruments; filename,$2478,$20 ($28 for FM3 instruments)
(1) 1662/     EC0 :                     FmIns_Fm3_OpenHat:
(1) 1663/     EC0 :                     		binclude "data/sound/instr/fm/fm3_openhat.gsx",2478h,28h
(1) 1664/     EE8 :                     FmIns_Fm3_ClosedHat:
(1) 1665/     EE8 :                     		binclude "data/sound/instr/fm/fm3_closedhat.gsx",2478h,28h
(1) 1666/     F10 :                     FmIns_DrumKick:
(1) 1667/     F10 :                     		binclude "data/sound/instr/fm/drum_kick.gsx",2478h,20h
(1) 1668/     F30 :                     FmIns_DrumSnare:
(1) 1669/     F30 :                     		binclude "data/sound/instr/fm/drum_snare.gsx",2478h,20h
(1) 1670/     F50 :                     FmIns_DrumCloseHat:
(1) 1671/     F50 :                     		binclude "data/sound/instr/fm/drum_closehat.gsx",2478h,20h
(1) 1672/     F70 :                     FmIns_Piano_m1:
(1) 1673/     F70 :                     		binclude "data/sound/instr/fm/piano_m1.gsx",2478h,20h
(1) 1674/     F90 :                     FmIns_Bass_gum:
(1) 1675/     F90 :                     		binclude "data/sound/instr/fm/bass_gum.gsx",2478h,20h
(1) 1676/     FB0 :                     FmIns_Bass_calm:
(1) 1677/     FB0 :                     		binclude "data/sound/instr/fm/bass_calm.gsx",2478h,20h
(1) 1678/     FD0 :                     FmIns_Bass_heavy:
(1) 1679/     FD0 :                     		binclude "data/sound/instr/fm/bass_heavy.gsx",2478h,20h
(1) 1680/     FF0 :                     FmIns_Bass_ambient:
(1) 1681/     FF0 :                     		binclude "data/sound/instr/fm/bass_ambient.gsx",2478h,20h
(1) 1682/    1010 :                     FmIns_Brass_gummy:
(1) 1683/    1010 :                     		binclude "data/sound/instr/fm/brass_gummy.gsx",2478h,20h
(1) 1684/    1030 :                     FmIns_Flaute_1:
(1) 1685/    1030 :                     		binclude "data/sound/instr/fm/flaute_1.gsx",2478h,20h
(1) 1686/    1050 :                     FmIns_Bass_2:
(1) 1687/    1050 :                     		binclude "data/sound/instr/fm/bass_2.gsx",2478h,20h
(1) 1688/    1070 :                     FmIns_Bass_3:
(1) 1689/    1070 :                     		binclude "data/sound/instr/fm/bass_3.gsx",2478h,20h
(1) 1690/    1090 :                     FmIns_Bass_5:
(1) 1691/    1090 :                     		binclude "data/sound/instr/fm/bass_5.gsx",2478h,20h
(1) 1692/    10B0 :                     FmIns_Bass_synth:
(1) 1693/    10B0 :                     		binclude "data/sound/instr/fm/bass_synth_1.gsx",2478h,20h
(1) 1694/    10D0 :                     FmIns_Guitar_1:
(1) 1695/    10D0 :                     		binclude "data/sound/instr/fm/guitar_1.gsx",2478h,20h
(1) 1696/    10F0 :                     FmIns_Horn_1:
(1) 1697/    10F0 :                     		binclude "data/sound/instr/fm/horn_1.gsx",2478h,20h
(1) 1698/    1110 :                     FmIns_Organ_M1:
(1) 1699/    1110 :                     		binclude "data/sound/instr/fm/organ_m1.gsx",2478h,20h
(1) 1700/    1130 :                     FmIns_Bass_Beach:
(1) 1701/    1130 :                     		binclude "data/sound/instr/fm/bass_beach.gsx",2478h,20h
(1) 1702/    1150 :                     FmIns_Bass_Beach_2:
(1) 1703/    1150 :                     		binclude "data/sound/instr/fm/bass_beach_2.gsx",2478h,20h
(1) 1704/    1170 :                     FmIns_Brass_Cave:
(1) 1705/    1170 :                     		binclude "data/sound/instr/fm/brass_cave.gsx",2478h,20h
(1) 1706/    1190 :                     FmIns_Piano_Small:
(1) 1707/    1190 :                     		binclude "data/sound/instr/fm/piano_small.gsx",2478h,20h
(1) 1708/    11B0 :                     FmIns_Trumpet_2:
(1) 1709/    11B0 :                     		binclude "data/sound/instr/fm/trumpet_2.gsx",2478h,20h
(1) 1710/    11D0 :                     FmIns_Bell_Glass:
(1) 1711/    11D0 :                     		binclude "data/sound/instr/fm/bell_glass.gsx",2478h,20h
(1) 1712/    11F0 :                     FmIns_Marimba_1:
(1) 1713/    11F0 :                     		binclude "data/sound/instr/fm/marimba_1.gsx",2478h,20h
(1) 1714/    1210 :                     FmIns_Ambient_dark:
(1) 1715/    1210 :                     		binclude "data/sound/instr/fm/ambient_dark.gsx",2478h,20h
(1) 1716/    1230 :                     FmIns_Ambient_spook:
(1) 1717/    1230 :                     		binclude "data/sound/instr/fm/ambient_spook.gsx",2478h,20h
(1) 1718/    1250 :                     FmIns_Ding_toy:
(1) 1719/    1250 :                     		binclude "data/sound/instr/fm/ding_toy.gsx",2478h,20h
(1) 1720/    1270 :                     
(1) 1721/    1270 :                     		
(1) 1722/    1270 :                     ; ====================================================================
(1) 1723/    1270 :                     
(1) 1724/    1270 :                     		cpu 68000
(1) 1725/    1270 :                     		padding off
(1) 1726/  FF2E3E :                     		phase Z80_CODE+*
(1) 1727/  FF2E3E :                     Z80_CODE_END:
(1) 1728/  FF2E3E :                     		align 2
(1) 1729/  FF2E3E :                     
      36/  FF2E3E :                     		
      37/  FF2E3E :                     ; --------------------------------------------------------
      38/  FF2E3E :                     ; Initialize system
      39/  FF2E3E :                     ; --------------------------------------------------------
      40/  FF2E3E :                     
      41/  FF2E3E :                     MD_Main:
      42/  FF2E3E : 6100 EB22           		bsr 	Sound_init
      43/  FF2E42 : 6100 D526           		bsr 	Video_init
      44/  FF2E46 : 6100 D1B8           		bsr	System_Init
      45/  FF2E4A :                     		include "code/md/gm_mode0.asm"
(1)    1/  FF2E4A :                     ; ====================================================================
(1)    2/  FF2E4A :                     ; ----------------------------------------------------------------
(1)    3/  FF2E4A :                     ; Game Mode 0
(1)    4/  FF2E4A :                     ; ----------------------------------------------------------------
(1)    5/  FF2E4A :                     
(1)    6/  FF2E4A :                     ; ====================================================================
(1)    7/  FF2E4A :                     ; ------------------------------------------------------
(1)    8/  FF2E4A :                     ; Variables
(1)    9/  FF2E4A :                     ; ------------------------------------------------------
(1)   10/  FF2E4A :                     
(1)   11/  FF2E4A : =$2000              var_MoveSpd	equ	$2000
(1)   12/  FF2E4A :                     
(1)   13/  FF2E4A :                     ; ====================================================================
(1)   14/  FF2E4A :                     ; ------------------------------------------------------
(1)   15/  FF2E4A :                     ; Structs
(1)   16/  FF2E4A :                     ; ------------------------------------------------------
(1)   17/  FF2E4A :                     
(1)   18/  FF2E4A : (MACRO)             		struct 0
(1)   18/  FF2E4A : =$FF2E4A            GLBL_LASTPC     set *
(1)   18/    377C :                                     dephase
(1)   18/    377C : =$377C              GLBL_LASTORG    set *
(1)   18/       0 :                                     phase 0
(1)   19/       0 :                     strc_xpos	ds.w 1
(1)   20/       2 :                     strc_ypos	ds.w 1
(1)   21/       4 : (MACRO)             		finish
(1)   21/       0 :                                     !org GLBL_LASTORG
(1)   21/  FF2E4A :                                     phase GLBL_LASTPC
(1)   22/  FF2E4A :                     
(1)   23/  FF2E4A :                     ; ====================================================================
(1)   24/  FF2E4A :                     ; ------------------------------------------------------
(1)   25/  FF2E4A :                     ; This mode's RAM
(1)   26/  FF2E4A :                     ; ------------------------------------------------------
(1)   27/  FF2E4A :                     
(1)   28/  FF2E4A : (MACRO)             		struct 0
(1)   28/  FF2E4A : =$FF2E4A            GLBL_LASTPC     set *
(1)   28/    377C :                                     dephase
(1)   28/    377C : =$377C              GLBL_LASTORG    set *
(1)   28/       0 :                                     phase 0
(1)   29/       0 :                     cam2_x_pos	ds.l 1
(1)   30/       4 :                     cam2_y_pos	ds.l 1
(1)   31/       8 :                     cam2_z_pos	ds.l 1
(1)   32/       C :                     cam2_x_rot	ds.l 1
(1)   33/      10 :                     cam2_y_rot	ds.l 1
(1)   34/      14 :                     cam2_z_rot	ds.l 1
(1)   35/      18 :                     cam2_animdata	ds.l 1
(1)   36/      1C :                     cam2_animframe	ds.l 1
(1)   37/      20 :                     cam2_animtimer	ds.l 1
(1)   38/      24 :                     sizeof_mdcam	ds.l 0
(1)   39/      24 : (MACRO)             		finish
(1)   39/       0 :                                     !org GLBL_LASTORG
(1)   39/  FF2E4A :                                     phase GLBL_LASTPC
(1)   40/  FF2E4A :                     		
(1)   41/  FF2E4A : (MACRO)             		struct RAM_ModeBuff
(1)   41/  FF2E4A : =$FF2E4A            GLBL_LASTPC     set *
(1)   41/    377C :                                     dephase
(1)   41/    377C : =$377C              GLBL_LASTORG    set *
(1)   41/FFFFFFFFFFFF8800 :                                     phase RAM_MODEBUFF
(1)   42/FFFFFFFFFFFF8800 :                     RAM_MdCamera	ds.b sizeof_mdcam
(1)   43/FFFFFFFFFFFF8824 :                     RAM_RotX	ds.l 1
(1)   44/FFFFFFFFFFFF8828 :                     RAM_MdlCurrMd	ds.w 1
(1)   45/FFFFFFFFFFFF882A :                     RAM_SndPitch	ds.w 1
(1)   46/FFFFFFFFFFFF882C :                     RAM_BgCamera	ds.w 1
(1)   47/FFFFFFFFFFFF882E :                     RAM_BgCamCurr	ds.w 1
(1)   48/FFFFFFFFFFFF8830 :                     sizeof_mdglbl	ds.l 0
(1)   49/FFFFFFFFFFFF8830 : (MACRO)             		finish
(1)   49/FFFFFFFFFFFF8800 :                                     !org GLBL_LASTORG
(1)   49/  FF2E4A :                                     phase GLBL_LASTPC
(1)   50/  FF2E4A :                     		
(1)   51/  FF2E4A :                     ; ====================================================================
(1)   52/  FF2E4A :                     ; ------------------------------------------------------
(1)   53/  FF2E4A :                     ; Code start
(1)   54/  FF2E4A :                     ; ------------------------------------------------------
(1)   55/  FF2E4A :                     
(1)   56/  FF2E4A :                     MD_GmMode0:
(1)   57/  FF2E4A : 46FC 2700           		move.w	#$2700,sr
(1)   58/  FF2E4E : 6100 D4EC           		bsr	Mode_Init
(1)   59/  FF2E52 : 6100 D702           		bsr	Video_PrintInit
(1)   60/  FF2E56 : 41FA 0348           		lea	str_Title(pc),a0
(1)   61/  FF2E5A : 203C 0000 0101      		move.l	#locate(0,1,1),d0
(1)   62/  FF2E60 : 6100 D718           		bsr	Video_Print
(1)   63/  FF2E64 : 08F9 0006 FFFF 97EF 		bset	#bitDispEnbl,(RAM_VdpRegs+1).l		; Enable display
(1)   64/  FF2E6C : 6100 D594           		bsr	Video_Update
(1)   65/  FF2E70 :                     
(1)   66/  FF2E70 : 41F8 8800           		lea	(RAM_MdCamera),a0
(1)   67/  FF2E74 : 7000                		moveq	#0,d0
(1)   68/  FF2E76 : 2080                		move.l	d0,cam2_x_pos(a0)
(1)   69/  FF2E78 : 2140 0004           		move.l	d0,cam2_y_pos(a0)
(1)   70/  FF2E7C : 2140 000C           		move.l	d0,cam2_x_rot(a0)
(1)   71/  FF2E80 : 2140 0010           		move.l	d0,cam2_y_rot(a0)
(1)   72/  FF2E84 : 2140 0014           		move.l	d0,cam2_z_rot(a0)
(1)   73/  FF2E88 : 2140 0008           		move.l	d0,cam2_z_pos(a0)
(1)   74/  FF2E8C :                     
(1)   75/  FF2E8C :                     ; ====================================================================
(1)   76/  FF2E8C :                     ; ------------------------------------------------------
(1)   77/  FF2E8C :                     ; Loop
(1)   78/  FF2E8C :                     ; ------------------------------------------------------
(1)   79/  FF2E8C :                     
(1)   80/  FF2E8C :                     .loop:
(1)   81/  FF2E8C : 6100 D37A           		bsr	System_VSync
(1)   82/  FF2E90 : 23FC 7C00 0003 00C0 		move.l	#$7C000003,(vdp_ctrl).l
                    0004                
(1)   83/  FF2E9A : 3039 FFFF 882E      		move.w	(RAM_BgCamCurr).l,d0
(1)   84/  FF2EA0 : E648                		lsr.w	#3,d0
(1)   85/  FF2EA2 : 33FC 0000 00C0 0000 		move.w	#0,(vdp_data).l
(1)   86/  FF2EAA : 33C0 00C0 0000      		move.w	d0,(vdp_data).l
(1)   87/  FF2EB0 : 41FA 043A           		lea	str_Status(pc),a0
(1)   88/  FF2EB4 : 203C 0000 0119      		move.l	#locate(0,1,25),d0
(1)   89/  FF2EBA : 6100 D6BE           		bsr	Video_Print
(1)   90/  FF2EBE : 3038 8828           		move.w	(RAM_MdlCurrMd).w,d0
(1)   91/  FF2EC2 : C07C 00FF           		and.w	#$FF,d0
(1)   92/  FF2EC6 : D040                		add.w	d0,d0
(1)   93/  FF2EC8 : D040                		add.w	d0,d0
(1)   94/  FF2ECA : 610A                		bsr	.mode0;.list(pc,d0.w)
(1)   95/  FF2ECC : 60BE                		bra	.loop
(1)   96/  FF2ECE :                     
(1)   97/  FF2ECE :                     ; ====================================================================
(1)   98/  FF2ECE :                     ; ------------------------------------------------------
(1)   99/  FF2ECE :                     ; Mode sections
(1)  100/  FF2ECE :                     ; ------------------------------------------------------
(1)  101/  FF2ECE :                     
(1)  102/  FF2ECE :                     .list:
(1)  103/  FF2ECE : 6000 0006           		bra.w	.mode0
(1)  104/  FF2ED2 : 6000 0002           		bra.w	.mode0
(1)  105/  FF2ED6 :                     		
(1)  106/  FF2ED6 :                     ; --------------------------------------------------
(1)  107/  FF2ED6 :                     
(1)  108/  FF2ED6 :                     .mode0:
(1)  109/  FF2ED6 : 4A78 8828           		tst.w	(RAM_MdlCurrMd).w
(1)  110/  FF2EDA : 6B5C                		bmi	.mode0_loop
(1)  111/  FF2EDC : 0078 8000 8828      		or.w	#$8000,(RAM_MdlCurrMd).w
(1)  112/  FF2EE2 :                     
(1)  113/  FF2EE2 :                     ; 		move.l	#CmdTaskMd_SetBitmap,d0		; 32X display OFF
(1)  114/  FF2EE2 :                     ; 		moveq	#0,d1
(1)  115/  FF2EE2 :                     ; 		bsr	System_MdMars_MstCall
(1)  116/  FF2EE2 : 203C 0600 1BA8      		move.l	#CmdTaskMd_ObjectClrAll,d0	; Clear ALL objects
(1)  117/  FF2EE8 : 6100 D352           		bsr	System_MdMars_SlvAddTask
(1)  118/  FF2EEC : 203C 0600 1B54      		move.l	#CmdTaskMd_ObjectSet,d0		; Set new object
(1)  119/  FF2EF2 : 7200                		moveq	#0,d1
(1)  120/  FF2EF4 : 243C 0601 1260      		move.l	#MARSOBJ_SMOK,d2
(1)  121/  FF2EFA : 6100 D340           		bsr	System_MdMars_SlvAddTask
(1)  122/  FF2EFE :                     
(1)  123/  FF2EFE : 203C 0600 1B40      		move.l	#CmdTaskMd_LoadSPal,d0		; Load palette
(1)  124/  FF2F04 : 223C 2600 4460      		move.l	#Palette_Puyo|TH,d1
(1)  125/  FF2F0A : 7400                		moveq	#0,d2
(1)  126/  FF2F0C : 363C 0100           		move.w	#256,d3
(1)  127/  FF2F10 : 7800                		moveq	#0,d4
(1)  128/  FF2F12 : 6100 D31C           		bsr	System_MdMars_MstAddTask
(1)  129/  FF2F16 : 203C 0600 1B30      		move.l	#CmdTaskMd_SetBitmap,d0		; 32X display ON
(1)  130/  FF2F1C : 7201                		moveq	#1,d1
(1)  131/  FF2F1E : 6100 D310           		bsr	System_MdMars_MstAddTask
(1)  132/  FF2F22 : 6100 D364           		bsr	System_MdMars_MstSendAll
(1)  133/  FF2F26 : 6100 D380           		bsr	System_MdMars_SlvSendAll
(1)  134/  FF2F2A : 31FC 0100 882A      		move.w	#$100,(RAM_SndPitch).w
(1)  135/  FF2F30 : 6100 012C           		bsr	MdMdl_Update
(1)  136/  FF2F34 : 6100 010E           		bsr	.update
(1)  137/  FF2F38 :                     .mode0_loop:
(1)  138/  FF2F38 :                     
(1)  139/  FF2F38 : 3E39 FFFF 9004      		move.w	(Controller_1+on_press).l,d7
(1)  140/  FF2F3E : 0807 0005           		btst	#bitJoyC,d7
(1)  141/  FF2F42 : 671E                		beq.s	.noc
(1)  142/  FF2F44 : 203C 0091 8054      		move.l	#TEST_WAV,d0
(1)  143/  FF2F4A : 223C 0002 0000      		move.l	#(TEST_WAV_E-TEST_WAV),d1
(1)  144/  FF2F50 : 243C 0000 0000      		move.l	#0,d2
(1)  145/  FF2F56 : 3638 882A           		move.w	(RAM_SndPitch).w,d3
(1)  146/  FF2F5A : 6100 EAB4           		bsr	SoundReq_SetSample
(1)  147/  FF2F5E : 6100 00E4           		bsr	.update
(1)  148/  FF2F62 :                     .noc:
(1)  149/  FF2F62 : 3E39 FFFF 9004      		move.w	(Controller_1+on_press).l,d7
(1)  150/  FF2F68 : 0807 0002           		btst	#bitJoyLeft,d7
(1)  151/  FF2F6C : 670A                		beq.s	.nol
(1)  152/  FF2F6E : 0478 0001 882A      		sub.w	#1,(RAM_SndPitch).w
(1)  153/  FF2F74 : 6100 00CE           		bsr	.update
(1)  154/  FF2F78 :                     .nol:
(1)  155/  FF2F78 : 3E39 FFFF 9004      		move.w	(Controller_1+on_press).l,d7
(1)  156/  FF2F7E : 0807 0003           		btst	#bitJoyRight,d7
(1)  157/  FF2F82 : 670A                		beq.s	.nor
(1)  158/  FF2F84 : 0678 0001 882A      		add.w	#1,(RAM_SndPitch).w
(1)  159/  FF2F8A : 6100 00B8           		bsr	.update
(1)  160/  FF2F8E :                     .nor:
(1)  161/  FF2F8E : 3E39 FFFF 9004      		move.w	(Controller_1+on_press).l,d7
(1)  162/  FF2F94 : 0807 0000           		btst	#bitJoyUp,d7
(1)  163/  FF2F98 : 670A                		beq.s	.nou
(1)  164/  FF2F9A : 0678 0010 882A      		add.w	#$10,(RAM_SndPitch).w
(1)  165/  FF2FA0 : 6100 00A2           		bsr	.update
(1)  166/  FF2FA4 :                     .nou:
(1)  167/  FF2FA4 : 3E39 FFFF 9004      		move.w	(Controller_1+on_press).l,d7
(1)  168/  FF2FAA : 0807 0001           		btst	#bitJoyDown,d7
(1)  169/  FF2FAE : 670A                		beq.s	.nod
(1)  170/  FF2FB0 : 0478 0010 882A      		sub.w	#$10,(RAM_SndPitch).w
(1)  171/  FF2FB6 : 6100 008C           		bsr	.update
(1)  172/  FF2FBA :                     .nod:
(1)  173/  FF2FBA :                     
(1)  174/  FF2FBA : 3E39 FFFF 9004      		move.w	(Controller_1+on_press).l,d7
(1)  175/  FF2FC0 : CE7C 0040           		and	#JoyA,d7
(1)  176/  FF2FC4 : 674C                		beq.s	.nox
(1)  177/  FF2FC6 : 7200                		moveq	#0,d1
(1)  178/  FF2FC8 : 243C 0204 000C      		move.l	#PWM_LEFT,d2
(1)  179/  FF2FCE : 263C 020C 000C      		move.l	#PWM_LEFT_e,d3
(1)  180/  FF2FD4 : 2802                		move.l	d2,d4
(1)  181/  FF2FD6 : 2A3C 0000 0100      		move.l	#$100,d5
(1)  182/  FF2FDC : 7C00                		moveq	#0,d6
(1)  183/  FF2FDE : 7E02                		moveq	#%10,d7
(1)  184/  FF2FE0 : 203C 0600 1BF0      		move.l	#CmdTaskMd_SetPWM,d0
(1)  185/  FF2FE6 : 6100 D248           		bsr	System_MdMars_MstAddTask
(1)  186/  FF2FEA : 7201                		moveq	#1,d1
(1)  187/  FF2FEC : 243C 020C 000C      		move.l	#PWM_RIGHT,d2
(1)  188/  FF2FF2 : 263C 0214 000C      		move.l	#PWM_RIGHT_e,d3
(1)  189/  FF2FF8 : 2802                		move.l	d2,d4
(1)  190/  FF2FFA : 2A3C 0000 0100      		move.l	#$100,d5
(1)  191/  FF3000 : 7C00                		moveq	#0,d6
(1)  192/  FF3002 : 7E01                		moveq	#%01,d7
(1)  193/  FF3004 : 203C 0600 1BF0      		move.l	#CmdTaskMd_SetPWM,d0
(1)  194/  FF300A : 6100 D224           		bsr	System_MdMars_MstAddTask
(1)  195/  FF300E : 6100 D278           		bsr	System_MdMars_MstSendAll
(1)  196/  FF3012 :                     		
(1)  197/  FF3012 :                     .nox:
(1)  198/  FF3012 : 203C 0600 1B7C      		move.l	#CmdTaskMd_ObjectPos,d0		; Cmnd $0A: Modify object pos and rot
(1)  199/  FF3018 : 7200                		moveq	#0,d1				; Slot
(1)  200/  FF301A : 7400                		moveq	#0,d2				; X
(1)  201/  FF301C : 7600                		moveq	#0,d3				; Y
(1)  202/  FF301E : 283C FFFD 0000      		move.l	#-$30000,d4			; Z
(1)  203/  FF3024 : 2A38 8824           		move.l	(RAM_RotX),d5
(1)  204/  FF3028 : 2C38 8824           		move.l	(RAM_RotX),d6
(1)  205/  FF302C : 2E38 8824           		move.l	(RAM_RotX),d7
(1)  206/  FF3030 : E48D                		lsr.l	#2,d5
(1)  207/  FF3032 : 6100 D208           		bsr	System_MdMars_SlvAddTask
(1)  208/  FF3036 : 6100 D270           		bsr	System_MdMars_SlvSendAll
(1)  209/  FF303A : 06B8 0000 2000 8824 		add.l	#$2000,(RAM_RotX)
(1)  210/  FF3042 : 4E75                		rts
(1)  211/  FF3044 :                     .update:
(1)  212/  FF3044 : 303C 0022           		move.w	#$22,d0
(1)  213/  FF3048 : 3238 882A           		move.w	(RAM_SndPitch).w,d1
(1)  214/  FF304C : 6100 E9E6           		bsr	Sound_Request
(1)  215/  FF3050 : 41FA 0292           		lea	str_StatusPtch(pc),a0
(1)  216/  FF3054 : 203C 0000 0605      		move.l	#locate(0,6,5),d0
(1)  217/  FF305A : 6000 D51E           		bra	Video_Print
(1)  218/  FF305E :                     
(1)  219/  FF305E :                     ; ; --------------------------------------------------
(1)  220/  FF305E :                     ; 
(1)  221/  FF305E :                     ; .mode1:
(1)  222/  FF305E :                     ; 		tst.w	(RAM_MdlCurrMd).w
(1)  223/  FF305E :                     ; 		bmi.s	.mode1_loop
(1)  224/  FF305E :                     ; 		or.w	#$8000,(RAM_MdlCurrMd).w
(1)  225/  FF305E :                     ; 		move.l	#CAMERA_ANIM,(RAM_MdCamera+cam2_animdata)
(1)  226/  FF305E :                     ; 
(1)  227/  FF305E :                     ; 		move.l	#CmdTaskMd_SetBitmap,d0			; 32X display OFF
(1)  228/  FF305E :                     ; 		moveq	#0,d1
(1)  229/  FF305E :                     ; 		bsr	System_MdMars_Call
(1)  230/  FF305E :                     ; 		move.l	#CmdTaskMd_ObjectClrAll,d0		; Clear ALL objects
(1)  231/  FF305E :                     ; 		bsr	System_MdMars_Call
(1)  232/  FF305E :                     ; 
(1)  233/  FF305E :                     ; 		move.l	#CmdTaskMd_MapSet,d0			; Set layout data
(1)  234/  FF305E :                     ; 		move.l	#TEST_LAYOUT,d1
(1)  235/  FF305E :                     ; 		bsr	System_MdMars_AddTask
(1)  236/  FF305E :                     ; 		move.l	#CmdTaskMd_LoadSPal,d0			; Load SuperVDP palette
(1)  237/  FF305E :                     ; 		move.l	#Palette_Map,d1
(1)  238/  FF305E :                     ; 		moveq	#0,d2
(1)  239/  FF305E :                     ; 		move.w	#255,d3
(1)  240/  FF305E :                     ; 		moveq	#0,d4
(1)  241/  FF305E :                     ; 		move.w	#$7FFF,d5
(1)  242/  FF305E :                     ; 		bsr	System_MdMars_AddTask
(1)  243/  FF305E :                     ; 		move.l	#CmdTaskMd_SetBitmap,d0			; 32X display ON
(1)  244/  FF305E :                     ; 		moveq	#1,d1
(1)  245/  FF305E :                     ; 		bsr	System_MdMars_AddTask
(1)  246/  FF305E :                     ; .holdon_1:	bsr	System_MdMars_CheckBusy
(1)  247/  FF305E :                     ; 		bne.s	.holdon_1
(1)  248/  FF305E :                     ; 		bsr	System_MdMars_SendAll
(1)  249/  FF305E :                     ; 		bsr	MdMdl_Update
(1)  250/  FF305E :                     ; 
(1)  251/  FF305E :                     ; .mode1_loop:
(1)  252/  FF305E :                     ; 		move.w	(Controller_1+on_press),d7
(1)  253/  FF305E :                     ; 		and.w	#JoyA,d7
(1)  254/  FF305E :                     ; 		beq.s	.no_prss1
(1)  255/  FF305E :                     ; 		move.w	#0,(RAM_MdlCurrMd).w
(1)  256/  FF305E :                     ; 		rts
(1)  257/  FF305E :                     ; .no_prss1:
(1)  258/  FF305E :                     ; ; 		bsr	MdMdl_CamAnimate
(1)  259/  FF305E :                     ; 		bsr	MdMdl1_Usercontrol		; Foward/Backward/Left/Right
(1)  260/  FF305E :                     ; 		bsr	System_MdMars_CheckBusy
(1)  261/  FF305E :                     ; 		bne.s	.it_is
(1)  262/  FF305E :                     ; 		lea	(RAM_MdCamera),a0
(1)  263/  FF305E :                     ; 		move.l	#CmdTaskMd_CameraPos,d0		; Cmnd $0D: Set camera positions
(1)  264/  FF305E :                     ; 		moveq	#0,d1
(1)  265/  FF305E :                     ; 		move.l	cam2_x_pos(a0),d2
(1)  266/  FF305E :                     ; 		move.l	cam2_y_pos(a0),d3
(1)  267/  FF305E :                     ; 		move.l	cam2_z_pos(a0),d4
(1)  268/  FF305E :                     ; 		move.l	cam2_x_rot(a0),d5
(1)  269/  FF305E :                     ; 		move.l	cam2_y_rot(a0),d6
(1)  270/  FF305E :                     ; 		move.l	cam2_z_rot(a0),d7
(1)  271/  FF305E :                     ; 		bsr	System_MdMars_AddTask
(1)  272/  FF305E :                     ; 		bsr	System_MdMars_SendAll
(1)  273/  FF305E :                     ; .it_is:
(1)  274/  FF305E :                     ; 		rts
(1)  275/  FF305E :                     
(1)  276/  FF305E :                     ; ====================================================================
(1)  277/  FF305E :                     ; ------------------------------------------------------
(1)  278/  FF305E :                     ; Subroutines
(1)  279/  FF305E :                     ; ------------------------------------------------------
(1)  280/  FF305E :                     
(1)  281/  FF305E :                     MdMdl_Update:
(1)  282/  FF305E : 41FA 0158           		lea	str_Mode0(pc),a0
(1)  283/  FF3062 : 3038 8828           		move.w	(RAM_MdlCurrMd).w,d0
(1)  284/  FF3066 : C07C 00FF           		and.w	#$FF,d0
(1)  285/  FF306A : 6704                		beq.s	.mod0
(1)  286/  FF306C : 41FA 01E0           		lea	str_Mode1(pc),a0
(1)  287/  FF3070 :                     .mod0:
(1)  288/  FF3070 : 203C 0000 0103      		move.l	#locate(0,1,3),d0
(1)  289/  FF3076 : 6000 D502           		bra	Video_Print
(1)  290/  FF307A :                     
(1)  291/  FF307A :                     MdMdl_CamAnimate:
(1)  292/  FF307A : 41F8 8800           		lea	(RAM_MdCamera),a0
(1)  293/  FF307E : 2028 0018           		move.l	cam2_animdata(a0),d0		; If 0 == No animation
(1)  294/  FF3082 : 6754                		beq.s	.no_camanim
(1)  295/  FF3084 : 04A8 0000 0001 0020 		sub.l	#1,cam2_animtimer(a0)
(1)  296/  FF308C : 6A4A                		bpl.s	.no_camanim
(1)  297/  FF308E : 217C 0000 0002 0020 		move.l	#1+1,cam2_animtimer(a0)		; TEMPORAL timer
(1)  298/  FF3096 : 2240                		move.l	d0,a1
(1)  299/  FF3098 : 2219                		move.l	(a1)+,d1
(1)  300/  FF309A : 2028 001C           		move.l	cam2_animframe(a0),d0
(1)  301/  FF309E : D0BC 0000 0001      		add.l	#1,d0
(1)  302/  FF30A4 : B081                		cmp.l	d1,d0
(1)  303/  FF30A6 : 6602                		bne.s	.on_frames
(1)  304/  FF30A8 : 7000                		moveq	#0,d0
(1)  305/  FF30AA :                     .on_frames:
(1)  306/  FF30AA : 2140 001C           		move.l	d0,cam2_animframe(a0)
(1)  307/  FF30AE : C0FC 0018           		mulu.w	#$18,d0
(1)  308/  FF30B2 : D2C0                		adda	d0,a1
(1)  309/  FF30B4 : 2099                		move.l	(a1)+,cam2_x_pos(a0)
(1)  310/  FF30B6 : 2159 0004           		move.l	(a1)+,cam2_y_pos(a0)
(1)  311/  FF30BA : 2159 0008           		move.l	(a1)+,cam2_z_pos(a0)
(1)  312/  FF30BE : 2219                		move.l	(a1)+,d1
(1)  313/  FF30C0 : 2001                		move.l	d1,d0
(1)  314/  FF30C2 : 4480                		neg.l	d0
(1)  315/  FF30C4 : 2140 000C           		move.l	d0,cam2_x_rot(a0)
(1)  316/  FF30C8 : 2159 0010           		move.l	(a1)+,cam2_y_rot(a0)
(1)  317/  FF30CC : 2159 0014           		move.l	(a1)+,cam2_z_rot(a0)
(1)  318/  FF30D0 : EE89                		lsr.l	#7,d1
(1)  319/  FF30D2 : 33C1 FFFF 882C      		move.w	d1,(RAM_BgCamera).l
(1)  320/  FF30D8 :                     .no_camanim:
(1)  321/  FF30D8 : 4E75                		rts
(1)  322/  FF30DA :                     
(1)  323/  FF30DA :                     MdMdl1_Usercontrol:
(1)  324/  FF30DA : 2A3C 0000 2000      		move.l	#var_MoveSpd,d5
(1)  325/  FF30E0 : 2C3C FFFF E000      		move.l	#-var_MoveSpd,d6
(1)  326/  FF30E6 : 3E38 9002           		move.w	(Controller_1+on_hold),d7
(1)  327/  FF30EA : 0807 0000           		btst	#bitJoyUp,d7
(1)  328/  FF30EE : 670E                		beq.s	.no_up
(1)  329/  FF30F0 : 41F8 8800           		lea	(RAM_MdCamera),a0
(1)  330/  FF30F4 : 2028 0008           		move.l	cam2_z_pos(a0),d0
(1)  331/  FF30F8 : D085                		add.l	d5,d0
(1)  332/  FF30FA : 2140 0008           		move.l	d0,cam2_z_pos(a0)
(1)  333/  FF30FE :                     .no_up:
(1)  334/  FF30FE : 0807 0001           		btst	#bitJoyDown,d7
(1)  335/  FF3102 : 670E                		beq.s	.no_dw
(1)  336/  FF3104 : 41F8 8800           		lea	(RAM_MdCamera),a0
(1)  337/  FF3108 : 2028 0008           		move.l	cam2_z_pos(a0),d0
(1)  338/  FF310C : D086                		add.l	d6,d0
(1)  339/  FF310E : 2140 0008           		move.l	d0,cam2_z_pos(a0)
(1)  340/  FF3112 :                     .no_dw:
(1)  341/  FF3112 : 0807 0002           		btst	#bitJoyLeft,d7
(1)  342/  FF3116 : 670A                		beq.s	.no_lf
(1)  343/  FF3118 : 41F8 8800           		lea	(RAM_MdCamera),a0
(1)  344/  FF311C : 2010                		move.l	cam2_x_pos(a0),d0
(1)  345/  FF311E : D086                		add.l	d6,d0
(1)  346/  FF3120 : 2080                		move.l	d0,cam2_x_pos(a0)
(1)  347/  FF3122 :                     .no_lf:
(1)  348/  FF3122 : 0807 0003           		btst	#bitJoyRight,d7
(1)  349/  FF3126 : 670A                		beq.s	.no_rg
(1)  350/  FF3128 : 41F8 8800           		lea	(RAM_MdCamera),a0
(1)  351/  FF312C : 2010                		move.l	cam2_x_pos(a0),d0
(1)  352/  FF312E : D085                		add.l	d5,d0
(1)  353/  FF3130 : 2080                		move.l	d0,cam2_x_pos(a0)
(1)  354/  FF3132 :                     .no_rg:
(1)  355/  FF3132 :                     
(1)  356/  FF3132 : 0807 0004           		btst	#bitJoyB,d7
(1)  357/  FF3136 : 671A                		beq.s	.no_a
(1)  358/  FF3138 : 41F8 8800           		lea	(RAM_MdCamera),a0
(1)  359/  FF313C : 2028 000C           		move.l	cam2_x_rot(a0),d0
(1)  360/  FF3140 : 2206                		move.l	d6,d1
(1)  361/  FF3142 : D081                		add.l	d1,d0
(1)  362/  FF3144 : 2140 000C           		move.l	d0,cam2_x_rot(a0)
(1)  363/  FF3148 : EE88                		lsr.l	#7,d0
(1)  364/  FF314A : 4480                		neg.l	d0
(1)  365/  FF314C : 33C0 FFFF 882C      		move.w	d0,(RAM_BgCamera).l
(1)  366/  FF3152 :                     .no_a:
(1)  367/  FF3152 : 0807 0005           		btst	#bitJoyC,d7
(1)  368/  FF3156 : 671A                		beq.s	.no_b
(1)  369/  FF3158 : 41F8 8800           		lea	(RAM_MdCamera),a0
(1)  370/  FF315C : 2028 000C           		move.l	cam2_x_rot(a0),d0
(1)  371/  FF3160 : 2205                		move.l	d5,d1
(1)  372/  FF3162 : D081                		add.l	d1,d0
(1)  373/  FF3164 : 2140 000C           		move.l	d0,cam2_x_rot(a0)
(1)  374/  FF3168 : EE88                		lsr.l	#7,d0
(1)  375/  FF316A : 4480                		neg.l	d0
(1)  376/  FF316C : 33C0 FFFF 882C      		move.w	d0,(RAM_BgCamera).l
(1)  377/  FF3172 :                     .no_b:
(1)  378/  FF3172 :                     	; Reset all
(1)  379/  FF3172 :                     ; 		btst	#bitJoyC,d7
(1)  380/  FF3172 :                     ; 		beq.s	.no_c
(1)  381/  FF3172 :                     ; 		;move.w	#1,(RAM_MdMdlsUpd).l
(1)  382/  FF3172 :                     ; 		lea	(RAM_MdCamera),a0
(1)  383/  FF3172 :                     ; 		moveq	#0,d0
(1)  384/  FF3172 :                     ; 		move.l	d0,cam2_x_pos(a0)
(1)  385/  FF3172 :                     ; 		move.l	d0,cam2_y_pos(a0)
(1)  386/  FF3172 :                     ; 		move.l	d0,cam2_z_pos(a0)
(1)  387/  FF3172 :                     ; 		move.l	d0,cam2_x_rot(a0)
(1)  388/  FF3172 :                     ; 		move.l	d0,cam2_y_rot(a0)
(1)  389/  FF3172 :                     ; 		move.l	d0,cam2_z_rot(a0)
(1)  390/  FF3172 :                     ; .no_c:
(1)  391/  FF3172 :                     
(1)  392/  FF3172 :                     
(1)  393/  FF3172 :                     	; Up/Down
(1)  394/  FF3172 : 3807                		move.w	d7,d4
(1)  395/  FF3174 : C87C 0200           		and.w	#JoyY,d4
(1)  396/  FF3178 : 670E                		beq.s	.no_x
(1)  397/  FF317A :                     		;move.w	#1,(RAM_MdMdlsUpd).l
(1)  398/  FF317A : 41F8 8800           		lea	(RAM_MdCamera),a0
(1)  399/  FF317E : 2028 0004           		move.l	cam2_y_pos(a0),d0
(1)  400/  FF3182 : D085                		add.l	d5,d0
(1)  401/  FF3184 : 2140 0004           		move.l	d0,cam2_y_pos(a0)
(1)  402/  FF3188 :                     .no_x:
(1)  403/  FF3188 : 3807                		move.w	d7,d4
(1)  404/  FF318A : C87C 0100           		and.w	#JoyZ,d4
(1)  405/  FF318E : 670E                		beq.s	.no_y
(1)  406/  FF3190 :                     		;move.w	#1,(RAM_MdMdlsUpd).l
(1)  407/  FF3190 : 41F8 8800           		lea	(RAM_MdCamera),a0
(1)  408/  FF3194 : 2028 0004           		move.l	cam2_y_pos(a0),d0
(1)  409/  FF3198 : D086                		add.l	d6,d0
(1)  410/  FF319A : 2140 0004           		move.l	d0,cam2_y_pos(a0)
(1)  411/  FF319E :                     .no_y:
(1)  412/  FF319E : 4E75                		rts
(1)  413/  FF31A0 :                     
(1)  414/  FF31A0 :                     ; ====================================================================
(1)  415/  FF31A0 :                     ; ------------------------------------------------------
(1)  416/  FF31A0 :                     ; Interrupts
(1)  417/  FF31A0 :                     ; ------------------------------------------------------
(1)  418/  FF31A0 :                     
(1)  419/  FF31A0 :                     ; --------------------------------------------------
(1)  420/  FF31A0 :                     ; Custom VBlank
(1)  421/  FF31A0 :                     ; --------------------------------------------------
(1)  422/  FF31A0 :                     
(1)  423/  FF31A0 :                     ; --------------------------------------------------
(1)  424/  FF31A0 :                     ; Custom HBlank
(1)  425/  FF31A0 :                     ; --------------------------------------------------
(1)  426/  FF31A0 :                     
(1)  427/  FF31A0 :                     ; ====================================================================
(1)  428/  FF31A0 :                     ; ------------------------------------------------------
(1)  429/  FF31A0 :                     ; DATA
(1)  430/  FF31A0 :                     ; 
(1)  431/  FF31A0 :                     ; short stuff goes here
(1)  432/  FF31A0 :                     ; ------------------------------------------------------
(1)  433/  FF31A0 :                     
(1)  434/  FF31A0 :                     		align 2
(1)  435/  FF31A0 : 5072 6F6A 6563 7420 str_Title:	dc.b "Project Shinrinx + GEMA",0
                    5368 696E 7269 6E78 
                    202B 2047 454D 4100 
(1)  436/  FF31B8 :                     		align 2
(1)  437/  FF31B8 : 3C20 4D6F 6465 2030 str_Mode0:	dc.b "< Mode 0: GEMA sound tester >",$A
                    3A20 4745 4D41 2073 
                    6F75 6E64 2074 6573 
                    7465 7220 3E0A      
(1)  438/  FF31D6 : 2020 2020 2020 2020 		dc.b "                             ",$A
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 200A      
(1)  439/  FF31F4 : 4441 433A 2030 3030 		dc.b "DAC: 0000 (UDLR-BC)          ",$A
                    3020 2855 444C 522D 
                    4243 2920 2020 2020 
                    2020 2020 200A      
(1)  440/  FF3212 : 5057 4D3A 2030 3030 		dc.b "PWM: 0000 (XYZ)              ",$A
                    3020 2858 595A 2920 
                    2020 2020 2020 2020 
                    2020 2020 200A      
(1)  441/  FF3230 : 2020 2020 2020 2020 		dc.b "                             ",0
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2000      
(1)  442/  FF324E :                     		align 2
(1)  443/  FF324E : 3C20 4D6F 6465 2031 str_Mode1:	dc.b "< Mode 1: Map layout sample >",$A
                    3A20 4D61 7020 6C61 
                    796F 7574 2073 616D 
                    706C 6520 3E0A      
(1)  444/  FF326C : 2020 2020 2020 2020 		dc.b "                             ",$A
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 200A      
(1)  445/  FF328A : 2020 2020 2020 2020 		dc.b "                             ",$A
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 200A      
(1)  446/  FF32A8 : 2020 2020 2020 2020 		dc.b "                             ",$A
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 200A      
(1)  447/  FF32C6 : 2020 2020 2020 2020 		dc.b "                             ",0
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2000      
(1)  448/  FF32E4 :                     		align 2
(1)  449/  FF32E4 : 5C77 00             str_StatusPtch:	dc.b "\\w",0
(1)  450/  FF32E7 : FFFF 882A           		dc.l RAM_SndPitch
(1)  451/  FF32EB :                     		align 2
(1)  452/  FF32EC :                     		
(1)  453/  FF32EC :                     str_Status:
(1)  454/  FF32EC : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w       MD: \\l",$A
                    205C 7720 2020 2020 
                    2020 4D44 3A20 5C6C 
                    0A                  
(1)  455/  FF3305 : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w",0
                    205C 7700           
(1)  456/  FF3311 : 00A1 5120           		dc.l sysmars_reg+comm0
(1)  457/  FF3315 : 00A1 5122           		dc.l sysmars_reg+comm2
(1)  458/  FF3319 : 00A1 5124           		dc.l sysmars_reg+comm4
(1)  459/  FF331D : 00A1 5126           		dc.l sysmars_reg+comm6
(1)  460/  FF3321 : FFFF 9638           		dc.l RAM_FrameCount
(1)  461/  FF3325 : 00A1 5128           		dc.l sysmars_reg+comm8
(1)  462/  FF3329 : 00A1 512A           		dc.l sysmars_reg+comm10
(1)  463/  FF332D : 00A1 512C           		dc.l sysmars_reg+comm12
(1)  464/  FF3331 : 00A1 512E           		dc.l sysmars_reg+comm14
(1)  465/  FF3335 :                     ; 		dc.l RAM_MdCamera+cam2_x_pos
(1)  466/  FF3335 :                     ; 		dc.l RAM_MdCamera+cam2_y_pos
(1)  467/  FF3335 :                     ; 		dc.l RAM_MdCamera+cam2_z_pos
(1)  468/  FF3335 :                     ; 		dc.l RAM_MdCamera+cam2_x_rot
(1)  469/  FF3335 :                     ; 		dc.l RAM_MdCamera+cam2_y_rot
(1)  470/  FF3335 :                     ; 		dc.l RAM_MdCamera+cam2_z_rot
(1)  471/  FF3335 :                     		align 4
(1)  472/  FF3336 :                     		
(1)  473/  FF3336 :                     ; MdPal_Bg:
(1)  474/  FF3336 :                     ; 		binclude "data/md/bg/bg_pal.bin"
(1)  475/  FF3336 :                     ; 		align 2
(1)  476/  FF3336 :                     ; MdMap_Bg:
(1)  477/  FF3336 :                     ; 		binclude "data/md/bg/bg_map.bin"
(1)  478/  FF3336 :                     ; 		align 2
(1)  479/  FF3336 :                     
      46/    3C68 :                     		dephase
      47/    3C68 :                     Engine_Code_end:
MD RAM CODE uses: 3336
      49/    3C68 :                     		message "MD RAM CODE uses: \{Engine_Code_end-Engine_Code}"
      51/    3C68 :                     	
      52/    3C68 :                     ; ====================================================================
      53/    3C68 :                     ; ----------------------------------------------------------------
      54/    3C68 :                     ; SH2 CODE for 32X
      55/    3C68 :                     ; ----------------------------------------------------------------
      56/    3C68 :                     
      57/    3C68 :                     		align 4
      58/    3C68 :                     MARS_RAMDATA:
      59/    3C68 :                     		include "code/mars.asm"
(1)    1/    3C68 :                     ; ====================================================================		
(1)    2/    3C68 :                     ; ----------------------------------------------------------------
(1)    3/    3C68 :                     ; MARS SH2 Section
(1)    4/    3C68 :                     ; 
(1)    5/    3C68 :                     ; CODE for both CPUs
(1)    6/    3C68 :                     ; RAM and some DATA go here
(1)    7/    3C68 :                     ; ----------------------------------------------------------------
(1)    8/    3C68 :                     
(1)    9/ 6000000 :                     		phase CS3		; now we are at SDRAM
(1)   10/ 6000000 :                     		cpu SH7600		; should be SH7095 but ASL doesn't have it, this is close enough
(1)   11/ 6000000 :                     
(1)   12/ 6000000 :                     ; ====================================================================
(1)   13/ 6000000 :                     
(1)   14/ 6000000 :                     		include "system/mars/head.asm"
(2)    1/ 6000000 :                     ; ====================================================================		
(2)    2/ 6000000 :                     ; ----------------------------------------------------------------
(2)    3/ 6000000 :                     ; MASTER CPU HEAD
(2)    4/ 6000000 :                     ; ----------------------------------------------------------------
(2)    5/ 6000000 :                     
(2)    6/ 6000000 :                     		align 4
(2)    7/ 6000000 :                     SH2_Master:
(2)    8/ 6000000 : 0600 176C 0604 0000 		dc.l SH2_M_Entry,CS3|$40000	; Cold PC,SP
(2)    9/ 6000008 : 0600 176C 0604 0000 		dc.l SH2_M_Entry,CS3|$40000	; Manual PC,SP
(2)   10/ 6000010 :                     
(2)   11/ 6000010 : 0600 030C           		dc.l SH2_Error			; Illegal instruction
(2)   12/ 6000014 : 0000 0000           		dc.l 0				; reserved
(2)   13/ 6000018 : 0600 030C           		dc.l SH2_Error			; Invalid slot instruction
(2)   14/ 600001C : 2010 0400           		dc.l $20100400			; reserved
(2)   15/ 6000020 : 2010 0420           		dc.l $20100420			; reserved
(2)   16/ 6000024 : 0600 030C           		dc.l SH2_Error			; CPU address error
(2)   17/ 6000028 : 0600 030C           		dc.l SH2_Error			; DMA address error
(2)   18/ 600002C : 0600 030C           		dc.l SH2_Error			; NMI vector
(2)   19/ 6000030 : 0600 030C           		dc.l SH2_Error			; User break vector
(2)   20/ 6000034 :                     
(2)   21/ 6000034 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0,0	; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
(2)   22/ 600005C : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(2)   23/ 6000080 :                     
(2)   24/ 6000080 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error	; Trap vectors
(2)   25/ 6000088 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   26/ 6000090 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   27/ 6000098 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error		
(2)   28/ 60000A0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   29/ 60000A8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   30/ 60000B0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   31/ 60000B8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   32/ 60000C0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error		
(2)   33/ 60000C8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   34/ 60000D0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   35/ 60000D8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   36/ 60000E0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   37/ 60000E8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error		
(2)   38/ 60000F0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   39/ 60000F8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   40/ 6000100 :                     
(2)   41/ 6000100 : 0600 0248            		dc.l master_irq			; Level 1 IRQ
(2)   42/ 6000104 : 0600 0248           		dc.l master_irq			; Level 2 & 3 IRQ's
(2)   43/ 6000108 : 0600 0248           		dc.l master_irq			; Level 4 & 5 IRQ's
(2)   44/ 600010C : 0600 0248           		dc.l master_irq			; PWM interupt
(2)   45/ 6000110 : 0600 0248           		dc.l master_irq			; Command interupt
(2)   46/ 6000114 : 0600 0248           		dc.l master_irq			; H Blank interupt
(2)   47/ 6000118 : 0600 0248           		dc.l master_irq			; V Blank interupt
(2)   48/ 600011C : 0600 0248           		dc.l master_irq			; Reset Button
(2)   49/ 6000120 : 0600 0248           		dc.l master_irq			;
(2)   50/ 6000124 :                     
(2)   51/ 6000124 :                     ; ====================================================================
(2)   52/ 6000124 :                     ; ----------------------------------------------------------------
(2)   53/ 6000124 :                     ; SLAVE CPU HEAD
(2)   54/ 6000124 :                     ; ----------------------------------------------------------------
(2)   55/ 6000124 :                     
(2)   56/ 6000124 :                     		align 4
(2)   57/ 6000124 :                     SH2_Slave:
(2)   58/ 6000124 : 0600 1920 0603 F000 		dc.l SH2_S_Entry,CS3|$3F000	; Cold PC,SP
(2)   59/ 600012C : 0600 1920 0603 F000 		dc.l SH2_S_Entry,CS3|$3F000	; Manual PC,SP
(2)   60/ 6000134 :                     
(2)   61/ 6000134 : 0600 030C           		dc.l SH2_Error			; Illegal instruction
(2)   62/ 6000138 : 0000 0000           		dc.l 0				; reserved
(2)   63/ 600013C : 0600 030C           		dc.l SH2_Error			; Invalid slot instruction
(2)   64/ 6000140 : 2010 0400           		dc.l $20100400			; reserved
(2)   65/ 6000144 : 2010 0420           		dc.l $20100420			; reserved
(2)   66/ 6000148 : 0600 030C           		dc.l SH2_Error			; CPU address error
(2)   67/ 600014C : 0600 030C           		dc.l SH2_Error			; DMA address error
(2)   68/ 6000150 : 0600 030C           		dc.l SH2_Error			; NMI vector
(2)   69/ 6000154 : 0600 030C           		dc.l SH2_Error			; User break vector
(2)   70/ 6000158 :                     
(2)   71/ 6000158 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0,0	; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
(2)   72/ 6000180 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(2)   73/ 60001A4 :                     
(2)   74/ 60001A4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error	; Trap vectors
(2)   75/ 60001AC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   76/ 60001B4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   77/ 60001BC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error		
(2)   78/ 60001C4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   79/ 60001CC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   80/ 60001D4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   81/ 60001DC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   82/ 60001E4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error		
(2)   83/ 60001EC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   84/ 60001F4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   85/ 60001FC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   86/ 6000204 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   87/ 600020C : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error		
(2)   88/ 6000214 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   89/ 600021C : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(2)   90/ 6000224 :                     
(2)   91/ 6000224 : 0600 02AC            		dc.l slave_irq			; Level 1 IRQ
(2)   92/ 6000228 : 0600 02AC           		dc.l slave_irq			; Level 2 & 3 IRQ's
(2)   93/ 600022C : 0600 02AC           		dc.l slave_irq			; Level 4 & 5 IRQ's
(2)   94/ 6000230 : 0600 02AC           		dc.l slave_irq			; PWM interupt
(2)   95/ 6000234 : 0600 02AC           		dc.l slave_irq			; Command interupt
(2)   96/ 6000238 : 0600 02AC           		dc.l slave_irq			; H Blank interupt
(2)   97/ 600023C : 0600 02AC           		dc.l slave_irq			; V Blank interupt
(2)   98/ 6000240 : 0600 02AC           		dc.l slave_irq			; Reset Button
(2)   99/ 6000244 : 0600 02AC           		dc.l slave_irq
(2)  100/ 6000248 :                     
(2)  101/ 6000248 :                     ; ====================================================================
(2)  102/ 6000248 :                     ; ----------------------------------------------------------------
(2)  103/ 6000248 :                     ; irq
(2)  104/ 6000248 :                     ; 
(2)  105/ 6000248 :                     ; r0-r1 are safe
(2)  106/ 6000248 :                     ; ----------------------------------------------------------------
(2)  107/ 6000248 :                     
(2)  108/ 6000248 :                     		align 4
(2)  109/ 6000248 :                     master_irq:
(2)  110/ 6000248 : 2F06                		mov.l	r0,@-r15
(2)  111/ 600024A : 2F16                		mov.l	r1,@-r15
(2)  112/ 600024C : 4F22                		sts.l	pr,@-r15
(2)  113/ 600024E :                     	
(2)  114/ 600024E : 0002                		stc	sr,r0
(2)  115/ 6000250 : 4009                		shlr2	r0
(2)  116/ 6000252 : C93C                		and	#$3C,r0
(2)  117/ 6000254 : D104                		mov	#int_m_list,r1
(2)  118/ 6000256 : 301C                		add	r1,r0
(2)  119/ 6000258 : 6102                		mov	@r0,r1
(2)  120/ 600025A : 410B                		jsr	@r1
(2)  121/ 600025C : 0009                		nop
(2)  122/ 600025E :                     		
(2)  123/ 600025E : 4F26                		lds.l	@r15+,pr
(2)  124/ 6000260 : 61F6                		mov.l	@r15+,r1
(2)  125/ 6000262 : 60F6                		mov.l	@r15+,r0
(2)  126/ 6000264 : 002B                		rte
(2)  127/ 6000266 : 0009                		nop
(2)  128/ 6000268 :                     		align 4
(2)  129/ 6000268 : 0600 026C           		ltorg
(2)  130/ 600026C :                     
(2)  131/ 600026C :                     ; ------------------------------------------------
(2)  132/ 600026C :                     ; irq list
(2)  133/ 600026C :                     ; ------------------------------------------------
(2)  134/ 600026C :                     
(2)  135/ 600026C :                     		align 4
(2)  136/ 600026C :                     int_m_list:
(2)  137/ 600026C : 0600 0314 0600 0314 		dc.l m_irq_bad,m_irq_bad
(2)  138/ 6000274 : 0600 0314 0600 0314 		dc.l m_irq_bad,m_irq_bad
(2)  139/ 600027C : 0600 0314 C000 0000 		dc.l m_irq_bad,m_irq_custom
(2)  140/ 6000284 : 0600 0318 0600 0318 		dc.l m_irq_pwm,m_irq_pwm
(2)  141/ 600028C : 0600 033C 0600 033C 		dc.l m_irq_cmd,m_irq_cmd
(2)  142/ 6000294 : 0600 03A4 0600 03A4 		dc.l m_irq_h,m_irq_h
(2)  143/ 600029C : 0600 03C0 0600 03C0 		dc.l m_irq_v,m_irq_v
(2)  144/ 60002A4 : 0600 0464 0600 0464 		dc.l m_irq_vres,m_irq_vres
(2)  145/ 60002AC :                     		
(2)  146/ 60002AC :                     ; ====================================================================
(2)  147/ 60002AC :                     ; ----------------------------------------------------------------
(2)  148/ 60002AC :                     ; irq
(2)  149/ 60002AC :                     ; 
(2)  150/ 60002AC :                     ; r0-r1 are safe
(2)  151/ 60002AC :                     ; ----------------------------------------------------------------
(2)  152/ 60002AC :                     
(2)  153/ 60002AC :                     		align 4
(2)  154/ 60002AC :                     slave_irq:
(2)  155/ 60002AC : 2F06                		mov.l	r0,@-r15
(2)  156/ 60002AE : 2F16                		mov.l	r1,@-r15
(2)  157/ 60002B0 : 4F22                		sts.l	pr,@-r15
(2)  158/ 60002B2 :                     
(2)  159/ 60002B2 : 0002                		stc	sr,r0
(2)  160/ 60002B4 : 4009                		shlr2	r0
(2)  161/ 60002B6 : C93C                		and	#$3C,r0
(2)  162/ 60002B8 : D180                		mov	#int_s_list,r1
(2)  163/ 60002BA : 301C                		add	r1,r0
(2)  164/ 60002BC : 6102                		mov	@r0,r1
(2)  165/ 60002BE : 410B                		jsr	@r1
(2)  166/ 60002C0 : 0009                		nop
(2)  167/ 60002C2 :                     		
(2)  168/ 60002C2 : 4F26                		lds.l	@r15+,pr
(2)  169/ 60002C4 : 61F6                		mov.l	@r15+,r1
(2)  170/ 60002C6 : 60F6                		mov.l	@r15+,r0
(2)  171/ 60002C8 : 002B                		rte
(2)  172/ 60002CA : 0009                		nop
(2)  173/ 60002CC :                     		
(2)  174/ 60002CC :                     ; ------------------------------------------------
(2)  175/ 60002CC :                     ; irq list
(2)  176/ 60002CC :                     ; ------------------------------------------------
(2)  177/ 60002CC :                     
(2)  178/ 60002CC :                     		align 4
(2)  179/ 60002CC :                     int_s_list:
(2)  180/ 60002CC : 0600 050E 0600 050E 		dc.l s_irq_bad,s_irq_bad
(2)  181/ 60002D4 : 0600 050E 0600 050E 		dc.l s_irq_bad,s_irq_bad
(2)  182/ 60002DC : 0600 050E 0600 1C28 		dc.l s_irq_bad,s_irq_custom
(2)  183/ 60002E4 : 0600 0514 0600 0514 		dc.l s_irq_pwm,s_irq_pwm
(2)  184/ 60002EC : 0600 0530 0600 0530 		dc.l s_irq_cmd,s_irq_cmd
(2)  185/ 60002F4 : 0600 058C 0600 058C 		dc.l s_irq_h,s_irq_h
(2)  186/ 60002FC : 0600 05A8 0600 05A8 		dc.l s_irq_v,s_irq_v
(2)  187/ 6000304 : 0600 05BC 0600 05BC 		dc.l s_irq_vres,s_irq_vres
(2)  188/ 600030C :                     
(1)   15/ 600030C :                     
(1)   16/ 600030C :                     ; ====================================================================
(1)   17/ 600030C :                     ; ----------------------------------------------------------------
(1)   18/ 600030C :                     ; MARS Global variables (for gbr)
(1)   19/ 600030C :                     ; 
(1)   20/ 600030C :                     ; Shared for both CPUs
(1)   21/ 600030C :                     ; ----------------------------------------------------------------
(1)   22/ 600030C :                     
(1)   23/ 600030C : (MACRO)             			struct 0
(1)   23/ 600030C : =$600030C           GLBL_LASTPC     set *
(1)   23/    3F74 :                                     dephase
(1)   23/    3F74 : =$3F74              GLBL_LASTORG    set *
(1)   23/       0 :                                     phase 0
(1)   24/       0 :                     marsGbl_PlyPzList_R	ds.l 1		; Current graphic piece to draw
(1)   25/       4 :                     marsGbl_PlyPzList_W	ds.l 1		; Current graphic piece to write
(1)   26/       8 :                     marsGbl_CurrZList	ds.l 1		; Current Zsort entry
(1)   27/       C :                     marsGbl_CurrFacePos	ds.l 1		; Current top face of the list while reading model data
(1)   28/      10 :                     marsGbl_MdTaskList_Sw	ds.w 1		; Requests from Genesis FIFO reading point
(1)   29/      12 :                     marsGbl_MdTaskList_Rq	ds.w 1		; and writing point
(1)   30/      14 :                     marsGbl_MdlFacesCntr	ds.w 1		; And the number of faces stored on that list
(1)   31/      16 :                     marsGbl_PolyBuffNum	ds.w 1		; PolygonBuffer switch: READ/WRITE or WRITE/READ
(1)   32/      18 :                     marsGbl_PzListCntr	ds.w 1		; Number of graphic pieces to draw
(1)   33/      1A :                     marsGbl_DrwTask		ds.w 1		; Current Drawing task for Watchdog
(1)   34/      1C :                     marsGbl_VIntFlag_M	ds.w 1		; Sets to 0 if VBlank finished on Master CPU
(1)   35/      1E :                     marsGbl_VIntFlag_S	ds.w 1		; Same thing but for the Slave CPU
(1)   36/      20 :                     marsGbl_DivReq_M	ds.w 1		; Flag to tell Watchdog we are in the middle of division
(1)   37/      22 :                     marsGbl_CurrFb		ds.w 1		; Current framebuffer number
(1)   38/      24 :                     marsGbl_PalDmaMidWr	ds.w 1		; Enable this flag if modifing RAM_Mars_Palette
(1)   39/      26 :                     sizeof_MarsGbl		ds.l 0
(1)   40/      28 : (MACRO)             			finish
(1)   40/       0 :                                     !org GLBL_LASTORG
(1)   40/ 600030C :                                     phase GLBL_LASTPC
(1)   41/ 600030C :                     			
(1)   42/ 600030C :                     ; ====================================================================
(1)   43/ 600030C :                     ; ----------------------------------------------------------------
(1)   44/ 600030C :                     ; Error trap
(1)   45/ 600030C :                     ; ----------------------------------------------------------------
(1)   46/ 600030C :                     
(1)   47/ 600030C :                     SH2_Error:
(1)   48/ 600030C : 0009                		nop
(1)   49/ 600030E : AFFD                		bra	SH2_Error
(1)   50/ 6000310 : 0009                		nop
(1)   51/ 6000312 :                     		align 4
(1)   52/ 6000314 :                     
(1)   53/ 6000314 :                     ; ====================================================================		
(1)   54/ 6000314 :                     ; ----------------------------------------------------------------
(1)   55/ 6000314 :                     ; MARS Interrupts for both CPUs
(1)   56/ 6000314 :                     ; ----------------------------------------------------------------
(1)   57/ 6000314 :                     
(1)   58/ 6000314 :                     ; =================================================================
(1)   59/ 6000314 :                     ; ------------------------------------------------
(1)   60/ 6000314 :                     ; Master | Unused interrupt
(1)   61/ 6000314 :                     ; ------------------------------------------------
(1)   62/ 6000314 :                     
(1)   63/ 6000314 :                     m_irq_bad:
(1)   64/ 6000314 : 000B                		rts
(1)   65/ 6000316 : 0009                		nop
(1)   66/ 6000318 :                     		align 4
(1)   67/ 6000318 :                     
(1)   68/ 6000318 :                     ; =================================================================
(1)   69/ 6000318 :                     ; ------------------------------------------------
(1)   70/ 6000318 :                     ; Master | PWM Interrupt
(1)   71/ 6000318 :                     ; ------------------------------------------------
(1)   72/ 6000318 :                     
(1)   73/ 6000318 :                     m_irq_pwm:
(1)   74/ 6000318 : D169                		mov	#_sysreg+monowidth,r1
(1)   75/ 600031A : 6010                		mov.b	@r1,r0
(1)   76/ 600031C : C880                 		tst	#$80,r0
(1)   77/ 600031E : 8B04                 		bf	.exit
(1)   78/ 6000320 : 4F22                		sts	pr,@-r15
(1)   79/ 6000322 : D068                		mov	#MarsSound_PWM,r0
(1)   80/ 6000324 : 400B                		jsr	@r0
(1)   81/ 6000326 : 0009                		nop
(1)   82/ 6000328 : 4F26                		lds	@r15+,pr
(1)   83/ 600032A :                     .exit:
(1)   84/ 600032A : 91ED                		mov	#_FRT,r1
(1)   85/ 600032C : 8417                		mov.b	@(7,r1),r0
(1)   86/ 600032E : CA02                		xor	#2,r0
(1)   87/ 6000330 : 8017                		mov.b	r0,@(7,r1)
(1)   88/ 6000332 : D165                		mov	#_sysreg+pwmintclr,r1
(1)   89/ 6000334 : 2101                		mov.w	r0,@r1
(1)   90/ 6000336 : 000B                		rts
(1)   91/ 6000338 : 0009                		nop
(1)   92/ 600033A :                     		align 4
(1)   93/ 600033C :                     
(1)   94/ 600033C :                     ; =================================================================
(1)   95/ 600033C :                     ; ------------------------------------------------
(1)   96/ 600033C :                     ; Master | CMD Interrupt (MD request)
(1)   97/ 600033C :                     ; ------------------------------------------------
(1)   98/ 600033C :                     
(1)   99/ 600033C :                     m_irq_cmd:
(1)  100/ 600033C : 91E4                		mov	#_FRT,r1
(1)  101/ 600033E : 8417                		mov.b	@(7,r1),r0
(1)  102/ 6000340 : CA02                		xor	#2,r0
(1)  103/ 6000342 : 8017                		mov.b	r0,@(7,r1)
(1)  104/ 6000344 : D161                		mov	#_sysreg+cmdintclr,r1
(1)  105/ 6000346 : 2101                		mov.w	r0,@r1
(1)  106/ 6000348 :                     		
(1)  107/ 6000348 : 2F26                		mov	r2,@-r15
(1)  108/ 600034A : 2F36                		mov	r3,@-r15
(1)  109/ 600034C : 4F03                		stc	sr,@-r15
(1)  110/ 600034E : 90DC                		mov	#$F0,r0
(1)  111/ 6000350 : 400E                		ldc	r0,sr
(1)  112/ 6000352 : D25F                		mov	#RAM_Mars_MdTasksFifo_M,r2
(1)  113/ 6000354 : D15F                		mov	#_sysreg+comm8,r1
(1)  114/ 6000356 :                     .next_comm:
(1)  115/ 6000356 : E002                		mov	#2,r0		; SH is ready
(1)  116/ 6000358 : 8011                		mov.b	r0,@(1,r1)
(1)  117/ 600035A :                     .wait_md_b:
(1)  118/ 600035A : 8410                		mov.b	@(0,r1),r0	; get MD status
(1)  119/ 600035C : C9FF                		and	#$FF,r0
(1)  120/ 600035E : 2008                		tst	r0,r0
(1)  121/ 6000360 : 8911                		bt	.finish
(1)  122/ 6000362 : 8801                		cmp/eq	#1,r0		; MD is writing?
(1)  123/ 6000364 : 8BF9                		bf	.wait_md_b
(1)  124/ 6000366 : E001                		mov	#1,r0		; SH is busy
(1)  125/ 6000368 : 8011                		mov.b	r0,@(1,r1)
(1)  126/ 600036A :                     .wait_md_c:
(1)  127/ 600036A : 8410                		mov.b	@(0,r1),r0
(1)  128/ 600036C : C9FF                		and	#$FF,r0
(1)  129/ 600036E : 2008                		tst	r0,r0
(1)  130/ 6000370 : 8909                		bt	.finish
(1)  131/ 6000372 : 8802                		cmp/eq	#2,r0		; MD is ready?
(1)  132/ 6000374 : 8BF9                		bf	.wait_md_c
(1)  133/ 6000376 : 8511                		mov.w	@(2,r1),r0	; comm10
(1)  134/ 6000378 : 2201                		mov.w	r0,@r2
(1)  135/ 600037A : 8512                		mov.w	@(4,r1),r0	; comm12
(1)  136/ 600037C : 8121                		mov.w	r0,@(2,r2)
(1)  137/ 600037E :                     		
(1)  138/ 600037E :                     ; 		mov	#_sysreg+comm6,r4
(1)  139/ 600037E :                     ; 		mov.w	@r4,r0
(1)  140/ 600037E :                     ; 		add	#1,r0
(1)  141/ 600037E :                     ; 		mov.w	r0,@r4
(1)  142/ 600037E : E002                		mov	#2,r0		; SH is ready
(1)  143/ 6000380 : 8011                		mov.b	r0,@(1,r1)
(1)  144/ 6000382 : AFE8                		bra	.next_comm
(1)  145/ 6000384 : 7204                		add	#4,r2
(1)  146/ 6000386 :                     .finish:
(1)  147/ 6000386 : D154                		mov	#_sysreg+comm14,r1
(1)  148/ 6000388 : 6010                		mov.b	@r1,r0
(1)  149/ 600038A : CB80                		or	#$80,r0
(1)  150/ 600038C : 2100                		mov.b	r0,@r1
(1)  151/ 600038E : 4F07                		ldc 	@r15+,sr
(1)  152/ 6000390 : 63F6                		mov 	@r15+,r3
(1)  153/ 6000392 : 62F6                		mov 	@r15+,r2
(1)  154/ 6000394 : 000B                		rts
(1)  155/ 6000396 : 0009                		nop
(1)  156/ 6000398 :                     		align 4
(1)  157/ 6000398 :                     
(1)  158/ 6000398 : 0009                		nop
(1)  159/ 600039A : 0009                		nop
(1)  160/ 600039C : 0009                		nop
(1)  161/ 600039E : 000B                		rts
(1)  162/ 60003A0 : 0009                		nop
(1)  163/ 60003A2 :                     		align 4
(1)  164/ 60003A4 :                     		
(1)  165/ 60003A4 :                     ; =================================================================
(1)  166/ 60003A4 :                     ; ------------------------------------------------
(1)  167/ 60003A4 :                     ; Master | HBlank
(1)  168/ 60003A4 :                     ; ------------------------------------------------
(1)  169/ 60003A4 :                     
(1)  170/ 60003A4 :                     m_irq_h:
(1)  171/ 60003A4 : 91B0                		mov	#_FRT,r1
(1)  172/ 60003A6 : 8417                		mov.b	@(7,r1),r0
(1)  173/ 60003A8 : CA02                		xor	#2,r0
(1)  174/ 60003AA : 8017                		mov.b	r0,@(7,r1)
(1)  175/ 60003AC : D14B                		mov	#_sysreg+hintclr,r1
(1)  176/ 60003AE : 2101                		mov.w	r0,@r1
(1)  177/ 60003B0 : 0009                		nop
(1)  178/ 60003B2 : 0009                		nop
(1)  179/ 60003B4 : 0009                		nop
(1)  180/ 60003B6 : 0009                		nop
(1)  181/ 60003B8 : 0009                		nop
(1)  182/ 60003BA : 000B                		rts
(1)  183/ 60003BC : 0009                		nop
(1)  184/ 60003BE :                     		align 4
(1)  185/ 60003C0 :                     		
(1)  186/ 60003C0 :                     ; =================================================================
(1)  187/ 60003C0 :                     ; ------------------------------------------------
(1)  188/ 60003C0 :                     ; Master | VBlank
(1)  189/ 60003C0 :                     ; ------------------------------------------------
(1)  190/ 60003C0 :                     
(1)  191/ 60003C0 :                     m_irq_v:
(1)  192/ 60003C0 : 91A2                		mov	#_FRT,r1
(1)  193/ 60003C2 : 8417                		mov.b	@(7,r1),r0
(1)  194/ 60003C4 : CA02                		xor	#2,r0
(1)  195/ 60003C6 : 8017                		mov.b	r0,@(7,r1)
(1)  196/ 60003C8 : D145                		mov	#_sysreg+vintclr,r1
(1)  197/ 60003CA : 2101                		mov.w	r0,@r1
(1)  198/ 60003CC :                     
(1)  199/ 60003CC :                     	; TODO: DMA works but after the first
(1)  200/ 60003CC :                     	; pass it locks both SOURCE and DESTINATION
(1)  201/ 60003CC :                     	; data sections
(1)  202/ 60003CC : D145                		mov	#_vdpreg,r1			; Wait for palette access ok
(1)  203/ 60003CE : 841A                .wait		mov.b	@(vdpsts,r1),r0
(1)  204/ 60003D0 : C820                		tst	#$20,r0
(1)  205/ 60003D2 : 89FC                		bt	.wait
(1)  206/ 60003D4 : 4F03                		stc	sr,@-r15
(1)  207/ 60003D6 : 2F26                		mov	r2,@-r15
(1)  208/ 60003D8 : 2F36                		mov	r3,@-r15
(1)  209/ 60003DA : 2F46                		mov	r4,@-r15
(1)  210/ 60003DC : 2F56                		mov	r5,@-r15
(1)  211/ 60003DE : 2F66                		mov	r6,@-r15
(1)  212/ 60003E0 : 9093                		mov	#$F0,r0
(1)  213/ 60003E2 : 400E                		ldc	r0,sr
(1)  214/ 60003E4 : D140                		mov	#RAM_Mars_Palette,r1		; Send palette stored on RAM		
(1)  215/ 60003E6 : D241                		mov	#_palette,r2
(1)  216/ 60003E8 : E310                 		mov	#256/16,r3		
(1)  217/ 60003EA :                     .copy_pal:
(1)  218/ 60003EA :                     	rept 16
(1)  219/ 60003EA :                     		mov.w	@r1+,r0
(1)  220/ 60003EA :                     		mov.w	r0,@r2
(1)  221/ 60003EA :                     		add	#2,r2
(1)  222/ 60003EA :                     	endm
(1)  219/ 60003EA : 6015                		mov.w	@r1+,r0
(1)  220/ 60003EC : 2201                		mov.w	r0,@r2
(1)  221/ 60003EE : 7202                		add	#2,r2
(1)  219/ 60003F0 : 6015                		mov.w	@r1+,r0
(1)  220/ 60003F2 : 2201                		mov.w	r0,@r2
(1)  221/ 60003F4 : 7202                		add	#2,r2
(1)  219/ 60003F6 : 6015                		mov.w	@r1+,r0
(1)  220/ 60003F8 : 2201                		mov.w	r0,@r2
(1)  221/ 60003FA : 7202                		add	#2,r2
(1)  219/ 60003FC : 6015                		mov.w	@r1+,r0
(1)  220/ 60003FE : 2201                		mov.w	r0,@r2
(1)  221/ 6000400 : 7202                		add	#2,r2
(1)  219/ 6000402 : 6015                		mov.w	@r1+,r0
(1)  220/ 6000404 : 2201                		mov.w	r0,@r2
(1)  221/ 6000406 : 7202                		add	#2,r2
(1)  219/ 6000408 : 6015                		mov.w	@r1+,r0
(1)  220/ 600040A : 2201                		mov.w	r0,@r2
(1)  221/ 600040C : 7202                		add	#2,r2
(1)  219/ 600040E : 6015                		mov.w	@r1+,r0
(1)  220/ 6000410 : 2201                		mov.w	r0,@r2
(1)  221/ 6000412 : 7202                		add	#2,r2
(1)  219/ 6000414 : 6015                		mov.w	@r1+,r0
(1)  220/ 6000416 : 2201                		mov.w	r0,@r2
(1)  221/ 6000418 : 7202                		add	#2,r2
(1)  219/ 600041A : 6015                		mov.w	@r1+,r0
(1)  220/ 600041C : 2201                		mov.w	r0,@r2
(1)  221/ 600041E : 7202                		add	#2,r2
(1)  219/ 6000420 : 6015                		mov.w	@r1+,r0
(1)  220/ 6000422 : 2201                		mov.w	r0,@r2
(1)  221/ 6000424 : 7202                		add	#2,r2
(1)  219/ 6000426 : 6015                		mov.w	@r1+,r0
(1)  220/ 6000428 : 2201                		mov.w	r0,@r2
(1)  221/ 600042A : 7202                		add	#2,r2
(1)  219/ 600042C : 6015                		mov.w	@r1+,r0
(1)  220/ 600042E : 2201                		mov.w	r0,@r2
(1)  221/ 6000430 : 7202                		add	#2,r2
(1)  219/ 6000432 : 6015                		mov.w	@r1+,r0
(1)  220/ 6000434 : 2201                		mov.w	r0,@r2
(1)  221/ 6000436 : 7202                		add	#2,r2
(1)  219/ 6000438 : 6015                		mov.w	@r1+,r0
(1)  220/ 600043A : 2201                		mov.w	r0,@r2
(1)  221/ 600043C : 7202                		add	#2,r2
(1)  219/ 600043E : 6015                		mov.w	@r1+,r0
(1)  220/ 6000440 : 2201                		mov.w	r0,@r2
(1)  221/ 6000442 : 7202                		add	#2,r2
(1)  219/ 6000444 : 6015                		mov.w	@r1+,r0
(1)  220/ 6000446 : 2201                		mov.w	r0,@r2
(1)  221/ 6000448 : 7202                		add	#2,r2
(1)  223/ 600044A : 4310                		dt	r3
(1)  224/ 600044C : 8BCD                		bf	.copy_pal
(1)  225/ 600044E :                     
(1)  226/ 600044E :                     ; 		mov	#RAM_Mars_Palette,r1		; Send palette stored on RAM
(1)  227/ 600044E :                     ; 		mov	#_palette,r2
(1)  228/ 600044E :                     ;  		mov	#256,r3
(1)  229/ 600044E :                     ; 		mov	#%0101011011110001,r4		; transfer size 2 / burst
(1)  230/ 600044E :                     ; 		mov	#_DMASOURCE0,r5 		; _DMASOURCE = $ffffff80
(1)  231/ 600044E :                     ; 		mov	#_DMAOPERATION,r6 		; _DMAOPERATION = $ffffffb0
(1)  232/ 600044E :                     ; 		mov	r1,@r5				; set source address
(1)  233/ 600044E :                     ; 		mov	r2,@(4,r5)			; set destination address
(1)  234/ 600044E :                     ; 		mov	r3,@(8,r5)			; set length
(1)  235/ 600044E :                     ; 		xor	r0,r0
(1)  236/ 600044E :                     ; 		mov	r0,@r6				; Stop OPERATION
(1)  237/ 600044E :                     ; 		xor	r0,r0
(1)  238/ 600044E :                     ; 		mov	r0,@($C,r5)			; clear TE bit
(1)  239/ 600044E :                     ; 		mov	r4,@($C,r5)			; load mode
(1)  240/ 600044E :                     ; 		add	#1,r0
(1)  241/ 600044E :                     ; 		mov	r0,@r6				; Start OPERATION
(1)  242/ 600044E : 66F6                		mov	@r15+,r6
(1)  243/ 6000450 : 65F6                		mov	@r15+,r5
(1)  244/ 6000452 : 64F6                		mov	@r15+,r4
(1)  245/ 6000454 : 63F6                		mov	@r15+,r3
(1)  246/ 6000456 : 62F6                		mov	@r15+,r2
(1)  247/ 6000458 : 4F07                		ldc	@r15+,sr
(1)  248/ 600045A :                     		
(1)  249/ 600045A :                     .mid_pwrite:
(1)  250/ 600045A : E000                		mov 	#0,r0				; Clear VintFlag for Master
(1)  251/ 600045C : C10E                		mov.w	r0,@(marsGbl_VIntFlag_M,gbr)
(1)  252/ 600045E : 000B                		rts
(1)  253/ 6000460 : 0009                		nop
(1)  254/ 6000462 :                     		align 4
(1)  255/ 6000464 :                     		
(1)  256/ 6000464 :                     ; =================================================================
(1)  257/ 6000464 :                     ; ------------------------------------------------
(1)  258/ 6000464 :                     ; Master | VRES Interrupt (Pressed RESET on Genesis)
(1)  259/ 6000464 :                     ; ------------------------------------------------
(1)  260/ 6000464 :                     
(1)  261/ 6000464 :                     m_irq_vres:
(1)  262/ 6000464 : D022                		mov.l	#_sysreg,r0
(1)  263/ 6000466 : 401E                		ldc	r0,gbr
(1)  264/ 6000468 : C10A                		mov.w	r0,@(vresintclr,gbr)	; V interrupt clear
(1)  265/ 600046A : 0009                		nop
(1)  266/ 600046C : 0009                		nop
(1)  267/ 600046E : 0009                		nop
(1)  268/ 6000470 : 0009                		nop
(1)  269/ 6000472 : 904A                		mov	#$F0,r0
(1)  270/ 6000474 : 400E                		ldc	r0,sr
(1)  271/ 6000476 : C406                		mov.b	@(dreqctl,gbr),r0
(1)  272/ 6000478 : C801                		tst	#1,r0
(1)  273/ 600047A : 8B18                		bf	.mars_reset
(1)  274/ 600047C :                     .md_reset:
(1)  275/ 600047C : D11D                		mov.l	#"68UP",r1		; wait for the 68K to show up
(1)  276/ 600047E : C60B                		mov.l	@(comm12,gbr),r0
(1)  277/ 6000480 : 3100                		cmp/eq	r0,r1
(1)  278/ 6000482 : 8BFB                		bf	.md_reset
(1)  279/ 6000484 :                     .sh_wait:
(1)  280/ 6000484 : D11C                		mov.l	#"S_OK",r1		; wait for the Slave CPU to show up
(1)  281/ 6000486 : C609                		mov.l	@(comm4,gbr),r0
(1)  282/ 6000488 : 3100                		cmp/eq	r0,r1
(1)  283/ 600048A : 8BFB                		bf	.sh_wait
(1)  284/ 600048C : D01B                		mov.l	#"M_OK",r0		; let the others know master ready
(1)  285/ 600048E : C208                		mov.l	r0,@(comm0,gbr)
(1)  286/ 6000490 : DF1B                		mov.l	#CS3|$40000-8,r15	; Set reset values
(1)  287/ 6000492 : D01C                		mov.l	#SH2_M_HotStart,r0
(1)  288/ 6000494 : 2F02                		mov.l	r0,@r15
(1)  289/ 6000496 : 9038                		mov.w	#$F0,r0
(1)  290/ 6000498 : 1F01                		mov.l	r0,@(4,r15)
(1)  291/ 600049A : E1B0                		mov.l	#_DMAOPERATION,r1
(1)  292/ 600049C : E000                		mov.l	#0,r0
(1)  293/ 600049E : 2102                		mov.l	r0,@r1			; Turn any DMA tasks OFF
(1)  294/ 60004A0 : E18C                		mov.l	#_DMACHANNEL0,r1
(1)  295/ 60004A2 : E000                		mov.l	#0,r0
(1)  296/ 60004A4 : 2102                		mov.l	r0,@r1
(1)  297/ 60004A6 : 9131                		mov.l	#%0100010011100000,r1
(1)  298/ 60004A8 : 2102                		mov.l	r0,@r1			; Channel control
(1)  299/ 60004AA : 002B                		rte
(1)  300/ 60004AC : 0009                		nop
(1)  301/ 60004AE :                     .mars_reset:
(1)  302/ 60004AE : 912B                		mov	#_FRT,r1
(1)  303/ 60004B0 : 8417                		mov.b	@(_TOCR,r1),r0
(1)  304/ 60004B2 : CB01                		or	#$01,r0
(1)  305/ 60004B4 : 8017                		mov.b	r0,@(_TOCR,r1)
(1)  306/ 60004B6 :                     .vresloop:
(1)  307/ 60004B6 : AFFE                		bra	.vresloop
(1)  308/ 60004B8 : 0009                		nop
(1)  309/ 60004BA :                     		align 4
(1)  310/ 60004BC : 0600 02CC 2000 4038 		ltorg				; Save MASTER IRQ literals here
                    0600 1640 2000 401C 
                    2000 401A 0602 1D9C 
                    2000 4028 2000 402E 
                    2000 4018 2000 4016 
                    2000 4100 0602 219C 
                    2000 4200 2000 4000 
                    3638 5550 535F 4F4B 
                    4D5F 4F4B 0603 FFF8 
                    0600 17B2 FE10 00F0 
                    44E0                
(1)  311/ 600050E :                     
(1)  312/ 600050E :                     ; =================================================================
(1)  313/ 600050E :                     ; ------------------------------------------------
(1)  314/ 600050E :                     ; Master | Watchdog interrupt
(1)  315/ 600050E :                     ; ------------------------------------------------
(1)  316/ 600050E :                     
(1)  317/ 600050E :                     ; m_irq_custom:
(1)  318/ 600050E :                     ; see video.asm
(1)  319/ 600050E :                     
(1)  320/ 600050E :                     ; =================================================================
(1)  321/ 600050E :                     ; ------------------------------------------------
(1)  322/ 600050E :                     ; Unused
(1)  323/ 600050E :                     ; ------------------------------------------------
(1)  324/ 600050E :                     
(1)  325/ 600050E :                     s_irq_bad:
(1)  326/ 600050E : 000B                		rts
(1)  327/ 6000510 : 0009                		nop
(1)  328/ 6000512 :                     		align 4
(1)  329/ 6000514 :                     
(1)  330/ 6000514 :                     ; =================================================================
(1)  331/ 6000514 :                     ; ------------------------------------------------
(1)  332/ 6000514 :                     ; Slave | PWM Interrupt
(1)  333/ 6000514 :                     ; ------------------------------------------------
(1)  334/ 6000514 :                     
(1)  335/ 6000514 :                     s_irq_pwm:
(1)  336/ 6000514 : 9198                		mov	#_FRT,r1
(1)  337/ 6000516 : 8417                		mov.b	@(7,r1),r0
(1)  338/ 6000518 : CA02                		xor	#2,r0
(1)  339/ 600051A : 8017                		mov.b	r0,@(7,r1)
(1)  340/ 600051C : D13D                		mov	#_sysreg+pwmintclr,r1
(1)  341/ 600051E : 2101                		mov.w	r0,@r1
(1)  342/ 6000520 : 0009                		nop
(1)  343/ 6000522 : 0009                		nop
(1)  344/ 6000524 : 0009                		nop
(1)  345/ 6000526 : 0009                		nop
(1)  346/ 6000528 : 0009                		nop
(1)  347/ 600052A : 000B                		rts
(1)  348/ 600052C : 0009                		nop
(1)  349/ 600052E :                     		align 4
(1)  350/ 6000530 :                     
(1)  351/ 6000530 :                     ; =================================================================
(1)  352/ 6000530 :                     ; ------------------------------------------------
(1)  353/ 6000530 :                     ; Slave | CMD Interrupt
(1)  354/ 6000530 :                     ; 
(1)  355/ 6000530 :                     ; Process request from MD
(1)  356/ 6000530 :                     ; ------------------------------------------------
(1)  357/ 6000530 :                     
(1)  358/ 6000530 :                     s_irq_cmd:
(1)  359/ 6000530 : 918A                		mov	#_FRT,r1
(1)  360/ 6000532 : 8417                		mov.b	@(7,r1),r0
(1)  361/ 6000534 : CA02                		xor	#2,r0
(1)  362/ 6000536 : 8017                		mov.b	r0,@(7,r1)
(1)  363/ 6000538 : D137                		mov	#_sysreg+cmdintclr,r1
(1)  364/ 600053A : 2101                		mov.w	r0,@r1
(1)  365/ 600053C :                     
(1)  366/ 600053C : 2F26                		mov	r2,@-r15
(1)  367/ 600053E : 2F36                		mov	r3,@-r15
(1)  368/ 6000540 :                     ; 		mov	r4,@-r15
(1)  369/ 6000540 : D236                		mov	#RAM_Mars_MdTasksFifo_S,r2
(1)  370/ 6000542 : D137                		mov	#_sysreg+comm8,r1
(1)  371/ 6000544 :                     .next_comm:
(1)  372/ 6000544 : E002                		mov	#2,r0		; SH is ready
(1)  373/ 6000546 : 8011                		mov.b	r0,@(1,r1)
(1)  374/ 6000548 :                     .wait_md_b:
(1)  375/ 6000548 : 8410                		mov.b	@(0,r1),r0	; get MD status
(1)  376/ 600054A : C9FF                		and	#$FF,r0
(1)  377/ 600054C : 2008                		tst	r0,r0
(1)  378/ 600054E : 8911                		bt	.finish
(1)  379/ 6000550 : 8801                		cmp/eq	#1,r0		; MD is writing?
(1)  380/ 6000552 : 8BF9                		bf	.wait_md_b
(1)  381/ 6000554 : E001                		mov	#1,r0		; SH is busy
(1)  382/ 6000556 : 8011                		mov.b	r0,@(1,r1)
(1)  383/ 6000558 :                     .wait_md_c:
(1)  384/ 6000558 : 8410                		mov.b	@(0,r1),r0
(1)  385/ 600055A : C9FF                		and	#$FF,r0
(1)  386/ 600055C : 2008                		tst	r0,r0
(1)  387/ 600055E : 8909                		bt	.finish
(1)  388/ 6000560 : 8802                		cmp/eq	#2,r0		; MD is ready?
(1)  389/ 6000562 : 8BF9                		bf	.wait_md_c
(1)  390/ 6000564 : 8511                		mov.w	@(2,r1),r0	; comm10
(1)  391/ 6000566 : 2201                		mov.w	r0,@r2
(1)  392/ 6000568 : 8512                		mov.w	@(4,r1),r0	; comm12
(1)  393/ 600056A : 8121                		mov.w	r0,@(2,r2)
(1)  394/ 600056C :                     		
(1)  395/ 600056C :                     ; 		mov	#_sysreg+comm6,r4
(1)  396/ 600056C :                     ; 		mov.w	@r4,r0
(1)  397/ 600056C :                     ; 		add	#1,r0
(1)  398/ 600056C :                     ; 		mov.w	r0,@r4
(1)  399/ 600056C : E002                		mov	#2,r0		; SH is ready
(1)  400/ 600056E : 8011                		mov.b	r0,@(1,r1)
(1)  401/ 6000570 : AFE8                		bra	.next_comm
(1)  402/ 6000572 : 7204                		add	#4,r2
(1)  403/ 6000574 :                     .finish:
(1)  404/ 6000574 : D12B                		mov	#_sysreg+comm15,r1
(1)  405/ 6000576 : 6010                		mov.b	@r1,r0
(1)  406/ 6000578 : CB80                		or	#$80,r0
(1)  407/ 600057A : 2100                		mov.b	r0,@r1
(1)  408/ 600057C :                     ; 		mov 	@r15+,r4		
(1)  409/ 600057C : 63F6                		mov 	@r15+,r3
(1)  410/ 600057E : 62F6                		mov 	@r15+,r2
(1)  411/ 6000580 : 0009                		nop
(1)  412/ 6000582 : 0009                		nop
(1)  413/ 6000584 : 0009                		nop
(1)  414/ 6000586 : 000B                		rts
(1)  415/ 6000588 : 0009                		nop
(1)  416/ 600058A :                     		align 4
(1)  417/ 600058C :                     		
(1)  418/ 600058C :                     ; =================================================================
(1)  419/ 600058C :                     ; ------------------------------------------------
(1)  420/ 600058C :                     ; Slave | HBlank
(1)  421/ 600058C :                     ; ------------------------------------------------
(1)  422/ 600058C :                     
(1)  423/ 600058C :                     s_irq_h:
(1)  424/ 600058C : 915C                		mov	#_FRT,r1
(1)  425/ 600058E : 8417                		mov.b	@(7,r1),r0
(1)  426/ 6000590 : CA02                		xor	#2,r0
(1)  427/ 6000592 : 8017                		mov.b	r0,@(7,r1)
(1)  428/ 6000594 : D124                		mov	#_sysreg+hintclr,r1
(1)  429/ 6000596 : 2101                		mov.w	r0,@r1
(1)  430/ 6000598 : 0009                		nop
(1)  431/ 600059A : 0009                		nop
(1)  432/ 600059C : 0009                		nop
(1)  433/ 600059E : 0009                		nop
(1)  434/ 60005A0 : 0009                		nop
(1)  435/ 60005A2 : 000B                		rts
(1)  436/ 60005A4 : 0009                		nop
(1)  437/ 60005A6 :                     		align 4
(1)  438/ 60005A8 :                     
(1)  439/ 60005A8 :                     ; =================================================================
(1)  440/ 60005A8 :                     ; ------------------------------------------------
(1)  441/ 60005A8 :                     ; Slave | VBlank
(1)  442/ 60005A8 :                     ; ------------------------------------------------
(1)  443/ 60005A8 :                     
(1)  444/ 60005A8 :                     s_irq_v:
(1)  445/ 60005A8 : E000                		mov 	#0,r0				; Clear VintFlag for Slave
(1)  446/ 60005AA : C10F                		mov.w	r0,@(marsGbl_VIntFlag_S,gbr)
(1)  447/ 60005AC : 914C                		mov	#_FRT,r1
(1)  448/ 60005AE : 8417                		mov.b	@(7,r1),r0
(1)  449/ 60005B0 : CA02                		xor	#2,r0
(1)  450/ 60005B2 : 8017                		mov.b	r0,@(7,r1)
(1)  451/ 60005B4 : D11D                		mov	#_sysreg+vintclr,r1
(1)  452/ 60005B6 : 000B                		rts
(1)  453/ 60005B8 : 2101                		mov.w	r0,@r1
(1)  454/ 60005BA :                     		align 4
(1)  455/ 60005BC :                     
(1)  456/ 60005BC :                     ; =================================================================
(1)  457/ 60005BC :                     ; ------------------------------------------------
(1)  458/ 60005BC :                     ; Slave | VRES Interrupt (Pressed RESET on Genesis)
(1)  459/ 60005BC :                     ; ------------------------------------------------
(1)  460/ 60005BC :                     
(1)  461/ 60005BC :                     s_irq_vres:
(1)  462/ 60005BC : D01C                		mov.l	#_sysreg,r0
(1)  463/ 60005BE : 401E                		ldc	r0,gbr
(1)  464/ 60005C0 : C10A                		mov.w	r0,@(vresintclr,gbr)	; V interrupt clear
(1)  465/ 60005C2 : 0009                		nop
(1)  466/ 60005C4 : 0009                		nop
(1)  467/ 60005C6 : 0009                		nop
(1)  468/ 60005C8 : 0009                		nop
(1)  469/ 60005CA : 903E                		mov	#$F0,r0
(1)  470/ 60005CC : 400E                		ldc	r0,sr
(1)  471/ 60005CE : C406                		mov.b	@(dreqctl,gbr),r0
(1)  472/ 60005D0 : C801                		tst	#1,r0
(1)  473/ 60005D2 : 8B18                		bf	.mars_reset
(1)  474/ 60005D4 :                     .md_reset:
(1)  475/ 60005D4 : D117                		mov.l	#"68UP",r1		; wait for the 68k to show up
(1)  476/ 60005D6 : C60B                		mov.l	@(comm12,gbr),r0
(1)  477/ 60005D8 : 3100                		cmp/eq	r0,r1
(1)  478/ 60005DA : 8BFB                		bf	.md_reset
(1)  479/ 60005DC : D016                		mov.l	#"S_OK",r0		; tell the others slave is ready
(1)  480/ 60005DE : C209                		mov.l	r0,@(comm4,gbr)
(1)  481/ 60005E0 :                     .sh_wait:
(1)  482/ 60005E0 : D116                		mov.l	#"M_OK",r1		; wait for the slave to show up
(1)  483/ 60005E2 : C608                		mov.l	@(comm0,gbr),r0
(1)  484/ 60005E4 : 3100                		cmp/eq	r0,r1
(1)  485/ 60005E6 : 8BFB                		bf	.sh_wait
(1)  486/ 60005E8 : DF15                		mov.l	#CS3|$3F000-8,r15
(1)  487/ 60005EA : D016                		mov.l	#SH2_S_HotStart,r0
(1)  488/ 60005EC : 2F02                		mov.l	r0,@r15
(1)  489/ 60005EE : 902C                		mov.w	#$F0,r0
(1)  490/ 60005F0 : 1F01                		mov.l	r0,@(4,r15)
(1)  491/ 60005F2 : E1B0                		mov.l	#_DMAOPERATION,r1
(1)  492/ 60005F4 : E000                		mov.l	#0,r0
(1)  493/ 60005F6 : 2102                		mov.l	r0,@r1			; DMA off
(1)  494/ 60005F8 : E18C                		mov.l	#_DMACHANNEL0,r1
(1)  495/ 60005FA : E000                		mov.l	#0,r0
(1)  496/ 60005FC : 2102                		mov.l	r0,@r1
(1)  497/ 60005FE : 9125                		mov.l	#%0100010011100000,r1
(1)  498/ 6000600 : 2102                		mov.l	r0,@r1			; Channel control
(1)  499/ 6000602 : 002B                		rte
(1)  500/ 6000604 : 0009                		nop
(1)  501/ 6000606 :                     .mars_reset:
(1)  502/ 6000606 : 911F                		mov	#_FRT,r1
(1)  503/ 6000608 : 8417                		mov.b	@(_TOCR,r1),r0
(1)  504/ 600060A : CB01                		or	#$01,r0
(1)  505/ 600060C : 8017                		mov.b	r0,@(_TOCR,r1)
(1)  506/ 600060E :                     .vresloop:
(1)  507/ 600060E : AFFE                		bra	.vresloop
(1)  508/ 6000610 : 0009                		nop
(1)  509/ 6000612 :                     		align 4
(1)  510/ 6000614 : 2000 401C 2000 401A 		ltorg			; Save Slave IRQ literals
                    0602 1F9C 2000 4028 
                    2000 402F 2000 4018 
                    2000 4016 2000 4000 
                    3638 5550 535F 4F4B 
                    4D5F 4F4B 0603 EFF8 
                    0600 1968 FE10 00F0 
                    44E0                
(1)  511/ 600064E :                     
(1)  512/ 600064E :                     ; ====================================================================
(1)  513/ 600064E :                     ; ----------------------------------------------------------------
(1)  514/ 600064E :                     ; MARS System features
(1)  515/ 600064E :                     ; ----------------------------------------------------------------
(1)  516/ 600064E :                     
(1)  517/ 600064E :                     		include "system/mars/video.asm"
(2)    1/ 600064E :                     ; ====================================================================
(2)    2/ 600064E :                     ; ----------------------------------------------------------------
(2)    3/ 600064E :                     ; MARS Video
(2)    4/ 600064E :                     ; ----------------------------------------------------------------
(2)    5/ 600064E :                     
(2)    6/ 600064E :                     ; MARS Polygons
(2)    7/ 600064E :                     ; 
(2)    8/ 600064E :                     ; type format:
(2)    9/ 600064E :                     ;   0 - end-of-list
(2)   10/ 600064E :                     ;  -1 - skip polygon (already drawn)
(2)   11/ 600064E :                     ; $03 - triangle
(2)   12/ 600064E :                     ; $04 - quad
(2)   13/ 600064E :                     
(2)   14/ 600064E :                     ; ----------------------------------------
(2)   15/ 600064E :                     ; Settings
(2)   16/ 600064E :                     ; ----------------------------------------
(2)   17/ 600064E :                     
(2)   18/ 600064E : =$100               MAX_FACES	equ	256	; Maximum polygon faces (models,sprites) to store on buffer
(2)   19/ 600064E : =$180               MAX_SVDP_PZ	equ	384	; This list is for both read and write, increase the value if needed
(2)   20/ 600064E : =$40                MAX_MODELS	equ	64	; Note: First 9 models are reserved for layout map
(2)   21/ 600064E : =$FFFFFFFFFF..      MAX_ZDIST	equ	-$2000	; Max drawing distance (-Z max)
(2)   22/ 600064E : =$20                LAY_WIDTH	equ	$10*2	; Layout data width * 2
(2)   23/ 600064E :                     
(2)   24/ 600064E :                     ; ----------------------------------------
(2)   25/ 600064E :                     ; Variables
(2)   26/ 600064E :                     ; ----------------------------------------
(2)   27/ 600064E :                     
(2)   28/ 600064E : =$140               SCREEN_WIDTH	equ	320
(2)   29/ 600064E : =$E0                SCREEN_HEIGHT	equ	224
(2)   30/ 600064E :                     
(2)   31/ 600064E :                     ; MSB
(2)   32/ 600064E : =$80                PLGN_TEXURE	equ	%10000000
(2)   33/ 600064E : =$40                PLGN_TRI	equ	%01000000
(2)   34/ 600064E : =$20                PLGN_SPRITE	equ	%00100000
(2)   35/ 600064E :                     
(2)   36/ 600064E :                     ; ----------------------------------------
(2)   37/ 600064E :                     ; Structs
(2)   38/ 600064E :                     ; ----------------------------------------
(2)   39/ 600064E :                     
(2)   40/ 600064E :                     ; model objects
(2)   41/ 600064E : (MACRO)             		struct 0
(2)   41/ 600064E : =$600064E           GLBL_LASTPC     set *
(2)   41/    42B6 :                                     dephase
(2)   41/    42B6 : =$42B6              GLBL_LASTORG    set *
(2)   41/       0 :                                     phase 0
(2)   42/       0 :                     mdl_data	ds.l 1			; Model data pointer, zero: model disabled
(2)   43/       4 :                     mdl_x_pos	ds.l 1			; X position $000000.00
(2)   44/       8 :                     mdl_y_pos	ds.l 1			; Y position $000000.00
(2)   45/       C :                     mdl_z_pos	ds.l 1			; Z position $000000.00
(2)   46/      10 :                     mdl_x_rot	ds.l 1			; X rotation $000000.00
(2)   47/      14 :                     mdl_y_rot	ds.l 1			; Y rotation $000000.00
(2)   48/      18 :                     mdl_z_rot	ds.l 1			; Z rotation $000000.00
(2)   49/      1C :                     mdl_animdata	ds.l 1			; Model animation data pointer, zero: no animation
(2)   50/      20 :                     mdl_animframe	ds.l 1			; Current frame in animation
(2)   51/      24 :                     mdl_animtimer	ds.l 1			; Animation timer
(2)   52/      28 :                     mdl_animspd	ds.l 1			; Animation speed
(2)   53/      2C :                     sizeof_mdlobj	ds.l 0
(2)   54/      2E : (MACRO)             		finish
(2)   54/       0 :                                     !org GLBL_LASTORG
(2)   54/ 600064E :                                     phase GLBL_LASTPC
(2)   55/ 600064E :                     		
(2)   56/ 600064E :                     ; field view camera
(2)   57/ 600064E : (MACRO)             		struct 0
(2)   57/ 600064E : =$600064E           GLBL_LASTPC     set *
(2)   57/    42B6 :                                     dephase
(2)   57/    42B6 : =$42B6              GLBL_LASTORG    set *
(2)   57/       0 :                                     phase 0
(2)   58/       0 :                     cam_x_pos	ds.l 1			; X position $000000.00
(2)   59/       4 :                     cam_y_pos	ds.l 1			; Y position $000000.00
(2)   60/       8 :                     cam_z_pos	ds.l 1			; Z position $000000.00
(2)   61/       C :                     cam_x_rot	ds.l 1			; X rotation $000000.00
(2)   62/      10 :                     cam_y_rot	ds.l 1			; Y rotation $000000.00
(2)   63/      14 :                     cam_z_rot	ds.l 1			; Z rotation $000000.00
(2)   64/      18 :                     cam_animdata	ds.l 1			; Model animation data pointer, zero: no animation
(2)   65/      1C :                     cam_animframe	ds.l 1			; Current frame in animation
(2)   66/      20 :                     cam_animtimer	ds.l 1			; Animation timer
(2)   67/      24 :                     cam_animspd	ds.l 1			; Animation speed
(2)   68/      28 :                     sizeof_camera	ds.l 0
(2)   69/      2A : (MACRO)             		finish
(2)   69/       0 :                                     !org GLBL_LASTORG
(2)   69/ 600064E :                                     phase GLBL_LASTPC
(2)   70/ 600064E :                     		
(2)   71/ 600064E : (MACRO)             		struct 0
(2)   71/ 600064E : =$600064E           GLBL_LASTPC     set *
(2)   71/    42B6 :                                     dephase
(2)   71/    42B6 : =$42B6              GLBL_LASTORG    set *
(2)   71/       0 :                                     phase 0
(2)   72/       0 :                     mdllay_data	ds.l 1			; Model layout data, zero: Don't use layout
(2)   73/       4 :                     mdllay_x	ds.l 1			; X position
(2)   74/       8 :                     mdllay_y	ds.l 1			; Y position
(2)   75/       C :                     mdllay_z	ds.l 1			; Z position
(2)   76/      10 :                     mdllay_x_last	ds.l 1			; LAST saved X position
(2)   77/      14 :                     mdllay_y_last	ds.l 1			; LAST saved Y position
(2)   78/      18 :                     mdllay_z_last	ds.l 1			; LAST saved Z position
(2)   79/      1C :                     mdllay_xr_last	ds.l 1			; LAST saved X rotation
(2)   80/      20 :                     sizeof_layout	ds.l 0
(2)   81/      22 : (MACRO)             		finish
(2)   81/       0 :                                     !org GLBL_LASTORG
(2)   81/ 600064E :                                     phase GLBL_LASTPC
(2)   82/ 600064E :                     
(2)   83/ 600064E : (MACRO)             		struct 0
(2)   83/ 600064E : =$600064E           GLBL_LASTPC     set *
(2)   83/    42B6 :                                     dephase
(2)   83/    42B6 : =$42B6              GLBL_LASTORG    set *
(2)   83/       0 :                                     phase 0
(2)   84/       0 :                     plypz_ypos	ds.l 1			; Ytop | Ybottom
(2)   85/       4 :                     plypz_xl	ds.l 1
(2)   86/       8 :                     plypz_xl_dx	ds.l 1
(2)   87/       C :                     plypz_xr	ds.l 1
(2)   88/      10 :                     plypz_xr_dx	ds.l 1
(2)   89/      14 :                     plypz_src_xl	ds.l 1
(2)   90/      18 :                     plypz_src_xl_dx	ds.l 1
(2)   91/      1C :                     plypz_src_yl	ds.l 1
(2)   92/      20 :                     plypz_src_yl_dx	ds.l 1
(2)   93/      24 :                     plypz_src_xr	ds.l 1
(2)   94/      28 :                     plypz_src_xr_dx	ds.l 1
(2)   95/      2C :                     plypz_src_yr	ds.l 1
(2)   96/      30 :                     plypz_src_yr_dx	ds.l 1
(2)   97/      34 :                     plypz_mtrl	ds.l 1
(2)   98/      38 :                     plypz_mtrlopt	ds.l 1			; Type | Option
(2)   99/      3C :                     sizeof_plypz	ds.l 0
(2)  100/      3E : (MACRO)             		finish
(2)  100/       0 :                                     !org GLBL_LASTORG
(2)  100/ 600064E :                                     phase GLBL_LASTPC
(2)  101/ 600064E :                     
(2)  102/ 600064E : (MACRO)             		struct 0
(2)  102/ 600064E : =$600064E           GLBL_LASTPC     set *
(2)  102/    42B6 :                                     dephase
(2)  102/    42B6 : =$42B6              GLBL_LASTORG    set *
(2)  102/       0 :                                     phase 0
(2)  103/       0 :                     polygn_type	ds.l 1		; %MST0 0000 wwww wwww | Type bits and Material option (Width or PalIncr)
(2)  104/       4 :                     polygn_mtrl	ds.l 1		; Material Type: Color (0-255) or Texture data address
(2)  105/       8 :                     polygn_points	ds.l 4*2	; X/Y positions
(2)  106/      28 :                     polygn_srcpnts	ds.w 4*2	; X/Y texture points (16-bit), ignored on solidcolor
(2)  107/      38 :                     sizeof_polygn	ds.l 0
(2)  108/      3A : (MACRO)             		finish
(2)  108/       0 :                                     !org GLBL_LASTORG
(2)  108/ 600064E :                                     phase GLBL_LASTPC
(2)  109/ 600064E :                     
(2)  110/ 600064E :                     ; ====================================================================
(2)  111/ 600064E :                     ; ----------------------------------------------------------------
(2)  112/ 600064E :                     ; Init MARS Video
(2)  113/ 600064E :                     ; ----------------------------------------------------------------
(2)  114/ 600064E :                     
(2)  115/ 600064E :                     MarsVideo_Init:
(2)  116/ 600064E : 4F22                		sts	pr,@-r15
(2)  117/ 6000650 : D430                		mov	#_sysreg,r4
(2)  118/ 6000652 : 9067                		mov 	#FM,r0		; Set SVDP permission to SH2
(2)  119/ 6000654 : 8040                  		mov.b	r0,@(adapter,r4)
(2)  120/ 6000656 : D430                		mov 	#_vdpreg,r4
(2)  121/ 6000658 : B008                		bsr	.this_fb	; Init line tables for both framebuffers
(2)  122/ 600065A : 0009                		nop
(2)  123/ 600065C : B006                		bsr	.this_fb
(2)  124/ 600065E : 0009                		nop
(2)  125/ 6000660 :                     ; 		mov	#2,r0
(2)  126/ 6000660 :                     ; 		mov.w	r0,@(marsGbl_BitmapSet,gbr)
(2)  127/ 6000660 :                     ; 		mov	#1,r0
(2)  128/ 6000660 :                     ; 		mov.w	r0,@(marsGbl_BitmapReq,gbr)
(2)  129/ 6000660 : E001                		mov	#1,r0
(2)  130/ 6000662 : 8041                		mov.b	r0,@(bitmapmd,r4)
(2)  131/ 6000664 : 4F26                		lds	@r15+,pr
(2)  132/ 6000666 : 000B                		rts
(2)  133/ 6000668 : 0009                		nop
(2)  134/ 600066A :                     		align 4
(2)  135/ 600066C :                     
(2)  136/ 600066C :                     ; ------------------------------------------------
(2)  137/ 600066C :                     ; Init current framebuffer
(2)  138/ 600066C :                     ; ------------------------------------------------
(2)  139/ 600066C :                     
(2)  140/ 600066C :                     .this_fb:
(2)  141/ 600066C : D12B                 		mov	#_framebuffer,r1
(2)  142/ 600066E : 905A                		mov	#$200/2,r0	; START line data
(2)  143/ 6000670 : 925A                		mov	#240,r2		; Vertical lines to set
(2)  144/ 6000672 : 6303                		mov	r0,r3		; Increment by (copy from r0)
(2)  145/ 6000674 : 2101                .loop:		mov.w	r0,@r1
(2)  146/ 6000676 : 7102                		add	#2,r1
(2)  147/ 6000678 : 303C                		add	r3,r0
(2)  148/ 600067A : 4210                		dt	r2
(2)  149/ 600067C : 8BFA                		bf	.loop
(2)  150/ 600067E : 8545                .fb_wait1:	mov.w   @($A,r4),r0	; Swap for next table
(2)  151/ 6000680 : C802                		tst     #2,r0
(2)  152/ 6000682 : 8BFC                		bf      .fb_wait1
(2)  153/ 6000684 : 8545                		mov.w   @($A,r4), r0
(2)  154/ 6000686 : CA01                		xor     #1,r0
(2)  155/ 6000688 : 8145                		mov.w   r0,@($A,r4)
(2)  156/ 600068A : C901                		and     #1,r0
(2)  157/ 600068C : 6103                		mov     r0,r1
(2)  158/ 600068E :                     .wait_result:
(2)  159/ 600068E : 8545                		mov.w   @($A,r4),r0
(2)  160/ 6000690 : C901                		and     #1,r0
(2)  161/ 6000692 : 3100                		cmp/eq  r0,r1
(2)  162/ 6000694 : 8BFB                		bf      .wait_result
(2)  163/ 6000696 : 000B                		rts
(2)  164/ 6000698 : 0009                		nop
(2)  165/ 600069A :                     		align 4
(2)  166/ 600069C :                     		
(2)  167/ 600069C :                     ; ------------------------------------
(2)  168/ 600069C :                     ; MarsVideo_ClearFrame
(2)  169/ 600069C :                     ; 
(2)  170/ 600069C :                     ; Clear the current framebuffer
(2)  171/ 600069C :                     ; ------------------------------------
(2)  172/ 600069C :                     
(2)  173/ 600069C :                     MarsVideo_ClearFrame:
(2)  174/ 600069C : D11E                		mov	#_vdpreg,r1
(2)  175/ 600069E : 8515                .wait2		mov.w	@(10,r1),r0		; Wait for FEN to clear
(2)  176/ 60006A0 : C902                		and	#%10,r0
(2)  177/ 60006A2 : 8802                		cmp/eq	#2,r0
(2)  178/ 60006A4 : 89FB                		bt	.wait2
(2)  179/ 60006A6 :                     
(2)  180/ 60006A6 : 9240                		mov	#255,r2			; 256 words per pass
(2)  181/ 60006A8 : 933D                		mov	#$100,r3		; Starting address
(2)  182/ 60006AA : E400                		mov	#0,r4			; Clear to zero
(2)  183/ 60006AC : 953B                		mov	#256,r5			; Increment address by 256
(2)  184/ 60006AE : 963B                		mov	#((512*240)/256)/2,r6	; 140 passes
(2)  185/ 60006B0 :                     .loop
(2)  186/ 60006B0 : 6023                		mov	r2,r0
(2)  187/ 60006B2 : 8112                		mov.w	r0,@(4,r1)		; Set length
(2)  188/ 60006B4 : 6033                		mov	r3,r0
(2)  189/ 60006B6 : 8113                		mov.w	r0,@(6,r1)		; Set address
(2)  190/ 60006B8 : 6043                		mov	r4,r0
(2)  191/ 60006BA : 8114                		mov.w	r0,@(8,r1)		; Set data
(2)  192/ 60006BC : 335C                		add	r5,r3
(2)  193/ 60006BE :                     		
(2)  194/ 60006BE : 8515                .wait		mov.w	@(10,r1),r0		; Wait for FEN to clear
(2)  195/ 60006C0 : C902                		and	#%10,r0
(2)  196/ 60006C2 : 8802                		cmp/eq	#2,r0
(2)  197/ 60006C4 : 89FB                		bt	.wait
(2)  198/ 60006C6 : 4610                		dt	r6
(2)  199/ 60006C8 : 8BF2                		bf	.loop
(2)  200/ 60006CA : 000B                		rts
(2)  201/ 60006CC : 0009                		nop
(2)  202/ 60006CE :                     		align 4
(2)  203/ 60006D0 :                     
(2)  204/ 60006D0 :                     ; ------------------------------------
(2)  205/ 60006D0 :                     ; MarsVideo_FrameSwap
(2)  206/ 60006D0 :                     ; ------------------------------------
(2)  207/ 60006D0 :                     
(2)  208/ 60006D0 :                     MarsVideo_FrameSwap:
(2)  209/ 60006D0 : D211                		mov.l	#_vdpreg,r2
(2)  210/ 60006D2 :                     .wait_fb:
(2)  211/ 60006D2 : 8525                		mov.w	@($A,r2),r0
(2)  212/ 60006D4 : C802                		tst	#2,r0
(2)  213/ 60006D6 : 8BFC                		bf	.wait_fb
(2)  214/ 60006D8 : 8525                		mov.w	@($A,r2),r0
(2)  215/ 60006DA : CA01                		xor	#1,r0
(2)  216/ 60006DC : 8125                		mov.w	r0,@($A,r2)
(2)  217/ 60006DE : C901                		and	#1,r0
(2)  218/ 60006E0 : 6103                		mov	r0,r1
(2)  219/ 60006E2 :                     .wait_result:
(2)  220/ 60006E2 : 8525                		mov.w	@($A,r2),r0
(2)  221/ 60006E4 : C901                		and	#1,r0
(2)  222/ 60006E6 : 3100                		cmp/eq	r0,r1
(2)  223/ 60006E8 : 8BFB                		bf	.wait_result
(2)  224/ 60006EA : 000B                		rts
(2)  225/ 60006EC : 0009                		nop
(2)  226/ 60006EE :                     		align 4
(2)  227/ 60006F0 :                     
(2)  228/ 60006F0 :                     ; ------------------------------------
(2)  229/ 60006F0 :                     ; MarsVdp_LoadPal
(2)  230/ 60006F0 :                     ; 
(2)  231/ 60006F0 :                     ; Load palette to RAM
(2)  232/ 60006F0 :                     ; then the Palette will be transfered
(2)  233/ 60006F0 :                     ; on VBlank
(2)  234/ 60006F0 :                     ; 
(2)  235/ 60006F0 :                     ; Input:
(2)  236/ 60006F0 :                     ; r1 - Palette data
(2)  237/ 60006F0 :                     ; r2 - Start index
(2)  238/ 60006F0 :                     ; r3 - Number of colors
(2)  239/ 60006F0 :                     ; r4 - OR value ($0000 or $8000)
(2)  240/ 60006F0 :                     ;
(2)  241/ 60006F0 :                     ; Uses:
(2)  242/ 60006F0 :                     ; r0,r4-r6
(2)  243/ 60006F0 :                     ; ------------------------------------
(2)  244/ 60006F0 :                     
(2)  245/ 60006F0 :                     MarsVideo_LoadPal:
(2)  246/ 60006F0 :                     ; 		mov.w	@(marsGbl_PalDmaMidWr,gbr),r0
(2)  247/ 60006F0 :                     ; 		cmp/eq	#1,r0
(2)  248/ 60006F0 :                     ; 		bt	MarsVideo_LoadPal
(2)  249/ 60006F0 : E001                		mov	#1,r0
(2)  250/ 60006F2 : C112                		mov.w	r0,@(marsGbl_PalDmaMidWr,gbr)
(2)  251/ 60006F4 : 6513                		mov 	r1,r5
(2)  252/ 60006F6 : D60A                		mov 	#RAM_Mars_Palette,r6
(2)  253/ 60006F8 : 6023                		mov 	r2,r0
(2)  254/ 60006FA : 4000                		shll	r0
(2)  255/ 60006FC : 360C                		add 	r0,r6
(2)  256/ 60006FE : 6733                		mov 	r3,r7
(2)  257/ 6000700 :                     .loop:
(2)  258/ 6000700 : 6055                		mov.w	@r5+,r0
(2)  259/ 6000702 : 204B                		or	r4,r0
(2)  260/ 6000704 : 2601                		mov.w	r0,@r6
(2)  261/ 6000706 : 4710                		dt	r7
(2)  262/ 6000708 : 8FFA                		bf/s	.loop
(2)  263/ 600070A : 7602                		add 	#2,r6
(2)  264/ 600070C : E000                		mov	#0,r0
(2)  265/ 600070E : C112                		mov.w	r0,@(marsGbl_PalDmaMidWr,gbr)
(2)  266/ 6000710 : 000B                		rts
(2)  267/ 6000712 : 0009                		nop
(2)  268/ 6000714 :                     		align 4
(2)  269/ 6000714 : 2000 4000 2000 4100 		ltorg
                    2400 0000 0602 219C 
                    0080 0100 00F0 00FF 
(2)  270/ 600072C :                     
(2)  271/ 600072C :                     ; ====================================================================
(2)  272/ 600072C :                     ; ----------------------------------------------------------------
(2)  273/ 600072C :                     ; 3D MODEL RENDERER
(2)  274/ 600072C :                     ; ----------------------------------------------------------------
(2)  275/ 600072C :                     
(2)  276/ 600072C :                     ; ------------------------------------------------
(2)  277/ 600072C :                     ; Object layout routines
(2)  278/ 600072C :                     ; ------------------------------------------------
(2)  279/ 600072C :                     
(2)  280/ 600072C :                     ; ----------------------------------------
(2)  281/ 600072C :                     ; Read layout
(2)  282/ 600072C :                     ; ----------------------------------------
(2)  283/ 600072C :                     
(2)  284/ 600072C :                     MarsLay_Read:
(2)  285/ 600072C : 4F22                		sts	pr,@-r15
(2)  286/ 600072E : DE1B                		mov	#RAM_Mars_ObjLayout,r14
(2)  287/ 6000730 : DD1B                		mov	#RAM_Mars_ObjCamera,r13
(2)  288/ 6000732 : DC1C                		mov	#RAM_Mars_Objects,r12
(2)  289/ 6000734 : 50E0                		mov	@(mdllay_data,r14),r0
(2)  290/ 6000736 : 4015                		cmp/pl	r0
(2)  291/ 6000738 : 8B2D                		bf	.no_lay
(2)  292/ 600073A : 6B03                		mov	r0,r11
(2)  293/ 600073C :                     
(2)  294/ 600073C : EA00                		mov	#0,r10				; r10 - Update counter
(2)  295/ 600073E : D91A                		mov	#-$100000,r9			;  r9 - MAX Z block size
(2)  296/ 6000740 : D819                		mov	#-$100000,r8			;  r8 - MAX Y block size	
(2)  297/ 6000742 : D719                		mov	#-$100000,r7			;  r7 - MAX X block size
(2)  298/ 6000744 : 9632                		mov	#-$8000,r6			;  r6 - X Rotation update point
(2)  299/ 6000746 :                     
(2)  300/ 6000746 : 55E6                		mov	@(mdllay_z_last,r14),r5
(2)  301/ 6000748 : 50D2                		mov	@(cam_z_pos,r13),r0
(2)  302/ 600074A : 2099                		and	r9,r0
(2)  303/ 600074C : 2599                		and	r9,r5
(2)  304/ 600074E : 3500                		cmp/eq	r0,r5
(2)  305/ 6000750 : 8902                		bt	.no_z_upd
(2)  306/ 6000752 :                     ; 		add	r9,r5
(2)  307/ 6000752 :                     ; 		neg	r5,r4
(2)  308/ 6000752 :                     ; 		cmp/gt	r5,r0
(2)  309/ 6000752 :                     ; 		bf	.set_z_upd
(2)  310/ 6000752 :                     ; 		cmp/ge	r4,r0
(2)  311/ 6000752 :                     ; 		bf	.no_z_upd
(2)  312/ 6000752 :                     ; .set_z_upd:
(2)  313/ 6000752 : 2099                		and	r9,r0
(2)  314/ 6000754 : 1E06                		mov	r0,@(mdllay_z_last,r14)
(2)  315/ 6000756 : 7A01                		add	#1,r10
(2)  316/ 6000758 :                     .no_z_upd:
(2)  317/ 6000758 :                     
(2)  318/ 6000758 : 55E5                		mov	@(mdllay_y_last,r14),r5
(2)  319/ 600075A : 50D1                		mov	@(cam_y_pos,r13),r0
(2)  320/ 600075C : 2089                		and	r8,r0
(2)  321/ 600075E : 2589                		and	r8,r5
(2)  322/ 6000760 : 3500                		cmp/eq	r0,r5
(2)  323/ 6000762 : 8902                		bt	.no_y_upd
(2)  324/ 6000764 :                     ; 		add	r8,r5
(2)  325/ 6000764 :                     ; 		neg	r5,r4
(2)  326/ 6000764 :                     ; 		cmp/gt	r5,r0
(2)  327/ 6000764 :                     ; 		bf	.set_y_upd
(2)  328/ 6000764 :                     ; 		cmp/ge	r4,r0
(2)  329/ 6000764 :                     ; 		bf	.no_y_upd
(2)  330/ 6000764 :                     ; .set_y_upd:
(2)  331/ 6000764 : 2089                		and	r8,r0
(2)  332/ 6000766 : 1E05                		mov	r0,@(mdllay_y_last,r14)
(2)  333/ 6000768 : 7A01                		add	#1,r10
(2)  334/ 600076A :                     .no_y_upd:
(2)  335/ 600076A :                     
(2)  336/ 600076A : 55E4                		mov	@(mdllay_x_last,r14),r5
(2)  337/ 600076C : 50D0                		mov	@(cam_x_pos,r13),r0
(2)  338/ 600076E : 2079                		and	r7,r0
(2)  339/ 6000770 : 2579                		and	r7,r5
(2)  340/ 6000772 : 3500                		cmp/eq	r0,r5
(2)  341/ 6000774 : 8902                		bt	.no_x_upd
(2)  342/ 6000776 :                     ; 		add	r7,r5
(2)  343/ 6000776 :                     ; 		neg	r5,r4
(2)  344/ 6000776 :                     ; 		cmp/gt	r5,r0
(2)  345/ 6000776 :                     ; 		bf	.set_x_upd
(2)  346/ 6000776 :                     ; 		cmp/ge	r4,r0
(2)  347/ 6000776 :                     ; 		bf	.no_x_upd
(2)  348/ 6000776 :                     ; .set_x_upd:
(2)  349/ 6000776 : 2079                		and	r7,r0
(2)  350/ 6000778 : 1E04                		mov	r0,@(mdllay_x_last,r14)
(2)  351/ 600077A : 7A01                		add	#1,r10
(2)  352/ 600077C :                     .no_x_upd:
(2)  353/ 600077C :                     
(2)  354/ 600077C : 55E7                		mov	@(mdllay_xr_last,r14),r5
(2)  355/ 600077E : 50D3                		mov	@(cam_x_rot,r13),r0
(2)  356/ 6000780 : 2069                		and	r6,r0
(2)  357/ 6000782 : 2569                		and	r6,r5
(2)  358/ 6000784 : 3500                		cmp/eq	r0,r5
(2)  359/ 6000786 : 8902                		bt	.no_xr_upd
(2)  360/ 6000788 :                     ; 		add	r6,r5
(2)  361/ 6000788 :                     ; 		neg	r5,r4
(2)  362/ 6000788 :                     ; 		cmp/gt	r5,r0
(2)  363/ 6000788 :                     ; 		bf	.set_xr_upd
(2)  364/ 6000788 :                     ; 		cmp/ge	r4,r0
(2)  365/ 6000788 :                     ; 		bf	.no_xr_upd
(2)  366/ 6000788 :                     ; .set_xr_upd:
(2)  367/ 6000788 : 2069                		and	r6,r0
(2)  368/ 600078A : 1E07                		mov	r0,@(mdllay_xr_last,r14)
(2)  369/ 600078C : 7A01                		add	#1,r10
(2)  370/ 600078E :                     .no_xr_upd:
(2)  371/ 600078E :                     
(2)  372/ 600078E : 4A15                		cmp/pl	r10
(2)  373/ 6000790 : 8B01                		bf	.no_lay
(2)  374/ 6000792 : B016                		bsr	MarsLay_Draw
(2)  375/ 6000794 : 0009                		nop
(2)  376/ 6000796 :                     .no_lay:
(2)  377/ 6000796 : 4F26                		lds	@r15+,pr
(2)  378/ 6000798 : 000B                		rts
(2)  379/ 600079A : 0009                		nop
(2)  380/ 600079C :                     		align 4
(2)  381/ 600079C : 0601 157C 0601 1554 		ltorg
                    0601 159C FFF0 0000 
                    8000                
(2)  382/ 60007AE :                     
(2)  383/ 60007AE :                     ; r1 - layout data pointer
(2)  384/ 60007AE :                     MarsLay_Make:
(2)  385/ 60007AE : DEAF                		mov	#RAM_Mars_ObjLayout,r14
(2)  386/ 60007B0 : DDAF                		mov	#RAM_Mars_ObjCamera,r13
(2)  387/ 60007B2 : 200A                		xor	r0,r0
(2)  388/ 60007B4 : 1E10                		mov	r1,@(mdllay_data,r14)
(2)  389/ 60007B6 : 1E04                		mov	r0,@(mdllay_x_last,r14)
(2)  390/ 60007B8 : 1E05                		mov	r0,@(mdllay_y_last,r14)
(2)  391/ 60007BA : 1E06                		mov	r0,@(mdllay_z_last,r14)
(2)  392/ 60007BC : 1E01                		mov	r0,@(mdllay_x,r14)
(2)  393/ 60007BE : 1E02                		mov	r0,@(mdllay_y,r14)
(2)  394/ 60007C0 : 1E03                		mov	r0,@(mdllay_z,r14)
(2)  395/ 60007C2 :                     MarsLay_Draw:
(2)  396/ 60007C2 : DAAC                		mov	#RAM_Mars_Objects,r10
(2)  397/ 60007C4 : 62A3                		mov	r10,r2
(2)  398/ 60007C6 : E32C                		mov	#sizeof_mdlobj,r3
(2)  399/ 60007C8 : E000                		mov	#0,r0
(2)  400/ 60007CA : E409                		mov	#9,r4
(2)  401/ 60007CC :                     .clrold:
(2)  402/ 60007CC : 1200                		mov	r0,@(mdl_data,r2)
(2)  403/ 60007CE : 1201                		mov	r0,@(mdl_x_pos,r2)
(2)  404/ 60007D0 : 1202                		mov	r0,@(mdl_y_pos,r2)
(2)  405/ 60007D2 : 1203                		mov	r0,@(mdl_z_pos,r2)
(2)  406/ 60007D4 : 1204                		mov	r0,@(mdl_x_rot,r2)
(2)  407/ 60007D6 : 1205                		mov	r0,@(mdl_y_rot,r2)
(2)  408/ 60007D8 : 1206                		mov	r0,@(mdl_z_rot,r2)
(2)  409/ 60007DA : 4410                		dt	r4
(2)  410/ 60007DC : 8FF6                		bf/s	.clrold
(2)  411/ 60007DE : 323C                		add	r3,r2
(2)  412/ 60007E0 :                     
(2)  413/ 60007E0 :                     	; r13 - Layout Ids
(2)  414/ 60007E0 :                     	; r12 - Layout model list
(2)  415/ 60007E0 : E400                		mov	#0,r4
(2)  416/ 60007E2 : 5DE0                		mov	@(mdllay_data,r14),r13
(2)  417/ 60007E4 : 6CD6                		mov	@r13+,r12
(2)  418/ 60007E6 : D00E                		mov	.center_val,r0			; list center point
(2)  419/ 60007E8 : 3D0C                		add	r0,r13
(2)  420/ 60007EA : 51E4                		mov	@(mdllay_x_last,r14),r1
(2)  421/ 60007EC : 52E6                		mov	@(mdllay_z_last,r14),r2
(2)  422/ 60007EE : E020                		mov	#LAY_WIDTH,r0
(2)  423/ 60007F0 : 4129                		shlr16	r1
(2)  424/ 60007F2 : 4229                		shlr16	r2
(2)  425/ 60007F4 : 611F                		exts	r1,r1
(2)  426/ 60007F6 : 622F                		exts	r2,r2
(2)  427/ 60007F8 :                     	rept 3
(2)  428/ 60007F8 :                     		shar	r1
(2)  429/ 60007F8 :                     		shar	r2
(2)  430/ 60007F8 :                     	endm
(2)  428/ 60007F8 : 4121                		shar	r1
(2)  429/ 60007FA : 4221                		shar	r2
(2)  428/ 60007FC : 4121                		shar	r1
(2)  429/ 60007FE : 4221                		shar	r2
(2)  428/ 6000800 : 4121                		shar	r1
(2)  429/ 6000802 : 4221                		shar	r2
(2)  431/ 6000804 : 4221                		shar	r2			; extra shift
(2)  432/ 6000806 : 220F                		muls	r0,r2
(2)  433/ 6000808 : 001A                		sts	macl,r0
(2)  434/ 600080A : 3D1C                		add	r1,r13
(2)  435/ 600080C : 3D08                		sub	r0,r13
(2)  436/ 600080E : 50E7                		mov	@(mdllay_xr_last,r14),r0
(2)  437/ 6000810 : 4029                		shlr16	r0
(2)  438/ 6000812 : C93F                		and	#$3F,r0
(2)  439/ 6000814 : 4008                		shll2	r0
(2)  440/ 6000816 : D198                		mov	#.list,r1
(2)  441/ 6000818 : 001E                		mov	@(r0,r1),r0
(2)  442/ 600081A : 402B                		jmp	@r0
(2)  443/ 600081C : 0009                		nop
(2)  444/ 600081E :                     		align 4
(2)  445/ 6000820 : 0000 00CA           .center_val:	dc.l (LAY_WIDTH*6)+(2*5)
(2)  446/ 6000824 :                     
(2)  447/ 6000824 :                     .list:
(2)  448/ 6000824 : 0600 097C           		dc.l .front
(2)  449/ 6000828 : 0600 09A4           		dc.l .front_fr
(2)  450/ 600082C : 0600 09A4           		dc.l .front_fr
(2)  451/ 6000830 : 0600 09A4           		dc.l .front_fr
(2)  452/ 6000834 : 0600 09A4           		dc.l .front_fr
(2)  453/ 6000838 : 0600 09A4           		dc.l .front_fr
(2)  454/ 600083C : 0600 09A4           		dc.l .front_fr
(2)  455/ 6000840 : 0600 09A4           		dc.l .front_fr
(2)  456/ 6000844 : 0600 09A4           		dc.l .front_fr
(2)  457/ 6000848 : 0600 09A4           		dc.l .front_fr
(2)  458/ 600084C : 0600 09A4           		dc.l .front_fr
(2)  459/ 6000850 : 0600 09A4           		dc.l .front_fr
(2)  460/ 6000854 : 0600 09A4           		dc.l .front_fr
(2)  461/ 6000858 : 0600 09A4           		dc.l .front_fr
(2)  462/ 600085C : 0600 09A4           		dc.l .front_fr
(2)  463/ 6000860 : 0600 09A4           		dc.l .front_fr
(2)  464/ 6000864 :                     		
(2)  465/ 6000864 : 0600 09CC           		dc.l .right_dw
(2)  466/ 6000868 : 0600 09CC           		dc.l .right_dw
(2)  467/ 600086C : 0600 09CC           		dc.l .right_dw
(2)  468/ 6000870 : 0600 09CC           		dc.l .right_dw
(2)  469/ 6000874 : 0600 09CC           		dc.l .right_dw
(2)  470/ 6000878 : 0600 09CC           		dc.l .right_dw
(2)  471/ 600087C : 0600 09CC           		dc.l .right_dw
(2)  472/ 6000880 : 0600 09CC           		dc.l .right_dw
(2)  473/ 6000884 : 0600 09CC           		dc.l .right_dw
(2)  474/ 6000888 : 0600 09CC           		dc.l .right_dw
(2)  475/ 600088C : 0600 09CC           		dc.l .right_dw
(2)  476/ 6000890 : 0600 09CC           		dc.l .right_dw
(2)  477/ 6000894 : 0600 09CC           		dc.l .right_dw
(2)  478/ 6000898 : 0600 09CC           		dc.l .right_dw
(2)  479/ 600089C : 0600 09CC           		dc.l .right_dw
(2)  480/ 60008A0 : 0600 09CC           		dc.l .right_dw
(2)  481/ 60008A4 :                     		
(2)  482/ 60008A4 : 0600 09F4           		dc.l .down
(2)  483/ 60008A8 : 0600 0A1C           		dc.l .down_left
(2)  484/ 60008AC : 0600 0A1C           		dc.l .down_left
(2)  485/ 60008B0 : 0600 0A1C           		dc.l .down_left
(2)  486/ 60008B4 : 0600 0A1C           		dc.l .down_left
(2)  487/ 60008B8 : 0600 0A1C           		dc.l .down_left
(2)  488/ 60008BC : 0600 0A1C           		dc.l .down_left
(2)  489/ 60008C0 : 0600 0A1C           		dc.l .down_left
(2)  490/ 60008C4 : 0600 0A1C           		dc.l .down_left
(2)  491/ 60008C8 : 0600 0A1C           		dc.l .down_left
(2)  492/ 60008CC : 0600 0A1C           		dc.l .down_left
(2)  493/ 60008D0 : 0600 0A1C           		dc.l .down_left
(2)  494/ 60008D4 : 0600 0A1C           		dc.l .down_left
(2)  495/ 60008D8 : 0600 0A1C           		dc.l .down_left
(2)  496/ 60008DC : 0600 0A1C           		dc.l .down_left
(2)  497/ 60008E0 : 0600 0A1C           		dc.l .down_left
(2)  498/ 60008E4 :                     
(2)  499/ 60008E4 : 0600 0A44           		dc.l .front_lf
(2)  500/ 60008E8 : 0600 0A44           		dc.l .front_lf
(2)  501/ 60008EC : 0600 0A44           		dc.l .front_lf
(2)  502/ 60008F0 : 0600 0A44           		dc.l .front_lf
(2)  503/ 60008F4 : 0600 0A44           		dc.l .front_lf
(2)  504/ 60008F8 : 0600 0A44           		dc.l .front_lf
(2)  505/ 60008FC : 0600 0A44           		dc.l .front_lf
(2)  506/ 6000900 : 0600 0A44           		dc.l .front_lf
(2)  507/ 6000904 : 0600 0A44           		dc.l .front_lf
(2)  508/ 6000908 : 0600 0A44           		dc.l .front_lf
(2)  509/ 600090C : 0600 0A44           		dc.l .front_lf
(2)  510/ 6000910 : 0600 0A44           		dc.l .front_lf
(2)  511/ 6000914 : 0600 0A44           		dc.l .front_lf
(2)  512/ 6000918 : 0600 0A44           		dc.l .front_lf
(2)  513/ 600091C : 0600 0A44           		dc.l .front_lf
(2)  514/ 6000920 : 0600 097C           		dc.l .front
(2)  515/ 6000924 :                     
(2)  516/ 6000924 :                     ; r5 - numof pieces
(2)  517/ 6000924 :                     ; uses: r6,r7
(2)  518/ 6000924 :                     .do_piece:
(2)  519/ 6000924 : 2F16                		mov	r1,@-r15
(2)  520/ 6000926 : 2FD6                		mov	r13,@-r15
(2)  521/ 6000928 : D654                		mov	#$100000,r6
(2)  522/ 600092A :                     .nxt_one:
(2)  523/ 600092A : 244A                		xor	r4,r4
(2)  524/ 600092C : 60D5                		mov.w	@r13+,r0
(2)  525/ 600092E : 4015                		cmp/pl 	r0
(2)  526/ 6000930 : 8B0F                		bf	.blank_mdl
(2)  527/ 6000932 : 6703                		mov	r0,r7
(2)  528/ 6000934 : 4019                		shlr8	r0
(2)  529/ 6000936 : 4009                		shlr2	r0
(2)  530/ 6000938 : 4001                		shlr	r0
(2)  531/ 600093A : C91C                		and	#%11100,r0
(2)  532/ 600093C : D850                		mov	#.xrotlist,r8
(2)  533/ 600093E : 088E                		mov	@(r8,r0),r8
(2)  534/ 6000940 : 6073                		mov	r7,r0
(2)  535/ 6000942 : 70FF                		add	#-1,r0
(2)  536/ 6000944 : 4008                		shll2	r0
(2)  537/ 6000946 : 4000                		shll	r0
(2)  538/ 6000948 : 97A2                		mov	#$1FFF,r7
(2)  539/ 600094A : 2079                		and	r7,r0
(2)  540/ 600094C : 04CE                		mov	@(r12,r0),r4
(2)  541/ 600094E : D04D                		mov	#$40000000,r0
(2)  542/ 6000950 : 240B                		or	r0,r4
(2)  543/ 6000952 :                     .blank_mdl:
(2)  544/ 6000952 : 1A11                		mov	r1,@(mdl_x_pos,r10)
(2)  545/ 6000954 : 1A22                		mov	r2,@(mdl_y_pos,r10)
(2)  546/ 6000956 : 1A33                		mov	r3,@(mdl_z_pos,r10)
(2)  547/ 6000958 : 1A84                		mov	r8,@(mdl_x_rot,r10)	
(2)  548/ 600095A : 1A40                		mov	r4,@(mdl_data,r10)
(2)  549/ 600095C : 7A2C                		add	#sizeof_mdlobj,r10
(2)  550/ 600095E : 4510                		dt	r5
(2)  551/ 6000960 : 8FE3                		bf/s	.nxt_one
(2)  552/ 6000962 : 316C                		add	r6,r1
(2)  553/ 6000964 : 6DF6                		mov	@r15+,r13
(2)  554/ 6000966 : 61F6                		mov	@r15+,r1
(2)  555/ 6000968 : 000B                		rts
(2)  556/ 600096A : 0009                		nop
(2)  557/ 600096C :                     		align 4
(2)  558/ 600096C : 0000 0000           .xrotlist:	dc.l 0
(2)  559/ 6000970 : 0010 0000           		dc.l $100000
(2)  560/ 6000974 : 0020 0000           		dc.l $200000
(2)  561/ 6000978 : 0030 0000           		dc.l $300000
(2)  562/ 600097C :                     
(2)  563/ 600097C :                     ; o X X X o
(2)  564/ 600097C :                     ; o X X X o
(2)  565/ 600097C :                     ; o X C X o
(2)  566/ 600097C :                     ; o - - - o
(2)  567/ 600097C :                     ; o o o o o
(2)  568/ 600097C :                     .front:
(2)  569/ 600097C : D142                		mov	#-$100000,r1
(2)  570/ 600097E : E200                		mov	#0,r2
(2)  571/ 6000980 : D342                		mov	#-$200000,r3
(2)  572/ 6000982 : 7D02                		add	#(1*2),r13
(2)  573/ 6000984 : DB3D                		mov	#$100000,r11
(2)  574/ 6000986 :                     
(2)  575/ 6000986 : 4F22                		sts	pr,@-r15
(2)  576/ 6000988 : BFCC                		bsr	.do_piece
(2)  577/ 600098A : E503                		mov	#3,r5
(2)  578/ 600098C : 7D20                		add	#LAY_WIDTH,r13
(2)  579/ 600098E : 33BC                		add	r11,r3
(2)  580/ 6000990 : BFC8                		bsr	.do_piece
(2)  581/ 6000992 : E503                		mov	#3,r5
(2)  582/ 6000994 : 7D20                		add	#LAY_WIDTH,r13
(2)  583/ 6000996 : 33BC                		add	r11,r3
(2)  584/ 6000998 : BFC4                		bsr	.do_piece
(2)  585/ 600099A : E503                		mov	#3,r5
(2)  586/ 600099C : 4F26                		lds	@r15+,pr
(2)  587/ 600099E : 000B                		rts
(2)  588/ 60009A0 : 0009                		nop
(2)  589/ 60009A2 :                     		align 4
(2)  590/ 60009A4 :                     
(2)  591/ 60009A4 :                     ; front right view
(2)  592/ 60009A4 :                     ; o o X X X
(2)  593/ 60009A4 :                     ; o - X X X
(2)  594/ 60009A4 :                     ; o - C X X
(2)  595/ 60009A4 :                     ; o - - - o
(2)  596/ 60009A4 :                     ; o o o o o
(2)  597/ 60009A4 :                     .front_fr:
(2)  598/ 60009A4 : E100                		mov	#0,r1
(2)  599/ 60009A6 : E200                		mov	#0,r2
(2)  600/ 60009A8 : D338                		mov	#-$200000,r3
(2)  601/ 60009AA : 7D04                		add	#(2*2),r13
(2)  602/ 60009AC : DB33                		mov	#$100000,r11
(2)  603/ 60009AE : 4F22                		sts	pr,@-r15
(2)  604/ 60009B0 : BFB8                		bsr	.do_piece
(2)  605/ 60009B2 : E503                		mov	#3,r5
(2)  606/ 60009B4 : 7D20                		add	#LAY_WIDTH,r13
(2)  607/ 60009B6 : 33BC                		add	r11,r3
(2)  608/ 60009B8 : BFB4                		bsr	.do_piece
(2)  609/ 60009BA : E503                		mov	#3,r5
(2)  610/ 60009BC : 7D20                		add	#LAY_WIDTH,r13
(2)  611/ 60009BE : 33BC                		add	r11,r3
(2)  612/ 60009C0 : BFB0                		bsr	.do_piece
(2)  613/ 60009C2 : E503                		mov	#3,r5
(2)  614/ 60009C4 : 4F26                		lds	@r15+,pr
(2)  615/ 60009C6 : 000B                		rts
(2)  616/ 60009C8 : 0009                		nop
(2)  617/ 60009CA :                     		align 4
(2)  618/ 60009CC :                     
(2)  619/ 60009CC :                     
(2)  620/ 60009CC :                     ; right view/down
(2)  621/ 60009CC :                     ; o o o o o
(2)  622/ 60009CC :                     ; o - - - o
(2)  623/ 60009CC :                     ; o - C X X
(2)  624/ 60009CC :                     ; o - X X X
(2)  625/ 60009CC :                     ; o o X X X
(2)  626/ 60009CC :                     .right_dw:
(2)  627/ 60009CC : E100                		mov	#0,r1
(2)  628/ 60009CE : E200                		mov	#0,r2
(2)  629/ 60009D0 : D32D                		mov	#-$100000,r3
(2)  630/ 60009D2 : E024                		mov	#(2*2)+(LAY_WIDTH),r0
(2)  631/ 60009D4 : 3D0C                		add	r0,r13
(2)  632/ 60009D6 : DB29                		mov	#$100000,r11
(2)  633/ 60009D8 : 4F22                		sts	pr,@-r15
(2)  634/ 60009DA : BFA3                		bsr	.do_piece
(2)  635/ 60009DC : E503                		mov	#3,r5
(2)  636/ 60009DE : 7D20                		add	#LAY_WIDTH,r13
(2)  637/ 60009E0 : 33BC                		add	r11,r3
(2)  638/ 60009E2 : BF9F                		bsr	.do_piece
(2)  639/ 60009E4 : E503                		mov	#3,r5
(2)  640/ 60009E6 : 7D20                		add	#LAY_WIDTH,r13
(2)  641/ 60009E8 : 33BC                		add	r11,r3
(2)  642/ 60009EA : BF9B                		bsr	.do_piece
(2)  643/ 60009EC : E503                		mov	#3,r5
(2)  644/ 60009EE : 4F26                		lds	@r15+,pr
(2)  645/ 60009F0 : 000B                		rts
(2)  646/ 60009F2 : 0009                		nop
(2)  647/ 60009F4 :                     		align 4
(2)  648/ 60009F4 :                     
(2)  649/ 60009F4 :                     ; o o o o o
(2)  650/ 60009F4 :                     ; o - - - o
(2)  651/ 60009F4 :                     ; o X C X o
(2)  652/ 60009F4 :                     ; o X X X o
(2)  653/ 60009F4 :                     ; o X X X o
(2)  654/ 60009F4 :                     .down:
(2)  655/ 60009F4 : E100                		mov	#0,r1
(2)  656/ 60009F6 : E200                		mov	#0,r2
(2)  657/ 60009F8 : D323                		mov	#-$100000,r3
(2)  658/ 60009FA : E024                		mov	#(2*2)+(LAY_WIDTH*1),r0
(2)  659/ 60009FC : 3D0C                		add	r0,r13
(2)  660/ 60009FE : DB1F                		mov	#$100000,r11
(2)  661/ 6000A00 : 4F22                		sts	pr,@-r15
(2)  662/ 6000A02 : BF8F                		bsr	.do_piece
(2)  663/ 6000A04 : E503                		mov	#3,r5
(2)  664/ 6000A06 : 7D20                		add	#LAY_WIDTH,r13
(2)  665/ 6000A08 : 33BC                		add	r11,r3
(2)  666/ 6000A0A : BF8B                		bsr	.do_piece
(2)  667/ 6000A0C : E503                		mov	#3,r5
(2)  668/ 6000A0E : 7D20                		add	#LAY_WIDTH,r13
(2)  669/ 6000A10 : 33BC                		add	r11,r3
(2)  670/ 6000A12 : BF87                		bsr	.do_piece
(2)  671/ 6000A14 : E503                		mov	#3,r5
(2)  672/ 6000A16 : 4F26                		lds	@r15+,pr
(2)  673/ 6000A18 : 000B                		rts
(2)  674/ 6000A1A : 0009                		nop
(2)  675/ 6000A1C :                     		align 4
(2)  676/ 6000A1C :                     
(2)  677/ 6000A1C :                     ; o o o o o
(2)  678/ 6000A1C :                     ; o - - - o
(2)  679/ 6000A1C :                     ; X X C - o
(2)  680/ 6000A1C :                     ; X X X - o
(2)  681/ 6000A1C :                     ; X X X o o
(2)  682/ 6000A1C :                     .down_left:
(2)  683/ 6000A1C : D11A                		mov	#-$100000,r1
(2)  684/ 6000A1E : E200                		mov	#0,r2
(2)  685/ 6000A20 : D319                		mov	#-$100000,r3
(2)  686/ 6000A22 : E022                		mov	#(1*2)+(LAY_WIDTH*1),r0
(2)  687/ 6000A24 : 3D0C                		add	r0,r13
(2)  688/ 6000A26 : DB15                		mov	#$100000,r11
(2)  689/ 6000A28 : 4F22                		sts	pr,@-r15
(2)  690/ 6000A2A : BF7B                		bsr	.do_piece
(2)  691/ 6000A2C : E503                		mov	#3,r5
(2)  692/ 6000A2E : 7D20                		add	#LAY_WIDTH,r13
(2)  693/ 6000A30 : 33BC                		add	r11,r3
(2)  694/ 6000A32 : BF77                		bsr	.do_piece
(2)  695/ 6000A34 : E503                		mov	#3,r5
(2)  696/ 6000A36 : 7D20                		add	#LAY_WIDTH,r13
(2)  697/ 6000A38 : 33BC                		add	r11,r3
(2)  698/ 6000A3A : BF73                		bsr	.do_piece
(2)  699/ 6000A3C : E503                		mov	#3,r5
(2)  700/ 6000A3E : 4F26                		lds	@r15+,pr
(2)  701/ 6000A40 : 000B                		rts
(2)  702/ 6000A42 : 0009                		nop
(2)  703/ 6000A44 :                     		align 4
(2)  704/ 6000A44 :                     
(2)  705/ 6000A44 :                     
(2)  706/ 6000A44 :                     ; X X X o o
(2)  707/ 6000A44 :                     ; X X X - o
(2)  708/ 6000A44 :                     ; X X C - o
(2)  709/ 6000A44 :                     ; o - - - o
(2)  710/ 6000A44 :                     ; o o o o o
(2)  711/ 6000A44 :                     .front_lf:
(2)  712/ 6000A44 : D110                		mov	#-$100000,r1
(2)  713/ 6000A46 : E200                		mov	#0,r2
(2)  714/ 6000A48 : D310                		mov	#-$200000,r3
(2)  715/ 6000A4A : 7D02                		add	#(1*2),r13
(2)  716/ 6000A4C : DB0B                		mov	#$100000,r11
(2)  717/ 6000A4E : 4F22                		sts	pr,@-r15
(2)  718/ 6000A50 : BF68                		bsr	.do_piece
(2)  719/ 6000A52 : E503                		mov	#3,r5
(2)  720/ 6000A54 : 7D20                		add	#LAY_WIDTH,r13
(2)  721/ 6000A56 : 33BC                		add	r11,r3
(2)  722/ 6000A58 : BF64                		bsr	.do_piece
(2)  723/ 6000A5A : E503                		mov	#3,r5
(2)  724/ 6000A5C : 7D20                		add	#LAY_WIDTH,r13
(2)  725/ 6000A5E : 33BC                		add	r11,r3
(2)  726/ 6000A60 : BF60                		bsr	.do_piece
(2)  727/ 6000A62 : E503                		mov	#3,r5
(2)  728/ 6000A64 : 4F26                		lds	@r15+,pr
(2)  729/ 6000A66 : 000B                		rts
(2)  730/ 6000A68 : 0009                		nop
(2)  731/ 6000A6A :                     		align 4
(2)  732/ 6000A6C : 0601 157C 0601 1554 		ltorg
                    0601 159C 0600 0824 
                    0010 0000 0600 096C 
                    4000 0000 FFF0 0000 
                    FFE0 0000 1FFF      
(2)  733/ 6000A92 :                     
(2)  734/ 6000A92 :                     ; ------------------------------------------------
(2)  735/ 6000A92 :                     ; MarsMdl_Init
(2)  736/ 6000A92 :                     ; 
(2)  737/ 6000A92 :                     ; Reset ALL objects
(2)  738/ 6000A92 :                     ; ------------------------------------------------
(2)  739/ 6000A92 :                     
(2)  740/ 6000A92 :                     MarsMdl_Init:
(2)  741/ 6000A92 : D104                		mov	#RAM_Mars_Objects,r1
(2)  742/ 6000A94 : 9208                		mov	#(sizeof_mdlobj*MAX_MODELS)/4,r2
(2)  743/ 6000A96 : E000                		mov	#0,r0
(2)  744/ 6000A98 :                     .clnup:
(2)  745/ 6000A98 : 2102                		mov	r0,@r1
(2)  746/ 6000A9A : 4210                		dt	r2
(2)  747/ 6000A9C : 8FFC                		bf/s	.clnup
(2)  748/ 6000A9E : 7104                		add	#4,r1
(2)  749/ 6000AA0 : 000B                		rts
(2)  750/ 6000AA2 : 0009                		nop
(2)  751/ 6000AA4 :                     		align 4
(2)  752/ 6000AA4 : 0601 159C 02C0      		ltorg
(2)  753/ 6000AAA :                     
(2)  754/ 6000AAA :                     MarsMdl_ReadModel:
(2)  755/ 6000AAA : 4F22                		sts	pr,@-r15
(2)  756/ 6000AAC :                     
(2)  757/ 6000AAC : 5DE7                		mov	@(mdl_animdata,r14),r13
(2)  758/ 6000AAE : 4D15                		cmp/pl	r13
(2)  759/ 6000AB0 : 8B1E                		bf	.no_anim
(2)  760/ 6000AB2 : 50E9                		mov	@(mdl_animtimer,r14),r0
(2)  761/ 6000AB4 : 70FF                		add	#-1,r0
(2)  762/ 6000AB6 : 4015                		cmp/pl 	r0
(2)  763/ 6000AB8 : 8919                		bt	.wait_camanim
(2)  764/ 6000ABA : 62D6                		mov	@r13+,r2
(2)  765/ 6000ABC : 50E8                		mov	@(mdl_animframe,r14),r0
(2)  766/ 6000ABE : 7001                		add	#1,r0
(2)  767/ 6000AC0 : 3020                		cmp/eq	r2,r0
(2)  768/ 6000AC2 : 8B00                		bf	.on_frames
(2)  769/ 6000AC4 : 200A                		xor	r0,r0
(2)  770/ 6000AC6 :                     .on_frames:
(2)  771/ 6000AC6 : 6103                		mov	r0,r1
(2)  772/ 6000AC8 : 1E08                		mov	r0,@(mdl_animframe,r14)
(2)  773/ 6000ACA : E018                		mov	#$18,r0
(2)  774/ 6000ACC : 210E                		mulu	r0,r1
(2)  775/ 6000ACE : 001A                		sts	macl,r0 	
(2)  776/ 6000AD0 : 3D0C                		add	r0,r13
(2)  777/ 6000AD2 : 61D6                		mov	@r13+,r1
(2)  778/ 6000AD4 : 62D6                		mov	@r13+,r2
(2)  779/ 6000AD6 : 63D6                		mov	@r13+,r3
(2)  780/ 6000AD8 : 64D6                		mov	@r13+,r4
(2)  781/ 6000ADA : 65D6                		mov	@r13+,r5
(2)  782/ 6000ADC : 66D6                		mov	@r13+,r6
(2)  783/ 6000ADE : 644B                		neg	r4,r4
(2)  784/ 6000AE0 : 1E11                		mov	r1,@(mdl_x_pos,r14)
(2)  785/ 6000AE2 : 1E22                		mov	r2,@(mdl_y_pos,r14)
(2)  786/ 6000AE4 : 1E33                		mov	r3,@(mdl_z_pos,r14)
(2)  787/ 6000AE6 : 1E44                		mov	r4,@(mdl_x_rot,r14)
(2)  788/ 6000AE8 : 1E55                		mov	r5,@(mdl_y_rot,r14)
(2)  789/ 6000AEA : 1E66                		mov	r6,@(mdl_z_rot,r14)
(2)  790/ 6000AEC : E001                		mov	#1,r0				; TEMPORAL timer
(2)  791/ 6000AEE :                     .wait_camanim:
(2)  792/ 6000AEE : 1E09                		mov	r0,@(mdl_animtimer,r14)	
(2)  793/ 6000AF0 :                     .no_anim:
(2)  794/ 6000AF0 :                     
(2)  795/ 6000AF0 :                     	; Now start reading
(2)  796/ 6000AF0 : C603                		mov	@(marsGbl_CurrFacePos,gbr),r0
(2)  797/ 6000AF2 : 6D03                		mov	r0,r13				; r13 - output faces
(2)  798/ 6000AF4 : D06F                		mov	#$3FFFFFFF,r0
(2)  799/ 6000AF6 : 5CE0                		mov	@(mdl_data,r14),r12		; r12 - model header
(2)  800/ 6000AF8 : 2C09                		and	r0,r12
(2)  801/ 6000AFA : 5BC2                		mov 	@(8,r12),r11			; r11 - face data
(2)  802/ 6000AFC : 5AC1                		mov 	@(4,r12),r10			; r10 - vertice data (X,Y,Z)
(2)  803/ 6000AFE : 69C1                		mov.w	@r12,r9				;  r9 - Number of faces used on model
(2)  804/ 6000B00 : C602                		mov	@(marsGbl_CurrZList,gbr),r0	;  r8 - Zlist for sorting
(2)  805/ 6000B02 : 6803                		mov	r0,r8
(2)  806/ 6000B04 :                     .next_face:
(2)  807/ 6000B04 : C50A                		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0	; Ran out of space to store faces?
(2)  808/ 6000B06 : 91DD                		mov	#MAX_FACES,r1
(2)  809/ 6000B08 : 3013                		cmp/ge	r1,r0
(2)  810/ 6000B0A : 8B01                		bf	.can_build
(2)  811/ 6000B0C : A0CF                		bra	.exit_model
(2)  812/ 6000B0E : 0009                		nop
(2)  813/ 6000B10 :                     .can_build:
(2)  814/ 6000B10 : 64B5                		mov.w	@r11+,r4			; Read type from model
(2)  815/ 6000B12 : E703                		mov	#3,r7				; r7 - Current polygon type: triangle (3)
(2)  816/ 6000B14 : 6043                		mov	r4,r0
(2)  817/ 6000B16 : 4019                		shlr8	r0
(2)  818/ 6000B18 : C840                		tst	#PLGN_TRI,r0			; Model face uses triangle?
(2)  819/ 6000B1A : 8B00                		bf	.set_tri
(2)  820/ 6000B1C : 7701                		add	#1,r7				; Face is quad, r7 = 4 points
(2)  821/ 6000B1E :                     .set_tri:
(2)  822/ 6000B1E : 4415                		cmp/pl	r4				; Faces uses texture?
(2)  823/ 6000B20 : 8936                		bt	.solid_type
(2)  824/ 6000B22 :                     
(2)  825/ 6000B22 :                     ; --------------------------------
(2)  826/ 6000B22 :                     ; Set texture material
(2)  827/ 6000B22 :                     ; --------------------------------
(2)  828/ 6000B22 :                     
(2)  829/ 6000B22 : 56C3                		mov	@($C,r12),r6			; r6 - Material data
(2)  830/ 6000B24 : 65D3                		mov	r13,r5				; r5 - Go to UV section 
(2)  831/ 6000B26 : 7528                		add 	#polygn_srcpnts,r5
(2)  832/ 6000B28 : 6373                		mov	r7,r3				; r3 - copy of current face points (3 or 4)
(2)  833/ 6000B2A :                     
(2)  834/ 6000B2A :                     	; New method
(2)  835/ 6000B2A :                     	rept 3
(2)  836/ 6000B2A :                     		mov.w	@r11+,r0			; Read UV index			
(2)  837/ 6000B2A :                     		extu	r0,r0
(2)  838/ 6000B2A :                     		shll2	r0
(2)  839/ 6000B2A :                     		mov	@(r6,r0),r0
(2)  840/ 6000B2A :                     		mov.w	r0,@(2,r5)
(2)  841/ 6000B2A :                     		shlr16	r0
(2)  842/ 6000B2A :                     		mov.w	r0,@r5
(2)  843/ 6000B2A :                     		add	#4,r5
(2)  844/ 6000B2A :                     	endm
(2)  836/ 6000B2A : 60B5                		mov.w	@r11+,r0			; Read UV index			
(2)  837/ 6000B2C : 600D                		extu	r0,r0
(2)  838/ 6000B2E : 4008                		shll2	r0
(2)  839/ 6000B30 : 006E                		mov	@(r6,r0),r0
(2)  840/ 6000B32 : 8151                		mov.w	r0,@(2,r5)
(2)  841/ 6000B34 : 4029                		shlr16	r0
(2)  842/ 6000B36 : 2501                		mov.w	r0,@r5
(2)  843/ 6000B38 : 7504                		add	#4,r5
(2)  836/ 6000B3A : 60B5                		mov.w	@r11+,r0			; Read UV index			
(2)  837/ 6000B3C : 600D                		extu	r0,r0
(2)  838/ 6000B3E : 4008                		shll2	r0
(2)  839/ 6000B40 : 006E                		mov	@(r6,r0),r0
(2)  840/ 6000B42 : 8151                		mov.w	r0,@(2,r5)
(2)  841/ 6000B44 : 4029                		shlr16	r0
(2)  842/ 6000B46 : 2501                		mov.w	r0,@r5
(2)  843/ 6000B48 : 7504                		add	#4,r5
(2)  836/ 6000B4A : 60B5                		mov.w	@r11+,r0			; Read UV index			
(2)  837/ 6000B4C : 600D                		extu	r0,r0
(2)  838/ 6000B4E : 4008                		shll2	r0
(2)  839/ 6000B50 : 006E                		mov	@(r6,r0),r0
(2)  840/ 6000B52 : 8151                		mov.w	r0,@(2,r5)
(2)  841/ 6000B54 : 4029                		shlr16	r0
(2)  842/ 6000B56 : 2501                		mov.w	r0,@r5
(2)  843/ 6000B58 : 7504                		add	#4,r5
(2)  845/ 6000B5A : E003                		mov	#3,r0			; Triangle?
(2)  846/ 6000B5C : 3700                		cmp/eq	r0,r7
(2)  847/ 6000B5E : 8906                		bt	.alluvdone
(2)  848/ 6000B60 : 60B5                		mov.w	@r11+,r0			; Read UV index			
(2)  849/ 6000B62 : 600D                		extu	r0,r0
(2)  850/ 6000B64 : 4008                		shll2	r0
(2)  851/ 6000B66 : 006E                		mov	@(r6,r0),r0
(2)  852/ 6000B68 : 8151                		mov.w	r0,@(2,r5)
(2)  853/ 6000B6A : 4029                		shlr16	r0
(2)  854/ 6000B6C : 2501                		mov.w	r0,@r5
(2)  855/ 6000B6E :                     .alluvdone:
(2)  856/ 6000B6E :                     
(2)  857/ 6000B6E : 6043                		mov	r4,r0
(2)  858/ 6000B70 : 95A9                		mov	#$1FFF,r5
(2)  859/ 6000B72 : 2059                		and	r5,r0
(2)  860/ 6000B74 : 4008                		shll2	r0
(2)  861/ 6000B76 : 4000                		shll	r0
(2)  862/ 6000B78 : 56C4                		mov	@($10,r12),r6
(2)  863/ 6000B7A : 360C                		add	r0,r6
(2)  864/ 6000B7C : D04E                		mov	#$E000,r0		; grab special bits
(2)  865/ 6000B7E : 2409                		and	r0,r4
(2)  866/ 6000B80 : 4428                		shll16	r4
(2)  867/ 6000B82 : 5061                		mov	@(4,r6),r0
(2)  868/ 6000B84 : 240B                		or	r0,r4
(2)  869/ 6000B86 : 1D40                		mov	r4,@(polygn_type,r13)
(2)  870/ 6000B88 : 6062                		mov	@r6,r0
(2)  871/ 6000B8A : 1D01                		mov	r0,@(polygn_mtrl,r13)
(2)  872/ 6000B8C : A007                		bra	.go_faces
(2)  873/ 6000B8E : 0009                		nop
(2)  874/ 6000B90 :                     
(2)  875/ 6000B90 :                     ; --------------------------------
(2)  876/ 6000B90 :                     ; Set texture material
(2)  877/ 6000B90 :                     ; --------------------------------
(2)  878/ 6000B90 :                     
(2)  879/ 6000B90 :                     .solid_type:
(2)  880/ 6000B90 : 6043                		mov	r4,r0
(2)  881/ 6000B92 : D549                		mov	#$E000,r5
(2)  882/ 6000B94 : 2459                		and	r5,r4
(2)  883/ 6000B96 : 4428                		shll16	r4
(2)  884/ 6000B98 : 1D40                		mov	r4,@(polygn_type,r13)		; Set type 0 (tri) or quad (1)
(2)  885/ 6000B9A : C9FF                		and	#$FF,r0
(2)  886/ 6000B9C : 1D01                		mov	r0,@(polygn_mtrl,r13)		; Set pixel color (0-255)
(2)  887/ 6000B9E :                     
(2)  888/ 6000B9E :                     ; --------------------------------
(2)  889/ 6000B9E :                     ; Read faces
(2)  890/ 6000B9E :                     ; --------------------------------
(2)  891/ 6000B9E :                     
(2)  892/ 6000B9E :                     .go_faces:
(2)  893/ 6000B9E : 61D3                		mov	r13,r1
(2)  894/ 6000BA0 : 7108                		add 	#polygn_points,r1
(2)  895/ 6000BA2 : 66B3                		mov	r11,r6
(2)  896/ 6000BA4 : 6073                		mov	r7,r0
(2)  897/ 6000BA6 : 4000                		shll	r0
(2)  898/ 6000BA8 : 3B0C                		add	r0,r11
(2)  899/ 6000BAA : 2F86                		mov 	r8,@-r15
(2)  900/ 6000BAC : 2F96                		mov 	r9,@-r15
(2)  901/ 6000BAE : 2FB6                		mov 	r11,@-r15
(2)  902/ 6000BB0 : 2FC6                		mov 	r12,@-r15
(2)  903/ 6000BB2 : 2FD6                		mov 	r13,@-r15
(2)  904/ 6000BB4 : 9888                		mov	#-160,r8
(2)  905/ 6000BB6 : 698B                		neg	r8,r9
(2)  906/ 6000BB8 : EB90                		mov	#-112,r11
(2)  907/ 6000BBA : 6CBB                		neg	r11,r12
(2)  908/ 6000BBC : D53F                		mov	#$7FFFFFFF,r5
(2)  909/ 6000BBE : EDFF                		mov	#$FFFFFFFF,r13
(2)  910/ 6000BC0 :                     
(2)  911/ 6000BC0 :                     	; New method, might speed up
(2)  912/ 6000BC0 :                     	; a little...
(2)  913/ 6000BC0 :                     	rept 3
(2)  914/ 6000BC0 :                     		mov	#0,r0
(2)  915/ 6000BC0 :                     		mov.w 	@r6+,r0
(2)  916/ 6000BC0 :                     		mov	#$C,r4
(2)  917/ 6000BC0 :                     		mulu	r4,r0
(2)  918/ 6000BC0 :                     		sts	macl,r0
(2)  919/ 6000BC0 :                     		mov	r10,r4
(2)  920/ 6000BC0 :                     		add 	r0,r4
(2)  921/ 6000BC0 :                     		mov	@r4,r2
(2)  922/ 6000BC0 :                     		mov	@(4,r4),r3
(2)  923/ 6000BC0 :                     		mov	@(8,r4),r4
(2)  924/ 6000BC0 :                     		bsr	mdlrd_setpoint
(2)  925/ 6000BC0 :                     		nop
(2)  926/ 6000BC0 :                     		mov	r2,@r1
(2)  927/ 6000BC0 :                     		mov	r3,@(4,r1)
(2)  928/ 6000BC0 :                     		add	#8,r1
(2)  929/ 6000BC0 :                     	endm
(2)  914/ 6000BC0 : E000                		mov	#0,r0
(2)  915/ 6000BC2 : 6065                		mov.w 	@r6+,r0
(2)  916/ 6000BC4 : E40C                		mov	#$C,r4
(2)  917/ 6000BC6 : 204E                		mulu	r4,r0
(2)  918/ 6000BC8 : 001A                		sts	macl,r0
(2)  919/ 6000BCA : 64A3                		mov	r10,r4
(2)  920/ 6000BCC : 340C                		add 	r0,r4
(2)  921/ 6000BCE : 6242                		mov	@r4,r2
(2)  922/ 6000BD0 : 5341                		mov	@(4,r4),r3
(2)  923/ 6000BD2 : 5442                		mov	@(8,r4),r4
(2)  924/ 6000BD4 : B07A                		bsr	mdlrd_setpoint
(2)  925/ 6000BD6 : 0009                		nop
(2)  926/ 6000BD8 : 2122                		mov	r2,@r1
(2)  927/ 6000BDA : 1131                		mov	r3,@(4,r1)
(2)  928/ 6000BDC : 7108                		add	#8,r1
(2)  914/ 6000BDE : E000                		mov	#0,r0
(2)  915/ 6000BE0 : 6065                		mov.w 	@r6+,r0
(2)  916/ 6000BE2 : E40C                		mov	#$C,r4
(2)  917/ 6000BE4 : 204E                		mulu	r4,r0
(2)  918/ 6000BE6 : 001A                		sts	macl,r0
(2)  919/ 6000BE8 : 64A3                		mov	r10,r4
(2)  920/ 6000BEA : 340C                		add 	r0,r4
(2)  921/ 6000BEC : 6242                		mov	@r4,r2
(2)  922/ 6000BEE : 5341                		mov	@(4,r4),r3
(2)  923/ 6000BF0 : 5442                		mov	@(8,r4),r4
(2)  924/ 6000BF2 : B06B                		bsr	mdlrd_setpoint
(2)  925/ 6000BF4 : 0009                		nop
(2)  926/ 6000BF6 : 2122                		mov	r2,@r1
(2)  927/ 6000BF8 : 1131                		mov	r3,@(4,r1)
(2)  928/ 6000BFA : 7108                		add	#8,r1
(2)  914/ 6000BFC : E000                		mov	#0,r0
(2)  915/ 6000BFE : 6065                		mov.w 	@r6+,r0
(2)  916/ 6000C00 : E40C                		mov	#$C,r4
(2)  917/ 6000C02 : 204E                		mulu	r4,r0
(2)  918/ 6000C04 : 001A                		sts	macl,r0
(2)  919/ 6000C06 : 64A3                		mov	r10,r4
(2)  920/ 6000C08 : 340C                		add 	r0,r4
(2)  921/ 6000C0A : 6242                		mov	@r4,r2
(2)  922/ 6000C0C : 5341                		mov	@(4,r4),r3
(2)  923/ 6000C0E : 5442                		mov	@(8,r4),r4
(2)  924/ 6000C10 : B05C                		bsr	mdlrd_setpoint
(2)  925/ 6000C12 : 0009                		nop
(2)  926/ 6000C14 : 2122                		mov	r2,@r1
(2)  927/ 6000C16 : 1131                		mov	r3,@(4,r1)
(2)  928/ 6000C18 : 7108                		add	#8,r1
(2)  930/ 6000C1A : E003                		mov	#3,r0			; Triangle?
(2)  931/ 6000C1C : 3700                		cmp/eq	r0,r7
(2)  932/ 6000C1E : 890D                		bt	.allfcsdone
(2)  933/ 6000C20 : E000                		mov	#0,r0			; Do forth point for Quad
(2)  934/ 6000C22 : 6065                		mov.w 	@r6+,r0
(2)  935/ 6000C24 : E40C                		mov	#$C,r4
(2)  936/ 6000C26 : 204E                		mulu	r4,r0
(2)  937/ 6000C28 : 001A                		sts	macl,r0
(2)  938/ 6000C2A : 64A3                		mov	r10,r4
(2)  939/ 6000C2C : 340C                		add 	r0,r4
(2)  940/ 6000C2E : 6242                		mov	@r4,r2
(2)  941/ 6000C30 : 5341                		mov	@(4,r4),r3
(2)  942/ 6000C32 : 5442                		mov	@(8,r4),r4
(2)  943/ 6000C34 : B04A                		bsr	mdlrd_setpoint
(2)  944/ 6000C36 : 0009                		nop
(2)  945/ 6000C38 : 2122                		mov	r2,@r1
(2)  946/ 6000C3A : 1131                		mov	r3,@(4,r1)
(2)  947/ 6000C3C :                     .allfcsdone:
(2)  948/ 6000C3C :                     
(2)  949/ 6000C3C : 6183                		mov	r8,r1
(2)  950/ 6000C3E : 6293                		mov	r9,r2
(2)  951/ 6000C40 : 63B3                		mov	r11,r3
(2)  952/ 6000C42 : 64C3                		mov	r12,r4
(2)  953/ 6000C44 : 66D3                		mov	r13,r6
(2)  954/ 6000C46 : 6DF6                		mov	@r15+,r13
(2)  955/ 6000C48 : 6CF6                		mov	@r15+,r12
(2)  956/ 6000C4A : 6BF6                		mov	@r15+,r11
(2)  957/ 6000C4C : 69F6                		mov	@r15+,r9
(2)  958/ 6000C4E : 68F6                		mov	@r15+,r8
(2)  959/ 6000C50 :                     		
(2)  960/ 6000C50 :                     	; NOTE: if you don't like how the perspective works
(2)  961/ 6000C50 :                     	; change this register depending how you want to ignore
(2)  962/ 6000C50 :                     	; faces closer to the camera:
(2)  963/ 6000C50 :                     	; 
(2)  964/ 6000C50 :                     	; r5 - Back Z point, keep affine limitations
(2)  965/ 6000C50 :                     	; r6 - Front Z point, skip face but larger faces are affected
(2)  966/ 6000C50 : 4511                		cmp/pz	r5
(2)  967/ 6000C52 : 8924                		bt	.face_out
(2)  968/ 6000C54 : D01A                		mov	#RAM_Mars_ObjCamera,r0
(2)  969/ 6000C56 : 5701                		mov	@(cam_y_pos,r0),r7
(2)  970/ 6000C58 : 4709                		shlr2	r7
(2)  971/ 6000C5A : 4709                		shlr2	r7
(2)  972/ 6000C5C : 4709                		shlr2	r7
(2)  973/ 6000C5E : 4701                		shlr	r7
(2)  974/ 6000C60 : 677F                		exts	r7,r7
(2)  975/ 6000C62 : 4715                		cmp/pl	r7
(2)  976/ 6000C64 : 8B00                		bf	.revrscam
(2)  977/ 6000C66 : 677B                		neg	r7,r7
(2)  978/ 6000C68 :                     .revrscam:
(2)  979/ 6000C68 : 9027                		mov	#MAX_ZDIST,r0
(2)  980/ 6000C6A : 3703                		cmp/ge	r0,r7
(2)  981/ 6000C6C : 8900                		bt	.camlimit
(2)  982/ 6000C6E : 6703                		mov	r0,r7
(2)  983/ 6000C70 :                     .camlimit:
(2)  984/ 6000C70 :                     ; 		cmp/pl	r6
(2)  985/ 6000C70 :                     ; 		bt	.face_out
(2)  986/ 6000C70 : 9023                		mov	#MAX_ZDIST,r0		; Draw distance
(2)  987/ 6000C72 : 307C                		add 	r7,r0
(2)  988/ 6000C74 : 3503                		cmp/ge	r0,r5
(2)  989/ 6000C76 : 8B12                		bf	.face_out
(2)  990/ 6000C78 :                     		
(2)  991/ 6000C78 : 9026                		mov	#-(SCREEN_WIDTH/2),r0
(2)  992/ 6000C7A : 3107                		cmp/gt	r0,r1
(2)  993/ 6000C7C : 8B0F                		bf	.face_out
(2)  994/ 6000C7E : 600B                		neg	r0,r0
(2)  995/ 6000C80 : 3203                		cmp/ge	r0,r2
(2)  996/ 6000C82 : 890C                		bt	.face_out
(2)  997/ 6000C84 : E090                		mov	#-(SCREEN_HEIGHT/2),r0
(2)  998/ 6000C86 : 3307                		cmp/gt	r0,r3
(2)  999/ 6000C88 : 8B09                		bf	.face_out
(2) 1000/ 6000C8A : 600B                		neg	r0,r0
(2) 1001/ 6000C8C : 3403                		cmp/ge	r0,r4
(2) 1002/ 6000C8E : 8906                		bt	.face_out
(2) 1003/ 6000C90 :                     
(2) 1004/ 6000C90 :                     ; --------------------------------
(2) 1005/ 6000C90 :                     
(2) 1006/ 6000C90 :                     .face_ok:
(2) 1007/ 6000C90 : C50A                		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0	; Add 1 face to the list
(2) 1008/ 6000C92 : 7001                		add	#1,r0
(2) 1009/ 6000C94 : C10A                		mov.w	r0,@(marsGbl_MdlFacesCntr,gbr)
(2) 1010/ 6000C96 : 2852                		mov	r5,@r8				; Store current Z to Zlist
(2) 1011/ 6000C98 : 18D1                		mov	r13,@(4,r8)			; And it's address
(2) 1012/ 6000C9A : 7808                		add	#8,r8
(2) 1013/ 6000C9C : 7D38                		add	#sizeof_polygn,r13
(2) 1014/ 6000C9E :                     .face_out:
(2) 1015/ 6000C9E : 4910                		dt	r9
(2) 1016/ 6000CA0 : 8901                		bt	.finish_this
(2) 1017/ 6000CA2 : AF2F                		bra	.next_face
(2) 1018/ 6000CA4 : 0009                		nop
(2) 1019/ 6000CA6 :                     .finish_this:
(2) 1020/ 6000CA6 : 6083                		mov	r8,r0
(2) 1021/ 6000CA8 : C202                		mov	r0,@(marsGbl_CurrZList,gbr)
(2) 1022/ 6000CAA : 60D3                		mov	r13,r0
(2) 1023/ 6000CAC : C203                		mov	r0,@(marsGbl_CurrFacePos,gbr)
(2) 1024/ 6000CAE :                     .exit_model:
(2) 1025/ 6000CAE : 4F26                		lds	@r15+,pr
(2) 1026/ 6000CB0 : 000B                		rts
(2) 1027/ 6000CB2 : 0009                		nop
(2) 1028/ 6000CB4 :                     		align 4
(2) 1029/ 6000CB4 : 3FFF FFFF 0000 E000 		ltorg
                    7FFF FFFF 0601 1554 
                    0100 1FFF FF60      
(2) 1030/ 6000CCA :                     
(2) 1031/ 6000CCA :                     ; ----------------------------------------	
(2) 1032/ 6000CCA :                     ; Modify position to current point
(2) 1033/ 6000CCA :                     ; ----------------------------------------
(2) 1034/ 6000CCA :                     
(2) 1035/ 6000CCA :                     		align 4
(2) 1036/ 6000CCC :                     mdlrd_setpoint:
(2) 1037/ 6000CCC : 4F22                		sts	pr,@-r15
(2) 1038/ 6000CCE : 2F56                		mov 	r5,@-r15
(2) 1039/ 6000CD0 : 2F66                		mov 	r6,@-r15
(2) 1040/ 6000CD2 : 2F76                		mov 	r7,@-r15
(2) 1041/ 6000CD4 : 2F86                		mov 	r8,@-r15
(2) 1042/ 6000CD6 : 2F96                		mov 	r9,@-r15
(2) 1043/ 6000CD8 : 2FA6                		mov 	r10,@-r15
(2) 1044/ 6000CDA : 2FB6                		mov 	r11,@-r15
(2) 1045/ 6000CDC :                     		
(2) 1046/ 6000CDC :                     	; Object rotation
(2) 1047/ 6000CDC : 6523                		mov	r2,r5			; r5 - X
(2) 1048/ 6000CDE : 6643                		mov	r4,r6			; r6 - Z
(2) 1049/ 6000CE0 : 50E4                  		mov 	@(mdl_x_rot,r14),r0
(2) 1050/ 6000CE2 : 4009                  		shlr2	r0
(2) 1051/ 6000CE4 : 4001                  		shlr	r0
(2) 1052/ 6000CE6 : B0A1                  		bsr	mdlrd_rotate
(2) 1053/ 6000CE8 : 4019                		shlr8	r0
(2) 1054/ 6000CEA : 6273                   		mov	r7,r2
(2) 1055/ 6000CEC : 6533                   		mov	r3,r5
(2) 1056/ 6000CEE : 6683                  		mov	r8,r6
(2) 1057/ 6000CF0 : 50E5                  		mov 	@(mdl_y_rot,r14),r0
(2) 1058/ 6000CF2 : 4009                  		shlr2	r0
(2) 1059/ 6000CF4 : 4001                  		shlr	r0
(2) 1060/ 6000CF6 : B099                  		bsr	mdlrd_rotate
(2) 1061/ 6000CF8 : 4019                		shlr8	r0
(2) 1062/ 6000CFA : 6483                   		mov	r8,r4
(2) 1063/ 6000CFC : 6523                   		mov	r2,r5
(2) 1064/ 6000CFE : 6673                   		mov	r7,r6
(2) 1065/ 6000D00 : 50E6                   		mov 	@(mdl_z_rot,r14),r0
(2) 1066/ 6000D02 : 4009                  		shlr2	r0
(2) 1067/ 6000D04 : 4001                  		shlr	r0
(2) 1068/ 6000D06 : B091                  		bsr	mdlrd_rotate
(2) 1069/ 6000D08 : 4019                		shlr8	r0
(2) 1070/ 6000D0A : 6273                   		mov	r7,r2
(2) 1071/ 6000D0C : 6383                   		mov	r8,r3
(2) 1072/ 6000D0E : 55E1                		mov	@(mdl_x_pos,r14),r5
(2) 1073/ 6000D10 : 56E2                		mov	@(mdl_y_pos,r14),r6
(2) 1074/ 6000D12 : 57E3                		mov	@(mdl_z_pos,r14),r7
(2) 1075/ 6000D14 : 4519                		shlr8	r5
(2) 1076/ 6000D16 : 4619                		shlr8	r6
(2) 1077/ 6000D18 : 4719                		shlr8	r7
(2) 1078/ 6000D1A : 655F                		exts	r5,r5
(2) 1079/ 6000D1C : 666F                		exts	r6,r6		
(2) 1080/ 6000D1E : 677F                		exts	r7,r7		
(2) 1081/ 6000D20 : 325C                		add 	r5,r2
(2) 1082/ 6000D22 : 336C                		add 	r6,r3
(2) 1083/ 6000D24 : 347C                		add 	r7,r4
(2) 1084/ 6000D26 :                     
(2) 1085/ 6000D26 :                     	; Include camera changes
(2) 1086/ 6000D26 : DB3D                		mov 	#RAM_Mars_ObjCamera,r11
(2) 1087/ 6000D28 : 55B0                		mov	@(cam_x_pos,r11),r5
(2) 1088/ 6000D2A : 56B1                		mov	@(cam_y_pos,r11),r6
(2) 1089/ 6000D2C : 57B2                		mov	@(cam_z_pos,r11),r7
(2) 1090/ 6000D2E : 50E0                		mov	@(mdl_data,r14),r0		; Layout object?
(2) 1091/ 6000D30 : 4000                		shll	r0
(2) 1092/ 6000D32 : 4015                		cmp/pl	r0
(2) 1093/ 6000D34 : 8902                		bt	.lay_move
(2) 1094/ 6000D36 : D03A                		mov	#$FFFFF,r0			; Limit camera movement
(2) 1095/ 6000D38 : 2509                		and	r0,r5
(2) 1096/ 6000D3A :                     ; 		and	r0,r6
(2) 1097/ 6000D3A : 2709                		and	r0,r7
(2) 1098/ 6000D3C :                     .lay_move:
(2) 1099/ 6000D3C : 4519                		shlr8	r5
(2) 1100/ 6000D3E : 4619                		shlr8	r6
(2) 1101/ 6000D40 : 4719                		shlr8	r7
(2) 1102/ 6000D42 : 655F                		exts	r5,r5
(2) 1103/ 6000D44 : 666F                		exts	r6,r6		
(2) 1104/ 6000D46 : 677F                		exts	r7,r7
(2) 1105/ 6000D48 : 3258                		sub 	r5,r2
(2) 1106/ 6000D4A : 3368                		sub 	r6,r3
(2) 1107/ 6000D4C : 347C                		add 	r7,r4
(2) 1108/ 6000D4E :                     
(2) 1109/ 6000D4E : 6523                		mov	r2,r5
(2) 1110/ 6000D50 : 6643                		mov	r4,r6
(2) 1111/ 6000D52 : 50B3                  		mov 	@(cam_x_rot,r11),r0
(2) 1112/ 6000D54 : 4009                  		shlr2	r0
(2) 1113/ 6000D56 : 4001                  		shlr	r0
(2) 1114/ 6000D58 : B068                  		bsr	mdlrd_rotate
(2) 1115/ 6000D5A : 4019                		shlr8	r0
(2) 1116/ 6000D5C : 6273                   		mov	r7,r2
(2) 1117/ 6000D5E : 6483                   		mov	r8,r4
(2) 1118/ 6000D60 : 6533                   		mov	r3,r5
(2) 1119/ 6000D62 : 6683                  		mov	r8,r6
(2) 1120/ 6000D64 : 50B4                  		mov 	@(cam_y_rot,r11),r0
(2) 1121/ 6000D66 : 4009                  		shlr2	r0
(2) 1122/ 6000D68 : 4001                  		shlr	r0
(2) 1123/ 6000D6A : B05F                  		bsr	mdlrd_rotate
(2) 1124/ 6000D6C : 4019                		shlr8	r0
(2) 1125/ 6000D6E : 6483                   		mov	r8,r4
(2) 1126/ 6000D70 : 6523                   		mov	r2,r5
(2) 1127/ 6000D72 : 6673                   		mov	r7,r6
(2) 1128/ 6000D74 : 50B5                   		mov 	@(cam_z_rot,r11),r0
(2) 1129/ 6000D76 : 4009                  		shlr2	r0
(2) 1130/ 6000D78 : 4001                  		shlr	r0
(2) 1131/ 6000D7A : B057                  		bsr	mdlrd_rotate
(2) 1132/ 6000D7C : 4019                		shlr8	r0
(2) 1133/ 6000D7E : 6273                   		mov	r7,r2
(2) 1134/ 6000D80 : 6383                   		mov	r8,r3
(2) 1135/ 6000D82 :                     
(2) 1136/ 6000D82 :                     	; Perspective projection
(2) 1137/ 6000D82 :                     	; NOT PERFECT, this is the best I got.
(2) 1138/ 6000D82 : 604B                		neg	r4,r0		; reverse Z
(2) 1139/ 6000D84 : 4015                		cmp/pl	r0
(2) 1140/ 6000D86 : 891D                		bt	.inside
(2) 1141/ 6000D88 : 964E                		mov	#$1FFF,r6
(2) 1142/ 6000D8A : 55B3                		mov	@(cam_x_rot,r11),r5
(2) 1143/ 6000D8C : 2569                		and	r6,r5
(2) 1144/ 6000D8E : 4521                		shar	r5
(2) 1145/ 6000D90 : 4521                		shar	r5
(2) 1146/ 6000D92 : 4521                		shar	r5
(2) 1147/ 6000D94 : 4521                		shar	r5		
(2) 1148/ 6000D96 : 6043                		mov	r4,r0
(2) 1149/ 6000D98 : 7040                		add 	#64,r0
(2) 1150/ 6000D9A : 4028                		shll16	r0
(2) 1151/ 6000D9C : 304C                		add	r4,r0
(2) 1152/ 6000D9E : 305C                		add	r5,r0
(2) 1153/ 6000DA0 : 6503                		mov	r0,r5
(2) 1154/ 6000DA2 : 325D                		dmuls	r5,r2
(2) 1155/ 6000DA4 : 000A                		sts	mach,r0
(2) 1156/ 6000DA6 : 021A                		sts	macl,r2
(2) 1157/ 6000DA8 : 220D                		xtrct	r0,r2
(2) 1158/ 6000DAA : 335D                		dmuls	r5,r3
(2) 1159/ 6000DAC : 000A                		sts	mach,r0
(2) 1160/ 6000DAE : 031A                		sts	macl,r3
(2) 1161/ 6000DB0 : 230D                		xtrct	r0,r3
(2) 1162/ 6000DB2 :                     	rept 3
(2) 1163/ 6000DB2 :                     		shar	r2
(2) 1164/ 6000DB2 :                     		shar	r3
(2) 1165/ 6000DB2 :                     	endm
(2) 1163/ 6000DB2 : 4221                		shar	r2
(2) 1164/ 6000DB4 : 4321                		shar	r3
(2) 1163/ 6000DB6 : 4221                		shar	r2
(2) 1164/ 6000DB8 : 4321                		shar	r3
(2) 1163/ 6000DBA : 4221                		shar	r2
(2) 1164/ 6000DBC : 4321                		shar	r3
(2) 1166/ 6000DBE : 74C0                		add	#-64,r4
(2) 1167/ 6000DC0 : A00F                		bra	.zmulti
(2) 1168/ 6000DC2 : 0009                		nop
(2) 1169/ 6000DC4 :                     .inside:
(2) 1170/ 6000DC4 : D717                		mov	#512<<16,r7
(2) 1171/ 6000DC6 : 9830                		mov 	#_JR,r8
(2) 1172/ 6000DC8 : 7040                		add 	#64,r0
(2) 1173/ 6000DCA : 2802                		mov 	r0,@r8
(2) 1174/ 6000DCC : 1871                		mov 	r7,@(4,r8)
(2) 1175/ 6000DCE : 0009                		nop
(2) 1176/ 6000DD0 : 5781                		mov 	@(4,r8),r7
(2) 1177/ 6000DD2 : 327D                		dmuls	r7,r2
(2) 1178/ 6000DD4 : 000A                		sts	mach,r0
(2) 1179/ 6000DD6 : 021A                		sts	macl,r2
(2) 1180/ 6000DD8 : 220D                		xtrct	r0,r2
(2) 1181/ 6000DDA : 337D                		dmuls	r7,r3
(2) 1182/ 6000DDC : 000A                		sts	mach,r0
(2) 1183/ 6000DDE : 031A                		sts	macl,r3
(2) 1184/ 6000DE0 : 230D                		xtrct	r0,r3
(2) 1185/ 6000DE2 :                     .zmulti:
(2) 1186/ 6000DE2 :                     
(2) 1187/ 6000DE2 : 6BF6                		mov	@r15+,r11
(2) 1188/ 6000DE4 : 6AF6                		mov	@r15+,r10
(2) 1189/ 6000DE6 : 69F6                		mov	@r15+,r9
(2) 1190/ 6000DE8 : 68F6                		mov	@r15+,r8
(2) 1191/ 6000DEA : 67F6                		mov	@r15+,r7
(2) 1192/ 6000DEC : 66F6                		mov	@r15+,r6
(2) 1193/ 6000DEE : 65F6                		mov	@r15+,r5
(2) 1194/ 6000DF0 :                     		
(2) 1195/ 6000DF0 :                     	; Set the most far limit points
(2) 1196/ 6000DF0 :                     	; for each direction (X,Y,Z)
(2) 1197/ 6000DF0 : 34D7                		cmp/gt	r13,r4
(2) 1198/ 6000DF2 : 8B00                		bf	.save_z2
(2) 1199/ 6000DF4 : 6D43                		mov	r4,r13
(2) 1200/ 6000DF6 :                     .save_z2:
(2) 1201/ 6000DF6 : 3457                		cmp/gt	r5,r4
(2) 1202/ 6000DF8 : 8900                		bt	.save_z
(2) 1203/ 6000DFA : 6543                		mov	r4,r5
(2) 1204/ 6000DFC :                     .save_z:
(2) 1205/ 6000DFC : 3287                		cmp/gt	r8,r2
(2) 1206/ 6000DFE : 8B00                		bf	.x_lw
(2) 1207/ 6000E00 : 6823                		mov	r2,r8
(2) 1208/ 6000E02 :                     .x_lw:
(2) 1209/ 6000E02 : 3297                		cmp/gt	r9,r2
(2) 1210/ 6000E04 : 8900                		bt	.x_rw
(2) 1211/ 6000E06 : 6923                		mov	r2,r9
(2) 1212/ 6000E08 :                     .x_rw:
(2) 1213/ 6000E08 : 33B7                		cmp/gt	r11,r3
(2) 1214/ 6000E0A : 8B00                		bf	.y_lw
(2) 1215/ 6000E0C : 6B33                		mov	r3,r11
(2) 1216/ 6000E0E :                     .y_lw:
(2) 1217/ 6000E0E : 33C7                		cmp/gt	r12,r3
(2) 1218/ 6000E10 : 8900                		bt	.y_rw
(2) 1219/ 6000E12 : 6C33                		mov	r3,r12
(2) 1220/ 6000E14 :                     .y_rw:
(2) 1221/ 6000E14 :                     
(2) 1222/ 6000E14 : 4F26                		lds	@r15+,pr
(2) 1223/ 6000E16 : 000B                		rts
(2) 1224/ 6000E18 : 0009                		nop
(2) 1225/ 6000E1A :                     		align 4
(2) 1226/ 6000E1C : 0601 1554 000F FFFF 		ltorg
                    0200 0000 1FFF FF00 
(2) 1227/ 6000E2C :                     
(2) 1228/ 6000E2C :                     ; ------------------------------
(2) 1229/ 6000E2C :                     ; Rotate point
(2) 1230/ 6000E2C :                     ;
(2) 1231/ 6000E2C :                     ; Entry:
(2) 1232/ 6000E2C :                     ; r5: x
(2) 1233/ 6000E2C :                     ; r6: y
(2) 1234/ 6000E2C :                     ; r0: theta
(2) 1235/ 6000E2C :                     ;
(2) 1236/ 6000E2C :                     ; Returns:
(2) 1237/ 6000E2C :                     ; r7: (x  cos @) + (y sin @)
(2) 1238/ 6000E2C :                     ; r8: (x -sin @) + (y cos @)
(2) 1239/ 6000E2C :                     ; ------------------------------
(2) 1240/ 6000E2C :                     
(2) 1241/ 6000E2C :                     mdlrd_rotate:
(2) 1242/ 6000E2C : 9740                    		mov	#$7FF,r7
(2) 1243/ 6000E2E : 2079                    		and	r7,r0
(2) 1244/ 6000E30 : 4008                   		shll2	r0
(2) 1245/ 6000E32 : D71A                		mov	#sin_table,r7
(2) 1246/ 6000E34 : D81A                		mov	#sin_table+$800,r8
(2) 1247/ 6000E36 : 097E                		mov	@(r0,r7),r9
(2) 1248/ 6000E38 : 0A8E                		mov	@(r0,r8),r10
(2) 1249/ 6000E3A :                     
(2) 1250/ 6000E3A : 3A5D                		dmuls	r5,r10		; x cos @
(2) 1251/ 6000E3C : 071A                		sts	macl,r7
(2) 1252/ 6000E3E : 000A                		sts	mach,r0
(2) 1253/ 6000E40 : 270D                		xtrct	r0,r7
(2) 1254/ 6000E42 : 396D                		dmuls	r6,r9		; y sin @
(2) 1255/ 6000E44 : 081A                		sts	macl,r8
(2) 1256/ 6000E46 : 000A                		sts	mach,r0
(2) 1257/ 6000E48 : 280D                		xtrct	r0,r8
(2) 1258/ 6000E4A : 378C                		add	r8,r7
(2) 1259/ 6000E4C :                     
(2) 1260/ 6000E4C : 699B                		neg	r9,r9
(2) 1261/ 6000E4E : 395D                		dmuls	r5,r9		; x -sin @
(2) 1262/ 6000E50 : 081A                		sts	macl,r8
(2) 1263/ 6000E52 : 000A                		sts	mach,r0
(2) 1264/ 6000E54 : 280D                		xtrct	r0,r8
(2) 1265/ 6000E56 : 3A6D                		dmuls	r6,r10		; y cos @
(2) 1266/ 6000E58 : 091A                		sts	macl,r9
(2) 1267/ 6000E5A : 000A                		sts	mach,r0
(2) 1268/ 6000E5C : 290D                		xtrct	r0,r9
(2) 1269/ 6000E5E : 389C                		add	r9,r8
(2) 1270/ 6000E60 : 000B                 		rts
(2) 1271/ 6000E62 : 0009                		nop
(2) 1272/ 6000E64 :                     		align 4
(2) 1273/ 6000E64 :                     	
(2) 1274/ 6000E64 :                     ; ------------------------------------------------
(2) 1275/ 6000E64 :                     ; MarsVideo_SetWatchdog
(2) 1276/ 6000E64 :                     ; 
(2) 1277/ 6000E64 :                     ; Starts interrupt for drawing the polygon pieces
(2) 1278/ 6000E64 :                     ; ------------------------------------------------
(2) 1279/ 6000E64 :                     
(2) 1280/ 6000E64 :                     MarsVideo_SetWatchdog:
(2) 1281/ 6000E64 : 4F03                		stc	sr,@-r15
(2) 1282/ 6000E66 : 0002                		stc	sr,r0
(2) 1283/ 6000E68 : CBF0                		or	#$F0,r0				; Disable interrupts first
(2) 1284/ 6000E6A : 400E                		ldc	r0,sr
(2) 1285/ 6000E6C : D00D                		mov	#RAM_Mars_VdpDrwList,r0		; Reset the piece-drawing pointer
(2) 1286/ 6000E6E : C200                		mov	r0,@(marsGbl_PlyPzList_R,gbr)	; on both READ and WRITE pointers
(2) 1287/ 6000E70 : C201                		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2) 1288/ 6000E72 : E000                		mov	#0,r0				; Reset polygon pieces counter
(2) 1289/ 6000E74 : C10C                		mov.w	r0,@(marsGbl_PzListCntr,gbr)
(2) 1290/ 6000E76 : D10C                		mov	#Cach_ClrLines,r1		; Line counter for the framebuffer-clear routine
(2) 1291/ 6000E78 : 901B                		mov	#224,r0
(2) 1292/ 6000E7A : 2102                		mov	r0,@r1
(2) 1293/ 6000E7C : E008                		mov	#8,r0				; Set starting watchdog task to $08 (Clear framebuffer)
(2) 1294/ 6000E7E : C10D                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2) 1295/ 6000E80 : D10A                		mov	#_vdpreg,r1
(2) 1296/ 6000E82 :                     .wait_fb:
(2) 1297/ 6000E82 : 8515                		mov.w	@($A,r1),r0			; Framebuffer available?
(2) 1298/ 6000E84 : C802                		tst	#2,r0
(2) 1299/ 6000E86 : 8BFC                		bf	.wait_fb
(2) 1300/ 6000E88 : 9014                		mov.w	#$A1,r0				; Pre-start SVDP fill line at address $A1
(2) 1301/ 6000E8A : 8113                		mov.w	r0,@(6,r1)
(2) 1302/ 6000E8C : 9113                		mov	#$FFFFFE80,r1
(2) 1303/ 6000E8E : 9013                		mov.w	#$5AFF,r0			; Watchdog wait timer
(2) 1304/ 6000E90 : 2101                		mov.w	r0,@r1
(2) 1305/ 6000E92 : 9012                		mov.w	#$A538,r0			; Enable watchdog
(2) 1306/ 6000E94 : 2101                		mov.w	r0,@r1
(2) 1307/ 6000E96 : 4F07                		ldc	@r15+,sr			; Restore interrupts
(2) 1308/ 6000E98 : 000B                		rts
(2) 1309/ 6000E9A : 0009                		nop
(2) 1310/ 6000E9C :                     		align 4
(2) 1311/ 6000E9C : 0600 1C60 0600 2460 		ltorg
                    0601 909C C000 075C 
                    2000 4100 07FF 00E0 
                    00A1 FE80 5AFF A538 
(2) 1312/ 6000EBC :                     
(2) 1313/ 6000EBC :                     ; ====================================================================
(2) 1314/ 6000EBC :                     ; ----------------------------------------------------------------
(2) 1315/ 6000EBC :                     ; Video CACHE routines for Master CPU
(2) 1316/ 6000EBC :                     ; ----------------------------------------------------------------
(2) 1317/ 6000EBC :                     
(2) 1318/ 6000EBC :                     		align 4
(2) 1319/ 6000EBC :                     CACHE_MASTER:
(2) 1320/FFFFFFFFC0000000 :                     		phase $C0000000
(2) 1321/FFFFFFFFC0000000 :                     
(2) 1322/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2) 1323/FFFFFFFFC0000000 :                     ; MASTER Background tasks
(2) 1324/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2) 1325/FFFFFFFFC0000000 :                     
(2) 1326/FFFFFFFFC0000000 :                     ; Cache_OnInterrupt:
(2) 1327/FFFFFFFFC0000000 :                     m_irq_custom:
(2) 1328/FFFFFFFFC0000000 : 912C                		mov	#_FRT,r1
(2) 1329/FFFFFFFFC0000002 : 8417                		mov.b	@(7,r1), r0
(2) 1330/FFFFFFFFC0000004 : CA02                		xor	#2,r0
(2) 1331/FFFFFFFFC0000006 : 8017                		mov.b	r0,@(7,r1)
(2) 1332/FFFFFFFFC0000008 : C50D                		mov.w	@(marsGbl_DrwTask,gbr),r0	; Framebuffer clear request ($08)?
(2) 1333/FFFFFFFFC000000A : 8808                		cmp/eq	#8,r0
(2) 1334/FFFFFFFFC000000C : 8B2B                		bf	maindrw_tasks
(2) 1335/FFFFFFFFC000000E :                     
(2) 1336/FFFFFFFFC000000E :                     ; --------------------------------
(2) 1337/FFFFFFFFC000000E :                     ; TASK $08 - Clear Framebuffer
(2) 1338/FFFFFFFFC000000E :                     ; --------------------------------
(2) 1339/FFFFFFFFC000000E :                     
(2) 1340/FFFFFFFFC000000E :                     ; .task_08:
(2) 1341/FFFFFFFFC000000E : 2F26                		mov	r2,@-r15
(2) 1342/FFFFFFFFC0000010 : D110                		mov	#_vdpreg,r1
(2) 1343/FFFFFFFFC0000012 : C422                		mov.b	@(marsGbl_CurrFb,gbr),r0
(2) 1344/FFFFFFFFC0000014 : 6203                		mov	r0,r2
(2) 1345/FFFFFFFFC0000016 : 841B                .wait_frmswp:	mov.b	@(framectl,r1),r0
(2) 1346/FFFFFFFFC0000018 : 3200                		cmp/eq	r0,r2
(2) 1347/FFFFFFFFC000001A : 8BFC                		bf	.wait_frmswp
(2) 1348/FFFFFFFFC000001C : 8515                .wait_fb:	mov.w   @($A,r1), r0		; Framebuffer free?
(2) 1349/FFFFFFFFC000001E : C802                		tst     #2,r0
(2) 1350/FFFFFFFFC0000020 : 8BFC                		bf      .wait_fb
(2) 1351/FFFFFFFFC0000022 : 8513                		mov.w   @(6,r1),r0		; SVDP-fill address
(2) 1352/FFFFFFFFC0000024 : 705F                		add     #$5F,r0			; Preincrement
(2) 1353/FFFFFFFFC0000026 : 8113                		mov.w   r0,@(6,r1)
(2) 1354/FFFFFFFFC0000028 : 9019                		mov.w   #320/2,r0		; SVDP-fill size (320 pixels)
(2) 1355/FFFFFFFFC000002A : 8112                		mov.w   r0,@(4,r1)
(2) 1356/FFFFFFFFC000002C : E000                		mov     #0,r0			; SVDP-fill pixel data and start filling
(2) 1357/FFFFFFFFC000002E : 8114                		mov.w   r0,@(8,r1)		; After finishing, SVDP-address got updated
(2) 1358/FFFFFFFFC0000030 : 9116                		mov.l   #$FFFFFE80,r1
(2) 1359/FFFFFFFFC0000032 : 9016                		mov.w   #$A518,r0		; OFF
(2) 1360/FFFFFFFFC0000034 : 2101                		mov.w   r0,@r1
(2) 1361/FFFFFFFFC0000036 : CB20                		or      #$20,r0			; ON
(2) 1362/FFFFFFFFC0000038 : 2101                		mov.w   r0,@r1
(2) 1363/FFFFFFFFC000003A : 9013                		mov.w   #$5A10,r0
(2) 1364/FFFFFFFFC000003C : 2101                		mov.w   r0,@r1
(2) 1365/FFFFFFFFC000003E : D106                		mov	#Cach_ClrLines,r1	; Decrement a line to progress
(2) 1366/FFFFFFFFC0000040 : 6012                		mov	@r1,r0
(2) 1367/FFFFFFFFC0000042 : 4010                		dt	r0
(2) 1368/FFFFFFFFC0000044 : 8F02                		bf/s	.on_clr
(2) 1369/FFFFFFFFC0000046 : 2102                		mov	r0,@r1
(2) 1370/FFFFFFFFC0000048 : E001                		mov	#1,r0			; If finished: set task $01
(2) 1371/FFFFFFFFC000004A : C10D                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2) 1372/FFFFFFFFC000004C :                     .on_clr:
(2) 1373/FFFFFFFFC000004C : 62F6                		mov	@r15+,r2
(2) 1374/FFFFFFFFC000004E : 000B                		rts
(2) 1375/FFFFFFFFC0000050 : 0009                		nop
(2) 1376/FFFFFFFFC0000052 :                     		align 4
(2) 1377/FFFFFFFFC0000054 : 2000 4100 C000 075C 		ltorg
                    FE10 00A0 FE80 A518 
                    5A10                
(2) 1378/FFFFFFFFC0000066 :                     
(2) 1379/FFFFFFFFC0000066 :                     ; --------------------------------
(2) 1380/FFFFFFFFC0000066 :                     ; Main drawing routine
(2) 1381/FFFFFFFFC0000066 :                     ; --------------------------------
(2) 1382/FFFFFFFFC0000066 :                     
(2) 1383/FFFFFFFFC0000066 :                     maindrw_tasks:
(2) 1384/FFFFFFFFC0000066 : 4008                		shll2	r0
(2) 1385/FFFFFFFFC0000068 : D12B                		mov	#.list,r1
(2) 1386/FFFFFFFFC000006A : 001E                		mov	@(r1,r0),r0
(2) 1387/FFFFFFFFC000006C : 402B                		jmp	@r0
(2) 1388/FFFFFFFFC000006E : 0009                		nop
(2) 1389/FFFFFFFFC0000070 :                     		align 4
(2) 1390/FFFFFFFFC0000070 :                     .list:
(2) 1391/FFFFFFFFC0000070 : C000 00C0           		dc.l drwtsk_01		; (null entry, but failsafe)
(2) 1392/FFFFFFFFC0000074 : C000 00C0           		dc.l drwtsk_01		; Main drawing routine
(2) 1393/FFFFFFFFC0000078 : C000 007C           		dc.l drwtsk_02		; Resume from solid color
(2) 1394/FFFFFFFFC000007C :                     
(2) 1395/FFFFFFFFC000007C :                     ; --------------------------------
(2) 1396/FFFFFFFFC000007C :                     ; Task $02
(2) 1397/FFFFFFFFC000007C :                     ; --------------------------------
(2) 1398/FFFFFFFFC000007C :                     
(2) 1399/FFFFFFFFC000007C :                     ; TODO: currently it only resumes
(2) 1400/FFFFFFFFC000007C :                     ; from solid_color
(2) 1401/FFFFFFFFC000007C :                     
(2) 1402/FFFFFFFFC000007C :                     drwtsk_02:
(2) 1403/FFFFFFFFC000007C : 2F26                		mov	r2,@-r15
(2) 1404/FFFFFFFFC000007E : 2F36                		mov	r3,@-r15
(2) 1405/FFFFFFFFC0000080 : 2F46                		mov	r4,@-r15
(2) 1406/FFFFFFFFC0000082 : 2F56                		mov	r5,@-r15
(2) 1407/FFFFFFFFC0000084 : 2F66                		mov	r6,@-r15
(2) 1408/FFFFFFFFC0000086 : 2F76                		mov	r7,@-r15
(2) 1409/FFFFFFFFC0000088 : 2F86                		mov	r8,@-r15
(2) 1410/FFFFFFFFC000008A : 2F96                		mov	r9,@-r15
(2) 1411/FFFFFFFFC000008C : 2FA6                		mov	r10,@-r15
(2) 1412/FFFFFFFFC000008E : 2FB6                		mov	r11,@-r15
(2) 1413/FFFFFFFFC0000090 : 2FC6                		mov	r12,@-r15
(2) 1414/FFFFFFFFC0000092 : 2FD6                		mov	r13,@-r15
(2) 1415/FFFFFFFFC0000094 : 2FE6                		mov	r14,@-r15
(2) 1416/FFFFFFFFC0000096 : 4F12                		sts	macl,@-r15
(2) 1417/FFFFFFFFC0000098 : 4F02                		sts	mach,@-r15
(2) 1418/FFFFFFFFC000009A : D020                		mov	#Cach_LnDrw_L,r0
(2) 1419/FFFFFFFFC000009C : 6E06                		mov	@r0+,r14
(2) 1420/FFFFFFFFC000009E : 6D06                		mov	@r0+,r13
(2) 1421/FFFFFFFFC00000A0 : 6C06                		mov	@r0+,r12
(2) 1422/FFFFFFFFC00000A2 : 6B06                		mov	@r0+,r11
(2) 1423/FFFFFFFFC00000A4 : 6A06                		mov	@r0+,r10
(2) 1424/FFFFFFFFC00000A6 : 6906                		mov	@r0+,r9
(2) 1425/FFFFFFFFC00000A8 : 6806                		mov	@r0+,r8
(2) 1426/FFFFFFFFC00000AA : 6706                		mov	@r0+,r7
(2) 1427/FFFFFFFFC00000AC : 6606                		mov	@r0+,r6
(2) 1428/FFFFFFFFC00000AE : 6506                		mov	@r0+,r5
(2) 1429/FFFFFFFFC00000B0 : 6406                		mov	@r0+,r4
(2) 1430/FFFFFFFFC00000B2 : 6306                		mov	@r0+,r3
(2) 1431/FFFFFFFFC00000B4 : 6206                		mov	@r0+,r2
(2) 1432/FFFFFFFFC00000B6 : 6106                		mov	@r0+,r1
(2) 1433/FFFFFFFFC00000B8 : E001                		mov	#1,r0
(2) 1434/FFFFFFFFC00000BA : C10D                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2) 1435/FFFFFFFFC00000BC : A119                		bra	drwsld_updline
(2) 1436/FFFFFFFFC00000BE : 0009                		nop
(2) 1437/FFFFFFFFC00000C0 :                     
(2) 1438/FFFFFFFFC00000C0 :                     ; --------------------------------
(2) 1439/FFFFFFFFC00000C0 :                     ; Task $01
(2) 1440/FFFFFFFFC00000C0 :                     ; --------------------------------
(2) 1441/FFFFFFFFC00000C0 :                     
(2) 1442/FFFFFFFFC00000C0 :                     drwtsk_01:
(2) 1443/FFFFFFFFC00000C0 : 2F26                		mov	r2,@-r15
(2) 1444/FFFFFFFFC00000C2 : C50C                		mov.w	@(marsGbl_PzListCntr,gbr),r0	; Any pieces to draw?
(2) 1445/FFFFFFFFC00000C4 : 8800                		cmp/eq	#0,r0
(2) 1446/FFFFFFFFC00000C6 : 8B03                		bf	.has_pz
(2) 1447/FFFFFFFFC00000C8 : E000                		mov	#0,r0				; If none, just end quickly.
(2) 1448/FFFFFFFFC00000CA : C10D                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2) 1449/FFFFFFFFC00000CC : A135                		bra	drwtask_exit
(2) 1450/FFFFFFFFC00000CE : E27F                		mov	#$7F,r2
(2) 1451/FFFFFFFFC00000D0 :                     
(2) 1452/FFFFFFFFC00000D0 :                     .has_pz:
(2) 1453/FFFFFFFFC00000D0 : 2F36                		mov	r3,@-r15
(2) 1454/FFFFFFFFC00000D2 : 2F46                		mov	r4,@-r15
(2) 1455/FFFFFFFFC00000D4 : 2F56                		mov	r5,@-r15
(2) 1456/FFFFFFFFC00000D6 : 2F66                		mov	r6,@-r15
(2) 1457/FFFFFFFFC00000D8 : 2F76                		mov	r7,@-r15
(2) 1458/FFFFFFFFC00000DA : 2F86                		mov	r8,@-r15
(2) 1459/FFFFFFFFC00000DC : 2F96                		mov	r9,@-r15
(2) 1460/FFFFFFFFC00000DE : 2FA6                		mov	r10,@-r15
(2) 1461/FFFFFFFFC00000E0 : 2FB6                		mov	r11,@-r15
(2) 1462/FFFFFFFFC00000E2 : 2FC6                		mov	r12,@-r15
(2) 1463/FFFFFFFFC00000E4 : 2FD6                		mov	r13,@-r15
(2) 1464/FFFFFFFFC00000E6 : 2FE6                		mov	r14,@-r15
(2) 1465/FFFFFFFFC00000E8 : 4F12                		sts	macl,@-r15
(2) 1466/FFFFFFFFC00000EA : 4F02                		sts	mach,@-r15
(2) 1467/FFFFFFFFC00000EC :                     drwtsk1_newpz:
(2) 1468/FFFFFFFFC00000EC : C600                		mov	@(marsGbl_PlyPzList_R,gbr),r0	; r14 - Current pieces pointer to READ
(2) 1469/FFFFFFFFC00000EE : 6E03                		mov	r0,r14
(2) 1470/FFFFFFFFC00000F0 : 59E0                		mov	@(plypz_ypos,r14),r9		; Start grabbing StartY/EndY positions
(2) 1471/FFFFFFFFC00000F2 : 6A93                		mov	r9,r10
(2) 1472/FFFFFFFFC00000F4 : D00A                		mov	#$FFFF,r0
(2) 1473/FFFFFFFFC00000F6 : 4929                		shlr16	r9
(2) 1474/FFFFFFFFC00000F8 : 699F                		exts	r9,r9			;  r9 - Top
(2) 1475/FFFFFFFFC00000FA : 2A09                		and	r0,r10			; r10 - Bottom
(2) 1476/FFFFFFFFC00000FC : 3090                		cmp/eq	r9,r0			; if Top==Bottom, exit
(2) 1477/FFFFFFFFC00000FE : 8908                		bt	.invld_y
(2) 1478/FFFFFFFFC0000100 : 9010                		mov	#SCREEN_HEIGHT,r0	; if Top > 224, skip
(2) 1479/FFFFFFFFC0000102 : 3903                		cmp/ge	r0,r9
(2) 1480/FFFFFFFFC0000104 : 8905                		bt	.invld_y		; if Bottom > 224, add max limit
(2) 1481/FFFFFFFFC0000106 : 3A07                		cmp/gt	r0,r10
(2) 1482/FFFFFFFFC0000108 : 8B00                		bf	.len_max
(2) 1483/FFFFFFFFC000010A : 6A03                		mov	r0,r10
(2) 1484/FFFFFFFFC000010C :                     .len_max:
(2) 1485/FFFFFFFFC000010C : 3A98                		sub	r9,r10			; r10: Turn it into Y lenght (Bottom - Top)
(2) 1486/FFFFFFFFC000010E : 4A15                		cmp/pl	r10
(2) 1487/FFFFFFFFC0000110 : 8909                		bt	drwtsk1_vld_y
(2) 1488/FFFFFFFFC0000112 :                     .invld_y:
(2) 1489/FFFFFFFFC0000112 : A0F3                		bra	drwsld_nextpz		; if LEN < 0 then check next one instead.
(2) 1490/FFFFFFFFC0000114 : 0009                		nop
(2) 1491/FFFFFFFFC0000116 :                     		align 4
(2) 1492/FFFFFFFFC0000118 : C000 0070 C000 06C4 		ltorg
                    0000 FFFF 00E0      
(2) 1493/FFFFFFFFC0000126 :                     
(2) 1494/FFFFFFFFC0000126 :                     ; ------------------------------------
(2) 1495/FFFFFFFFC0000126 :                     ; If Y top / Y len are valid:
(2) 1496/FFFFFFFFC0000126 :                     ; ------------------------------------
(2) 1497/FFFFFFFFC0000126 :                     
(2) 1498/FFFFFFFFC0000126 :                     drwtsk1_vld_y:
(2) 1499/FFFFFFFFC0000126 : 51E1                		mov	@(plypz_xl,r14),r1		; r1 - X left
(2) 1500/FFFFFFFFC0000128 : 52E2                		mov	@(plypz_xl_dx,r14),r2		; r2 - DX left
(2) 1501/FFFFFFFFC000012A : 53E3                		mov	@(plypz_xr,r14),r3		; r3 - X right
(2) 1502/FFFFFFFFC000012C : 54E4                		mov	@(plypz_xr_dx,r14),r4		; r4 - DX right
(2) 1503/FFFFFFFFC000012E : 50EE                		mov	@(plypz_mtrlopt,r14),r0		; Check material options
(2) 1504/FFFFFFFFC0000130 : 4029                		shlr16	r0
(2) 1505/FFFFFFFFC0000132 : 4019                		shlr8	r0
(2) 1506/FFFFFFFFC0000134 : C880                 		tst	#PLGN_TEXURE,r0			; Texture mode?
(2) 1507/FFFFFFFFC0000136 : 8B01                 		bf	drwtsk_texmode
(2) 1508/FFFFFFFFC0000138 : A086                		bra	drwtsk_solidmode
(2) 1509/FFFFFFFFC000013A : 0009                		nop
(2) 1510/FFFFFFFFC000013C :                     
(2) 1511/FFFFFFFFC000013C :                     ; ------------------------------------
(2) 1512/FFFFFFFFC000013C :                     ; Texture mode
(2) 1513/FFFFFFFFC000013C :                     ; 
(2) 1514/FFFFFFFFC000013C :                     ; r1  - XL
(2) 1515/FFFFFFFFC000013C :                     ; r2  - XL DX
(2) 1516/FFFFFFFFC000013C :                     ; r3  - XR
(2) 1517/FFFFFFFFC000013C :                     ; r4  - XR DX
(2) 1518/FFFFFFFFC000013C :                     ; r5  - SRC XL
(2) 1519/FFFFFFFFC000013C :                     ; r6  - SRC XR
(2) 1520/FFFFFFFFC000013C :                     ; r7  - SRC YL
(2) 1521/FFFFFFFFC000013C :                     ; r8  - SRC YR
(2) 1522/FFFFFFFFC000013C :                     ; r9  - Y current
(2) 1523/FFFFFFFFC000013C :                     ; r10  - Number of lines
(2) 1524/FFFFFFFFC000013C :                     ; ------------------------------------
(2) 1525/FFFFFFFFC000013C :                     
(2) 1526/FFFFFFFFC000013C :                     drwtsk_texmode:
(2) 1527/FFFFFFFFC000013C : C510                		mov.w	@(marsGbl_DivReq_M,gbr),r0	; Waste interrupt if MarsVideo_MakePolygon is in the
(2) 1528/FFFFFFFFC000013E : 8801                		cmp/eq	#1,r0				; middle of division
(2) 1529/FFFFFFFFC0000140 : 8B02                		bf	.texvalid
(2) 1530/FFFFFFFFC0000142 : A0EC                		bra	drwtask_return
(2) 1531/FFFFFFFFC0000144 : 0009                		nop
(2) 1532/FFFFFFFFC0000146 :                     		align 4
(2) 1533/FFFFFFFFC0000148 :                     .texvalid:
(2) 1534/FFFFFFFFC0000148 : 55E5                		mov	@(plypz_src_xl,r14),r5		; Texture X left
(2) 1535/FFFFFFFFC000014A : 56E9                		mov	@(plypz_src_xr,r14),r6		; Texture X right
(2) 1536/FFFFFFFFC000014C : 57E7                		mov	@(plypz_src_yl,r14),r7		; Texture Y up
(2) 1537/FFFFFFFFC000014E : 58EB                		mov	@(plypz_src_yr,r14),r8		; Texture Y down
(2) 1538/FFFFFFFFC0000150 :                     
(2) 1539/FFFFFFFFC0000150 :                     drwsld_nxtline_tex:
(2) 1540/FFFFFFFFC0000150 : 4911                		cmp/pz	r9				; Y Line below 0?
(2) 1541/FFFFFFFFC0000152 : 8B68                		bf	drwsld_updline_tex
(2) 1542/FFFFFFFFC0000154 : D03B                		mov	drwtex_tagshght,r0		; Y Line after 224?
(2) 1543/FFFFFFFFC0000156 : 3903                		cmp/ge	r0,r9
(2) 1544/FFFFFFFFC0000158 : 8972                		bt	drwtex_gonxtpz
(2) 1545/FFFFFFFFC000015A : 2F26                		mov	r2,@-r15
(2) 1546/FFFFFFFFC000015C : 2F46                		mov	r4,@-r15
(2) 1547/FFFFFFFFC000015E : 2F56                		mov	r5,@-r15
(2) 1548/FFFFFFFFC0000160 : 2F66                		mov	r6,@-r15		
(2) 1549/FFFFFFFFC0000162 : 2F76                		mov	r7,@-r15
(2) 1550/FFFFFFFFC0000164 : 2F86                		mov	r8,@-r15
(2) 1551/FFFFFFFFC0000166 : 2FA6                		mov	r10,@-r15
(2) 1552/FFFFFFFFC0000168 : 2FD6                		mov	r13,@-r15
(2) 1553/FFFFFFFFC000016A : 6B13                		mov	r1,r11			; r11 - X left copy
(2) 1554/FFFFFFFFC000016C : 6C33                		mov	r3,r12			; r12 - X right copy
(2) 1555/FFFFFFFFC000016E : 4B29                		shlr16	r11
(2) 1556/FFFFFFFFC0000170 : 4C29                		shlr16	r12
(2) 1557/FFFFFFFFC0000172 : 6BBF                		exts	r11,r11
(2) 1558/FFFFFFFFC0000174 : 6CCF                		exts	r12,r12
(2) 1559/FFFFFFFFC0000176 : 60C3                		mov	r12,r0			; r0: X Right - X Left
(2) 1560/FFFFFFFFC0000178 : 30B8                		sub	r11,r0
(2) 1561/FFFFFFFFC000017A : 4015                		cmp/pl	r0			; Line reversed?
(2) 1562/FFFFFFFFC000017C : 8908                		bt	.txrevers
(2) 1563/FFFFFFFFC000017E : 60C3                		mov	r12,r0			; Swap XL and XR values
(2) 1564/FFFFFFFFC0000180 : 6CB3                		mov	r11,r12
(2) 1565/FFFFFFFFC0000182 : 6B03                		mov	r0,r11
(2) 1566/FFFFFFFFC0000184 : 6053                		mov	r5,r0
(2) 1567/FFFFFFFFC0000186 : 6563                		mov	r6,r5
(2) 1568/FFFFFFFFC0000188 : 6603                		mov	r0,r6
(2) 1569/FFFFFFFFC000018A : 6073                		mov	r7,r0
(2) 1570/FFFFFFFFC000018C : 6783                		mov	r8,r7
(2) 1571/FFFFFFFFC000018E : 6803                		mov	r0,r8
(2) 1572/FFFFFFFFC0000190 :                     .txrevers:
(2) 1573/FFFFFFFFC0000190 : 3CB0                		cmp/eq	r11,r12				; Same X position?
(2) 1574/FFFFFFFFC0000192 : 8940                		bt	.tex_skip_line
(2) 1575/FFFFFFFFC0000194 : 90E6                		mov	#SCREEN_WIDTH,r0		; X right < 0?
(2) 1576/FFFFFFFFC0000196 : 4C15                		cmp/pl	r12
(2) 1577/FFFFFFFFC0000198 : 8B3D                		bf	.tex_skip_line
(2) 1578/FFFFFFFFC000019A : 3B07                		cmp/gt	r0,r11				; X left > 320?
(2) 1579/FFFFFFFFC000019C : 893B                		bt	.tex_skip_line
(2) 1580/FFFFFFFFC000019E : 62C3                		mov	r12,r2
(2) 1581/FFFFFFFFC00001A0 : 60B3                		mov 	r11,r0
(2) 1582/FFFFFFFFC00001A2 : 3208                		sub 	r0,r2
(2) 1583/FFFFFFFFC00001A4 : 3658                		sub	r5,r6
(2) 1584/FFFFFFFFC00001A6 : 3878                		sub	r7,r8
(2) 1585/FFFFFFFFC00001A8 :                     
(2) 1586/FFFFFFFFC00001A8 :                     	; Calculate new DX values
(2) 1587/FFFFFFFFC00001A8 : 90DD                		mov	#_JR,r0				; r6/r2
(2) 1588/FFFFFFFFC00001AA : 2022                		mov	r2,@r0
(2) 1589/FFFFFFFFC00001AC : 1061                		mov	r6,@(4,r0)
(2) 1590/FFFFFFFFC00001AE : 0009                		nop
(2) 1591/FFFFFFFFC00001B0 : 5601                		mov	@(4,r0),r6			; r8/r2
(2) 1592/FFFFFFFFC00001B2 : 2022                		mov	r2,@r0
(2) 1593/FFFFFFFFC00001B4 : 1081                		mov	r8,@(4,r0)
(2) 1594/FFFFFFFFC00001B6 : 0009                		nop
(2) 1595/FFFFFFFFC00001B8 : 5801                		mov	@(4,r0),r8
(2) 1596/FFFFFFFFC00001BA :                     
(2) 1597/FFFFFFFFC00001BA :                     	; Limit X destination points
(2) 1598/FFFFFFFFC00001BA :                     	; and correct the texture's X positions
(2) 1599/FFFFFFFFC00001BA : 90D3                		mov	#SCREEN_WIDTH,r0		; XR point > 320?
(2) 1600/FFFFFFFFC00001BC : 3C07                		cmp/gt	r0,r12
(2) 1601/FFFFFFFFC00001BE : 8B00                		bf	.tr_fix
(2) 1602/FFFFFFFFC00001C0 : 6C03                		mov	r0,r12				; Force XR to 320
(2) 1603/FFFFFFFFC00001C2 :                     .tr_fix:
(2) 1604/FFFFFFFFC00001C2 : 4B15                		cmp/pl	r11				; XL point < 0?
(2) 1605/FFFFFFFFC00001C4 : 8907                		bt	.tl_fix
(2) 1606/FFFFFFFFC00001C6 : 62BB                		neg	r11,r2				; Fix texture positions
(2) 1607/FFFFFFFFC00001C8 : 326D                		dmuls	r6,r2
(2) 1608/FFFFFFFFC00001CA : 001A                		sts	macl,r0
(2) 1609/FFFFFFFFC00001CC : 350C                		add	r0,r5
(2) 1610/FFFFFFFFC00001CE : 328D                		dmuls	r8,r2
(2) 1611/FFFFFFFFC00001D0 : 001A                		sts	macl,r0
(2) 1612/FFFFFFFFC00001D2 : 370C                		add	r0,r7
(2) 1613/FFFFFFFFC00001D4 : 2BBA                		xor	r11,r11				; And reset XL to 0
(2) 1614/FFFFFFFFC00001D6 :                     .tl_fix:
(2) 1615/FFFFFFFFC00001D6 : 3CB8                		sub 	r11,r12
(2) 1616/FFFFFFFFC00001D8 : 4C15                		cmp/pl	r12
(2) 1617/FFFFFFFFC00001DA : 8B1C                		bf	.tex_skip_line
(2) 1618/FFFFFFFFC00001DC :                     ; 		mov	#$10,r0				; (Limiter test)
(2) 1619/FFFFFFFFC00001DC :                     ; 		cmp/ge	r0,r12
(2) 1620/FFFFFFFFC00001DC :                     ; 		bf	.testlwrit
(2) 1621/FFFFFFFFC00001DC :                     ; 		mov	r0,r12
(2) 1622/FFFFFFFFC00001DC :                     ; .testlwrit:
(2) 1623/FFFFFFFFC00001DC : 6093                		mov 	r9,r0				; Y position * $200
(2) 1624/FFFFFFFFC00001DE : 4018                		shll8	r0
(2) 1625/FFFFFFFFC00001E0 : 4000                		shll	r0
(2) 1626/FFFFFFFFC00001E2 : DA5B                		mov 	#_overwrite+$200,r10		; Point to TOPLEFT in framebuffer
(2) 1627/FFFFFFFFC00001E4 : 3A0C                		add 	r0,r10				; Add Y
(2) 1628/FFFFFFFFC00001E6 : 3ABC                		add 	r11,r10				; Add X
(2) 1629/FFFFFFFFC00001E8 : 92BE                		mov	#$1FFF,r2
(2) 1630/FFFFFFFFC00001EA : 5BED                		mov	@(plypz_mtrl,r14),r11		; r11 - texture data
(2) 1631/FFFFFFFFC00001EC : 54EE                		mov	@(plypz_mtrlopt,r14),r4		;  r4 - texture palincr|width
(2) 1632/FFFFFFFFC00001EE : 6D43                		mov	r4,r13
(2) 1633/FFFFFFFFC00001F0 : 4429                		shlr16	r4
(2) 1634/FFFFFFFFC00001F2 : 2429                		and	r2,r4
(2) 1635/FFFFFFFFC00001F4 : 92B9                		mov	#$FF,r2
(2) 1636/FFFFFFFFC00001F6 : 2D29                		and	r2,r13
(2) 1637/FFFFFFFFC00001F8 :                     .tex_xloop:
(2) 1638/FFFFFFFFC00001F8 : 6273                		mov	r7,r2
(2) 1639/FFFFFFFFC00001FA : 4229                		shlr16	r2
(2) 1640/FFFFFFFFC00001FC : 242E                		mulu	r2,r4
(2) 1641/FFFFFFFFC00001FE : 6253                		mov	r5,r2	   			; Build column index
(2) 1642/FFFFFFFFC0000200 : 001A                		sts	macl,r0
(2) 1643/FFFFFFFFC0000202 : 4229                		shlr16	r2
(2) 1644/FFFFFFFFC0000204 : 302C                		add	r2,r0
(2) 1645/FFFFFFFFC0000206 : 00BC                		mov.b	@(r0,r11),r0			; Read pixel
(2) 1646/FFFFFFFFC0000208 : 30DC                		add	r13,r0
(2) 1647/FFFFFFFFC000020A : 2A00                		mov.b	r0,@r10	   			; Write pixel
(2) 1648/FFFFFFFFC000020C : 7A01                		add 	#1,r10
(2) 1649/FFFFFFFFC000020E : 356C                		add	r6,r5				; Update X
(2) 1650/FFFFFFFFC0000210 : 4C10                		dt	r12
(2) 1651/FFFFFFFFC0000212 : 8FF1                		bf/s	.tex_xloop
(2) 1652/FFFFFFFFC0000214 : 378C                		add	r8,r7				; Update Y
(2) 1653/FFFFFFFFC0000216 :                     .tex_skip_line:
(2) 1654/FFFFFFFFC0000216 : 6DF6                		mov	@r15+,r13
(2) 1655/FFFFFFFFC0000218 : 6AF6                		mov	@r15+,r10
(2) 1656/FFFFFFFFC000021A : 68F6                		mov	@r15+,r8
(2) 1657/FFFFFFFFC000021C : 67F6                		mov	@r15+,r7
(2) 1658/FFFFFFFFC000021E : 66F6                		mov	@r15+,r6
(2) 1659/FFFFFFFFC0000220 : 65F6                		mov	@r15+,r5
(2) 1660/FFFFFFFFC0000222 : 64F6                		mov	@r15+,r4
(2) 1661/FFFFFFFFC0000224 : 62F6                		mov	@r15+,r2
(2) 1662/FFFFFFFFC0000226 :                     drwsld_updline_tex:
(2) 1663/FFFFFFFFC0000226 : 50E6                		mov	@(plypz_src_xl_dx,r14),r0	; Update DX postions
(2) 1664/FFFFFFFFC0000228 : 350C                		add	r0,r5
(2) 1665/FFFFFFFFC000022A : 50EA                		mov	@(plypz_src_xr_dx,r14),r0
(2) 1666/FFFFFFFFC000022C : 360C                		add	r0,r6	
(2) 1667/FFFFFFFFC000022E : 50E8                		mov	@(plypz_src_yl_dx,r14),r0
(2) 1668/FFFFFFFFC0000230 : 370C                		add	r0,r7
(2) 1669/FFFFFFFFC0000232 : 50EC                		mov	@(plypz_src_yr_dx,r14),r0
(2) 1670/FFFFFFFFC0000234 : 380C                		add	r0,r8
(2) 1671/FFFFFFFFC0000236 : 312C                		add	r2,r1				; Update X postions
(2) 1672/FFFFFFFFC0000238 : 334C                		add	r4,r3
(2) 1673/FFFFFFFFC000023A : 4A10                		dt	r10
(2) 1674/FFFFFFFFC000023C : 8F88                		bf/s	drwsld_nxtline_tex
(2) 1675/FFFFFFFFC000023E : 7901                		add	#1,r9
(2) 1676/FFFFFFFFC0000240 :                     drwtex_gonxtpz:
(2) 1677/FFFFFFFFC0000240 : A05C                		bra	drwsld_nextpz
(2) 1678/FFFFFFFFC0000242 : 0009                		nop
(2) 1679/FFFFFFFFC0000244 :                     		align 4
(2) 1680/FFFFFFFFC0000244 : 0000 00E0           drwtex_tagshght	dc.l	SCREEN_HEIGHT
(2) 1681/FFFFFFFFC0000248 :                     
(2) 1682/FFFFFFFFC0000248 :                     ; ------------------------------------
(2) 1683/FFFFFFFFC0000248 :                     ; Solid Color
(2) 1684/FFFFFFFFC0000248 :                     ; ------------------------------------
(2) 1685/FFFFFFFFC0000248 :                     
(2) 1686/FFFFFFFFC0000248 :                     drwtsk_solidmode:
(2) 1687/FFFFFFFFC0000248 : 908F                		mov	#$FF,r0
(2) 1688/FFFFFFFFC000024A : 56ED                		mov	@(plypz_mtrl,r14),r6
(2) 1689/FFFFFFFFC000024C : 55EE                		mov	@(plypz_mtrlopt,r14),r5
(2) 1690/FFFFFFFFC000024E : 2509                		and	r0,r5
(2) 1691/FFFFFFFFC0000250 : 2609                		and	r0,r6
(2) 1692/FFFFFFFFC0000252 : 365C                		add	r5,r6
(2) 1693/FFFFFFFFC0000254 : DD3F                		mov	#_vdpreg,r13
(2) 1694/FFFFFFFFC0000256 :                     drwsld_nxtline:
(2) 1695/FFFFFFFFC0000256 : 6093                		mov	r9,r0
(2) 1696/FFFFFFFFC0000258 : 30AC                		add	r10,r0
(2) 1697/FFFFFFFFC000025A : 4015                		cmp/pl	r0
(2) 1698/FFFFFFFFC000025C : 8B4E                		bf	drwsld_nextpz
(2) 1699/FFFFFFFFC000025E : 4911                		cmp/pz	r9
(2) 1700/FFFFFFFFC0000260 : 8B47                		bf	drwsld_updline
(2) 1701/FFFFFFFFC0000262 : 9083                		mov	#SCREEN_HEIGHT,r0
(2) 1702/FFFFFFFFC0000264 : 3907                		cmp/gt	r0,r9
(2) 1703/FFFFFFFFC0000266 : 8949                		bt	drwsld_nextpz
(2) 1704/FFFFFFFFC0000268 : 6B13                		mov	r1,r11
(2) 1705/FFFFFFFFC000026A : 6C33                		mov	r3,r12
(2) 1706/FFFFFFFFC000026C : 4B29                		shlr16	r11
(2) 1707/FFFFFFFFC000026E : 4C29                		shlr16	r12
(2) 1708/FFFFFFFFC0000270 : 6BBF                		exts	r11,r11
(2) 1709/FFFFFFFFC0000272 : 6CCF                		exts	r12,r12
(2) 1710/FFFFFFFFC0000274 : 60C3                		mov	r12,r0
(2) 1711/FFFFFFFFC0000276 : 30B8                		sub	r11,r0
(2) 1712/FFFFFFFFC0000278 : 4015                		cmp/pl	r0
(2) 1713/FFFFFFFFC000027A : 8902                		bt	.revers
(2) 1714/FFFFFFFFC000027C : 60C3                		mov	r12,r0
(2) 1715/FFFFFFFFC000027E : 6CB3                		mov	r11,r12
(2) 1716/FFFFFFFFC0000280 : 6B03                		mov	r0,r11
(2) 1717/FFFFFFFFC0000282 :                     .revers:
(2) 1718/FFFFFFFFC0000282 : 9074                		mov	#SCREEN_WIDTH-1,r0
(2) 1719/FFFFFFFFC0000284 : 4C15                		cmp/pl	r12
(2) 1720/FFFFFFFFC0000286 : 8B34                		bf	drwsld_updline
(2) 1721/FFFFFFFFC0000288 : 3B07                		cmp/gt	r0,r11
(2) 1722/FFFFFFFFC000028A : 8932                		bt	drwsld_updline
(2) 1723/FFFFFFFFC000028C : 3C07                		cmp/gt	r0,r12
(2) 1724/FFFFFFFFC000028E : 8B00                		bf	.r_fix
(2) 1725/FFFFFFFFC0000290 : 6C03                		mov	r0,r12
(2) 1726/FFFFFFFFC0000292 :                     .r_fix:
(2) 1727/FFFFFFFFC0000292 : 4B15                		cmp/pl	r11
(2) 1728/FFFFFFFFC0000294 : 8900                		bt	.l_fix
(2) 1729/FFFFFFFFC0000296 : 2BBA                		xor	r11,r11
(2) 1730/FFFFFFFFC0000298 :                     .l_fix:
(2) 1731/FFFFFFFFC0000298 : E0FE                		mov	#-2,r0
(2) 1732/FFFFFFFFC000029A : 2B09                		and	r0,r11
(2) 1733/FFFFFFFFC000029C : 2C09                		and	r0,r12
(2) 1734/FFFFFFFFC000029E : 60C3                		mov	r12,r0
(2) 1735/FFFFFFFFC00002A0 : 30B8                		sub	r11,r0
(2) 1736/FFFFFFFFC00002A2 :                     ; 		mov	#6,r5
(2) 1737/FFFFFFFFC00002A2 :                     ; 		cmp/gt	r5,r0
(2) 1738/FFFFFFFFC00002A2 :                     ; 		bf	drwsld_lowpixls
(2) 1739/FFFFFFFFC00002A2 : 85D5                .wait:		mov.w	@(10,r13),r0
(2) 1740/FFFFFFFFC00002A4 : C802                		tst	#2,r0
(2) 1741/FFFFFFFFC00002A6 : 8BFC                		bf	.wait
(2) 1742/FFFFFFFFC00002A8 : 60C3                		mov	r12,r0
(2) 1743/FFFFFFFFC00002AA : 30B8                		sub	r11,r0
(2) 1744/FFFFFFFFC00002AC : 4001                		shlr	r0
(2) 1745/FFFFFFFFC00002AE : 81D2                		mov.w	r0,@(4,r13)	; length
(2) 1746/FFFFFFFFC00002B0 : 60B3                		mov	r11,r0
(2) 1747/FFFFFFFFC00002B2 : 4001                		shlr	r0
(2) 1748/FFFFFFFFC00002B4 : 6593                		mov	r9,r5
(2) 1749/FFFFFFFFC00002B6 : 7501                		add	#1,r5
(2) 1750/FFFFFFFFC00002B8 : 4518                		shll8	r5
(2) 1751/FFFFFFFFC00002BA : 305C                		add	r5,r0
(2) 1752/FFFFFFFFC00002BC : 81D3                		mov.w	r0,@(6,r13)	; address
(2) 1753/FFFFFFFFC00002BE : 6063                		mov	r6,r0
(2) 1754/FFFFFFFFC00002C0 : 4018                		shll8	r0
(2) 1755/FFFFFFFFC00002C2 : 206B                		or	r6,r0
(2) 1756/FFFFFFFFC00002C4 : 81D4                		mov.w	r0,@(8,r13)	; Set data
(2) 1757/FFFFFFFFC00002C6 :                     		
(2) 1758/FFFFFFFFC00002C6 :                     	; If the line is large, leave it to VDP
(2) 1759/FFFFFFFFC00002C6 :                     	; and exit interrupt, we will come back
(2) 1760/FFFFFFFFC00002C6 :                     	; with more lines to draw
(2) 1761/FFFFFFFFC00002C6 : E028                		mov	#$28,r0
(2) 1762/FFFFFFFFC00002C8 : 3C03                		cmp/ge	r0,r12
(2) 1763/FFFFFFFFC00002CA : 8B12                		bf	drwsld_updline
(2) 1764/FFFFFFFFC00002CC : E002                		mov	#2,r0
(2) 1765/FFFFFFFFC00002CE : C10D                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2) 1766/FFFFFFFFC00002D0 : D021                		mov	#Cach_LnDrw_S,r0
(2) 1767/FFFFFFFFC00002D2 : 2016                		mov	r1,@-r0
(2) 1768/FFFFFFFFC00002D4 : 2026                		mov	r2,@-r0
(2) 1769/FFFFFFFFC00002D6 : 2036                		mov	r3,@-r0
(2) 1770/FFFFFFFFC00002D8 : 2046                		mov	r4,@-r0
(2) 1771/FFFFFFFFC00002DA : 2056                		mov	r5,@-r0
(2) 1772/FFFFFFFFC00002DC : 2066                		mov	r6,@-r0
(2) 1773/FFFFFFFFC00002DE : 2076                		mov	r7,@-r0
(2) 1774/FFFFFFFFC00002E0 : 2086                		mov	r8,@-r0
(2) 1775/FFFFFFFFC00002E2 : 2096                		mov	r9,@-r0
(2) 1776/FFFFFFFFC00002E4 : 20A6                		mov	r10,@-r0
(2) 1777/FFFFFFFFC00002E6 : 20B6                		mov	r11,@-r0
(2) 1778/FFFFFFFFC00002E8 : 20C6                		mov	r12,@-r0
(2) 1779/FFFFFFFFC00002EA : 20D6                		mov	r13,@-r0
(2) 1780/FFFFFFFFC00002EC : 20E6                		mov	r14,@-r0
(2) 1781/FFFFFFFFC00002EE : A016                		bra	drwtask_return
(2) 1782/FFFFFFFFC00002F0 : E200                		mov	#0,r2
(2) 1783/FFFFFFFFC00002F2 :                     drwsld_updline:
(2) 1784/FFFFFFFFC00002F2 : 312C                		add	r2,r1
(2) 1785/FFFFFFFFC00002F4 : 334C                		add	r4,r3
(2) 1786/FFFFFFFFC00002F6 : 4A10                		dt	r10
(2) 1787/FFFFFFFFC00002F8 : 8FAD                		bf/s	drwsld_nxtline
(2) 1788/FFFFFFFFC00002FA : 7901                		add	#1,r9
(2) 1789/FFFFFFFFC00002FC :                     		
(2) 1790/FFFFFFFFC00002FC :                     ; ------------------------------------
(2) 1791/FFFFFFFFC00002FC :                     ; if lower than 6 pixels
(2) 1792/FFFFFFFFC00002FC :                     ; (TODO: check this later)
(2) 1793/FFFFFFFFC00002FC :                     
(2) 1794/FFFFFFFFC00002FC :                     ; drwsld_lowpixls:
(2) 1795/FFFFFFFFC00002FC :                     ; 		cmp/pl	r0
(2) 1796/FFFFFFFFC00002FC :                     ; 		bf	drwsld_updline
(2) 1797/FFFFFFFFC00002FC :                     ; 		mov	r0,r12
(2) 1798/FFFFFFFFC00002FC :                     ; 		mov	r9,r0
(2) 1799/FFFFFFFFC00002FC :                     ; 		add	#1,r0
(2) 1800/FFFFFFFFC00002FC :                     ; 		shll8	r0
(2) 1801/FFFFFFFFC00002FC :                     ; 		shll	r0
(2) 1802/FFFFFFFFC00002FC :                     ; 		add 	r11,r0
(2) 1803/FFFFFFFFC00002FC :                     ; 		mov	#_overwrite+$200,r5
(2) 1804/FFFFFFFFC00002FC :                     ; 		add	r0,r5
(2) 1805/FFFFFFFFC00002FC :                     ; .wait_fb	mov.w	@(10,r13),r0
(2) 1806/FFFFFFFFC00002FC :                     ; 		tst	#2,r0
(2) 1807/FFFFFFFFC00002FC :                     ; 		bf	.wait_fb
(2) 1808/FFFFFFFFC00002FC :                     ; 		mov	#-1,r0
(2) 1809/FFFFFFFFC00002FC :                     ; .perpixl:
(2) 1810/FFFFFFFFC00002FC :                     ; 		mov.b	r0,@r5
(2) 1811/FFFFFFFFC00002FC :                     ; 		dt	r12
(2) 1812/FFFFFFFFC00002FC :                     ; 		bf/s	.perpixl
(2) 1813/FFFFFFFFC00002FC :                     ; 		add	#1,r5
(2) 1814/FFFFFFFFC00002FC :                     
(2) 1815/FFFFFFFFC00002FC :                     ; ------------------------------------		
(2) 1816/FFFFFFFFC00002FC :                     		
(2) 1817/FFFFFFFFC00002FC :                     drwsld_nextpz:
(2) 1818/FFFFFFFFC00002FC : C50C                		mov.w	@(marsGbl_PzListCntr,gbr),r0	; -1 piece
(2) 1819/FFFFFFFFC00002FE : 70FF                		add	#-1,r0
(2) 1820/FFFFFFFFC0000300 : C10C                		mov.w	r0,@(marsGbl_PzListCntr,gbr)
(2) 1821/FFFFFFFFC0000302 : 7E3C                		add	#sizeof_plypz,r14		; Point to next piece for the next interrupt
(2) 1822/FFFFFFFFC0000304 : 60E3                		mov	r14,r0
(2) 1823/FFFFFFFFC0000306 : DE15                		mov	#RAM_Mars_VdpDrwList_e,r14	; End-of-list?
(2) 1824/FFFFFFFFC0000308 : 30E3                		cmp/ge	r14,r0
(2) 1825/FFFFFFFFC000030A : 8B00                		bf	.reset_rd
(2) 1826/FFFFFFFFC000030C : D014                		mov	#RAM_Mars_VdpDrwList,r0
(2) 1827/FFFFFFFFC000030E :                     .reset_rd:
(2) 1828/FFFFFFFFC000030E : C200                		mov	r0,@(marsGbl_PlyPzList_R,gbr)
(2) 1829/FFFFFFFFC0000310 :                     ; 		mov.w	@(marsGbl_PzListCntr,gbr),r0
(2) 1830/FFFFFFFFC0000310 :                     ; 		cmp/eq	#0,r0
(2) 1831/FFFFFFFFC0000310 :                     ; 		bt/s	.finish_it
(2) 1832/FFFFFFFFC0000310 :                     ; 		add	#-1,r0
(2) 1833/FFFFFFFFC0000310 :                     ; 		bra	drwtsk1_newpz
(2) 1834/FFFFFFFFC0000310 :                     ; 		mov.w	r0,@(marsGbl_PzListCntr,gbr)
(2) 1835/FFFFFFFFC0000310 :                     .finish_it:
(2) 1836/FFFFFFFFC0000310 : A005                		bra	drwtask_return
(2) 1837/FFFFFFFFC0000312 : E210                		mov	#$10,r2
(2) 1838/FFFFFFFFC0000314 :                     
(2) 1839/FFFFFFFFC0000314 :                     ; --------------------------------
(2) 1840/FFFFFFFFC0000314 :                     ; Task $00
(2) 1841/FFFFFFFFC0000314 :                     ; --------------------------------
(2) 1842/FFFFFFFFC0000314 :                     
(2) 1843/FFFFFFFFC0000314 :                     drwtsk_00:
(2) 1844/FFFFFFFFC0000314 : 2F26                		mov	r2,@-r15
(2) 1845/FFFFFFFFC0000316 : E000                		mov	#0,r0
(2) 1846/FFFFFFFFC0000318 : C10D                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2) 1847/FFFFFFFFC000031A : A00E                		bra	drwtask_exit
(2) 1848/FFFFFFFFC000031C : E27F                		mov	#$7F,r2
(2) 1849/FFFFFFFFC000031E :                     
(2) 1850/FFFFFFFFC000031E :                     drwtask_return:
(2) 1851/FFFFFFFFC000031E : 4F06                		lds	@r15+,mach
(2) 1852/FFFFFFFFC0000320 : 4F16                		lds	@r15+,macl
(2) 1853/FFFFFFFFC0000322 : 6EF6                		mov	@r15+,r14
(2) 1854/FFFFFFFFC0000324 : 6DF6                		mov	@r15+,r13
(2) 1855/FFFFFFFFC0000326 : 6CF6                		mov	@r15+,r12
(2) 1856/FFFFFFFFC0000328 : 6BF6                		mov	@r15+,r11
(2) 1857/FFFFFFFFC000032A : 6AF6                		mov	@r15+,r10
(2) 1858/FFFFFFFFC000032C : 69F6                		mov	@r15+,r9
(2) 1859/FFFFFFFFC000032E : 68F6                		mov	@r15+,r8
(2) 1860/FFFFFFFFC0000330 : 67F6                		mov	@r15+,r7
(2) 1861/FFFFFFFFC0000332 : 66F6                		mov	@r15+,r6
(2) 1862/FFFFFFFFC0000334 : 65F6                		mov	@r15+,r5
(2) 1863/FFFFFFFFC0000336 : 64F6                		mov	@r15+,r4
(2) 1864/FFFFFFFFC0000338 : 63F6                		mov	@r15+,r3
(2) 1865/FFFFFFFFC000033A :                     drwtask_exit:
(2) 1866/FFFFFFFFC000033A : 9119                		mov.l   #$FFFFFE80,r1
(2) 1867/FFFFFFFFC000033C : 9019                		mov.w   #$A518,r0
(2) 1868/FFFFFFFFC000033E : 2101                		mov.w   r0,@r1
(2) 1869/FFFFFFFFC0000340 : CB20                		or      #$20,r0
(2) 1870/FFFFFFFFC0000342 : 2101                		mov.w   r0,@r1
(2) 1871/FFFFFFFFC0000344 : 9016                		mov.w   #$5A00,r0
(2) 1872/FFFFFFFFC0000346 : 202B                		or	r2,r0
(2) 1873/FFFFFFFFC0000348 : 2101                		mov.w   r0,@r1
(2) 1874/FFFFFFFFC000034A : 62F6                		mov	@r15+,r2
(2) 1875/FFFFFFFFC000034C : 000B                		rts
(2) 1876/FFFFFFFFC000034E : 0009                		nop
(2) 1877/FFFFFFFFC0000350 :                     		align 4
(2) 1878/FFFFFFFFC0000350 : 2402 0200 2000 4100 		ltorg
                    C000 06FC 0602 0D9C 
                    0601 909C 0140 FF00 
                    1FFF 00FF 00E0 013F 
                    FE80 A518 5A00      
(2) 1879/FFFFFFFFC0000376 :                     
(2) 1880/FFFFFFFFC0000376 :                     ; ------------------------------------------------
(2) 1881/FFFFFFFFC0000376 :                     ; Read polygon and build pieces
(2) 1882/FFFFFFFFC0000376 :                     ; 
(2) 1883/FFFFFFFFC0000376 :                     ; Type bits:
(2) 1884/FFFFFFFFC0000376 :                     ; %tsp----- -------- -------- --------
(2) 1885/FFFFFFFFC0000376 :                     ; 
(2) 1886/FFFFFFFFC0000376 :                     ; p - Figure type: Quad (0) or Triangle (1)
(2) 1887/FFFFFFFFC0000376 :                     ; s - Polygon type: Normal (0) or Sprite (1)
(2) 1888/FFFFFFFFC0000376 :                     ; t - Polygon has texture data (1):
(2) 1889/FFFFFFFFC0000376 :                     ;     polygn_mtrlopt: Texture width
(2) 1890/FFFFFFFFC0000376 :                     ;     polygn_mtrl   : Texture data address
(2) 1891/FFFFFFFFC0000376 :                     ;     polygn_srcpnts: Texture X/Y positions for
(2) 1892/FFFFFFFFC0000376 :                     ;                     each edge (3 or 4)
(2) 1893/FFFFFFFFC0000376 :                     ; ------------------------------------------------
(2) 1894/FFFFFFFFC0000376 :                     
(2) 1895/FFFFFFFFC0000376 :                     MarsVideo_MakePolygon:
(2) 1896/FFFFFFFFC0000376 : 4F22                		sts	pr,@-r15
(2) 1897/FFFFFFFFC0000378 : DC4A                		mov	#CachDDA_Top,r12
(2) 1898/FFFFFFFFC000037A : DD4B                		mov	#CachDDA_Last,r13
(2) 1899/FFFFFFFFC000037C : 50E0                		mov	@(polygn_type,r14),r0
(2) 1900/FFFFFFFFC000037E : 4029                		shlr16	r0
(2) 1901/FFFFFFFFC0000380 : 4019                		shlr8	r0
(2) 1902/FFFFFFFFC0000382 : C840                		tst	#PLGN_TRI,r0			; PLGN_TRI set?
(2) 1903/FFFFFFFFC0000384 : 8B00                		bf	.tringl
(2) 1904/FFFFFFFFC0000386 : 7D08                		add	#8,r13
(2) 1905/FFFFFFFFC0000388 :                     .tringl:
(2) 1906/FFFFFFFFC0000388 : 61E3                		mov	r14,r1
(2) 1907/FFFFFFFFC000038A : 62C3                		mov	r12,r2
(2) 1908/FFFFFFFFC000038C : D347                		mov	#CachDDA_Src,r3
(2) 1909/FFFFFFFFC000038E : 7108                		add	#polygn_points,r1
(2) 1910/FFFFFFFFC0000390 : C820                		tst	#PLGN_SPRITE,r0			; PLGN_SPRITE set?
(2) 1911/FFFFFFFFC0000392 : 8930                		bt	.plgn_pnts
(2) 1912/FFFFFFFFC0000394 :                     		
(2) 1913/FFFFFFFFC0000394 :                     ; ----------------------------------------
(2) 1914/FFFFFFFFC0000394 :                     ; Sprite points
(2) 1915/FFFFFFFFC0000394 :                     ; ----------------------------------------
(2) 1916/FFFFFFFFC0000394 :                     
(2) 1917/FFFFFFFFC0000394 :                     ; TODO: rework or get rid of this
(2) 1918/FFFFFFFFC0000394 :                     .spr_pnts:
(2) 1919/FFFFFFFFC0000394 : 6815                		mov.w	@r1+,r8		; X pos
(2) 1920/FFFFFFFFC0000396 : 6915                		mov.w	@r1+,r9		; Y pos
(2) 1921/FFFFFFFFC0000398 :                     
(2) 1922/FFFFFFFFC0000398 : 6415                		mov.w	@r1+,r4
(2) 1923/FFFFFFFFC000039A : 6615                		mov.w	@r1+,r6
(2) 1924/FFFFFFFFC000039C : 6515                		mov.w	@r1+,r5
(2) 1925/FFFFFFFFC000039E : 6715                		mov.w	@r1+,r7
(2) 1926/FFFFFFFFC00003A0 : 7104                		add	#2*2,r1
(2) 1927/FFFFFFFFC00003A2 : 348C                		add	r8,r4
(2) 1928/FFFFFFFFC00003A4 : 358C                		add 	r8,r5
(2) 1929/FFFFFFFFC00003A6 : 369C                		add	r9,r6
(2) 1930/FFFFFFFFC00003A8 : 379C                		add 	r9,r7
(2) 1931/FFFFFFFFC00003AA : 2252                		mov	r5,@r2		; TR
(2) 1932/FFFFFFFFC00003AC : 7204                		add	#4,r2
(2) 1933/FFFFFFFFC00003AE : 2262                		mov	r6,@r2
(2) 1934/FFFFFFFFC00003B0 : 7204                		add	#4,r2
(2) 1935/FFFFFFFFC00003B2 : 2242                		mov	r4,@r2		; TL
(2) 1936/FFFFFFFFC00003B4 : 7204                		add	#4,r2
(2) 1937/FFFFFFFFC00003B6 : 2262                		mov	r6,@r2
(2) 1938/FFFFFFFFC00003B8 : 7204                		add	#4,r2
(2) 1939/FFFFFFFFC00003BA : 2242                		mov	r4,@r2		; BL
(2) 1940/FFFFFFFFC00003BC : 7204                		add	#4,r2
(2) 1941/FFFFFFFFC00003BE : 2272                		mov	r7,@r2
(2) 1942/FFFFFFFFC00003C0 : 7204                		add	#4,r2
(2) 1943/FFFFFFFFC00003C2 : 2252                		mov	r5,@r2		; BR
(2) 1944/FFFFFFFFC00003C4 : 7204                		add	#4,r2
(2) 1945/FFFFFFFFC00003C6 : 2272                		mov	r7,@r2
(2) 1946/FFFFFFFFC00003C8 : 7204                		add	#4,r2
(2) 1947/FFFFFFFFC00003CA :                     
(2) 1948/FFFFFFFFC00003CA : 6415                		mov.w	@r1+,r4
(2) 1949/FFFFFFFFC00003CC : 6615                		mov.w	@r1+,r6
(2) 1950/FFFFFFFFC00003CE : 6515                		mov.w	@r1+,r5
(2) 1951/FFFFFFFFC00003D0 : 6715                		mov.w	@r1+,r7
(2) 1952/FFFFFFFFC00003D2 : 2352                		mov	r5,@r3		; TR
(2) 1953/FFFFFFFFC00003D4 : 7304                		add	#4,r3
(2) 1954/FFFFFFFFC00003D6 : 2362                		mov	r6,@r3
(2) 1955/FFFFFFFFC00003D8 : 7304                		add	#4,r3
(2) 1956/FFFFFFFFC00003DA : 2342                		mov	r4,@r3		; TL
(2) 1957/FFFFFFFFC00003DC : 7304                		add	#4,r3
(2) 1958/FFFFFFFFC00003DE : 2362                		mov	r6,@r3
(2) 1959/FFFFFFFFC00003E0 : 7304                		add	#4,r3
(2) 1960/FFFFFFFFC00003E2 : 2342                		mov	r4,@r3		; BL
(2) 1961/FFFFFFFFC00003E4 : 7304                		add	#4,r3
(2) 1962/FFFFFFFFC00003E6 : 2372                		mov	r7,@r3
(2) 1963/FFFFFFFFC00003E8 : 7304                		add	#4,r3
(2) 1964/FFFFFFFFC00003EA : 2352                		mov	r5,@r3		; BR
(2) 1965/FFFFFFFFC00003EC : 7304                		add	#4,r3
(2) 1966/FFFFFFFFC00003EE : 2372                		mov	r7,@r3
(2) 1967/FFFFFFFFC00003F0 : 7304                		add	#4,r3
(2) 1968/FFFFFFFFC00003F2 :                     ; 		mov	#4*2,r0
(2) 1969/FFFFFFFFC00003F2 :                     ; .sprsrc_pnts:
(2) 1970/FFFFFFFFC00003F2 :                     ; 		mov.w	@r1+,r0
(2) 1971/FFFFFFFFC00003F2 :                     ; 		mov.w	@r1+,r4
(2) 1972/FFFFFFFFC00003F2 :                     ; 		mov	r0,@r3
(2) 1973/FFFFFFFFC00003F2 :                     ; 		mov	r4,@(4,r3)
(2) 1974/FFFFFFFFC00003F2 :                     ; 		dt	r0
(2) 1975/FFFFFFFFC00003F2 :                     ; 		bf/s	.sprsrc_pnts
(2) 1976/FFFFFFFFC00003F2 :                     ; 		add	#8,r3
(2) 1977/FFFFFFFFC00003F2 : A014                		bra	.start_math
(2) 1978/FFFFFFFFC00003F4 : 0009                		nop
(2) 1979/FFFFFFFFC00003F6 :                     
(2) 1980/FFFFFFFFC00003F6 :                     ; ----------------------------------------
(2) 1981/FFFFFFFFC00003F6 :                     ; Polygon points
(2) 1982/FFFFFFFFC00003F6 :                     ; ----------------------------------------
(2) 1983/FFFFFFFFC00003F6 :                     
(2) 1984/FFFFFFFFC00003F6 :                     .plgn_pnts:
(2) 1985/FFFFFFFFC00003F6 : E804                		mov	#4,r8
(2) 1986/FFFFFFFFC00003F8 : 9660                		mov	#SCREEN_WIDTH/2,r6
(2) 1987/FFFFFFFFC00003FA : E770                		mov	#SCREEN_HEIGHT/2,r7
(2) 1988/FFFFFFFFC00003FC :                     .setpnts:
(2) 1989/FFFFFFFFC00003FC : 6416                		mov	@r1+,r4
(2) 1990/FFFFFFFFC00003FE : 6516                		mov	@r1+,r5
(2) 1991/FFFFFFFFC0000400 : 346C                		add	r6,r4
(2) 1992/FFFFFFFFC0000402 : 357C                		add	r7,r5
(2) 1993/FFFFFFFFC0000404 : 2242                		mov	r4,@r2
(2) 1994/FFFFFFFFC0000406 : 1251                		mov	r5,@(4,r2)
(2) 1995/FFFFFFFFC0000408 : 4810                		dt	r8
(2) 1996/FFFFFFFFC000040A : 8FF7                		bf/s	.setpnts
(2) 1997/FFFFFFFFC000040C : 7208                		add	#8,r2
(2) 1998/FFFFFFFFC000040E : E804                		mov	#4,r8
(2) 1999/FFFFFFFFC0000410 :                     .src_pnts:
(2) 2000/FFFFFFFFC0000410 : 6415                		mov.w	@r1+,r4
(2) 2001/FFFFFFFFC0000412 : 6515                		mov.w	@r1+,r5
(2) 2002/FFFFFFFFC0000414 : 2342                		mov	r4,@r3
(2) 2003/FFFFFFFFC0000416 : 1351                		mov	r5,@(4,r3)
(2) 2004/FFFFFFFFC0000418 : 4810                		dt	r8
(2) 2005/FFFFFFFFC000041A : 8FF9                		bf/s	.src_pnts
(2) 2006/FFFFFFFFC000041C : 7308                		add	#8,r3
(2) 2007/FFFFFFFFC000041E :                     		
(2) 2008/FFFFFFFFC000041E :                     .start_math:
(2) 2009/FFFFFFFFC000041E : E903                		mov	#3,r9
(2) 2010/FFFFFFFFC0000420 : C840                		tst	#PLGN_TRI,r0			; PLGN_TRI set?
(2) 2011/FFFFFFFFC0000422 : 8B00                		bf	.ytringl
(2) 2012/FFFFFFFFC0000424 : 7901                		add	#1,r9
(2) 2013/FFFFFFFFC0000426 :                     .ytringl:
(2) 2014/FFFFFFFFC0000426 : DA22                		mov	#$7FFFFFFF,r10
(2) 2015/FFFFFFFFC0000428 : EBFF                		mov	#$FFFFFFFF,r11
(2) 2016/FFFFFFFFC000042A : 67C3                		mov 	r12,r7
(2) 2017/FFFFFFFFC000042C : 68C3                		mov	r12,r8
(2) 2018/FFFFFFFFC000042E :                     .find_top:
(2) 2019/FFFFFFFFC000042E : 5071                		mov	@(4,r7),r0
(2) 2020/FFFFFFFFC0000430 : 30B7                		cmp/gt	r11,r0
(2) 2021/FFFFFFFFC0000432 : 8B00                		bf	.is_low
(2) 2022/FFFFFFFFC0000434 : 6B03                		mov 	r0,r11
(2) 2023/FFFFFFFFC0000436 :                     .is_low:
(2) 2024/FFFFFFFFC0000436 : 5081                		mov	@(4,r8),r0
(2) 2025/FFFFFFFFC0000438 : 30A7                		cmp/gt	r10,r0
(2) 2026/FFFFFFFFC000043A : 8901                		bt	.is_high
(2) 2027/FFFFFFFFC000043C : 6A03                		mov 	r0,r10
(2) 2028/FFFFFFFFC000043E : 6183                		mov	r8,r1
(2) 2029/FFFFFFFFC0000440 :                     .is_high:
(2) 2030/FFFFFFFFC0000440 : 7708                		add 	#8,r7
(2) 2031/FFFFFFFFC0000442 : 4910                		dt	r9
(2) 2032/FFFFFFFFC0000444 : 8FF3                		bf/s	.find_top
(2) 2033/FFFFFFFFC0000446 : 7808                		add	#8,r8
(2) 2034/FFFFFFFFC0000448 : 3AB3                		cmp/ge	r11,r10			; Already reached end?
(2) 2035/FFFFFFFFC000044A : 8927                		bt	.exit
(2) 2036/FFFFFFFFC000044C : 4B15                		cmp/pl	r11			; Bottom < 0?
(2) 2037/FFFFFFFFC000044E : 8B25                		bf	.exit
(2) 2038/FFFFFFFFC0000450 : 9035                		mov	#SCREEN_HEIGHT,r0	; Top > 224?
(2) 2039/FFFFFFFFC0000452 : 3A03                		cmp/ge	r0,r10
(2) 2040/FFFFFFFFC0000454 : 8922                		bt	.exit
(2) 2041/FFFFFFFFC0000456 :                     		
(2) 2042/FFFFFFFFC0000456 :                     	; r1 - Main pointer
(2) 2043/FFFFFFFFC0000456 :                     	; r2 - Left pointer
(2) 2044/FFFFFFFFC0000456 :                     	; r3 - Right pointer
(2) 2045/FFFFFFFFC0000456 :                     	; r4 - Left X
(2) 2046/FFFFFFFFC0000456 :                     	; r5 - Left DX
(2) 2047/FFFFFFFFC0000456 :                     	; r6 - Right X
(2) 2048/FFFFFFFFC0000456 :                     	; r7 - Right DX
(2) 2049/FFFFFFFFC0000456 :                     	; r8 - Left width
(2) 2050/FFFFFFFFC0000456 :                     	; r9 - Right width
(2) 2051/FFFFFFFFC0000456 :                     	; r10 - Top Y (gets updated after calling put_piece)
(2) 2052/FFFFFFFFC0000456 :                     	; r11 - Bottom Y
(2) 2053/FFFFFFFFC0000456 :                     	; r12 - First DST point
(2) 2054/FFFFFFFFC0000456 :                     	; r13 - Last DST point
(2) 2055/FFFFFFFFC0000456 : 6213                		mov	r1,r2				; r2 - X left to process
(2) 2056/FFFFFFFFC0000458 : 6313                		mov	r1,r3				; r3 - X right to process
(2) 2057/FFFFFFFFC000045A : B031                		bsr	set_left
(2) 2058/FFFFFFFFC000045C : 0009                		nop
(2) 2059/FFFFFFFFC000045E : B073                		bsr	set_right
(2) 2060/FFFFFFFFC0000460 : 0009                		nop
(2) 2061/FFFFFFFFC0000462 :                     .next_pz:
(2) 2062/FFFFFFFFC0000462 : 902C                		mov	#SCREEN_HEIGHT,r0		; Current Y > 224?
(2) 2063/FFFFFFFFC0000464 : 3A07                		cmp/gt	r0,r10
(2) 2064/FFFFFFFFC0000466 : 8919                		bt	.exit
(2) 2065/FFFFFFFFC0000468 : 3AB3                		cmp/ge	r11,r10				; Reached Y end?
(2) 2066/FFFFFFFFC000046A : 8917                		bt	.exit
(2) 2067/FFFFFFFFC000046C : C601                		mov	@(marsGbl_PlyPzList_W,gbr),r0	; r1 - Current piece to WRITE
(2) 2068/FFFFFFFFC000046E : 6103                		mov	r0,r1
(2) 2069/FFFFFFFFC0000470 : D010                		mov	#RAM_Mars_VdpDrwList_e,r0	; pointer reached end of the list?
(2) 2070/FFFFFFFFC0000472 : 3103                		cmp/ge	r0,r1
(2) 2071/FFFFFFFFC0000474 : 8B02                		bf	.dontreset
(2) 2072/FFFFFFFFC0000476 : D010                		mov	#RAM_Mars_VdpDrwList,r0		; Return WRITE pointer to the top of the list
(2) 2073/FFFFFFFFC0000478 : 6103                		mov	r0,r1
(2) 2074/FFFFFFFFC000047A : C201                		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2) 2075/FFFFFFFFC000047C :                     .dontreset:
(2) 2076/FFFFFFFFC000047C : 4F03                		stc	sr,@-r15			; Stop interrupts (including Watchdog)
(2) 2077/FFFFFFFFC000047E : 0002                		stc	sr,r0
(2) 2078/FFFFFFFFC0000480 : CBF0                		or	#$F0,r0
(2) 2079/FFFFFFFFC0000482 : B0B2                		bsr	put_piece
(2) 2080/FFFFFFFFC0000484 : 400E                		ldc	r0,sr
(2) 2081/FFFFFFFFC0000486 : 4F07                		ldc	@r15+,sr			; Restore interrupts
(2) 2082/FFFFFFFFC0000488 : 3897                		cmp/gt	r9,r8				; Left width > Right width?
(2) 2083/FFFFFFFFC000048A : 8B03                		bf	.lefth2
(2) 2084/FFFFFFFFC000048C : B05C                		bsr	set_right
(2) 2085/FFFFFFFFC000048E : 0009                		nop
(2) 2086/FFFFFFFFC0000490 : AFE7                		bra	.next_pz
(2) 2087/FFFFFFFFC0000492 : 0009                		nop
(2) 2088/FFFFFFFFC0000494 :                     .lefth2:
(2) 2089/FFFFFFFFC0000494 : B014                		bsr	set_left
(2) 2090/FFFFFFFFC0000496 : 0009                		nop
(2) 2091/FFFFFFFFC0000498 : AFE3                		bra	.next_pz
(2) 2092/FFFFFFFFC000049A : 0009                		nop		
(2) 2093/FFFFFFFFC000049C :                     .exit:
(2) 2094/FFFFFFFFC000049C : 4F26                		lds	@r15+,pr
(2) 2095/FFFFFFFFC000049E : 000B                		rts
(2) 2096/FFFFFFFFC00004A0 : 0009                		nop
(2) 2097/FFFFFFFFC00004A2 :                     		align 4
(2) 2098/FFFFFFFFC00004A4 : C000 06FC C000 070C 		ltorg
                    C000 071C 7FFF FFFF 
                    0602 0D9C 0601 909C 
                    00A0 00E0           
(2) 2099/FFFFFFFFC00004C0 :                     
(2) 2100/FFFFFFFFC00004C0 :                     ; --------------------------------
(2) 2101/FFFFFFFFC00004C0 :                     
(2) 2102/FFFFFFFFC00004C0 :                     set_left:
(2) 2103/FFFFFFFFC00004C0 : 6823                		mov	r2,r8			; Get a copy of Xleft pointer
(2) 2104/FFFFFFFFC00004C2 : 7820                		add	#$20,r8			; To read Texture SRC points
(2) 2105/FFFFFFFFC00004C4 : 6482                		mov	@r8,r4
(2) 2106/FFFFFFFFC00004C6 : 5581                		mov	@(4,r8),r5
(2) 2107/FFFFFFFFC00004C8 : D841                		mov	#CachDDA_Src_L,r8
(2) 2108/FFFFFFFFC00004CA : 6043                		mov	r4,r0
(2) 2109/FFFFFFFFC00004CC : 4028                		shll16	r0
(2) 2110/FFFFFFFFC00004CE : 2802                		mov	r0,@r8
(2) 2111/FFFFFFFFC00004D0 : 6053                		mov	r5,r0
(2) 2112/FFFFFFFFC00004D2 : 4028                		shll16	r0
(2) 2113/FFFFFFFFC00004D4 : 1802                		mov	r0,@(8,r8)
(2) 2114/FFFFFFFFC00004D6 : 6122                		mov	@r2,r1
(2) 2115/FFFFFFFFC00004D8 : 5821                		mov	@(4,r2),r8
(2) 2116/FFFFFFFFC00004DA : 7208                		add	#8,r2
(2) 2117/FFFFFFFFC00004DC : 32D7                		cmp/gt	r13,r2
(2) 2118/FFFFFFFFC00004DE : 8B00                		bf	.lft_ok
(2) 2119/FFFFFFFFC00004E0 : 62C3                		mov 	r12,r2
(2) 2120/FFFFFFFFC00004E2 :                     .lft_ok:
(2) 2121/FFFFFFFFC00004E2 : 5021                		mov	@(4,r2),r0
(2) 2122/FFFFFFFFC00004E4 : 3088                		sub	r8,r0
(2) 2123/FFFFFFFFC00004E6 : 8800                		cmp/eq	#0,r0
(2) 2124/FFFFFFFFC00004E8 : 89EA                		bt	set_left
(2) 2125/FFFFFFFFC00004EA : 4011                		cmp/pz	r0
(2) 2126/FFFFFFFFC00004EC : 8B29                		bf	.lft_skip
(2) 2127/FFFFFFFFC00004EE :                     
(2) 2128/FFFFFFFFC00004EE : 400A                		lds	r0,mach
(2) 2129/FFFFFFFFC00004F0 : 6823                		mov	r2,r8
(2) 2130/FFFFFFFFC00004F2 : 7820                		add	#$20,r8
(2) 2131/FFFFFFFFC00004F4 : 6082                		mov 	@r8,r0
(2) 2132/FFFFFFFFC00004F6 : 3048                		sub 	r4,r0
(2) 2133/FFFFFFFFC00004F8 : 5481                		mov 	@(4,r8),r4
(2) 2134/FFFFFFFFC00004FA : 3458                		sub 	r5,r4
(2) 2135/FFFFFFFFC00004FC : 6503                		mov	r0,r5
(2) 2136/FFFFFFFFC00004FE : 4418                		shll8	r4
(2) 2137/FFFFFFFFC0000500 : 4518                		shll8	r5
(2) 2138/FFFFFFFFC0000502 : 080A                		sts	mach,r8
(2) 2139/FFFFFFFFC0000504 : E001                		mov	#1,r0				; Stopsign for HW Division
(2) 2140/FFFFFFFFC0000506 : C110                		mov.w	r0,@(marsGbl_DivReq_M,gbr)
(2) 2141/FFFFFFFFC0000508 : 906E                		mov	#_JR,r0				; HW DIV
(2) 2142/FFFFFFFFC000050A : 2082                		mov	r8,@r0
(2) 2143/FFFFFFFFC000050C : 1051                		mov	r5,@(4,r0)
(2) 2144/FFFFFFFFC000050E : 0009                		nop
(2) 2145/FFFFFFFFC0000510 : 5501                		mov	@(4,r0),r5
(2) 2146/FFFFFFFFC0000512 : 9069                		mov	#_JR,r0
(2) 2147/FFFFFFFFC0000514 : 2082                		mov	r8,@r0
(2) 2148/FFFFFFFFC0000516 : 1041                		mov	r4,@(4,r0)
(2) 2149/FFFFFFFFC0000518 : 0009                		nop
(2) 2150/FFFFFFFFC000051A : 5401                		mov	@(4,r0),r4
(2) 2151/FFFFFFFFC000051C : 4418                		shll8	r4
(2) 2152/FFFFFFFFC000051E : 4518                		shll8	r5
(2) 2153/FFFFFFFFC0000520 : D02C                		mov	#CachDDA_Src_L+$C,r0
(2) 2154/FFFFFFFFC0000522 : 2042                		mov	r4,@r0
(2) 2155/FFFFFFFFC0000524 : D02C                		mov	#CachDDA_Src_L+4,r0
(2) 2156/FFFFFFFFC0000526 : 2052                		mov	r5,@r0
(2) 2157/FFFFFFFFC0000528 : 6522                		mov	@r2,r5
(2) 2158/FFFFFFFFC000052A : 3518                		sub 	r1,r5
(2) 2159/FFFFFFFFC000052C : 6413                		mov 	r1,r4
(2) 2160/FFFFFFFFC000052E : 4518                		shll8	r5
(2) 2161/FFFFFFFFC0000530 : 4428                		shll16	r4
(2) 2162/FFFFFFFFC0000532 : 9059                		mov	#_JR,r0				; HW DIV
(2) 2163/FFFFFFFFC0000534 : 2082                		mov	r8,@r0
(2) 2164/FFFFFFFFC0000536 : 1051                		mov	r5,@(4,r0)
(2) 2165/FFFFFFFFC0000538 : 0009                		nop
(2) 2166/FFFFFFFFC000053A : 5501                		mov	@(4,r0),r5
(2) 2167/FFFFFFFFC000053C : E000                		mov	#0,r0				; Resume HW Division
(2) 2168/FFFFFFFFC000053E : C110                		mov.w	r0,@(marsGbl_DivReq_M,gbr)
(2) 2169/FFFFFFFFC0000540 : 4518                		shll8	r5
(2) 2170/FFFFFFFFC0000542 :                     .lft_skip:
(2) 2171/FFFFFFFFC0000542 : 000B                		rts
(2) 2172/FFFFFFFFC0000544 : 0009                		nop
(2) 2173/FFFFFFFFC0000546 :                     		align 4
(2) 2174/FFFFFFFFC0000548 :                     
(2) 2175/FFFFFFFFC0000548 :                     ; --------------------------------
(2) 2176/FFFFFFFFC0000548 :                     
(2) 2177/FFFFFFFFC0000548 :                     set_right:
(2) 2178/FFFFFFFFC0000548 : 6933                		mov	r3,r9
(2) 2179/FFFFFFFFC000054A : 7920                		add	#$20,r9
(2) 2180/FFFFFFFFC000054C : 6692                		mov	@r9,r6
(2) 2181/FFFFFFFFC000054E : 5791                		mov	@(4,r9),r7
(2) 2182/FFFFFFFFC0000550 : D922                		mov	#CachDDA_Src_R,r9
(2) 2183/FFFFFFFFC0000552 : 6063                		mov	r6,r0
(2) 2184/FFFFFFFFC0000554 : 4028                		shll16	r0
(2) 2185/FFFFFFFFC0000556 : 2902                		mov	r0,@r9
(2) 2186/FFFFFFFFC0000558 : 6073                		mov	r7,r0
(2) 2187/FFFFFFFFC000055A : 4028                		shll16	r0
(2) 2188/FFFFFFFFC000055C : 1902                		mov	r0,@(8,r9)
(2) 2189/FFFFFFFFC000055E :                     
(2) 2190/FFFFFFFFC000055E : 6132                		mov	@r3,r1
(2) 2191/FFFFFFFFC0000560 : 5931                		mov	@(4,r3),r9
(2) 2192/FFFFFFFFC0000562 : 73F8                		add	#-8,r3
(2) 2193/FFFFFFFFC0000564 : 33C3                		cmp/ge	r12,r3
(2) 2194/FFFFFFFFC0000566 : 8900                		bt	.rgt_ok
(2) 2195/FFFFFFFFC0000568 : 63D3                		mov 	r13,r3
(2) 2196/FFFFFFFFC000056A :                     .rgt_ok:
(2) 2197/FFFFFFFFC000056A : 5031                		mov	@(4,r3),r0
(2) 2198/FFFFFFFFC000056C : 3098                		sub	r9,r0
(2) 2199/FFFFFFFFC000056E : 8800                		cmp/eq	#0,r0
(2) 2200/FFFFFFFFC0000570 : 89EA                		bt	set_right
(2) 2201/FFFFFFFFC0000572 : 4011                		cmp/pz	r0
(2) 2202/FFFFFFFFC0000574 : 8B29                		bf	.rgt_skip
(2) 2203/FFFFFFFFC0000576 : 400A                		lds	r0,mach
(2) 2204/FFFFFFFFC0000578 : 6933                		mov	r3,r9
(2) 2205/FFFFFFFFC000057A : 7920                		add	#$20,r9
(2) 2206/FFFFFFFFC000057C : 6092                		mov 	@r9,r0
(2) 2207/FFFFFFFFC000057E : 3068                		sub 	r6,r0
(2) 2208/FFFFFFFFC0000580 : 5691                		mov 	@(4,r9),r6
(2) 2209/FFFFFFFFC0000582 : 3678                		sub 	r7,r6
(2) 2210/FFFFFFFFC0000584 : 6703                		mov	r0,r7
(2) 2211/FFFFFFFFC0000586 : 4618                		shll8	r6
(2) 2212/FFFFFFFFC0000588 : 4718                		shll8	r7
(2) 2213/FFFFFFFFC000058A : 090A                		sts	mach,r9
(2) 2214/FFFFFFFFC000058C : E001                		mov	#1,r0				; Resume HW Division
(2) 2215/FFFFFFFFC000058E : C110                		mov.w	r0,@(marsGbl_DivReq_M,gbr)
(2) 2216/FFFFFFFFC0000590 : 902A                		mov	#_JR,r0				; HW DIV
(2) 2217/FFFFFFFFC0000592 : 2092                		mov	r9,@r0
(2) 2218/FFFFFFFFC0000594 : 1071                		mov	r7,@(4,r0)
(2) 2219/FFFFFFFFC0000596 : 0009                		nop
(2) 2220/FFFFFFFFC0000598 : 5701                		mov	@(4,r0),r7
(2) 2221/FFFFFFFFC000059A : 9025                		mov	#_JR,r0
(2) 2222/FFFFFFFFC000059C : 2092                		mov	r9,@r0
(2) 2223/FFFFFFFFC000059E : 1061                		mov	r6,@(4,r0)
(2) 2224/FFFFFFFFC00005A0 : 0009                		nop
(2) 2225/FFFFFFFFC00005A2 : 5601                		mov	@(4,r0),r6
(2) 2226/FFFFFFFFC00005A4 : 4618                		shll8	r6
(2) 2227/FFFFFFFFC00005A6 : 4718                		shll8	r7
(2) 2228/FFFFFFFFC00005A8 : D00D                		mov	#CachDDA_Src_R+4,r0
(2) 2229/FFFFFFFFC00005AA : 2072                		mov	r7,@r0
(2) 2230/FFFFFFFFC00005AC : D00D                		mov	#CachDDA_Src_R+$C,r0
(2) 2231/FFFFFFFFC00005AE : 2062                		mov	r6,@r0
(2) 2232/FFFFFFFFC00005B0 : 6732                		mov	@r3,r7
(2) 2233/FFFFFFFFC00005B2 : 3718                		sub 	r1,r7
(2) 2234/FFFFFFFFC00005B4 : 6613                		mov 	r1,r6
(2) 2235/FFFFFFFFC00005B6 : 4628                		shll16	r6
(2) 2236/FFFFFFFFC00005B8 : 4718                		shll8	r7
(2) 2237/FFFFFFFFC00005BA : 9015                		mov	#_JR,r0				; HW DIV
(2) 2238/FFFFFFFFC00005BC : 2092                		mov	r9,@r0
(2) 2239/FFFFFFFFC00005BE : 1071                		mov	r7,@(4,r0)
(2) 2240/FFFFFFFFC00005C0 : 0009                		nop
(2) 2241/FFFFFFFFC00005C2 : 5701                		mov	@(4,r0),r7
(2) 2242/FFFFFFFFC00005C4 : E000                		mov	#0,r0				; Resume HW Division
(2) 2243/FFFFFFFFC00005C6 : C110                		mov.w	r0,@(marsGbl_DivReq_M,gbr)
(2) 2244/FFFFFFFFC00005C8 : 4718                		shll8	r7
(2) 2245/FFFFFFFFC00005CA :                     .rgt_skip:
(2) 2246/FFFFFFFFC00005CA : 000B                		rts
(2) 2247/FFFFFFFFC00005CC : 0009                		nop
(2) 2248/FFFFFFFFC00005CE :                     		align 4
(2) 2249/FFFFFFFFC00005D0 : C000 073C C000 0748 		ltorg
                    C000 0740 C000 074C 
                    C000 0750 C000 0758 
                    FF00                
(2) 2250/FFFFFFFFC00005EA :                     
(2) 2251/FFFFFFFFC00005EA :                     ; --------------------------------
(2) 2252/FFFFFFFFC00005EA :                     ; Mark piece
(2) 2253/FFFFFFFFC00005EA :                     ; --------------------------------
(2) 2254/FFFFFFFFC00005EA :                     
(2) 2255/FFFFFFFFC00005EA :                     put_piece:
(2) 2256/FFFFFFFFC00005EA : 5821                		mov	@(4,r2),r8
(2) 2257/FFFFFFFFC00005EC : 5931                		mov	@(4,r3),r9
(2) 2258/FFFFFFFFC00005EE : 38A8                		sub	r10,r8
(2) 2259/FFFFFFFFC00005F0 : 39A8                		sub	r10,r9
(2) 2260/FFFFFFFFC00005F2 : 6083                		mov	r8,r0
(2) 2261/FFFFFFFFC00005F4 : 3987                		cmp/gt	r8,r9
(2) 2262/FFFFFFFFC00005F6 : 8900                		bt	.lefth
(2) 2263/FFFFFFFFC00005F8 : 6093                		mov	r9,r0
(2) 2264/FFFFFFFFC00005FA :                     .lefth:
(2) 2265/FFFFFFFFC00005FA : 2F26                		mov	r2,@-r15
(2) 2266/FFFFFFFFC00005FC : 2F36                		mov	r3,@-r15
(2) 2267/FFFFFFFFC00005FE : 2F56                		mov	r5,@-r15
(2) 2268/FFFFFFFFC0000600 : 2F76                		mov	r7,@-r15
(2) 2269/FFFFFFFFC0000602 : 2F86                		mov	r8,@-r15
(2) 2270/FFFFFFFFC0000604 : 2F96                		mov	r9,@-r15
(2) 2271/FFFFFFFFC0000606 : 1141                		mov 	r4,@(plypz_xl,r1)
(2) 2272/FFFFFFFFC0000608 : 1152                		mov 	r5,@(plypz_xl_dx,r1)
(2) 2273/FFFFFFFFC000060A : 1163                		mov 	r6,@(plypz_xr,r1)
(2) 2274/FFFFFFFFC000060C : 1174                		mov 	r7,@(plypz_xr_dx,r1)
(2) 2275/FFFFFFFFC000060E : 350D                		dmuls	r0,r5
(2) 2276/FFFFFFFFC0000610 : 021A                		sts	macl,r2
(2) 2277/FFFFFFFFC0000612 : 370D                		dmuls	r0,r7
(2) 2278/FFFFFFFFC0000614 : 031A                		sts	macl,r3
(2) 2279/FFFFFFFFC0000616 : 342C                		add 	r2,r4
(2) 2280/FFFFFFFFC0000618 : 363C                		add	r3,r6
(2) 2281/FFFFFFFFC000061A : 62A3                		mov	r10,r2
(2) 2282/FFFFFFFFC000061C : 3A0C                		add	r0,r10
(2) 2283/FFFFFFFFC000061E : 63A3                		mov	r10,r3
(2) 2284/FFFFFFFFC0000620 : 4228                		shll16	r2
(2) 2285/FFFFFFFFC0000622 : 232B                		or	r2,r3
(2) 2286/FFFFFFFFC0000624 : 1130                		mov	r3,@(plypz_ypos,r1)
(2) 2287/FFFFFFFFC0000626 : 2F36                		mov	r3,@-r15
(2) 2288/FFFFFFFFC0000628 : D220                		mov	#CachDDA_Src_L,r2
(2) 2289/FFFFFFFFC000062A : 6522                		mov	@r2,r5
(2) 2290/FFFFFFFFC000062C : 1155                		mov	r5,@(plypz_src_xl,r1)
(2) 2291/FFFFFFFFC000062E : 5721                		mov	@(4,r2),r7
(2) 2292/FFFFFFFFC0000630 : 1176                		mov	r7,@(plypz_src_xl_dx,r1)
(2) 2293/FFFFFFFFC0000632 : 5822                		mov	@(8,r2),r8
(2) 2294/FFFFFFFFC0000634 : 1187                		mov	r8,@(plypz_src_yl,r1)
(2) 2295/FFFFFFFFC0000636 : 5923                		mov	@($C,r2),r9
(2) 2296/FFFFFFFFC0000638 : 1198                		mov	r9,@(plypz_src_yl_dx,r1)
(2) 2297/FFFFFFFFC000063A : 370D                		dmuls	r0,r7
(2) 2298/FFFFFFFFC000063C : 021A                		sts	macl,r2
(2) 2299/FFFFFFFFC000063E : 390D                		dmuls	r0,r9
(2) 2300/FFFFFFFFC0000640 : 031A                		sts	macl,r3
(2) 2301/FFFFFFFFC0000642 : 352C                		add 	r2,r5
(2) 2302/FFFFFFFFC0000644 : 383C                		add	r3,r8
(2) 2303/FFFFFFFFC0000646 : D21A                		mov	#CachDDA_Src_L,r2
(2) 2304/FFFFFFFFC0000648 : 2252                		mov	r5,@r2
(2) 2305/FFFFFFFFC000064A : 1282                		mov	r8,@(8,r2)
(2) 2306/FFFFFFFFC000064C : D219                		mov	#CachDDA_Src_R,r2
(2) 2307/FFFFFFFFC000064E : 6522                		mov	@r2,r5
(2) 2308/FFFFFFFFC0000650 : 1159                		mov	r5,@(plypz_src_xr,r1)
(2) 2309/FFFFFFFFC0000652 : 5721                		mov	@(4,r2),r7
(2) 2310/FFFFFFFFC0000654 : 117A                		mov	r7,@(plypz_src_xr_dx,r1)
(2) 2311/FFFFFFFFC0000656 : 5822                		mov	@(8,r2),r8
(2) 2312/FFFFFFFFC0000658 : 118B                		mov	r8,@(plypz_src_yr,r1)
(2) 2313/FFFFFFFFC000065A : 5923                		mov	@($C,r2),r9
(2) 2314/FFFFFFFFC000065C : 119C                		mov	r9,@(plypz_src_yr_dx,r1)
(2) 2315/FFFFFFFFC000065E : 370D                		dmuls	r0,r7
(2) 2316/FFFFFFFFC0000660 : 021A                		sts	macl,r2
(2) 2317/FFFFFFFFC0000662 : 390D                		dmuls	r0,r9
(2) 2318/FFFFFFFFC0000664 : 031A                		sts	macl,r3
(2) 2319/FFFFFFFFC0000666 : 352C                		add 	r2,r5
(2) 2320/FFFFFFFFC0000668 : 383C                		add	r3,r8
(2) 2321/FFFFFFFFC000066A : D213                		mov	#CachDDA_Src_R,r2
(2) 2322/FFFFFFFFC000066C : 2252                		mov	r5,@r2
(2) 2323/FFFFFFFFC000066E : 1282                		mov	r8,@(8,r2)
(2) 2324/FFFFFFFFC0000670 : 63F6                		mov	@r15+,r3
(2) 2325/FFFFFFFFC0000672 : 4315                		cmp/pl	r3			; TOP check, 2 steps
(2) 2326/FFFFFFFFC0000674 : 8902                		bt	.top_neg
(2) 2327/FFFFFFFFC0000676 : 4328                		shll16	r3
(2) 2328/FFFFFFFFC0000678 : 4315                		cmp/pl	r3
(2) 2329/FFFFFFFFC000067A : 8B0E                		bf	.bad_piece
(2) 2330/FFFFFFFFC000067C :                     .top_neg:
(2) 2331/FFFFFFFFC000067C : 50E1                		mov	@(polygn_mtrl,r14),r0
(2) 2332/FFFFFFFFC000067E : 110D                		mov 	r0,@(plypz_mtrl,r1)
(2) 2333/FFFFFFFFC0000680 : 50E0                		mov	@(polygn_type,r14),r0
(2) 2334/FFFFFFFFC0000682 : 110E                		mov 	r0,@(plypz_mtrlopt,r1)
(2) 2335/FFFFFFFFC0000684 : 713C                		add	#sizeof_plypz,r1
(2) 2336/FFFFFFFFC0000686 : 6013                		mov	r1,r0
(2) 2337/FFFFFFFFC0000688 : D80C                		mov	#RAM_Mars_VdpDrwList_e,r8
(2) 2338/FFFFFFFFC000068A : 3083                		cmp/ge	r8,r0
(2) 2339/FFFFFFFFC000068C : 8B01                		bf	.dontreset_pz
(2) 2340/FFFFFFFFC000068E : D00C                		mov	#RAM_Mars_VdpDrwList,r0
(2) 2341/FFFFFFFFC0000690 : 6103                		mov	r0,r1
(2) 2342/FFFFFFFFC0000692 :                     .dontreset_pz:
(2) 2343/FFFFFFFFC0000692 : C201                		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2) 2344/FFFFFFFFC0000694 : C50C                		mov.w	@(marsGbl_PzListCntr,gbr),r0
(2) 2345/FFFFFFFFC0000696 : 7001                		add	#1,r0
(2) 2346/FFFFFFFFC0000698 : C10C                		mov.w	r0,@(marsGbl_PzListCntr,gbr)
(2) 2347/FFFFFFFFC000069A :                     .bad_piece:
(2) 2348/FFFFFFFFC000069A : 69F6                		mov	@r15+,r9
(2) 2349/FFFFFFFFC000069C : 68F6                		mov	@r15+,r8
(2) 2350/FFFFFFFFC000069E : 67F6                		mov	@r15+,r7
(2) 2351/FFFFFFFFC00006A0 : 65F6                		mov	@r15+,r5
(2) 2352/FFFFFFFFC00006A2 : 63F6                		mov	@r15+,r3
(2) 2353/FFFFFFFFC00006A4 : 62F6                		mov	@r15+,r2
(2) 2354/FFFFFFFFC00006A6 : 000B                		rts
(2) 2355/FFFFFFFFC00006A8 : 0009                		nop
(2) 2356/FFFFFFFFC00006AA :                     		align 4
(2) 2357/FFFFFFFFC00006AC : C000 073C C000 073C 		ltorg
                    C000 074C C000 074C 
                    0602 0D9C 0601 909C 
(2) 2358/FFFFFFFFC00006C4 :                     
(2) 2359/FFFFFFFFC00006C4 :                     ; ------------------------------------------------
(2) 2360/FFFFFFFFC00006C4 :                     
(2) 2361/FFFFFFFFC00006C4 :                     		align 4
(2) 2362/FFFFFFFFC00006C4 :                     Cach_LnDrw_L	ds.l 14			;
(2) 2363/FFFFFFFFC00006FC :                     Cach_LnDrw_S	ds.l 0			; Reads backwards
(2) 2364/FFFFFFFFC00006FC :                     CachDDA_Top	ds.l 2*2		; First 2 points
(2) 2365/FFFFFFFFC000070C :                     CachDDA_Last	ds.l 2*2		; Triangle or Quad (+8)
(2) 2366/FFFFFFFFC000071C :                     CachDDA_Src	ds.l 4*2
(2) 2367/FFFFFFFFC000073C :                     CachDDA_Src_L	ds.l 4			; X/DX/Y/DX result for textures
(2) 2368/FFFFFFFFC000074C :                     CachDDA_Src_R	ds.l 4
(2) 2369/FFFFFFFFC000075C :                     Cach_ClrLines	ds.l 1
(2) 2370/FFFFFFFFC0000760 :                     
(2) 2371/FFFFFFFFC0000760 :                     ; ------------------------------------------------
(2) 2372/ 600161C :                     .end:		phase CACHE_MASTER+.end&$1FFF
(2) 2373/ 600161C :                     CACHE_MASTER_E:
(2) 2374/ 600161C :                     		align 4
(2) 2375/ 600161C :                     
(2) 2376/ 600161C :                     ; ====================================================================
(2) 2377/ 600161C :                     ; ----------------------------------------------------------------
(2) 2378/ 600161C :                     ; Video CACHE routines for Slave CPU
(2) 2379/ 600161C :                     ; ----------------------------------------------------------------
(2) 2380/ 600161C :                     
(2) 2381/ 600161C :                     		align 4
(2) 2382/ 600161C :                     CACHE_SLAVE:
(2) 2383/FFFFFFFFC0000000 :                     		phase $C0000000
(2) 2384/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2) 2385/FFFFFFFFC0000000 : 534C 4156 4520 4341 		dc.b "SLAVE CACHE CODE GOES HERE"
                    4348 4520 434F 4445 
                    2047 4F45 5320 4845 
                    5245                
(2) 2386/FFFFFFFFC000001A :                     ; ------------------------------------------------
(2) 2387/ 6001636 :                     .end:		phase CACHE_SLAVE+.end&$1FFF
(2) 2388/ 6001636 :                     CACHE_SLAVE_E:
(2) 2389/ 6001636 :                     		align 4
(2) 2390/ 6001638 :                     
(1)  518/ 6001638 :                     		include "system/mars/sound.asm"
(2)    1/ 6001638 :                     ; ====================================================================
(2)    2/ 6001638 :                     ; ----------------------------------------------------------------
(2)    3/ 6001638 :                     ; MARS Sound
(2)    4/ 6001638 :                     ; ----------------------------------------------------------------
(2)    5/ 6001638 :                     
(2)    6/ 6001638 : =$10                MAX_PWMCHNL	equ	16
(2)    7/ 6001638 :                     
(2)    8/ 6001638 :                     ; 32X sound channel
(2)    9/ 6001638 : (MACRO)             		struct 0
(2)    9/ 6001638 : =$6001638           GLBL_LASTPC     set *
(2)    9/    52A0 :                                     dephase
(2)    9/    52A0 : =$52A0              GLBL_LASTORG    set *
(2)    9/       0 :                                     phase 0
(2)   10/       0 :                     mchnsnd_enbl	ds.l 1
(2)   11/       4 :                     mchnsnd_read	ds.l 1		; 0 - off
(2)   12/       8 :                     mchnsnd_bank	ds.l 1		; CS0-3 OR value
(2)   13/       C :                     mchnsnd_start	ds.l 1
(2)   14/      10 :                     mchnsnd_end	ds.l 1
(2)   15/      14 :                     mchnsnd_loop	ds.l 1
(2)   16/      18 :                     mchnsnd_pitch	ds.l 1
(2)   17/      1C :                     mchnsnd_flags	ds.l 1
(2)   18/      20 :                     mchnsnd_vol	ds.l 1
(2)   19/      24 :                     sizeof_sndchn	ds.l 0
(2)   20/      24 : (MACRO)             		finish
(2)   20/       0 :                                     !org GLBL_LASTORG
(2)   20/ 6001638 :                                     phase GLBL_LASTPC
(2)   21/ 6001638 :                     
(2)   22/ 6001638 :                     ; ====================================================================
(2)   23/ 6001638 :                     ; ----------------------------------------------------------------
(2)   24/ 6001638 :                     ; Mars PWM control (Runs on VBlank)
(2)   25/ 6001638 :                     ; ----------------------------------------------------------------
(2)   26/ 6001638 :                     
(2)   27/ 6001638 :                     MarsSound_Run:
(2)   28/ 6001638 : 4F22                		sts	pr,@-r15
(2)   29/ 600163A :                     
(2)   30/ 600163A : 4F26                		lds	@r15+,pr
(2)   31/ 600163C : 000B                		rts
(2)   32/ 600163E : 0009                		nop
(2)   33/ 6001640 :                     		align 4
(2)   34/ 6001640 :                     
(2)   35/ 6001640 :                     ; ====================================================================
(2)   36/ 6001640 :                     ; ----------------------------------------------------------------
(2)   37/ 6001640 :                     ; Mars PWM playback (Runs on PWM interrupt)
(2)   38/ 6001640 :                     ; 
(2)   39/ 6001640 :                     ; READ/START/END/LOOP points are floating values (xxxxxx.00)
(2)   40/ 6001640 :                     ; 
(2)   41/ 6001640 :                     ; r0-r8 only
(2)   42/ 6001640 :                     ; ----------------------------------------------------------------
(2)   43/ 6001640 :                     
(2)   44/ 6001640 :                     MarsSound_PWM:
(2)   45/ 6001640 : 2F26                		mov.l	r2,@-r15
(2)   46/ 6001642 : 2F36                		mov.l	r3,@-r15
(2)   47/ 6001644 : 2F46                		mov.l	r4,@-r15
(2)   48/ 6001646 : 2F56                		mov.l	r5,@-r15
(2)   49/ 6001648 : 2F66                		mov.l	r6,@-r15
(2)   50/ 600164A : 2F76                		mov.l	r7,@-r15
(2)   51/ 600164C : 2F86                		mov.l	r8,@-r15
(2)   52/ 600164E : D721                		mov	#MarsSnd_PwmChnls,r7
(2)   53/ 6001650 : E301                		mov 	#1,r3			; LEFT
(2)   54/ 6001652 : E401                		mov 	#1,r4			; RIGHT
(2)   55/ 6001654 : E508                		mov 	#8,r5			; numof_chn
(2)   56/ 6001656 :                     		
(2)   57/ 6001656 :                     ; ------------------------------------------------
(2)   58/ 6001656 :                     ; Read wave data
(2)   59/ 6001656 :                     ; ------------------------------------------------
(2)   60/ 6001656 :                     
(2)   61/ 6001656 :                     .nxtchn:
(2)   62/ 6001656 : 5070                		mov 	@(mchnsnd_enbl,r7),r0
(2)   63/ 6001658 : 8800                		cmp/eq	#0,r0
(2)   64/ 600165A : 8920                		bt	.chnoff
(2)   65/ 600165C : 5171                		mov 	@(mchnsnd_read,r7),r1
(2)   66/ 600165E : 6213                		mov 	r1,r2
(2)   67/ 6001660 : 5072                		mov 	@(mchnsnd_bank,r7),r0
(2)   68/ 6001662 : 4219                		shlr8	r2
(2)   69/ 6001664 : 220B                		or	r0,r2
(2)   70/ 6001666 :                     
(2)   71/ 6001666 :                     ; Check end and loop
(2)   72/ 6001666 : 5074                		mov 	@(mchnsnd_end,r7),r0
(2)   73/ 6001668 : 3103                		cmp/ge	r0,r1
(2)   74/ 600166A : 8B0A                		bf	.read
(2)   75/ 600166C : 5075                		mov 	@(mchnsnd_loop,r7),r0
(2)   76/ 600166E : 88FF                		cmp/eq	#-1,r0
(2)   77/ 6001670 : 8B04                		bf	.noend
(2)   78/ 6001672 : E000                		mov 	#0,r0
(2)   79/ 6001674 : 1700                		mov 	r0,@(mchnsnd_enbl,r7)
(2)   80/ 6001676 : 5173                		mov 	@(mchnsnd_start,r7),r1
(2)   81/ 6001678 : A010                		bra	.keep
(2)   82/ 600167A : 0009                		nop
(2)   83/ 600167C :                     .noend:
(2)   84/ 600167C : 5173                		mov 	@(mchnsnd_start,r7),r1
(2)   85/ 600167E : A00D                		bra	.keep
(2)   86/ 6001680 : 0009                		nop
(2)   87/ 6001682 :                     ; Read WAV
(2)   88/ 6001682 :                     .read:
(2)   89/ 6001682 : 6020                		mov.b	@r2,r0
(2)   90/ 6001684 : C9FF                		and 	#$FF,r0
(2)   91/ 6001686 : 4000                		shll	r0				; manual volume
(2)   92/ 6001688 : 6203                		mov 	r0,r2
(2)   93/ 600168A : 5077                		mov 	@(mchnsnd_flags,r7),r0
(2)   94/ 600168C : C802                		tst	#2,r0
(2)   95/ 600168E : 8900                		bt	.nor
(2)   96/ 6001690 : 332C                		add	r2,r3
(2)   97/ 6001692 :                     .nor:
(2)   98/ 6001692 : C801                		tst	#1,r0
(2)   99/ 6001694 : 8900                		bt	.nol
(2)  100/ 6001696 : 342C                		add	r2,r4
(2)  101/ 6001698 :                     .nol:
(2)  102/ 6001698 : 5076                		mov 	@(mchnsnd_pitch,r7),r0
(2)  103/ 600169A : 310C                		add	r0,r1
(2)  104/ 600169C :                     		
(2)  105/ 600169C :                     ; save read
(2)  106/ 600169C :                     .keep:
(2)  107/ 600169C : 1711                		mov 	r1,@(mchnsnd_read,r7)
(2)  108/ 600169E :                     
(2)  109/ 600169E :                     .chnoff:
(2)  110/ 600169E : 7724                		add	#sizeof_sndchn,r7
(2)  111/ 60016A0 : 4510                		dt	r5
(2)  112/ 60016A2 : 8BD8                		bf	.nxtchn
(2)  113/ 60016A4 :                     
(2)  114/ 60016A4 :                     ; ------------------------------------------------
(2)  115/ 60016A4 :                     ; Play wave
(2)  116/ 60016A4 :                     ; 
(2)  117/ 60016A4 :                     ; r3 - left wave
(2)  118/ 60016A4 :                     ; r4 - right wave
(2)  119/ 60016A4 :                     ; ------------------------------------------------
(2)  120/ 60016A4 :                     
(2)  121/ 60016A4 : D10C                		mov	#_sysreg+monowidth,r1
(2)  122/ 60016A6 :                     .full:
(2)  123/ 60016A6 : 6010                		mov.b	@r1,r0
(2)  124/ 60016A8 : C880                 		tst	#$80,r0
(2)  125/ 60016AA : 8BFC                 		bf	.full
(2)  126/ 60016AC : D10B                		mov	#_sysreg+lchwidth,r1
(2)  127/ 60016AE : D20C                		mov	#_sysreg+rchwidth,r2
(2)  128/ 60016B0 : 6033                 		mov	r3,r0
(2)  129/ 60016B2 : 2101                 		mov.w	r0,@r1
(2)  130/ 60016B4 : 6043                 		mov	r4,r0
(2)  131/ 60016B6 : 2201                 		mov.w	r0,@r2
(2)  132/ 60016B8 :                      		
(2)  133/ 60016B8 : D10A                		mov	#_sysreg+comm4,r1
(2)  134/ 60016BA : 6011                		mov.w	@r1,r0
(2)  135/ 60016BC : 7001                		add	#1,r0
(2)  136/ 60016BE : 2101                		mov.w	r0,@r1
(2)  137/ 60016C0 :                     
(2)  138/ 60016C0 : 68F6                		mov.l	@r15+,r8
(2)  139/ 60016C2 : 67F6                		mov.l	@r15+,r7
(2)  140/ 60016C4 : 66F6                		mov.l	@r15+,r6
(2)  141/ 60016C6 : 65F6                		mov.l	@r15+,r5
(2)  142/ 60016C8 : 64F6                		mov.l	@r15+,r4
(2)  143/ 60016CA : 63F6                		mov.l	@r15+,r3
(2)  144/ 60016CC : 62F6                		mov.l	@r15+,r2
(2)  145/ 60016CE : 000B                		rts
(2)  146/ 60016D0 : 0009                		nop
(2)  147/ 60016D2 :                     		align 4
(2)  148/ 60016D4 : 0602 23A0 2000 4038 		ltorg
                    2000 4034 2000 4036 
                    2000 4024           
(2)  149/ 60016E8 :                     
(2)  150/ 60016E8 :                     ; ====================================================================
(2)  151/ 60016E8 :                     ; ----------------------------------------------------------------
(2)  152/ 60016E8 :                     ; Subroutines
(2)  153/ 60016E8 :                     ; ----------------------------------------------------------------
(2)  154/ 60016E8 :                     
(2)  155/ 60016E8 :                     ; --------------------------------------------------------
(2)  156/ 60016E8 :                     ; Init Sound PWM
(2)  157/ 60016E8 :                     ; 
(2)  158/ 60016E8 :                     ; Frequency values:
(2)  159/ 60016E8 :                     ; 23011361 NTSC
(2)  160/ 60016E8 :                     ; 22801467 PAL
(2)  161/ 60016E8 :                     ; 
(2)  162/ 60016E8 :                     ; NOTE: This causes a CLICK on boot, it's normal
(2)  163/ 60016E8 :                     ; --------------------------------------------------------
(2)  164/ 60016E8 :                     
(2)  165/ 60016E8 :                     MarsSound_Init:
(2)  166/ 60016E8 : 4F22                		sts	pr,@-r15
(2)  167/ 60016EA : 4F13                		stc	gbr,@-r15
(2)  168/ 60016EC : D01A                		mov	#_sysreg,r0
(2)  169/ 60016EE : 401E                		ldc	r0,gbr
(2)  170/ 60016F0 : 903A                		mov	#((((23011361<<1)/22050+1)>>1)+1),r0	; 22050 best
(2)  171/ 60016F2 : C119                		mov.w	r0,@(cycle,gbr)
(2)  172/ 60016F4 : 9039                		mov	#$0105,r0
(2)  173/ 60016F6 : C118                		mov.w	r0,@(timerctl,gbr)
(2)  174/ 60016F8 : E001                		mov	#1,r0
(2)  175/ 60016FA : C11C                		mov.w	r0,@(monowidth,gbr)
(2)  176/ 60016FC : C11C                		mov.w	r0,@(monowidth,gbr)
(2)  177/ 60016FE : C11C                		mov.w	r0,@(monowidth,gbr)
(2)  178/ 6001700 :                     		
(2)  179/ 6001700 : E000                		mov	#0,r0
(2)  180/ 6001702 : D116                		mov	#MarsSnd_PwmChnls,r1
(2)  181/ 6001704 : E210                		mov	#MAX_PWMCHNL,r2
(2)  182/ 6001706 : E324                		mov	#sizeof_sndchn,r3
(2)  183/ 6001708 :                     .clr_enbl:
(2)  184/ 6001708 : 1100                		mov	r0,@(mchnsnd_enbl,r1)
(2)  185/ 600170A : 4210                		dt	r2
(2)  186/ 600170C : 8FFC                		bf/s	.clr_enbl
(2)  187/ 600170E : 313C                		add	r3,r1
(2)  188/ 6001710 :                     		
(2)  189/ 6001710 : 4F17                		ldc	@r15+,gbr
(2)  190/ 6001712 : 4F26                		lds	@r15+,pr
(2)  191/ 6001714 : 000B                		rts
(2)  192/ 6001716 : 0009                		nop
(2)  193/ 6001718 :                     		align 4
(2)  194/ 6001718 :                     
(2)  195/ 6001718 :                     ; --------------------------------------------------------
(2)  196/ 6001718 :                     ; MarsSound_SetChannel
(2)  197/ 6001718 :                     ; 
(2)  198/ 6001718 :                     ; Set sound data to channel
(2)  199/ 6001718 :                     ; 
(2)  200/ 6001718 :                     ; Input:
(2)  201/ 6001718 :                     ; r1 | Channel
(2)  202/ 6001718 :                     ; r2 | Start address
(2)  203/ 6001718 :                     ; r3 | End address
(2)  204/ 6001718 :                     ; r4 | Loop address (-1, dont loop)
(2)  205/ 6001718 :                     ; r5 | Pitch ($xxxxxx.xx)
(2)  206/ 6001718 :                     ; r6 | Volume
(2)  207/ 6001718 :                     ; r7 | Flags (Currently: %xxxxxxLR)
(2)  208/ 6001718 :                     ; 
(2)  209/ 6001718 :                     ; Uses:
(2)  210/ 6001718 :                     ; r0,r8-r9
(2)  211/ 6001718 :                     ; --------------------------------------------------------
(2)  212/ 6001718 :                     
(2)  213/ 6001718 :                     MarsSound_SetChannel:
(2)  214/ 6001718 :                     ; 		stc	sr,r9
(2)  215/ 6001718 :                     ; 		mov	#$F0,r0
(2)  216/ 6001718 :                     ; 		ldc	r0,sr
(2)  217/ 6001718 : D811                		mov	#MarsSnd_PwmChnls,r8
(2)  218/ 600171A : E024                		mov 	#sizeof_sndchn,r0
(2)  219/ 600171C : 201E                		mulu	r1,r0
(2)  220/ 600171E : 001A                		sts	macl,r0
(2)  221/ 6001720 : 380C                		add 	r0,r8
(2)  222/ 6001722 : E000                		mov 	#0,r0
(2)  223/ 6001724 : 1800                		mov 	r0,@(mchnsnd_enbl,r8)
(2)  224/ 6001726 : 1801                		mov 	r0,@(mchnsnd_read,r8)
(2)  225/ 6001728 : 1802                		mov 	r0,@(mchnsnd_bank,r8)
(2)  226/ 600172A :                     		
(2)  227/ 600172A : 1856                		mov 	r5,@(mchnsnd_pitch,r8)
(2)  228/ 600172C : 1868                		mov 	r6,@(mchnsnd_vol,r8)		
(2)  229/ 600172E : 1877                		mov 	r7,@(mchnsnd_flags,r8)
(2)  230/ 6001730 : 6023                		mov 	r2,r0				; Set MSB
(2)  231/ 6001732 : D70C                		mov 	#$FF000000,r7
(2)  232/ 6001734 : 2079                		and 	r7,r0
(2)  233/ 6001736 : 1802                		mov 	r0,@(mchnsnd_bank,r8)
(2)  234/ 6001738 : 6043                		mov 	r4,r0				; Set POINTS
(2)  235/ 600173A : 88FF                		cmp/eq	#-1,r0
(2)  236/ 600173C : 8900                		bt	.endmrk
(2)  237/ 600173E : 4018                		shll8	r0
(2)  238/ 6001740 :                     .endmrk:
(2)  239/ 6001740 : 1805                		mov	r0,@(mchnsnd_loop,r8)
(2)  240/ 6001742 : 6033                		mov 	r3,r0
(2)  241/ 6001744 : 4018                		shll8	r0
(2)  242/ 6001746 : 1804                		mov	r0,@(mchnsnd_end,r8)
(2)  243/ 6001748 : 6023                		mov 	r2,r0
(2)  244/ 600174A : 4018                		shll8	r0
(2)  245/ 600174C : 1803                		mov 	r0,@(mchnsnd_start,r8)	
(2)  246/ 600174E : 1801                		mov 	r0,@(mchnsnd_read,r8)
(2)  247/ 6001750 : E001                		mov 	#1,r0
(2)  248/ 6001752 : 1800                		mov 	r0,@(mchnsnd_enbl,r8)
(2)  249/ 6001754 :                     ;  		ldc	r9,sr
(2)  250/ 6001754 : 000B                		rts
(2)  251/ 6001756 : 0009                		nop
(2)  252/ 6001758 :                     		align 4
(2)  253/ 6001758 :                     
(2)  254/ 6001758 :                     ; ====================================================================
(2)  255/ 6001758 :                     
(2)  256/ 6001758 : 2000 4000 0602 23A0 		ltorg			; Save literals
                    0602 23A0 FF00 0000 
                    0415 0105           
(2)  257/ 600176C :                     
(1)  519/ 600176C :                     		align 4
(1)  520/ 600176C :                     
(1)  521/ 600176C :                     ; ====================================================================
(1)  522/ 600176C :                     ; ----------------------------------------------------------------
(1)  523/ 600176C :                     ; Master entry
(1)  524/ 600176C :                     ; ----------------------------------------------------------------
(1)  525/ 600176C :                     
(1)  526/ 600176C :                     		align 4
(1)  527/ 600176C :                     SH2_M_Entry:
(1)  528/ 600176C : DF54                		mov	#CS3|$40000,r15			; Set default Stack for Master
(1)  529/ 600176E : 91CD                		mov	#_FRT,r1
(1)  530/ 6001770 : E000                		mov     #0,r0
(1)  531/ 6001772 : 8010                		mov.b   r0,@(0,r1)
(1)  532/ 6001774 : E0E2                		mov     #$FFFFFFE2,r0
(1)  533/ 6001776 : 8017                		mov.b   r0,@(7,r1)
(1)  534/ 6001778 : E000                		mov     #0,r0
(1)  535/ 600177A : 8014                		mov.b   r0,@(4,r1)
(1)  536/ 600177C : E001                		mov     #1,r0
(1)  537/ 600177E : 8015                		mov.b   r0,@(5,r1)
(1)  538/ 6001780 : E000                		mov     #0,r0
(1)  539/ 6001782 : 8016                		mov.b   r0,@(6,r1)
(1)  540/ 6001784 : E001                		mov     #1,r0
(1)  541/ 6001786 : 8011                		mov.b   r0,@(1,r1)
(1)  542/ 6001788 : E000                		mov     #0,r0
(1)  543/ 600178A : 8013                		mov.b   r0,@(3,r1)
(1)  544/ 600178C : 8012                		mov.b   r0,@(2,r1)
(1)  545/ 600178E : 90BE                		mov.l   #$FFFFFEE2,r0			; Pre-init special interrupt
(1)  546/ 6001790 : E150                		mov     #$50,r1
(1)  547/ 6001792 : 2011                		mov.w   r1,@r0
(1)  548/ 6001794 : 90BC                		mov.l   #$FFFFFEE4,r0
(1)  549/ 6001796 : E148                		mov     #$120/4,r1			; VBR + this/4
(1)  550/ 6001798 : 4118                		shll8   r1
(1)  551/ 600179A : 2011                		mov.w   r1,@r0
(1)  552/ 600179C :                     
(1)  553/ 600179C :                     ; ------------------------------------------------
(1)  554/ 600179C :                     ; Wait for Genesis and Slave CPU
(1)  555/ 600179C :                     ; ------------------------------------------------
(1)  556/ 600179C :                     
(1)  557/ 600179C :                     .wait_md:
(1)  558/ 600179C : D249                		mov 	#_sysreg+comm0,r2		; Wait for Genesis
(1)  559/ 600179E : 6022                		mov.l	@r2,r0
(1)  560/ 60017A0 : 8800                		cmp/eq	#0,r0
(1)  561/ 60017A2 : 8BFB                		bf	.wait_md
(1)  562/ 60017A4 : D148                		mov.l	#"SLAV",r1
(1)  563/ 60017A6 :                     .wait_slave:
(1)  564/ 60017A6 : 5022                		mov.l	@(8,r2),r0			; Wait for Slave CPU to finish booting
(1)  565/ 60017A8 : 3010                		cmp/eq	r1,r0
(1)  566/ 60017AA : 8BFC                		bf	.wait_slave
(1)  567/ 60017AC : E000                		mov.l	#0,r0				; clear "SLAV"
(1)  568/ 60017AE : 1202                		mov.l	r0,@(8,r2)
(1)  569/ 60017B0 : 2202                		mov.l	r0,@r2
(1)  570/ 60017B2 :                     		
(1)  571/ 60017B2 :                     ; ====================================================================
(1)  572/ 60017B2 :                     ; ----------------------------------------------------------------
(1)  573/ 60017B2 :                     ; Master main code
(1)  574/ 60017B2 :                     ; 
(1)  575/ 60017B2 :                     ; This CPU is exclusively used for drawing polygons, to interact
(1)  576/ 60017B2 :                     ; with models use the Slave CPU instead.
(1)  577/ 60017B2 :                     ; ----------------------------------------------------------------
(1)  578/ 60017B2 :                     
(1)  579/ 60017B2 :                     SH2_M_HotStart:
(1)  580/ 60017B2 : DF43                		mov	#CS3|$40000,r15				; Stack again if coming from RESET
(1)  581/ 60017B4 : DE45                		mov	#RAM_Mars_Global,r14			; GBR - Global values/variables
(1)  582/ 60017B6 : 4E1E                		ldc	r14,gbr
(1)  583/ 60017B8 : 90AB                		mov	#$F0,r0					; Interrupts OFF
(1)  584/ 60017BA : 400E                		ldc	r0,sr
(1)  585/ 60017BC : 91AA                		mov	#_CCR,r1
(1)  586/ 60017BE : E000                		mov	#0,r0					; Cache OFF
(1)  587/ 60017C0 : 2101                		mov.w	r0,@r1
(1)  588/ 60017C2 : E019                		mov	#%00011001,r0				; Cache purge / Two-way mode / Cache ON
(1)  589/ 60017C4 : 2101                		mov.w	r0,@r1
(1)  590/ 60017C6 : D142                		mov	#_sysreg,r1
(1)  591/ 60017C8 : E00B                		mov	#VIRQ_ON|CMDIRQ_ON|PWMIRQ_ON,r0		; Enable these interrupts		
(1)  592/ 60017CA : 8011                    		mov.b	r0,@(intmask,r1)
(1)  593/ 60017CC : D141                		mov 	#CACHE_MASTER,r1			; Load 3D Routines on CACHE	
(1)  594/ 60017CE : D242                		mov 	#$C0000000,r2				; Those run more faster here supposedly...
(1)  595/ 60017D0 : 93A1                		mov 	#(CACHE_MASTER_E-CACHE_MASTER)/4,r3
(1)  596/ 60017D2 :                     .copy:
(1)  597/ 60017D2 : 6016                		mov 	@r1+,r0
(1)  598/ 60017D4 : 2202                		mov 	r0,@r2
(1)  599/ 60017D6 : 7204                		add 	#4,r2
(1)  600/ 60017D8 : 4310                		dt	r3
(1)  601/ 60017DA : 8BFA                		bf	.copy
(1)  602/ 60017DC :                     		
(1)  603/ 60017DC :                     ; ------------------------------------------------
(1)  604/ 60017DC :                     
(1)  605/ 60017DC : D03F                		mov	#MarsVideo_Init,r0		; Init Video
(1)  606/ 60017DE : 400B                		jsr	@r0
(1)  607/ 60017E0 : 0009                		nop
(1)  608/ 60017E2 : BF81                		bsr	MarsSound_Init			; Init Sound
(1)  609/ 60017E4 : 0009                		nop
(1)  610/ 60017E6 :                     		
(1)  611/ 60017E6 :                     ; ------------------------------------------------
(1)  612/ 60017E6 :                     
(1)  613/ 60017E6 : 9195                		mov	#_CCR,r1
(1)  614/ 60017E8 : E008                		mov	#%00001000,r0			; Two-way mode
(1)  615/ 60017EA : 2101                		mov.w	r0,@r1
(1)  616/ 60017EC : E019                		mov	#%00011001,r0			; Cache purge / Two-way mode / Cache ON
(1)  617/ 60017EE : 2101                		mov.w	r0,@r1
(1)  618/ 60017F0 : E020                		mov.l	#$20,r0				; Interrupts ON
(1)  619/ 60017F2 : 400E                		ldc	r0,sr
(1)  620/ 60017F4 :                     
(1)  621/ 60017F4 : D13A                		mov	#Palette_Map,r1
(1)  622/ 60017F6 : E200                		mov	#0,r2
(1)  623/ 60017F8 : 938E                		mov	#256,r3
(1)  624/ 60017FA : E400                		mov	#0,r4
(1)  625/ 60017FC : D039                		mov	#MarsVideo_LoadPal,r0
(1)  626/ 60017FE : 400B                		jsr	@r0
(1)  627/ 6001800 : 0009                		nop
(1)  628/ 6001802 :                     
(1)  629/ 6001802 :                     ; --------------------------------------------------------
(1)  630/ 6001802 :                     ; Loop
(1)  631/ 6001802 :                     ; --------------------------------------------------------
(1)  632/ 6001802 :                     
(1)  633/ 6001802 :                     master_loop:
(1)  634/ 6001802 : D430                		mov	#_sysreg+comm0,r4
(1)  635/ 6001804 : 6041                		mov.w	@r4,r0
(1)  636/ 6001806 : 7001                		add	#1,r0
(1)  637/ 6001808 : 2401                		mov.w	r0,@r4
(1)  638/ 600180A :                     
(1)  639/ 600180A : D137                		mov	#_sysreg+comm14,r1
(1)  640/ 600180C : 6010                		mov.b	@r1,r0			; Any request from Slave?
(1)  641/ 600180E : 6203                		mov	r0,r2
(1)  642/ 6001810 : C980                		and 	#$80,r0
(1)  643/ 6001812 : 8800                		cmp/eq	#0,r0
(1)  644/ 6001814 : 8B06                		bf	.md_req
(1)  645/ 6001816 : 6023                		mov	r2,r0
(1)  646/ 6001818 : C97F                		and	#$7F,r0
(1)  647/ 600181A : 8800                		cmp/eq	#0,r0
(1)  648/ 600181C : 8B1B                		bf	.draw_objects		; If !=0, start drawing
(1)  649/ 600181E : 0009                		nop
(1)  650/ 6001820 : AFEF                		bra	master_loop
(1)  651/ 6001822 : 0009                		nop
(1)  652/ 6001824 :                     		align 4
(1)  653/ 6001824 :                     
(1)  654/ 6001824 :                     ; Process Visual/Audio requests from Genesis
(1)  655/ 6001824 :                     .md_req:
(1)  656/ 6001824 : 4F03                		stc	sr,@-r15
(1)  657/ 6001826 : 9074                		mov	#$F0,r0
(1)  658/ 6001828 : 400E                		ldc	r0,sr
(1)  659/ 600182A : ED10                		mov	#MAX_MDTASKS,r13
(1)  660/ 600182C : DE2F                		mov	#RAM_Mars_MdTasksFifo_M,r14
(1)  661/ 600182E :                     .next_req:
(1)  662/ 600182E : 2FD6                		mov	r13,@-r15
(1)  663/ 6001830 : 60E2                		mov	@r14,r0
(1)  664/ 6001832 : 8800                		cmp/eq	#0,r0
(1)  665/ 6001834 : 8903                		bt	.no_task
(1)  666/ 6001836 : 400B                		jsr	@r0
(1)  667/ 6001838 : 0009                		nop
(1)  668/ 600183A : 200A                		xor	r0,r0
(1)  669/ 600183C : 2E02                		mov	r0,@r14
(1)  670/ 600183E :                     .no_task:
(1)  671/ 600183E : E020                		mov	#MAX_MDTSKARG*4,r0
(1)  672/ 6001840 : 6DF6                		mov	@r15+,r13
(1)  673/ 6001842 : 4D10                		dt	r13
(1)  674/ 6001844 : 8FF3                		bf/s	.next_req
(1)  675/ 6001846 : 3E0C                		add	r0,r14
(1)  676/ 6001848 : D127                		mov	#_sysreg+comm14,r1
(1)  677/ 600184A : 6010                		mov.b	@r1,r0
(1)  678/ 600184C : C97F                		and	#$7F,r0
(1)  679/ 600184E : 2100                		mov.b	r0,@r1
(1)  680/ 6001850 : 4F07                		ldc 	@r15+,sr
(1)  681/ 6001852 : AFD6                		bra	master_loop
(1)  682/ 6001854 : 0009                		nop
(1)  683/ 6001856 :                     
(1)  684/ 6001856 :                     ; --------------------------------------------------------
(1)  685/ 6001856 :                     ; Start building and drawing polygons
(1)  686/ 6001856 :                     ; --------------------------------------------------------
(1)  687/ 6001856 :                     
(1)  688/ 6001856 :                     .draw_objects:
(1)  689/ 6001856 : 905D                		mov.l	#$FFFFFE92,r0
(1)  690/ 6001858 : E108                		mov	#8,r1
(1)  691/ 600185A : 2010                		mov.b	r1,@r0
(1)  692/ 600185C : E119                		mov	#$19,r1
(1)  693/ 600185E : 2010                		mov.b	r1,@r0
(1)  694/ 6001860 : D023                		mov	#MarsVideo_SetWatchdog,r0
(1)  695/ 6001862 : 400B                		jsr	@r0
(1)  696/ 6001864 : 0009                		nop
(1)  697/ 6001866 : C50B                		mov.w   @(marsGbl_PolyBuffNum,gbr),r0	; Start drawing polygons from the READ buffer
(1)  698/ 6001868 : C801                		tst     #1,r0				; Check for which buffer to use
(1)  699/ 600186A : 8903                		bt	.page_2
(1)  700/ 600186C : DE21                		mov 	#RAM_Mars_PlgnList_0,r14
(1)  701/ 600186E : DD22                		mov	#RAM_Mars_PlgnNum_0,r13
(1)  702/ 6001870 : A002                		bra	.cont_plgn
(1)  703/ 6001872 : 0009                		nop
(1)  704/ 6001874 :                     .page_2:
(1)  705/ 6001874 : DE21                		mov 	#RAM_Mars_PlgnList_1,r14
(1)  706/ 6001876 : DD22                		mov	#RAM_Mars_PlgnNum_1,r13
(1)  707/ 6001878 :                     .cont_plgn:
(1)  708/ 6001878 :                     
(1)  709/ 6001878 :                     	; While we are doing this, the watchdog is
(1)  710/ 6001878 :                     	; working on the background drawing the polygons
(1)  711/ 6001878 :                     	; using the "pieces" list
(1)  712/ 6001878 :                     	; 
(1)  713/ 6001878 :                     	; r14 - Polygon pointers list
(1)  714/ 6001878 :                     	; r13 - Number of polygons to build
(1)  715/ 6001878 : 6DD1                		mov.w	@r13,r13
(1)  716/ 600187A : 4D15                		cmp/pl	r13
(1)  717/ 600187C : 8B0C                		bf	.skip
(1)  718/ 600187E :                     .loop:
(1)  719/ 600187E : 2FE6                		mov	r14,@-r15
(1)  720/ 6001880 : 2FD6                		mov	r13,@-r15
(1)  721/ 6001882 : 6EE2                		mov	@r14,r14			; Get location of the polygon
(1)  722/ 6001884 : 4E15                		cmp/pl	r14
(1)  723/ 6001886 : 8B02                		bf	.invalid
(1)  724/ 6001888 : D01E                		mov 	#MarsVideo_MakePolygon,r0
(1)  725/ 600188A : 400B                		jsr	@r0
(1)  726/ 600188C : 0009                		nop
(1)  727/ 600188E :                     .invalid:
(1)  728/ 600188E : 6DF6                		mov	@r15+,r13
(1)  729/ 6001890 : 6EF6                		mov	@r15+,r14
(1)  730/ 6001892 : 4D10                		dt	r13
(1)  731/ 6001894 : 8FF3                		bf/s	.loop
(1)  732/ 6001896 : 7E04                		add	#4,r14
(1)  733/ 6001898 :                     .skip:
(1)  734/ 6001898 :                     
(1)  735/ 6001898 :                     	; --------------------------------------
(1)  736/ 6001898 : C50C                .wait_pz: 	mov.w	@(marsGbl_PzListCntr,gbr),r0	; Any pieces remaining on interrupt?
(1)  737/ 600189A : 8800                		cmp/eq	#0,r0
(1)  738/ 600189C : 8BFC                		bf	.wait_pz
(1)  739/ 600189E : C50D                .wait_task:	mov.w	@(marsGbl_DrwTask,gbr),r0	; Any draw task active?
(1)  740/ 60018A0 : 8800                		cmp/eq	#0,r0
(1)  741/ 60018A2 : 8BFC                		bf	.wait_task
(1)  742/ 60018A4 : 9139                		mov.l   #$FFFFFE80,r1			; Stop watchdog
(1)  743/ 60018A6 : 9039                		mov.w   #$A518,r0
(1)  744/ 60018A8 : 2101                		mov.w   r0,@r1
(1)  745/ 60018AA : D117                		mov	#_vdpreg,r1			; Framebuffer swap request
(1)  746/ 60018AC : 841B                		mov.b	@(framectl,r1),r0		; watchdog will check for it later
(1)  747/ 60018AE : CA01                		xor	#1,r0
(1)  748/ 60018B0 : 801B                		mov.b	r0,@(framectl,r1)
(1)  749/ 60018B2 : C022                		mov.b	r0,@(marsGbl_CurrFb,gbr)
(1)  750/ 60018B4 :                     
(1)  751/ 60018B4 :                     	; --------------------
(1)  752/ 60018B4 :                     	; DEBUG counter
(1)  753/ 60018B4 :                     ; 		mov	#_sysreg+comm4,r1
(1)  754/ 60018B4 :                     ; 		mov.w	@r1,r0
(1)  755/ 60018B4 :                     ; 		add	#1,r0
(1)  756/ 60018B4 :                     ; 		mov.w	r0,@r1
(1)  757/ 60018B4 :                     	; --------------------
(1)  758/ 60018B4 :                     	
(1)  759/ 60018B4 : D10C                		mov	#_sysreg+comm14,r1
(1)  760/ 60018B6 : 6010                		mov.b	@r1,r0
(1)  761/ 60018B8 : C980                		and	#$80,r0
(1)  762/ 60018BA : 2100                		mov.b	r0,@r1
(1)  763/ 60018BC : AFA1                		bra	master_loop
(1)  764/ 60018BE : 0009                		nop
(1)  765/ 60018C0 :                     		align 4
(1)  766/ 60018C0 : 0604 0000 2000 4020 		ltorg
                    534C 4156 0601 1508 
                    2000 4000 0600 0EBC 
                    C000 0000 0600 064E 
                    0600 4660 0600 06F0 
                    2000 402E 0602 1D9C 
                    0600 0E64 0602 0D9C 
                    0602 239C 0602 119C 
                    0602 239E C000 0376 
                    2000 4100 FE10 FEE2 
                    FEE4 00F0 FE92 01D8 
                    0100 FE80 A518      
(1)  767/ 600191E :                     
(1)  768/ 600191E :                     ; ====================================================================
(1)  769/ 600191E :                     ; ----------------------------------------------------------------
(1)  770/ 600191E :                     ; Slave entry
(1)  771/ 600191E :                     ; ----------------------------------------------------------------
(1)  772/ 600191E :                     
(1)  773/ 600191E :                     		align 4
(1)  774/ 6001920 :                     SH2_S_Entry:
(1)  775/ 6001920 : DE4B                		mov	#_sysreg,r14
(1)  776/ 6001922 : 4E1E                		ldc	r14,gbr
(1)  777/ 6001924 : 91C0                		mov	#_FRT,r1
(1)  778/ 6001926 : E000                		mov     #0,r0
(1)  779/ 6001928 : 8010                		mov.b   r0,@(0,r1)
(1)  780/ 600192A : E0E2                		mov     #$FFFFFFE2,r0
(1)  781/ 600192C : 8017                		mov.b   r0,@(7,r1)
(1)  782/ 600192E : E000                		mov     #0,r0
(1)  783/ 6001930 : 8014                		mov.b   r0,@(4,r1)
(1)  784/ 6001932 : E001                		mov     #1,r0
(1)  785/ 6001934 : 8015                		mov.b   r0,@(5,r1)
(1)  786/ 6001936 : E000                		mov     #0,r0
(1)  787/ 6001938 : 8016                		mov.b   r0,@(6,r1)
(1)  788/ 600193A : E001                		mov     #1,r0
(1)  789/ 600193C : 8011                		mov.b   r0,@(1,r1)
(1)  790/ 600193E : E000                		mov     #0,r0
(1)  791/ 6001940 : 8013                		mov.b   r0,@(3,r1)
(1)  792/ 6001942 : 8012                		mov.b   r0,@(2,r1)
(1)  793/ 6001944 : 90B1                		mov.l   #$FFFFFEE2,r0
(1)  794/ 6001946 : E150                		mov     #$50,r1
(1)  795/ 6001948 : 2011                		mov.w   r1,@r0
(1)  796/ 600194A : 90AF                		mov.l   #$FFFFFEE4,r0
(1)  797/ 600194C : E148                		mov     #$120/4,r1		; VBR + this/4
(1)  798/ 600194E : 4118                		shll8   r1
(1)  799/ 6001950 : 2011                		mov.w   r1,@r0
(1)  800/ 6001952 :                     		
(1)  801/ 6001952 :                     ; ------------------------------------------------
(1)  802/ 6001952 :                     ; Wait for Genesis, report to Master SH2
(1)  803/ 6001952 :                     ; ------------------------------------------------
(1)  804/ 6001952 :                     
(1)  805/ 6001952 :                     .wait_md:
(1)  806/ 6001952 : D240                		mov 	#_sysreg+comm0,r2
(1)  807/ 6001954 : 6022                		mov.l	@r2,r0
(1)  808/ 6001956 : 8800                		cmp/eq	#0,r0
(1)  809/ 6001958 : 8BFB                		bf	.wait_md
(1)  810/ 600195A : D03F                		mov.l	#"SLAV",r0
(1)  811/ 600195C : 1202                		mov.l	r0,@(8,r2)
(1)  812/ 600195E :                     
(1)  813/ 600195E : 91A6                		mov	#$FFFFFE80,r1
(1)  814/ 6001960 : 90A6                		mov.w	#$5A7F,r0			; Watchdog wait timer
(1)  815/ 6001962 : 2101                		mov.w	r0,@r1
(1)  816/ 6001964 : 90A5                		mov.w	#$A538,r0			; Watchdog ON
(1)  817/ 6001966 : 2101                		mov.w	r0,@r1
(1)  818/ 6001968 :                     		
(1)  819/ 6001968 :                     ; ====================================================================
(1)  820/ 6001968 :                     ; ----------------------------------------------------------------
(1)  821/ 6001968 :                     ; Slave main code
(1)  822/ 6001968 :                     ; ----------------------------------------------------------------
(1)  823/ 6001968 :                     
(1)  824/ 6001968 :                     SH2_S_HotStart:
(1)  825/ 6001968 : DF3C                		mov.l	#CS3|$3F000,r15			; Reset stack
(1)  826/ 600196A : DE3D                		mov.l	#RAM_Mars_Global,r14		; Reset gbr
(1)  827/ 600196C : 4E1E                		ldc	r14,gbr
(1)  828/ 600196E : 90A1                		mov.l	#$F0,r0				; Interrupts OFF
(1)  829/ 6001970 : 400E                		ldc	r0,sr
(1)  830/ 6001972 : 91A0                		mov.l	#_CCR,r1
(1)  831/ 6001974 : E000                		mov	#0,r0				; Cache OFF
(1)  832/ 6001976 : 2101                		mov.w	r0,@r1
(1)  833/ 6001978 : E019                		mov	#%00011001,r0			; Cache purge / Two-way mode / Cache ON
(1)  834/ 600197A : 2101                		mov.w	r0,@r1
(1)  835/ 600197C : D134                		mov	#_sysreg,r1
(1)  836/ 600197E : E00A                		mov	#VIRQ_ON|CMDIRQ_ON,r0		; Enable these interrupts		
(1)  837/ 6001980 : 8011                    		mov.b	r0,@(intmask,r1)
(1)  838/ 6001982 : D138                		mov 	#CACHE_SLAVE,r1			; Load 3D Routines on CACHE	
(1)  839/ 6001984 : D238                		mov 	#$C0000000,r2			; Those run more faster here supposedly...
(1)  840/ 6001986 : E306                		mov 	#(CACHE_SLAVE_E-CACHE_SLAVE)/4,r3
(1)  841/ 6001988 :                     .copy:
(1)  842/ 6001988 : 6016                		mov 	@r1+,r0
(1)  843/ 600198A : 2202                		mov 	r0,@r2
(1)  844/ 600198C : 7204                		add 	#4,r2
(1)  845/ 600198E : 4310                		dt	r3
(1)  846/ 6001990 : 8BFA                		bf	.copy
(1)  847/ 6001992 :                     
(1)  848/ 6001992 :                     ; ------------------------------------------------
(1)  849/ 6001992 :                     ; REMINDER: In blender, 1 meter = $10000
(1)  850/ 6001992 :                     ;
(1)  851/ 6001992 : D036                		mov	#MarsMdl_Init,r0
(1)  852/ 6001994 : 400B                		jsr	@r0
(1)  853/ 6001996 : 0009                		nop
(1)  854/ 6001998 :                     		
(1)  855/ 6001998 :                     ; ------------------------------------------------
(1)  856/ 6001998 :                     
(1)  857/ 6001998 : 918D                		mov	#_CCR,r1
(1)  858/ 600199A : E008                		mov	#%00001000,r0			; Two-way mode
(1)  859/ 600199C : 2101                		mov.w	r0,@r1
(1)  860/ 600199E : E019                		mov	#%00011001,r0			; Cache purge / Two-way mode / Cache ON
(1)  861/ 60019A0 : 2101                		mov.w	r0,@r1
(1)  862/ 60019A2 : E020                		mov.l	#$20,r0				; Interrupts ON
(1)  863/ 60019A4 : 400E                		ldc	r0,sr
(1)  864/ 60019A6 :                     		
(1)  865/ 60019A6 :                     ; --------------------------------------------------------
(1)  866/ 60019A6 :                     ; Loop
(1)  867/ 60019A6 :                     ; --------------------------------------------------------
(1)  868/ 60019A6 :                     
(1)  869/ 60019A6 :                     slave_loop:
(1)  870/ 60019A6 : D132                		mov	#_sysreg+comm15,r1
(1)  871/ 60019A8 : 6010                		mov.b	@r1,r0
(1)  872/ 60019AA : C980                		and	#$80,r0
(1)  873/ 60019AC : 8800                		cmp/eq	#0,r0
(1)  874/ 60019AE : 8912                		bt	.no_req
(1)  875/ 60019B0 : ED10                		mov	#MAX_MDTASKS,r13
(1)  876/ 60019B2 : DE30                		mov	#RAM_Mars_MdTasksFifo_S,r14
(1)  877/ 60019B4 :                     .next_req:
(1)  878/ 60019B4 : 2FD6                		mov	r13,@-r15
(1)  879/ 60019B6 : 60E2                		mov	@r14,r0
(1)  880/ 60019B8 : 8800                		cmp/eq	#0,r0
(1)  881/ 60019BA : 8903                		bt	.no_task
(1)  882/ 60019BC : 400B                		jsr	@r0
(1)  883/ 60019BE : 0009                		nop
(1)  884/ 60019C0 : 200A                		xor	r0,r0
(1)  885/ 60019C2 : 2E02                		mov	r0,@r14
(1)  886/ 60019C4 :                     .no_task:
(1)  887/ 60019C4 : E020                		mov	#MAX_MDTSKARG*4,r0
(1)  888/ 60019C6 : 6DF6                		mov	@r15+,r13
(1)  889/ 60019C8 : 4D10                		dt	r13
(1)  890/ 60019CA : 8FF3                		bf/s	.next_req
(1)  891/ 60019CC : 3E0C                		add	r0,r14
(1)  892/ 60019CE :                     
(1)  893/ 60019CE : D128                		mov	#_sysreg+comm15,r1
(1)  894/ 60019D0 : 6010                		mov.b	@r1,r0
(1)  895/ 60019D2 : C97F                		and	#$7F,r0
(1)  896/ 60019D4 : 2100                		mov.b	r0,@r1
(1)  897/ 60019D6 :                     .no_req:
(1)  898/ 60019D6 : D428                		mov	#_sysreg+comm2,r4
(1)  899/ 60019D8 : 6041                		mov.w	@r4,r0
(1)  900/ 60019DA : 7001                		add	#1,r0
(1)  901/ 60019DC : 2401                		mov.w	r0,@r4
(1)  902/ 60019DE :                     		
(1)  903/ 60019DE :                     ; --------------------------------------------------------
(1)  904/ 60019DE :                     ; Start building polygons from models
(1)  905/ 60019DE :                     ; 
(1)  906/ 60019DE :                     ; CAMERA ANIMATION IS DONE ON THE
(1)  907/ 60019DE :                     ; GENESIS SIDE
(1)  908/ 60019DE :                     ; --------------------------------------------------------
(1)  909/ 60019DE :                     
(1)  910/ 60019DE : E000                		mov	#0,r0
(1)  911/ 60019E0 : C10A                		mov.w	r0,@(marsGbl_MdlFacesCntr,gbr)
(1)  912/ 60019E2 : D126                		mov 	#RAM_Mars_Polygons_0,r1
(1)  913/ 60019E4 : C50B                		mov.w   @(marsGbl_PolyBuffNum,gbr),r0
(1)  914/ 60019E6 : C801                		tst     #1,r0
(1)  915/ 60019E8 : 8900                		bt	.go_mdl
(1)  916/ 60019EA : D125                		mov 	#RAM_Mars_Polygons_1,r1
(1)  917/ 60019EC :                     .go_mdl:
(1)  918/ 60019EC : 6013                		mov	r1,r0
(1)  919/ 60019EE : C203                		mov	r0,@(marsGbl_CurrFacePos,gbr)
(1)  920/ 60019F0 : D024                		mov	#RAM_Mars_Plgn_ZList,r0
(1)  921/ 60019F2 : C202                		mov	r0,@(marsGbl_CurrZList,gbr)
(1)  922/ 60019F4 :                     
(1)  923/ 60019F4 :                     ; ----------------------------------------
(1)  924/ 60019F4 :                     
(1)  925/ 60019F4 : D024                		mov	#MarsLay_Read,r0		; Build layout inside camera
(1)  926/ 60019F6 : 400B                		jsr	@r0				; takes 9 object slots
(1)  927/ 60019F8 : 0009                		nop
(1)  928/ 60019FA : DE24                		mov	#RAM_Mars_Objects,r14		; Build all objects
(1)  929/ 60019FC : ED40                		mov	#MAX_MODELS,r13
(1)  930/ 60019FE :                     .loop:
(1)  931/ 60019FE : 50E0                		mov	@(mdl_data,r14),r0		; Object model data == 0 or -1?
(1)  932/ 6001A00 : 4015                		cmp/pl	r0
(1)  933/ 6001A02 : 8B04                		bf	.invlid
(1)  934/ 6001A04 : 2FD6                		mov	r13,@-r15
(1)  935/ 6001A06 : D022                		mov	#MarsMdl_ReadModel,r0
(1)  936/ 6001A08 : 400B                		jsr	@r0
(1)  937/ 6001A0A : 0009                		nop
(1)  938/ 6001A0C : 6DF6                		mov	@r15+,r13
(1)  939/ 6001A0E :                     .invlid:
(1)  940/ 6001A0E : 4D10                		dt	r13
(1)  941/ 6001A10 : 8FF5                		bf/s	.loop
(1)  942/ 6001A12 : 7E2C                		add	#sizeof_mdlobj,r14
(1)  943/ 6001A14 :                     .skip:
(1)  944/ 6001A14 :                     	; Start Zsorting faces
(1)  945/ 6001A14 : C50B                		mov.w   @(marsGbl_PolyBuffNum,gbr),r0
(1)  946/ 6001A16 : C801                		tst     #1,r0
(1)  947/ 6001A18 : 8B05                		bf	.page_2
(1)  948/ 6001A1A : DE1E                		mov 	#RAM_Mars_PlgnList_0,r14
(1)  949/ 6001A1C : DD1E                		mov 	#RAM_Mars_PlgnNum_0,r13
(1)  950/ 6001A1E : B04B                		bsr	slv_sort_z
(1)  951/ 6001A20 : 0009                		nop
(1)  952/ 6001A22 : A004                		bra	.swap_now
(1)  953/ 6001A24 : 0009                		nop
(1)  954/ 6001A26 :                     .page_2:
(1)  955/ 6001A26 : DE1D                		mov 	#RAM_Mars_PlgnList_1,r14
(1)  956/ 6001A28 : DD1D                		mov 	#RAM_Mars_PlgnNum_1,r13
(1)  957/ 6001A2A : B045                		bsr	slv_sort_z
(1)  958/ 6001A2C : 0009                		nop
(1)  959/ 6001A2E :                     .swap_now:
(1)  960/ 6001A2E :                     ; 		mov.w	@r13,r0				; DEBUG: report number of faces
(1)  961/ 6001A2E :                     ; 		mov	#_sysreg+comm0,r1
(1)  962/ 6001A2E :                     ; 		mov.w	r0,@r1
(1)  963/ 6001A2E :                     		
(1)  964/ 6001A2E :                     	; Check if MASTER finished
(1)  965/ 6001A2E : D11D                		mov.l	#_sysreg+comm14,r1		; Master CPU still drawing pieces?
(1)  966/ 6001A30 :                     .wait_master:
(1)  967/ 6001A30 : 6010                		mov.b	@r1,r0
(1)  968/ 6001A32 : C97F                		and	#$7F,r0
(1)  969/ 6001A34 : 8801                		cmp/eq	#1,r0
(1)  970/ 6001A36 : 8908                		bt	.still_drwing
(1)  971/ 6001A38 : C50B                		mov.w	@(marsGbl_PolyBuffNum,gbr),r0	; Swap polygon buffer
(1)  972/ 6001A3A : CA01                 		xor	#1,r0
(1)  973/ 6001A3C : C10B                 		mov.w	r0,@(marsGbl_PolyBuffNum,gbr)
(1)  974/ 6001A3E :                      		
(1)  975/ 6001A3E : D219                		mov	#_sysreg+comm14,r2
(1)  976/ 6001A40 : E101                 		mov	#1,r1				; Set task $01 to Master
(1)  977/ 6001A42 : 6020                		mov.b	@r2,r0
(1)  978/ 6001A44 : C980                		and	#$80,r0
(1)  979/ 6001A46 : 201B                		or	r1,r0
(1)  980/ 6001A48 : 2200                		mov.b	r0,@r2
(1)  981/ 6001A4A :                     .still_drwing:
(1)  982/ 6001A4A : AFAC                		bra	slave_loop
(1)  983/ 6001A4C : 0009                		nop
(1)  984/ 6001A4E :                     		align 4
(1)  985/ 6001A50 : 2000 4000 2000 4020 		ltorg
                    534C 4156 0603 F000 
                    0601 1508 0600 161C 
                    C000 0000 0600 0A92 
                    2000 402F 0602 1F9C 
                    2000 4022 0601 209C 
                    0601 589C 0602 159C 
                    0600 072C 0601 159C 
                    0600 0AAA 0602 0D9C 
                    0602 239C 0602 119C 
                    0602 239E 2000 402E 
                    FE10 FEE2 FEE4 FE80 
                    5A7F A538 00F0 FE92 
(1)  986/ 6001AB8 :                     
(1)  987/ 6001AB8 :                     ; --------------------------------------------------------
(1)  988/ 6001AB8 :                     ; Sort all faces in the current buffer
(1)  989/ 6001AB8 :                     ; 
(1)  990/ 6001AB8 :                     ; r14 - Polygon list
(1)  991/ 6001AB8 :                     ; r13 - Number of polygons processed
(1)  992/ 6001AB8 :                     ; --------------------------------------------------------
(1)  993/ 6001AB8 :                     
(1)  994/ 6001AB8 :                     ; Bubble sorting
(1)  995/ 6001AB8 :                     
(1)  996/ 6001AB8 :                     slv_sort_z:
(1)  997/ 6001AB8 : 4F22                		sts	pr,@-r15
(1)  998/ 6001ABA : E000                		mov	#0,r0					; Reset current PlgnNum
(1)  999/ 6001ABC : 2D01                		mov.w	r0,@r13
(1) 1000/ 6001ABE : DC1A                		mov	#RAM_Mars_Plgn_ZList,r12	
(1) 1001/ 6001AC0 : EB02                		mov	#2,r11
(1) 1002/ 6001AC2 : C50A                		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0		; Check number of faces to sort
(1) 1003/ 6001AC4 : 30B7                		cmp/gt	r11,r0
(1) 1004/ 6001AC6 : 8B1C                		bf	.z_fewfaces
(1) 1005/ 6001AC8 : 6B03                		mov	r0,r11
(1) 1006/ 6001ACA :                     ; if faces > 2
(1) 1007/ 6001ACA :                     .z_normal:
(1) 1008/ 6001ACA : 9B2F                		mov	#MAX_FACES,r11
(1) 1009/ 6001ACC : 30B3                		cmp/ge	r11,r0
(1) 1010/ 6001ACE : 8B00                		bf	.z_ranout
(1) 1011/ 6001AD0 : 60B3                		mov	r11,r0
(1) 1012/ 6001AD2 :                     .z_ranout:
(1) 1013/ 6001AD2 : 6B03                		mov	r0,r11
(1) 1014/ 6001AD4 : 6A03                		mov	r0,r10
(1) 1015/ 6001AD6 : 7AFF                		add	#-1,r10
(1) 1016/ 6001AD8 : 67A3                		mov	r10,r7
(1) 1017/ 6001ADA : 77FF                		add	#-1,r7
(1) 1018/ 6001ADC : 4715                		cmp/pl	r7
(1) 1019/ 6001ADE : 8B1F                		bf	.z_end
(1) 1020/ 6001AE0 :                     .z_outer:
(1) 1021/ 6001AE0 : 68A3                		mov	r10,r8
(1) 1022/ 6001AE2 : 69C3                		mov	r12,r9
(1) 1023/ 6001AE4 :                     .z_inner:
(1) 1024/ 6001AE4 : 6092                		mov	@r9,r0
(1) 1025/ 6001AE6 : 5192                		mov	@(8,r9),r1
(1) 1026/ 6001AE8 : 3017                		cmp/gt	r1,r0
(1) 1027/ 6001AEA : 8B05                		bf	.z_high			; bf=back to front, bt=front to back
(1) 1028/ 6001AEC : 2912                		mov	r1,@r9
(1) 1029/ 6001AEE : 1902                		mov	r0,@(8,r9)
(1) 1030/ 6001AF0 : 5091                		mov	@(4,r9),r0
(1) 1031/ 6001AF2 : 5193                		mov	@($C,r9),r1
(1) 1032/ 6001AF4 : 1911                		mov	r1,@(4,r9)
(1) 1033/ 6001AF6 : 1903                		mov	r0,@($C,r9)
(1) 1034/ 6001AF8 :                     .z_high:
(1) 1035/ 6001AF8 : 4810                		dt	r8
(1) 1036/ 6001AFA : 8FF3                		bf/s	.z_inner
(1) 1037/ 6001AFC : 7908                		add	#8,r9
(1) 1038/ 6001AFE : 4710                		dt	r7
(1) 1039/ 6001B00 : 8BEE                		bf	.z_outer
(1) 1040/ 6001B02 :                     
(1) 1041/ 6001B02 :                     ; ----------------------------------------
(1) 1042/ 6001B02 :                     ; only 1 or 2 faces
(1) 1043/ 6001B02 :                     ; TODO: this is too much for 2 faces...
(1) 1044/ 6001B02 :                     
(1) 1045/ 6001B02 :                     .z_fewfaces:
(1) 1046/ 6001B02 : 6AC3                		mov	r12,r10
(1) 1047/ 6001B04 : 69B3                		mov	r11,r9
(1) 1048/ 6001B06 : E800                		mov	#0,r8
(1) 1049/ 6001B08 :                     .next_face:
(1) 1050/ 6001B08 : 57A1                		mov	@(4,r10),r7
(1) 1051/ 6001B0A : 4715                		cmp/pl	r7
(1) 1052/ 6001B0C : 8B04                		bf	.no_face
(1) 1053/ 6001B0E : E000                		mov	#0,r0
(1) 1054/ 6001B10 : 1A01                		mov	r0,@(4,r10)
(1) 1055/ 6001B12 : 2E72                		mov	r7,@r14
(1) 1056/ 6001B14 : 7E04                		add	#4,r14
(1) 1057/ 6001B16 : 7801                		add	#1,r8
(1) 1058/ 6001B18 :                     .no_face:
(1) 1059/ 6001B18 : 4910                		dt	r9
(1) 1060/ 6001B1A : 8FF5                		bf/s	.next_face
(1) 1061/ 6001B1C : 7A08                		add 	#8,r10
(1) 1062/ 6001B1E : 2D81                		mov.w	r8,@r13
(1) 1063/ 6001B20 :                     .z_end:
(1) 1064/ 6001B20 : 4F26                		lds	@r15+,pr
(1) 1065/ 6001B22 : 000B                		rts
(1) 1066/ 6001B24 : 0009                		nop
(1) 1067/ 6001B26 :                     		align 4
(1) 1068/ 6001B28 : 0602 159C 0100      		ltorg
(1) 1069/ 6001B2E :                     
(1) 1070/ 6001B2E :                     ; ====================================================================
(1) 1071/ 6001B2E :                     ; --------------------------------------------------------
(1) 1072/ 6001B2E :                     ; Task list for MD-to-MARS tasks, call these directly
(1) 1073/ 6001B2E :                     ; in the Genesis side
(1) 1074/ 6001B2E :                     ; 
(1) 1075/ 6001B2E :                     ; *** 68k EXAMPLES ***
(1) 1076/ 6001B2E :                     ; 
(1) 1077/ 6001B2E :                     ; Single task:
(1) 1078/ 6001B2E :                     ; 	move.l	#CmdTaskMd_SetBitmap,d0	; 32X display OFF
(1) 1079/ 6001B2E :                     ; 	moveq	#0,d1
(1) 1080/ 6001B2E :                     ; 	bsr	System_MdMars_Call
(1) 1081/ 6001B2E :                     ; 	
(1) 1082/ 6001B2E :                     ; Queued task:
(1) 1083/ 6001B2E :                     ; 	move.l	#CmdTaskMd_LoadSPal,d0	; Load palette
(1) 1084/ 6001B2E :                     ; 	move.l	#Palette_Data,d1	; Color data
(1) 1085/ 6001B2E :                     ; 	moveq	#0,d2			; Start from
(1) 1086/ 6001B2E :                     ; 	move.w	#255,d3			; Number of colors
(1) 1087/ 6001B2E :                     ; 	moveq	#0,d4			; OR value
(1) 1088/ 6001B2E :                     ; 	move.w	#$7FFF,d5		; AND value for BG
(1) 1089/ 6001B2E :                     ; 	bsr	System_MdMars_AddTask	; Insert task
(1) 1090/ 6001B2E :                     ; 	; Then more tasks go here...
(1) 1091/ 6001B2E :                     ; .wait:
(1) 1092/ 6001B2E :                     ;	bsr	System_MdMars_CheckBusy	; Check if active
(1) 1093/ 6001B2E :                     ; 	bne.s	.wait			; bne - busy
(1) 1094/ 6001B2E :                     ; 	bsr	System_MdMars_SendAll	; Send all tasks
(1) 1095/ 6001B2E :                     ; --------------------------------------------------------
(1) 1096/ 6001B2E :                     
(1) 1097/ 6001B2E :                     		align 4
(1) 1098/ 6001B30 :                     
(1) 1099/ 6001B30 :                     ; ------------------------------------------------
(1) 1100/ 6001B30 :                     ; CALLS EXCLUSIVE TO MASTER CPU
(1) 1101/ 6001B30 :                     ; ------------------------------------------------
(1) 1102/ 6001B30 :                     
(1) 1103/ 6001B30 :                     ; ------------------------------------------------
(1) 1104/ 6001B30 :                     ; Set SuperVDP bitmap value
(1) 1105/ 6001B30 :                     ;
(1) 1106/ 6001B30 :                     ; @($04,r14) - SuperVDP bitmap number (0-3)
(1) 1107/ 6001B30 :                     ; ------------------------------------------------
(1) 1108/ 6001B30 :                     
(1) 1109/ 6001B30 :                     CmdTaskMd_SetBitmap:
(1) 1110/ 6001B30 : D136                		mov 	#_vdpreg,r1
(1) 1111/ 6001B32 : 8515                .wait_fb:	mov.w   @($A,r1),r0
(1) 1112/ 6001B34 : C802                		tst     #2,r0
(1) 1113/ 6001B36 : 8BFC                		bf      .wait_fb
(1) 1114/ 6001B38 : 50E1                		mov	@($04,r14),r0
(1) 1115/ 6001B3A : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1116/ 6001B3C : 000B                		rts
(1) 1117/ 6001B3E : 0009                		nop
(1) 1118/ 6001B40 :                     		align 4
(1) 1119/ 6001B40 :                     
(1) 1120/ 6001B40 :                     ; ------------------------------------------------
(1) 1121/ 6001B40 :                     ; Load palette to SuperVDP from MD
(1) 1122/ 6001B40 :                     ;
(1) 1123/ 6001B40 :                     ; @($04,r14) - Palette data
(1) 1124/ 6001B40 :                     ; @($08,r14) - Start from
(1) 1125/ 6001B40 :                     ; @($0C,r14) - Number of colors
(1) 1126/ 6001B40 :                     ; @($10,r14) - OR value
(1) 1127/ 6001B40 :                     ; ------------------------------------------------
(1) 1128/ 6001B40 :                     
(1) 1129/ 6001B40 :                     CmdTaskMd_LoadSPal:
(1) 1130/ 6001B40 : 6DE3                		mov	r14,r13
(1) 1131/ 6001B42 : 7D04                		add	#4,r13
(1) 1132/ 6001B44 : 61D6                		mov	@r13+,r1
(1) 1133/ 6001B46 : 62D6                		mov	@r13+,r2
(1) 1134/ 6001B48 : 63D6                		mov	@r13+,r3
(1) 1135/ 6001B4A : 64D6                		mov	@r13+,r4
(1) 1136/ 6001B4C : D030                		mov	#MarsVideo_LoadPal,r0
(1) 1137/ 6001B4E : 402B                		jmp	@r0
(1) 1138/ 6001B50 : 0009                		nop
(1) 1139/ 6001B52 :                     		align 4
(1) 1140/ 6001B54 :                     
(1) 1141/ 6001B54 :                     ; ------------------------------------------------
(1) 1142/ 6001B54 :                     ; CALLS EXCLUSIVE TO SLAVE CPU
(1) 1143/ 6001B54 :                     ; ------------------------------------------------
(1) 1144/ 6001B54 :                     
(1) 1145/ 6001B54 :                     ; ------------------------------------------------
(1) 1146/ 6001B54 :                     ; Make new object and insert it to specific slot
(1) 1147/ 6001B54 :                     ;
(1) 1148/ 6001B54 :                     ; @($04,r14) - Object slot
(1) 1149/ 6001B54 :                     ; @($08,r14) - Object data
(1) 1150/ 6001B54 :                     ; ------------------------------------------------
(1) 1151/ 6001B54 :                     
(1) 1152/ 6001B54 :                     CmdTaskMd_ObjectSet:
(1) 1153/ 6001B54 : DC2F                		mov	#RAM_Mars_Objects+(sizeof_mdlobj*9),r12
(1) 1154/ 6001B56 : 6DE3                		mov	r14,r13
(1) 1155/ 6001B58 : 7D04                		add	#4,r13
(1) 1156/ 6001B5A : 60D6                		mov	@r13+,r0
(1) 1157/ 6001B5C : E12C                		mov	#sizeof_mdlobj,r1
(1) 1158/ 6001B5E : 201E                		mulu	r1,r0
(1) 1159/ 6001B60 : 001A                		sts	macl,r0
(1) 1160/ 6001B62 : 3C0C                		add	r0,r12
(1) 1161/ 6001B64 : 200A                		xor	r0,r0
(1) 1162/ 6001B66 : 61D6                		mov	@r13+,r1
(1) 1163/ 6001B68 : 1C10                		mov	r1,@(mdl_data,r12)
(1) 1164/ 6001B6A : 1C01                		mov	r0,@(mdl_x_pos,r12)
(1) 1165/ 6001B6C : 1C02                		mov	r0,@(mdl_y_pos,r12)
(1) 1166/ 6001B6E : 1C03                		mov	r0,@(mdl_z_pos,r12)
(1) 1167/ 6001B70 : 1C04                		mov	r0,@(mdl_x_rot,r12)
(1) 1168/ 6001B72 : 1C05                		mov	r0,@(mdl_y_rot,r12)
(1) 1169/ 6001B74 : 1C06                		mov	r0,@(mdl_z_rot,r12)
(1) 1170/ 6001B76 : 000B                		rts
(1) 1171/ 6001B78 : 0009                		nop
(1) 1172/ 6001B7A :                     		align 4
(1) 1173/ 6001B7C :                     		
(1) 1174/ 6001B7C :                     ; ------------------------------------------------
(1) 1175/ 6001B7C :                     ; Move/Rotate object from slot
(1) 1176/ 6001B7C :                     ; 
(1) 1177/ 6001B7C :                     ; @($04,r14) - Object slot
(1) 1178/ 6001B7C :                     ; @($08,r14) - Object X pos
(1) 1179/ 6001B7C :                     ; @($0C,r14) - Object Y pos
(1) 1180/ 6001B7C :                     ; @($10,r14) - Object Z pos
(1) 1181/ 6001B7C :                     ; @($14,r14) - Object X rot
(1) 1182/ 6001B7C :                     ; @($18,r14) - Object Y rot
(1) 1183/ 6001B7C :                     ; @($1C,r14) - Object Z rot
(1) 1184/ 6001B7C :                     ; ------------------------------------------------
(1) 1185/ 6001B7C :                     
(1) 1186/ 6001B7C :                     CmdTaskMd_ObjectPos:
(1) 1187/ 6001B7C : DC26                		mov	#RAM_Mars_Objects+(sizeof_mdlobj*9),r12
(1) 1188/ 6001B7E : 6DE3                		mov	r14,r13
(1) 1189/ 6001B80 : 7D04                		add	#4,r13
(1) 1190/ 6001B82 : 60D6                		mov	@r13+,r0
(1) 1191/ 6001B84 : E12C                		mov	#sizeof_mdlobj,r1
(1) 1192/ 6001B86 : 201E                		mulu	r1,r0
(1) 1193/ 6001B88 : 001A                		sts	macl,r0
(1) 1194/ 6001B8A : 3C0C                		add	r0,r12
(1) 1195/ 6001B8C : 61D6                		mov	@r13+,r1
(1) 1196/ 6001B8E : 62D6                		mov	@r13+,r2
(1) 1197/ 6001B90 : 63D6                		mov	@r13+,r3
(1) 1198/ 6001B92 : 64D6                		mov	@r13+,r4
(1) 1199/ 6001B94 : 65D6                		mov	@r13+,r5
(1) 1200/ 6001B96 : 66D6                		mov	@r13+,r6
(1) 1201/ 6001B98 : 1C11                		mov	r1,@(mdl_x_pos,r12)
(1) 1202/ 6001B9A : 1C22                		mov	r2,@(mdl_y_pos,r12)
(1) 1203/ 6001B9C : 1C33                		mov	r3,@(mdl_z_pos,r12)
(1) 1204/ 6001B9E : 1C44                		mov	r4,@(mdl_x_rot,r12)
(1) 1205/ 6001BA0 : 1C55                		mov	r5,@(mdl_y_rot,r12)
(1) 1206/ 6001BA2 : 1C66                		mov	r6,@(mdl_z_rot,r12)
(1) 1207/ 6001BA4 : 000B                		rts
(1) 1208/ 6001BA6 : 0009                		nop
(1) 1209/ 6001BA8 :                     		align 4
(1) 1210/ 6001BA8 :                     
(1) 1211/ 6001BA8 :                     ; ------------------------------------------------
(1) 1212/ 6001BA8 :                     ; Clear ALL objects, including layout
(1) 1213/ 6001BA8 :                     ; ------------------------------------------------
(1) 1214/ 6001BA8 :                     
(1) 1215/ 6001BA8 :                     CmdTaskMd_ObjectClrAll:
(1) 1216/ 6001BA8 : 4F22                		sts	pr,@-r15
(1) 1217/ 6001BAA : D01C                		mov	#MarsMdl_Init,r0
(1) 1218/ 6001BAC : 400B                		jsr	@r0
(1) 1219/ 6001BAE : 2FE6                		mov	r14,@-r15
(1) 1220/ 6001BB0 : 6EF6                		mov	@r15+,r14
(1) 1221/ 6001BB2 : 4F26                		lds	@r15+,pr
(1) 1222/ 6001BB4 : 000B                		rts
(1) 1223/ 6001BB6 : 0009                		nop
(1) 1224/ 6001BB8 :                     		align 4
(1) 1225/ 6001BB8 :                     
(1) 1226/ 6001BB8 :                     ; ------------------------------------------------
(1) 1227/ 6001BB8 :                     ; Set new map data
(1) 1228/ 6001BB8 :                     ; 
(1) 1229/ 6001BB8 :                     ; @($04,r14) - layout data
(1) 1230/ 6001BB8 :                     ; ------------------------------------------------
(1) 1231/ 6001BB8 :                     
(1) 1232/ 6001BB8 :                     CmdTaskMd_MapSet:
(1) 1233/ 6001BB8 : 4F22                		sts	pr,@-r15
(1) 1234/ 6001BBA : 51E1                		mov	@(4,r14),r1
(1) 1235/ 6001BBC : D018                		mov	#MarsLay_Make,r0
(1) 1236/ 6001BBE : 400B                		jsr	@r0
(1) 1237/ 6001BC0 : 2FE6                		mov	r14,@-r15
(1) 1238/ 6001BC2 : 6EF6                		mov	@r15+,r14
(1) 1239/ 6001BC4 : 4F26                		lds	@r15+,pr
(1) 1240/ 6001BC6 : 000B                		rts
(1) 1241/ 6001BC8 : 0009                		nop
(1) 1242/ 6001BCA :                     		align 4
(1) 1243/ 6001BCC :                     		
(1) 1244/ 6001BCC :                     ; ------------------------------------------------
(1) 1245/ 6001BCC :                     ; Set camera position
(1) 1246/ 6001BCC :                     ; 
(1) 1247/ 6001BCC :                     ; @($04,r14) - Camera slot (TODO)
(1) 1248/ 6001BCC :                     ; @($08,r14) - Camera X pos
(1) 1249/ 6001BCC :                     ; @($0C,r14) - Camera Y pos
(1) 1250/ 6001BCC :                     ; @($10,r14) - Camera Z pos
(1) 1251/ 6001BCC :                     ; @($14,r14) - Camera X rot
(1) 1252/ 6001BCC :                     ; @($18,r14) - Camera Y rot
(1) 1253/ 6001BCC :                     ; @($1C,r14) - Camera Z rot
(1) 1254/ 6001BCC :                     ; ------------------------------------------------
(1) 1255/ 6001BCC :                     
(1) 1256/ 6001BCC :                     CmdTaskMd_CameraPos:
(1) 1257/ 6001BCC : DC15                		mov	#RAM_Mars_ObjCamera,r12
(1) 1258/ 6001BCE : 6DE3                		mov	r14,r13
(1) 1259/ 6001BD0 : 7D08                		add	#8,r13
(1) 1260/ 6001BD2 : 61D6                		mov	@r13+,r1
(1) 1261/ 6001BD4 : 62D6                		mov	@r13+,r2
(1) 1262/ 6001BD6 : 63D6                		mov	@r13+,r3
(1) 1263/ 6001BD8 : 64D6                		mov	@r13+,r4
(1) 1264/ 6001BDA : 65D6                		mov	@r13+,r5
(1) 1265/ 6001BDC : 66D6                		mov	@r13+,r6
(1) 1266/ 6001BDE : 1C10                		mov	r1,@(cam_x_pos,r12)
(1) 1267/ 6001BE0 : 1C21                		mov	r2,@(cam_y_pos,r12)
(1) 1268/ 6001BE2 : 1C32                		mov	r3,@(cam_z_pos,r12)
(1) 1269/ 6001BE4 : 1C43                		mov	r4,@(cam_x_rot,r12)
(1) 1270/ 6001BE6 : 1C54                		mov	r5,@(cam_y_rot,r12)
(1) 1271/ 6001BE8 : 1C65                		mov	r6,@(cam_z_rot,r12)
(1) 1272/ 6001BEA : 000B                		rts
(1) 1273/ 6001BEC : 0009                		nop
(1) 1274/ 6001BEE :                     		align 4
(1) 1275/ 6001BF0 :                     
(1) 1276/ 6001BF0 :                     ; ------------------------------------------------
(1) 1277/ 6001BF0 :                     ; Set PWM to play
(1) 1278/ 6001BF0 :                     ; 
(1) 1279/ 6001BF0 :                     ; @($04,r14) - Channel slot
(1) 1280/ 6001BF0 :                     ; @($08,r14) - Start point
(1) 1281/ 6001BF0 :                     ; @($0C,r14) - End point
(1) 1282/ 6001BF0 :                     ; @($10,r14) - Loop point
(1) 1283/ 6001BF0 :                     ; @($14,r14) - Pitch
(1) 1284/ 6001BF0 :                     ; @($18,r14) - Volume
(1) 1285/ 6001BF0 :                     ; @($1C,r14) - Stereo output bits (%LR)
(1) 1286/ 6001BF0 :                     ; ------------------------------------------------
(1) 1287/ 6001BF0 :                     
(1) 1288/ 6001BF0 :                     CmdTaskMd_SetPWM:
(1) 1289/ 6001BF0 : 4F22                		sts	pr,@-r15
(1) 1290/ 6001BF2 :                     		
(1) 1291/ 6001BF2 : 51E1                		mov	@($04,r14),r1
(1) 1292/ 6001BF4 : 52E2                		mov	@($08,r14),r2
(1) 1293/ 6001BF6 : 53E3                		mov	@($0C,r14),r3
(1) 1294/ 6001BF8 : 54E4                		mov	@($10,r14),r4
(1) 1295/ 6001BFA : 55E5                		mov	@($14,r14),r5
(1) 1296/ 6001BFC : 56E6                		mov	@($18,r14),r6
(1) 1297/ 6001BFE : 57E7                		mov	@($1C,r14),r7
(1) 1298/ 6001C00 : BD8A                		bsr	MarsSound_SetChannel
(1) 1299/ 6001C02 : 0009                		nop
(1) 1300/ 6001C04 :                     
(1) 1301/ 6001C04 :                     ; 		mov	@($04,r14),r1
(1) 1302/ 6001C04 :                     ; 		mov	@($08,r14),r2
(1) 1303/ 6001C04 :                     ; 		mov	@($0C,r14),r3
(1) 1304/ 6001C04 :                     ; 		mov	@($10,r14),r4
(1) 1305/ 6001C04 :                     ; 		mov	@($14,r14),r5
(1) 1306/ 6001C04 :                     ; 		mov	@($18,r14),r6
(1) 1307/ 6001C04 :                     ; 		mov	@($1C,r14),r7
(1) 1308/ 6001C04 :                     ; 		mov	#MarsSound_SetChannel,r0
(1) 1309/ 6001C04 :                     ; 		jsr	@r0
(1) 1310/ 6001C04 :                     ; 		nop
(1) 1311/ 6001C04 : 4F26                		lds	@r15+,pr
(1) 1312/ 6001C06 : 000B                		rts
(1) 1313/ 6001C08 : 0009                		nop
(1) 1314/ 6001C0A :                     		align 4
(1) 1315/ 6001C0C :                     		
(1) 1316/ 6001C0C :                     ; 		mov	#0,r1
(1) 1317/ 6001C0C :                     ; 		mov	#WAV_LEFT,r2
(1) 1318/ 6001C0C :                     ; 		mov	#WAV_LEFT_E,r3
(1) 1319/ 6001C0C :                     ; 		mov	#WAV_LEFT,r4
(1) 1320/ 6001C0C :                     ; 		mov	#$100,r5
(1) 1321/ 6001C0C :                     ; 		mov	#0,r6
(1) 1322/ 6001C0C :                     ; 		bsr	MarsSound_SetChannel
(1) 1323/ 6001C0C :                     ; 		mov	#%10,r7
(1) 1324/ 6001C0C :                     
(1) 1325/ 6001C0C :                     ; 		mov	#1,r1
(1) 1326/ 6001C0C :                     ; 		mov	#WAV_RIGHT,r2
(1) 1327/ 6001C0C :                     ; 		mov	#WAV_RIGHT_E,r3
(1) 1328/ 6001C0C :                     ; 		mov	r2,r4
(1) 1329/ 6001C0C :                     ; 		mov	#$100,r5
(1) 1330/ 6001C0C :                     ; 		mov	#0,r6
(1) 1331/ 6001C0C :                     ; 		bsr	MarsSound_SetChannel
(1) 1332/ 6001C0C :                     ; 		mov	#%01,r7
(1) 1333/ 6001C0C :                     
(1) 1334/ 6001C0C :                     ; ----------------------------------------
(1) 1335/ 6001C0C :                     
(1) 1336/ 6001C0C : 2000 4100 0600 06F0 		ltorg
                    0601 1728 0601 1728 
                    0600 0A92 0600 07AE 
                    0601 1554           
(1) 1337/ 6001C28 :                     
(1) 1338/ 6001C28 :                     ; =================================================================
(1) 1339/ 6001C28 :                     ; ------------------------------------------------
(1) 1340/ 6001C28 :                     ; Slave | Custom interrupt
(1) 1341/ 6001C28 :                     ; 
(1) 1342/ 6001C28 :                     ; Autosort faces on the background
(1) 1343/ 6001C28 :                     ; ------------------------------------------------
(1) 1344/ 6001C28 :                     
(1) 1345/ 6001C28 :                     s_irq_custom:
(1) 1346/ 6001C28 : 2F26                		mov	r2,@-r15
(1) 1347/ 6001C2A : 9115                		mov	#_FRT,r1
(1) 1348/ 6001C2C : 8417                		mov.b   @(7,r1),r0
(1) 1349/ 6001C2E : CA02                		xor     #2,r0
(1) 1350/ 6001C30 : 8017                		mov.b   r0,@(7,r1)
(1) 1351/ 6001C32 :                     
(1) 1352/ 6001C32 : D108                		mov	#_sysreg+comm6,r1
(1) 1353/ 6001C34 : 6011                		mov.w	@r1,r0
(1) 1354/ 6001C36 : 7001                		add	#1,r0
(1) 1355/ 6001C38 : 2101                		mov.w	r0,@r1
(1) 1356/ 6001C3A :                     
(1) 1357/ 6001C3A :                     ; 	; Sorting task start here
(1) 1358/ 6001C3A :                     ; 		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0
(1) 1359/ 6001C3A :                     ; 		cmp/eq	#0,r0
(1) 1360/ 6001C3A :                     ; 		bt	.no_request
(1) 1361/ 6001C3A :                     ; 		mov	r3,@-r15
(1) 1362/ 6001C3A :                     ; 		mov	r4,@-r15
(1) 1363/ 6001C3A :                     ; 		mov	r5,@-r15
(1) 1364/ 6001C3A :                     ; 		mov	r6,@-r15
(1) 1365/ 6001C3A :                     ; 		mov	#CS3+$44,r1
(1) 1366/ 6001C3A :                     ; 		mov	@r1,r0
(1) 1367/ 6001C3A :                     ; 		add 	#1,r0
(1) 1368/ 6001C3A :                     ; 		mov	r0,@r1
(1) 1369/ 6001C3A :                     ; 		mov	@r15+,r6
(1) 1370/ 6001C3A :                     ; 		mov	@r15+,r5
(1) 1371/ 6001C3A :                     ; 		mov	@r15+,r4
(1) 1372/ 6001C3A :                     ; 		mov	@r15+,r3
(1) 1373/ 6001C3A :                     ; .no_request:
(1) 1374/ 6001C3A :                     ; 	; End
(1) 1375/ 6001C3A :                     ; 
(1) 1376/ 6001C3A : 910E                		mov	#$FFFFFE80,r1
(1) 1377/ 6001C3C : 900E                		mov.w   #$A518,r0		; Watchdog OFF
(1) 1378/ 6001C3E : 2101                		mov.w   r0,@r1
(1) 1379/ 6001C40 : CB20                		or      #$20,r0
(1) 1380/ 6001C42 : 2101                		mov.w   r0,@r1
(1) 1381/ 6001C44 : E201                		mov	#1,r2
(1) 1382/ 6001C46 : 900A                		mov.w   #$5A7F,r0		; Timer for next one
(1) 1383/ 6001C48 : 202B                		or	r2,r0
(1) 1384/ 6001C4A : 2101                		mov.w	r0,@r1
(1) 1385/ 6001C4C : 62F6                		mov	@r15+,r2
(1) 1386/ 6001C4E : 000B                		rts
(1) 1387/ 6001C50 : 0009                		nop
(1) 1388/ 6001C52 :                     		align 4
(1) 1389/ 6001C54 : 2000 4026 FE10 FE80 		ltorg
                    A518 5A7F           
(1) 1390/ 6001C60 :                     
(1) 1391/ 6001C60 :                     ; ====================================================================
(1) 1392/ 6001C60 :                     ; ----------------------------------------------------------------
(1) 1393/ 6001C60 :                     ; MARS DATA
(1) 1394/ 6001C60 :                     ; ----------------------------------------------------------------
(1) 1395/ 6001C60 :                     
(1) 1396/ 6001C60 :                     		align 4
(1) 1397/ 6001C60 :                     sin_table	binclude "system/mars/data/sinedata.bin"
(1) 1398/ 6004460 :                     		align 4
(1) 1399/ 6004460 :                     		include "data/mars_sdram.asm"
(2)    1/ 6004460 :                     ; ====================================================================
(2)    2/ 6004460 :                     ; ----------------------------------------------------------------
(2)    3/ 6004460 :                     ; SH2 SDRAM user data
(2)    4/ 6004460 :                     ; 
(2)    5/ 6004460 :                     ; This data is stored on SDRAM, it's always available to use
(2)    6/ 6004460 :                     ; and can be re-writeable
(2)    7/ 6004460 :                     ; Put your most usable data like palettes or models here.
(2)    8/ 6004460 :                     ; ----------------------------------------------------------------
(2)    9/ 6004460 :                     
(2)   10/ 6004460 :                     		include  "data/mars/objects/incl_sdram.asm"		; Models and palettes will go here
(3)    1/ 6004460 :                     ; --------------------------------------------------------
(3)    2/ 6004460 :                     ; Palettes
(3)    3/ 6004460 :                     ; --------------------------------------------------------
(3)    4/ 6004460 :                     
(3)    5/ 6004460 :                     Palette_Puyo:	binclude "data/mars/objects/mtrl/smok_pal.bin"
(3)    6/ 6004660 :                     		align 4
(3)    7/ 6004660 :                     Palette_Map:	binclude "data/mars/objects/mtrl/marscity_sdram_pal.bin"
(3)    8/ 60046FA :                     		align 4
(3)    9/ 60046FC :                     Textr_smok:
(3)   10/ 60046FC :                     		binclude "data/mars/objects/mtrl/smok_art.bin"
(3)   11/ 600DE95 :                     		align 4
(3)   12/ 600DE98 :                     Textr_marscity:
(3)   13/ 600DE98 :                     		binclude "data/mars/objects/mtrl/marscity_sdram_art.bin"
(3)   14/ 600FAB8 :                     		align 4
(3)   15/ 600FAB8 :                     		
(3)   16/ 600FAB8 :                     ; --------------------------------------------------------
(3)   17/ 600FAB8 :                     ; Objects
(3)   18/ 600FAB8 :                     ; 
(3)   19/ 600FAB8 :                     ; Models, animations, and smaller textures
(3)   20/ 600FAB8 :                     ; --------------------------------------------------------
(3)   21/ 600FAB8 :                     
(3)   22/ 600FAB8 :                     		include "data/mars/objects/mdl/test/head.asm"
(4)    1/ 600FAB8 :                     MarsObj_test:
(4)    2/ 600FAB8 : 0018 0023           		dc.w 24,35
(4)    3/ 600FABC : 0600 FACC 0600 FC70 		dc.l .vert,.face,.vrtx,.mtrl
                    0600 FDE0 0600 FED0 
(4)    4/ 600FACC :                     .vert:		binclude "data/mars/objects/mdl/test/vert.bin"
(4)    5/ 600FC70 :                     .face:		binclude "data/mars/objects/mdl/test/face.bin"
(4)    6/ 600FDE0 :                     .vrtx:		binclude "data/mars/objects/mdl/test/vrtx.bin"
(4)    7/ 600FED0 :                     .mtrl:		include "data/mars/objects/mdl/test/mtrl.asm"
(5)    1/ 600FED0 : 0600 DE98           	 dc.l Textr_marscity
(5)    2/ 600FED4 : 0048                	 dc.w 72
(5)    3/ 600FED6 : 0000                	 dc.w 0
(5)    4/ 600FED8 :                     
(4)    8/ 600FED8 :                     		align 4
(3)   23/ 600FED8 :                     		include "data/mars/objects/mdl/test2/head.asm"
(4)    1/ 600FED8 :                     MarsObj_test2:
(4)    2/ 600FED8 : 0052 0064           		dc.w 82,100
(4)    3/ 600FEDC : 0600 FEEC 0601 039C 		dc.l .vert,.face,.vrtx,.mtrl
                    0601 095C 0601 0E3C 
(4)    4/ 600FEEC :                     .vert:		binclude "data/mars/objects/mdl/test2/vert.bin"
(4)    5/ 601039C :                     .face:		binclude "data/mars/objects/mdl/test2/face.bin"
(4)    6/ 601095C :                     .vrtx:		binclude "data/mars/objects/mdl/test2/vrtx.bin"
(4)    7/ 6010E3C :                     .mtrl:		include "data/mars/objects/mdl/test2/mtrl.asm"
(5)    1/ 6010E3C : 0600 DE98           	 dc.l Textr_marscity
(5)    2/ 6010E40 : 0048                	 dc.w 72
(5)    3/ 6010E42 : 0000                	 dc.w 0
(5)    4/ 6010E44 :                     
(4)    8/ 6010E44 :                     		align 4
(3)   24/ 6010E44 :                     		include "data/mars/objects/mdl/test3/head.asm"
(4)    1/ 6010E44 :                     MarsObj_test3:
(4)    2/ 6010E44 : 0015 0024           		dc.w 21,36
(4)    3/ 6010E48 : 0601 0E58 0601 1008 		dc.l .vert,.face,.vrtx,.mtrl
                    0601 1148 0601 1258 
(4)    4/ 6010E58 :                     .vert:		binclude "data/mars/objects/mdl/test3/vert.bin"
(4)    5/ 6011008 :                     .face:		binclude "data/mars/objects/mdl/test3/face.bin"
(4)    6/ 6011148 :                     .vrtx:		binclude "data/mars/objects/mdl/test3/vrtx.bin"
(4)    7/ 6011258 :                     .mtrl:		include "data/mars/objects/mdl/test3/mtrl.asm"
(5)    1/ 6011258 : 0600 DE98           	 dc.l Textr_marscity
(5)    2/ 601125C : 0048                	 dc.w 72
(5)    3/ 601125E : 0000                	 dc.w 0
(5)    4/ 6011260 :                     
(4)    8/ 6011260 :                     		align 4
(3)   25/ 6011260 :                     		include "data/mars/objects/mdl/smok/head.asm"
(4)    1/ 6011260 :                     MarsObj_smok:
(4)    2/ 6011260 : 0001 0004           		dc.w 1,4
(4)    3/ 6011264 : 0601 1274 0601 12A4 		dc.l .vert,.face,.vrtx,.mtrl
                    0601 12C4 0601 12D4 
(4)    4/ 6011274 :                     .vert:		binclude "data/mars/objects/mdl/smok/vert.bin"
(4)    5/ 60112A4 :                     .face:		binclude "data/mars/objects/mdl/smok/face.bin"
(4)    6/ 60112C4 :                     .vrtx:		binclude "data/mars/objects/mdl/smok/vrtx.bin"
(4)    7/ 60112D4 :                     .mtrl:		include "data/mars/objects/mdl/smok/mtrl.asm"
(5)    1/ 60112D4 : 0600 46FC           	 dc.l Textr_smok
(5)    2/ 60112D8 : 00C5                	 dc.w 197
(5)    3/ 60112DA : 0000                	 dc.w 0
(5)    4/ 60112DC :                     
(4)    8/ 60112DC :                     		align 4
(3)   26/ 60112DC :                     		align 4
(3)   27/ 60112DC :                     
(3)   28/ 60112DC :                     ; --------------------------------------------------------
(3)   29/ 60112DC :                     ; Map layout
(3)   30/ 60112DC :                     ; --------------------------------------------------------
(3)   31/ 60112DC :                     
(3)   32/ 60112DC :                     ; center topleft is at X=6,Y=5 (actual center: X=7,Y=8)
(3)   33/ 60112DC :                     TEST_LAYOUT:
(3)   34/ 60112DC : 0601 14E0            dc.l .blocks
(3)   35/ 60112E0 :                      
(3)   36/ 60112E0 :                     ;       0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F 
(3)   37/ 60112E0 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0002,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; 0
                    0000 0000 0002 0002 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   38/ 6011300 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0001,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; 1
                    0000 0000 0002 0001 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   39/ 6011320 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0001,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; 2
                    0000 0000 0002 0001 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   40/ 6011340 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0001,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; 3
                    0000 0000 0002 0001 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   41/ 6011360 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0001,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; 4
                    0000 0000 0002 0001 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   42/ 6011380 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0001,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; 5
                    0000 0000 0002 0001 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   43/ 60113A0 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0001,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; 6
                    0000 0000 0002 0001 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   44/ 60113C0 : 0002 0002 0002 0002  dc.w $0002,$0002,$0002,$0002,$0002,$0002,$0002,$0001,$0002,$0002,$0002,$0002,$0002,$0002,$0002,$0000 ; 7
                    0002 0002 0002 0001 
                    0002 0002 0002 0002 
                    0002 0002 0002 0000 
(3)   45/ 60113E0 : 0002 2001 2001 2001  dc.w $0002,$2001,$2001,$2001,$2001,$2001,$2001,$0003,$2001,$2001,$2001,$2001,$2001,$2001,$0002,$0000 ; 8
                    2001 2001 2001 0003 
                    2001 2001 2001 2001 
                    2001 2001 0002 0000 
(3)   46/ 6011400 : 0002 0002 0002 0002  dc.w $0002,$0002,$0002,$0002,$0002,$0002,$0002,$0001,$0002,$0002,$0002,$0002,$0002,$0002,$0002,$0000 ; 9
                    0002 0002 0002 0001 
                    0002 0002 0002 0002 
                    0002 0002 0002 0000 
(3)   47/ 6011420 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0001,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; A
                    0000 0000 0002 0001 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   48/ 6011440 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0001,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; B
                    0000 0000 0002 0001 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   49/ 6011460 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0001,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; C
                    0000 0000 0002 0001 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   50/ 6011480 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0001,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; D
                    0000 0000 0002 0001 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   51/ 60114A0 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0001,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; E
                    0000 0000 0002 0001 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   52/ 60114C0 : 0000 0000 0000 0000  dc.w $0000,$0000,$0000,$0000,$0000,$0000,$0002,$0002,$0002,$0000,$0000,$0000,$0000,$0000,$0000,$0000 ; F
                    0000 0000 0002 0002 
                    0002 0000 0000 0000 
                    0000 0000 0000 0000 
(3)   53/ 60114E0 :                     
(3)   54/ 60114E0 :                     .blocks:
(3)   55/ 60114E0 : 0600 FAB8 0000 0000 	dc.l MARSOBJ_TEST,0
(3)   56/ 60114E8 : 0600 FED8 0000 0000 	dc.l MARSOBJ_TEST2,0
(3)   57/ 60114F0 : 0601 0E44 0000 0000 	dc.l MARSOBJ_TEST3,0
(3)   58/ 60114F8 :                     .objects:
(3)   59/ 60114F8 : 0000 0000           	dc.l 0
(3)   60/ 60114FC : 0000 0000           	dc.l 0
(3)   61/ 6011500 : 0000 0000           	dc.l 0
(3)   62/ 6011504 : 0000 0000           	dc.l 0
(3)   63/ 6011508 :                     	
(3)   64/ 6011508 :                     	
(3)   65/ 6011508 :                     ; TEST_ANIMATION:	binclude "data/mars/objects/anim/cube_anim.bin"
(3)   66/ 6011508 :                     ; 		align 4
(3)   67/ 6011508 :                     
(2)   11/ 6011508 :                     
(1) 1400/ 6011508 :                     
(1) 1401/ 6011508 :                     ; ====================================================================
(1) 1402/ 6011508 :                     ; ----------------------------------------------------------------
(1) 1403/ 6011508 :                     ; MARS SH2 RAM
(1) 1404/ 6011508 :                     ; ----------------------------------------------------------------
(1) 1405/ 6011508 :                     
(1) 1406/ 6011508 :                     SH2_RAM:
(1) 1407/ 6011508 : (MACRO)             		struct SH2_RAM
(1) 1407/ 6011508 : =$6011508           GLBL_LASTPC     set *
(1) 1407/   15170 :                                     dephase
(1) 1407/   15170 : =$15170             GLBL_LASTORG    set *
(1) 1407/ 6011508 :                                     phase SH2_RAM
(1) 1414/ 6011508 :                     MarsRam_System	ds.b (sizeof_marssys-MarsRam_System)
(1) 1415/ 6011554 :                     MarsRam_Video	ds.b (sizeof_marsvid-MarsRam_Video)
(1) 1416/ 60223A0 :                     MarsRam_Sound	ds.b (sizeof_marssnd-MarsRam_Sound)
(1) 1417/ 60225E0 :                     sizeof_marsram	ds.l 0
(1) 1419/ 60225E0 :                     
(1) 1420/ 60225E0 :                     .here:
MARS RAM from 11508 to 225E0
(1) 1422/ 60225E0 :                     		message "MARS RAM from \{((SH2_RAM)&$FFFFFF)} to \{((.here)&$FFFFFF)}"
(1) 1424/ 60225E0 : (MACRO)             		finish
(1) 1424/ 6011508 :                                     !org GLBL_LASTORG
(1) 1424/ 6011508 :                                     phase GLBL_LASTPC
(1) 1425/ 6011508 :                     		
(1) 1426/ 6011508 :                     ; ====================================================================
(1) 1427/ 6011508 :                     ; ----------------------------------------------------------------
(1) 1428/ 6011508 :                     ; MARS Sound RAM
(1) 1429/ 6011508 :                     ; ----------------------------------------------------------------
(1) 1430/ 6011508 :                     
(1) 1431/ 6011508 : (MACRO)             			struct MarsRam_Sound
(1) 1431/ 6011508 : =$6011508           GLBL_LASTPC     set *
(1) 1431/   15170 :                                     dephase
(1) 1431/   15170 : =$15170             GLBL_LASTORG    set *
(1) 1431/ 60223A0 :                                     phase MARSRAM_SOUND
(1) 1432/ 60223A0 :                     MarsSnd_PwmChnls	ds.b sizeof_sndchn*MAX_PWMCHNL
(1) 1433/ 60225E0 :                     sizeof_marssnd		ds.l 0
(1) 1434/ 60225E0 : (MACRO)             			finish
(1) 1434/ 60223A0 :                                     !org GLBL_LASTORG
(1) 1434/ 6011508 :                                     phase GLBL_LASTPC
(1) 1435/ 6011508 :                     
(1) 1436/ 6011508 :                     ; ====================================================================
(1) 1437/ 6011508 :                     ; ----------------------------------------------------------------
(1) 1438/ 6011508 :                     ; MARS Video RAM
(1) 1439/ 6011508 :                     ; ----------------------------------------------------------------
(1) 1440/ 6011508 :                     
(1) 1441/ 6011508 : (MACRO)             			struct MarsRam_Video
(1) 1441/ 6011508 : =$6011508           GLBL_LASTPC     set *
(1) 1441/   15170 :                                     dephase
(1) 1441/   15170 : =$15170             GLBL_LASTORG    set *
(1) 1441/ 6011554 :                                     phase MARSRAM_VIDEO
(1) 1442/ 6011554 :                     RAM_Mars_ObjCamera	ds.b sizeof_camera		; Camera buffer
(1) 1443/ 601157C :                     RAM_Mars_ObjLayout	ds.b sizeof_layout		; Layout buffer
(1) 1444/ 601159C :                     RAM_Mars_Objects	ds.b sizeof_mdlobj*MAX_MODELS	; Objects list
(1) 1445/ 601209C :                     RAM_Mars_Polygons_0	ds.b sizeof_polygn*MAX_FACES	; Polygon list 0
(1) 1446/ 601589C :                     RAM_Mars_Polygons_1	ds.b sizeof_polygn*MAX_FACES	; Polygon list 1
(1) 1447/ 601909C :                     RAM_Mars_VdpDrwList	ds.b sizeof_plypz*MAX_SVDP_PZ	; Pieces list
(1) 1448/ 601EA9C :                     RAM_Mars_FbDrwnBuff	ds.b (SCREEN_WIDTH/8)*SCREEN_HEIGHT
(1) 1449/ 6020D9C :                     RAM_Mars_VdpDrwList_e	ds.l 0				; (end-of-list label)
(1) 1450/ 6020D9C :                     RAM_Mars_PlgnList_0	ds.l MAX_FACES			; Pointer list(s)
(1) 1451/ 602119C :                     RAM_Mars_PlgnList_1	ds.l MAX_FACES
(1) 1452/ 602159C :                     RAM_Mars_Plgn_ZList	ds.l MAX_FACES*2		; Z value / foward faces
(1) 1453/ 6021D9C :                     RAM_Mars_MdTasksFifo_M	ds.l MAX_MDTSKARG*MAX_MDTASKS	; Request list for Master: SVDP and PWM interaction exclusive
(1) 1454/ 6021F9C :                     RAM_Mars_MdTasksFifo_S	ds.l MAX_MDTSKARG*MAX_MDTASKS	; Request list for Slave: Controlling objects and camera
(1) 1455/ 602219C :                     RAM_Mars_Palette	ds.w 256			; Indexed palette
(1) 1456/ 602239C :                     RAM_Mars_PlgnNum_0	ds.w 1				; Number of polygons to read, both buffers
(1) 1457/ 602239E :                     RAM_Mars_PlgnNum_1	ds.w 1				;
(1) 1458/ 60223A0 :                     sizeof_marsvid		ds.l 0
(1) 1459/ 60223A0 : (MACRO)             			finish
(1) 1459/ 6011554 :                                     !org GLBL_LASTORG
(1) 1459/ 6011508 :                                     phase GLBL_LASTPC
(1) 1460/ 6011508 :                     			
(1) 1461/ 6011508 :                     ; ====================================================================
(1) 1462/ 6011508 :                     ; ----------------------------------------------------------------
(1) 1463/ 6011508 :                     ; MARS System RAM
(1) 1464/ 6011508 :                     ; ----------------------------------------------------------------
(1) 1465/ 6011508 :                     
(1) 1466/ 6011508 : (MACRO)             			struct MarsRam_System
(1) 1466/ 6011508 : =$6011508           GLBL_LASTPC     set *
(1) 1466/   15170 :                                     dephase
(1) 1466/   15170 : =$15170             GLBL_LASTORG    set *
(1) 1466/ 6011508 :                                     phase MARSRAM_SYSTEM
(1) 1467/ 6011508 :                     RAM_Mars_Global		ds.w sizeof_MarsGbl		; keep it as a word
(1) 1468/ 6011554 :                     sizeof_marssys		ds.l 0
(1) 1469/ 6011554 : (MACRO)             			finish
(1) 1469/ 6011508 :                                     !org GLBL_LASTORG
(1) 1469/ 6011508 :                                     phase GLBL_LASTPC
(1) 1470/ 6011508 :                     
      60/ 6011508 :                     		ltorg
      61/ 6011508 :                     		cpu 68000
      62/ 6011508 :                     		padding off
      63/   15170 :                     		dephase
      64/   15170 :                     MARS_RAMDATA_E:
      65/   15170 :                     		align 4
      66/   15170 :                     
      67/   15170 :                     ; --------------------------------------------------------
      68/   15170 :                     ; SINGLE MD BANK
      69/   15170 :                     ; 
      70/   15170 :                     ; $900000 - $9FFFFF
      71/   15170 :                     ; --------------------------------------------------------
      72/   15170 :                     
      73/   15170 :                     		align 4
      74/  915170 :                     		phase $900000+*				; Only one currently
      75/  915170 :                     		include "data/md_bank0.asm"
(1)    1/  915170 :                     ; ====================================================================
(1)    2/  915170 :                     ; ----------------------------------------------------------------
(1)    3/  915170 :                     ; Single 68k DATA BANK for MD ($900000-$9FFFFF)
(1)    4/  915170 :                     ; for stuff other than DMA transfers
(1)    5/  915170 :                     ; 
(1)    6/  915170 :                     ; Maximum size: $0FFFFF bytes
(1)    7/  915170 :                     ; ----------------------------------------------------------------
(1)    8/  915170 :                     
(1)    9/  915170 :                     		align 4
(1)   10/  915170 :                     CAMERA_ANIM:	binclude "data/mars/objects/anim/camera_anim.bin"
(1)   11/  918054 :                     		align 4
(1)   12/  918054 :                     TEST_WAV:	binclude "data/sound/test.wav",$2C,$020000
(1)   13/  938054 :                     TEST_WAV_e:
(1)   14/  938054 :                     
      76/   38054 :                     		dephase
      77/   38054 :                     
      78/   38054 :                     ; --------------------------------------------------------
      79/   38054 :                     ; DATA for DMA transfers, bank-less
      80/   38054 :                     ; --------------------------------------------------------
      81/   38054 :                     
      82/   38054 :                     		align 4
      83/   38054 :                     		include "data/md_dmadata0.asm"
(1)    1/   38054 :                     ; ====================================================================
(1)    2/   38054 :                     ; ----------------------------------------------------------------
(1)    3/   38054 :                     ; DMA ROM DATA Transfer section, no bank limitations
(1)    4/   38054 :                     ; 
(1)    5/   38054 :                     ; RV bit must be set to access here
(1)    6/   38054 :                     ; ----------------------------------------------------------------
(1)    7/   38054 :                     
(1)    8/   38054 :                     		align $8000
(1)    9/   40000 : 4D44 2044 4D41 2053 		dc.b "MD DMA STUFF"
                    5455 4646           
(1)   10/   4000C :                     ; MdGfx_Bg:
(1)   11/   4000C :                     ; 		binclude "data/md/bg/bg_art.bin"
(1)   12/   4000C :                     ; MdGfx_Bg_e:	align 2
(1)   13/   4000C :                     
      84/   4000C :                     		
      85/   4000C :                     ; --------------------------------------------------------
      86/   4000C :                     ; MARS ROM data for SH2
      87/   4000C :                     ; 
      88/   4000C :                     ; This section will be gone if RV=1
      89/   4000C :                     ; (doing any MD ROM-to-DMA transfer)
      90/   4000C :                     ; --------------------------------------------------------
      91/   4000C :                     
      92/ 204000C :                     		phase CS1+*
      93/ 204000C :                     		align 4
      94/ 204000C :                     		include "data/mars_rom.asm"
(1)    1/ 204000C :                     ; ====================================================================
(1)    2/ 204000C :                     ; ----------------------------------------------------------------
(1)    3/ 204000C :                     ; SH2 ROM user data
(1)    4/ 204000C :                     ; 
(1)    5/ 204000C :                     ; If your data is too much for SDRAM, place it here.
(1)    6/ 204000C :                     ; Note that this section will be gone if the Genesis side is
(1)    7/ 204000C :                     ; perfoming a DMA ROM-to-VDP Transfer (setting RV=1)
(1)    8/ 204000C :                     ; 
(1)    9/ 204000C :                     ; also, reading from here is slow (supposedly)
(1)   10/ 204000C :                     ; ----------------------------------------------------------------
(1)   11/ 204000C :                     
(1)   12/ 204000C :                     		include  "data/mars/objects/incl_rom.asm"	; All textures will go in ROM
(2)    1/ 204000C :                     ; ====================================================================
(2)    2/ 204000C :                     ; ----------------------------------------------------------------
(2)    3/ 204000C :                     ; Put your model textures here
(2)    4/ 204000C :                     ; ----------------------------------------------------------------
(2)    5/ 204000C :                     
(2)    6/ 204000C :                     		align 4
(2)    7/ 204000C :                     ; Textr_marscity:
(2)    8/ 204000C :                     ; 		binclude "data/mars/objects/mtrl/marscity_art.bin"
(2)    9/ 204000C :                     ; 		align 4
(2)   10/ 204000C :                     
(1)   13/ 204000C :                     PWM_LEFT:	binclude "data/sound/pwm_l.wav",$2C,$080000
(1)   14/ 20C000C :                     PWM_LEFT_e:
(1)   15/ 20C000C :                     		align 4
(1)   16/ 20C000C :                     PWM_RIGHT:	binclude "data/sound/pwm_r.wav",$2C,$080000
(1)   17/ 214000C :                     PWM_RIGHT_e:
(1)   18/ 214000C :                     		align 4
(1)   19/ 214000C :                     
      95/  14000C :                     		dephase
      96/  14000C :                     
      97/  14000C :                     ; ====================================================================
      98/  14000C :                     ; ---------------------------------------------
      99/  14000C :                     ; End
     100/  14000C :                     ; ---------------------------------------------
     101/  14000C :                     		
     102/  14000C :                     ROM_END:
     103/  14000C :                     ; 		rompad (ROM_END&$FF0000)+$40000
     104/  14000C :                     		align $8000
     105/  148000 :                     
 AS V1.42 Beta [Bld 118] - source file mars.asm - page 2 - 2/19/2021 3:40:41


  symbol table (* = unused):
  ------------------------

 ADAPTER :                        0 - | *ADEN :                           2 - |
 ALV :                           24 - | *APPLY_BEND :                   2B6 C |
*ARCHITECTURE :                                        x86_64-unknown-linux - |
 ASCII_FONT :                FF0962 C |  ASCII_FONT_E :              FF1962 C |
 ASCII_PAL :                 FF0942 C | *ASCII_PAL_E :               FF0962 C |
 ATK :                            8 - | *BIGENDIAN :                      0 - |
 BITDISPENBL :                    6 - |  BITDMA :                         1 - |
 BITDMAENBL :                     4 - | *BITHINT :                        2 - |
*BITHINTENBL :                    4 - | *BITHVSTOP :                      1 - |
*BITJOYA :                        6 - |  BITJOYB :                        4 - |
 BITJOYC :                        5 - |  BITJOYDOWN :                     1 - |
 BITJOYLEFT :                     2 - | *BITJOYMODE :                     3 - |
 BITJOYRIGHT :                    3 - | *BITJOYSTART :                    7 - |
 BITJOYUP :                       0 - | *BITJOYX :                        2 - |
*BITJOYY :                        1 - | *BITJOYZ :                        0 - |
 BITMAPMD :                       1 - | *BITV30 :                         3 - |
 BITVINT :                        3 - | *BITVINTENBL :                    5 - |
*BRANCHEXT :                      0 - |  CACHDDA_LAST :    FFFFFFFFC000070C C |
 CACHDDA_SRC :     FFFFFFFFC000071C C |  CACHDDA_SRC_L :   FFFFFFFFC000073C C |
 CACHDDA_SRC_R :   FFFFFFFFC000074C C |  CACHDDA_TOP :     FFFFFFFFC00006FC C |
 CACHE_MASTER :             6000EBC C |  CACHE_MASTER_E :           600161C C |
 CACHE_SLAVE :              600161C C |  CACHE_SLAVE.END : FFFFFFFFC000001A C |
 CACHE_SLAVE_E :            6001636 C |  CACH_CLRLINES :   FFFFFFFFC000075C C |
 CACH_CLRLINES.END :                                       FFFFFFFFC0000760 C |
 CACH_LNDRW_L :    FFFFFFFFC00006C4 C |  CACH_LNDRW_S :    FFFFFFFFC00006FC C |
 CAM2_ANIMDATA :                 18 C |  CAM2_ANIMFRAME :                1C C |
 CAM2_ANIMTIMER :                20 C |  CAM2_X_POS :                     0 C |
 CAM2_X_ROT :                     C C |  CAM2_Y_POS :                     4 C |
 CAM2_Y_ROT :                    10 C |  CAM2_Z_POS :                     8 C |
 CAM2_Z_ROT :                    14 C | *CAMERA_ANIM :               915170 C |
*CAM_ANIMDATA :                  18 C | *CAM_ANIMFRAME :                 1C C |
*CAM_ANIMSPD :                   24 C | *CAM_ANIMTIMER :                 20 C |
 CAM_X_POS :                      0 C |  CAM_X_ROT :                      C C |
 CAM_Y_POS :                      4 C |  CAM_Y_ROT :                     10 C |
 CAM_Z_POS :                      8 C |  CAM_Z_ROT :                     14 C |
*CART :                           1 - | *CASESENSITIVE :                  0 - |
 CCB :                          A60 C | *CCBADDRH :                       5 - |
*CCBADDRL :                       3 - | *CCBADDRM :                       4 - |
*CCBATN :                        1E - | *CCBDELH :                        A - |
*CCBDELL :                        9 - | *CCBDURH :                        C - |
*CCBDURL :                        B - | *CCBENV :                        1D - |
 CCBFLAGS :                       6 - | *CCBLOOP0 :                      10 - |
*CCBLOOP1 :                      13 - | *CCBLOOP2 :                      16 - |
*CCBLOOP3 :                      19 - | *CCBPNUM :                        D - |
*CCBPRIO :                       1C - | *CCBSNUM :                        E - |
*CCBTAGH :                        2 - | *CCBTAGL :                        0 - |
*CCBTAGM :                        1 - | *CCBTIMERH :                      8 - |
*CCBTIMERL :                      7 - | *CCBVCHAN :                       F - |
*CCBY :                          1F - |  CH0BUF :                       C60 C |
 CHBUFPTR :                     25C C |  CHECK_TICK :                   210 C |
 CHECK_TICK.CTNOTICK :          237 C |  CHPATPTR :                     25E C |
 CMDINTCLR :                     1A - |  CMDIRQ_ON :                      2 - |
*CMDTASKMD_CAMERAPOS :      6001BCC C |  CMDTASKMD_LOADSPAL :       6001B40 C |
*CMDTASKMD_MAPSET :         6001BB8 C |  CMDTASKMD_OBJECTCLRALL :   6001BA8 C |
 CMDTASKMD_OBJECTPOS :      6001B7C C |  CMDTASKMD_OBJECTSET :      6001B54 C |
 CMDTASKMD_SETBITMAP :      6001B30 C |
 CMDTASKMD_SETBITMAP.WAIT_FB :                                      6001B32 C |
 CMDTASKMD_SETPWM :         6001BF0 C |  COM :                            0 - |
 COMM0 :                         20 - |  COMM10 :                        2A - |
 COMM12 :                        2C - |  COMM14 :                        2E - |
 COMM15 :                        2F - |  COMM2 :                         22 - |
 COMM4 :                         24 - |  COMM6 :                         26 - |
 COMM8 :                         28 - |  COMMZFIFO :                    A00 C |
 COMMZREAD :                    D71 C |  COMMZROMBLK :                  D73 C |
 COMMZROMRD :                   D74 C |  COMMZWRITE :                   D72 C |
*CONSTPI :        3.141592653589793 - |  CONTROLLER_1 :    FFFFFFFFFFFF9000 - |
*CONTROLLER_2 :    FFFFFFFFFFFF9006 - | *CS0 :                            0 - |
 CS1 :                      2000000 - |  CS2 :                      4000000 - |
 CS3 :                      6000000 - |  CURRTICKBITS :                 D67 C |
 CYCLE :                         32 - |  DAC_FILL :                     52C C |
 DAC_FIRSTFILL :                53A C |  DAC_ME :                       518 C |
 DAC_PLAY :                     4C2 C |  DAC_REFILL :                   53E C |
 DAC_REFILL.FDF4DONE :          58E C |  DAC_REFILL.FDF7 :              5FF C |
 DAC_REFILL.FDF72 :             5B8 C |  DAC_REFILL.FDFRETURN :         613 C |
*DAC_REFILL.KEEPCNTR :          567 C | *DATE :                   2/19/2021 - |
 DDACCNTR :                     D6B C |  DDACFIFOMID :                  D6E C |
 DDACPNTR :                     D68 C | *DISPENBL :                      40 - |
 DKY :                            C - | *DMAENBL :                       10 - |
*DOTTEDSTRUCTS :                  0 - |  DO_MULTIPLY :                  24D C |
 DO_MULTIPLY.MULBITCLR :        255 C |  DO_MULTIPLY.MUL_ADD :          250 C |
 DREQCTL :                        6 - | *DREQDEST :                       C - |
*DREQFIFO :                      12 - | *DREQLEN :                       10 - |
*DREQSOURCE :                     8 - |  DRV_LOOP :                      42 C |
 DRV_LOOP.CMND_0 :               FC C |  DRV_LOOP.CMND_WAV_PITCH :      168 C |
 DRV_LOOP.CMND_WAV_SET :        101 C |  DRV_LOOP.LIST :                 B6 C |
 DRV_LOOP.NEITHERTICK :          8D C |  DRV_LOOP.NEXT_CMD :             8D C |
 DRV_LOOP.NOBEATS :              7A C |  DRV_LOOP.NOTICKS :              62 C |
 DRWSLD_NEXTPZ :   FFFFFFFFC00002FC C |
*DRWSLD_NEXTPZ.FINISH_IT :                                 FFFFFFFFC0000310 C |
 DRWSLD_NEXTPZ.RESET_RD :                                  FFFFFFFFC000030E C |
 DRWSLD_NXTLINE :  FFFFFFFFC0000256 C |
 DRWSLD_NXTLINE.L_FIX :                                    FFFFFFFFC0000298 C |
 DRWSLD_NXTLINE.REVERS :                                   FFFFFFFFC0000282 C |
 DRWSLD_NXTLINE.R_FIX :                                    FFFFFFFFC0000292 C |
 DRWSLD_NXTLINE.WAIT :                                     FFFFFFFFC00002A2 C |
 DRWSLD_NXTLINE_TEX :                                      FFFFFFFFC0000150 C |
 DRWSLD_NXTLINE_TEX.TEX_SKIP_LINE :                        FFFFFFFFC0000216 C |
 DRWSLD_NXTLINE_TEX.TEX_XLOOP :                            FFFFFFFFC00001F8 C |
 DRWSLD_NXTLINE_TEX.TL_FIX :                               FFFFFFFFC00001D6 C |
 DRWSLD_NXTLINE_TEX.TR_FIX :                               FFFFFFFFC00001C2 C |
 DRWSLD_NXTLINE_TEX.TXREVERS :                             FFFFFFFFC0000190 C |
 DRWSLD_UPDLINE :  FFFFFFFFC00002F2 C |
 DRWSLD_UPDLINE_TEX :                                      FFFFFFFFC0000226 C |
 DRWTASK_EXIT :    FFFFFFFFC000033A C |  DRWTASK_RETURN :  FFFFFFFFC000031E C |
 DRWTEX_GONXTPZ :  FFFFFFFFC0000240 C |  DRWTEX_TAGSHGHT : FFFFFFFFC0000244 C |
*DRWTSK1_NEWPZ :   FFFFFFFFC00000EC C |
 DRWTSK1_NEWPZ.INVLD_Y :                                   FFFFFFFFC0000112 C |
 DRWTSK1_NEWPZ.LEN_MAX :                                   FFFFFFFFC000010C C |
 DRWTSK1_VLD_Y :   FFFFFFFFC0000126 C | *DRWTSK_00 :       FFFFFFFFC0000314 C |
 DRWTSK_01 :       FFFFFFFFC00000C0 C |
 DRWTSK_01.HAS_PZ :                                        FFFFFFFFC00000D0 C |
 DRWTSK_02 :       FFFFFFFFC000007C C |
 DRWTSK_SOLIDMODE :                                        FFFFFFFFC0000248 C |
 DRWTSK_TEXMODE :  FFFFFFFFC000013C C |
 DRWTSK_TEXMODE.TEXVALID :                                 FFFFFFFFC0000148 C |
 DTH :                           20 - |  DTL :                           1C - |
 DWAVEBUFF :                    900 C |  ENGINE_CODE :                  932 C |
 ENGINE_CODE_END :             3C68 C | *EXVTBLCD :                     DEA C |
*EXVTBLMARS :                   E23 C |  FALSE :                          0 - |
*FEN :                            2 - | *FILLDATA :                       8 - |
*FILLLENGTH :                     5 - | *FILLSTART :                      6 - |
 FLG :                           28 - |  FM :                            80 - |
*FMFREQ_LIST :                  708 C | *FMINS_AMBIENT_DARK :          1210 C |
*FMINS_AMBIENT_SPOOK :         1230 C | *FMINS_BASS_2 :                1050 C |
*FMINS_BASS_3 :                1070 C | *FMINS_BASS_5 :                1090 C |
*FMINS_BASS_AMBIENT :           FF0 C | *FMINS_BASS_BEACH :            1130 C |
*FMINS_BASS_BEACH_2 :          1150 C | *FMINS_BASS_CALM :              FB0 C |
*FMINS_BASS_GUM :               F90 C | *FMINS_BASS_HEAVY :             FD0 C |
*FMINS_BASS_SYNTH :            10B0 C | *FMINS_BELL_GLASS :            11D0 C |
*FMINS_BRASS_CAVE :            1170 C | *FMINS_BRASS_GUMMY :           1010 C |
*FMINS_DING_TOY :              1250 C | *FMINS_DRUMCLOSEHAT :           F50 C |
*FMINS_DRUMKICK :               F10 C | *FMINS_DRUMSNARE :              F30 C |
*FMINS_FLAUTE_1 :              1030 C | *FMINS_FM3_CLOSEDHAT :          EE8 C |
*FMINS_FM3_OPENHAT :            EC0 C | *FMINS_GUITAR_1 :              10D0 C |
*FMINS_HORN_1 :                10F0 C | *FMINS_MARIMBA_1 :             11F0 C |
*FMINS_ORGAN_M1 :              1110 C | *FMINS_PIANO_M1 :               F70 C |
*FMINS_PIANO_SMALL :           1190 C | *FMINS_TRUMPET_2 :             11B0 C |
*FMVTBL :                       DA1 C | *FMVTBLCH3 :                    DC4 C |
*FMVTBLCH6 :                    DBD C |  FRAMECTL :                       B - |
*FS :                             1 - | *FULLPMMU :                       1 - |
 GEMA_INIT :                    181 C |  GET_CMDBYTE :                  1E7 C |
 GET_CMDBYTE.GETCBYTEL :        1EA C |  GLBL_LASTORG :               15170 - |
 GLBL_LASTPC :              6011508 - | *HAS64 :                          1 - |
*HASDSP :                         0 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - | *HBLK :                          40 - |
*HCOUNT :                         5 - |  HINTCLR :                       18 - |
*HINTENBL :                      10 - |  HINT_DEFAULT :              FF0368 C |
*HIRQ_ON :                        4 - | *HVSTOP :                         2 - |
*INEXTMODE :                      0 - | *INLWORDMODE :                    0 - |
*INMAXMODE :                      0 - | *INSRCMODE :                      0 - |
*INSUPMODE :                      1 - |  INTMASK :                        1 - |
 INT_M_LIST :               600026C C |  INT_S_LIST :               60002CC C |
 JOYA :                          40 - | *JOYB :                          10 - |
*JOYC :                          20 - | *JOYDOWN :                        2 - |
*JOYLEFT :                        4 - | *JOYMODE :                      800 - |
*JOYRIGHT :                       8 - | *JOYSTART :                      80 - |
*JOYUP :                          1 - | *JOYX :                         400 - |
 JOYY :                         200 - |  JOYZ :                         100 - |
 LAY_WIDTH :                     20 - |  LCHWIDTH :                      34 - |
 LEV :                            4 - | *LISTON :                         3 - |
 LIST_VDPREGS :              FF092E C |  LITERAL_F_00000000_1 :     6000268 C |
 LITERAL_F_00000001_1 :     60004BC C |  LITERAL_F_00000002_1 :     60004C4 C |
 LITERAL_F_00000003_1 :     60004D0 C |  LITERAL_F_00000004_1 :     60004E8 C |
 LITERAL_F_00000005_1 :     6000504 C |  LITERAL_F_00000006_1 :     600061C C |
 LITERAL_F_00000007_1 :     6000644 C |  LITERAL_F_00000008_1 :     6000720 C |
 LITERAL_F_00000009_1 :     600079C C |  LITERAL_F_0000000A_1 :     60007A0 C |
 LITERAL_F_0000000B_1 :     60007A4 C |  LITERAL_F_0000000C_1 :     6000A6C C |
 LITERAL_F_0000000D_1 :     6000A70 C |  LITERAL_F_0000000E_1 :     6000A74 C |
 LITERAL_F_0000000F_1 :     6000A78 C |  LITERAL_F_00000010_1 :     6000A80 C |
 LITERAL_F_00000011_1 :     6000AA4 C |  LITERAL_F_00000012_1 :     6000CC0 C |
 LITERAL_F_00000013_1 :     6000E1C C |  LITERAL_F_00000014_1 :     6000E9C C |
 LITERAL_F_00000015_1 :     6000EA0 C |  LITERAL_F_00000016_1 :     6000EA4 C |
 LITERAL_F_00000017_1 :     6000EA8 C |
 LITERAL_F_00000018_1 :                                    FFFFFFFFC0000058 C |
 LITERAL_F_00000019_1 :                                    FFFFFFFFC0000118 C |
 LITERAL_F_0000001A_1 :                                    FFFFFFFFC000011C C |
 LITERAL_F_0000001B_1 :                                    FFFFFFFFC0000358 C |
 LITERAL_F_0000001C_1 :                                    FFFFFFFFC000035C C |
 LITERAL_F_0000001D_1 :                                    FFFFFFFFC0000360 C |
 LITERAL_F_0000001E_1 :                                    FFFFFFFFC00004A4 C |
 LITERAL_F_0000001F_1 :                                    FFFFFFFFC00004A8 C |
 LITERAL_F_00000020_1 :                                    FFFFFFFFC00004AC C |
 LITERAL_F_00000021_1 :                                    FFFFFFFFC00004B4 C |
 LITERAL_F_00000022_1 :                                    FFFFFFFFC00004B8 C |
 LITERAL_F_00000023_1 :                                    FFFFFFFFC00005D0 C |
 LITERAL_F_00000024_1 :                                    FFFFFFFFC00005D4 C |
 LITERAL_F_00000025_1 :                                    FFFFFFFFC00005D8 C |
 LITERAL_F_00000026_1 :                                    FFFFFFFFC00005DC C |
 LITERAL_F_00000027_1 :                                    FFFFFFFFC00005E0 C |
 LITERAL_F_00000028_1 :                                    FFFFFFFFC00005E4 C |
 LITERAL_F_00000029_1 :                                    FFFFFFFFC00006AC C |
 LITERAL_F_0000002A_1 :                                    FFFFFFFFC00006B0 C |
 LITERAL_F_0000002B_1 :                                    FFFFFFFFC00006B4 C |
 LITERAL_F_0000002C_1 :                                    FFFFFFFFC00006B8 C |
 LITERAL_F_0000002D_1 :                                    FFFFFFFFC00006BC C |
 LITERAL_F_0000002E_1 :                                    FFFFFFFFC00006C0 C |
 LITERAL_F_0000002F_1 :     60016D4 C |  LITERAL_F_00000030_1 :     600175C C |
 LITERAL_F_00000031_1 :     6001760 C |  LITERAL_F_00000032_1 :     60018CC C |
 LITERAL_F_00000033_1 :     60018E0 C |  LITERAL_F_00000034_1 :     60018EC C |
 LITERAL_F_00000035_1 :     60018F4 C |  LITERAL_F_00000036_1 :     60018F8 C |
 LITERAL_F_00000037_1 :     60018FC C |  LITERAL_F_00000038_1 :     6001900 C |
 LITERAL_F_00000039_1 :     6001A60 C |  LITERAL_F_0000003A_1 :     6001A74 C |
 LITERAL_F_0000003B_1 :     6001A7C C |  LITERAL_F_0000003C_1 :     6001A80 C |
 LITERAL_F_0000003D_1 :     6001A84 C |  LITERAL_F_0000003E_1 :     6001A8C C |
 LITERAL_F_0000003F_1 :     6001A94 C |  LITERAL_F_00000040_1 :     6001A98 C |
 LITERAL_F_00000041_1 :     6001A9C C |  LITERAL_F_00000042_1 :     6001AA0 C |
 LITERAL_F_00000043_1 :     6001B28 C |  LITERAL_F_00000044_1 :     6001C14 C |
 LITERAL_F_00000045_1 :     6001C18 C |  LITERAL_F_00000046_1 :     6001C24 C |
 LITERAL_L_0000E000_1 :     6000CB8 C |
 LITERAL_L_0000FFFF_1 :                                    FFFFFFFFC0000120 C |
 LITERAL_L_000FFFFF_1 :     6000E20 C |  LITERAL_L_00100000_1 :     6000A7C C |
 LITERAL_L_02000000_1 :     6000E24 C |  LITERAL_L_0600064E_1 :     60018DC C |
 LITERAL_L_060006F0_1 :     60018E4 C |  LITERAL_L_060006F0_2 :     6001C10 C |
 LITERAL_L_0600072C_1 :     6001A88 C |  LITERAL_L_060007AE_1 :     6001C20 C |
 LITERAL_L_06000A92_1 :     6001A6C C |  LITERAL_L_06000A92_2 :     6001C1C C |
 LITERAL_L_06000AAA_1 :     6001A90 C |  LITERAL_L_06000E64_1 :     60018F0 C |
 LITERAL_L_06000EBC_1 :     60018D4 C |  LITERAL_L_0600161C_1 :     6001A64 C |
 LITERAL_L_0603EFF8_1 :     6000640 C |  LITERAL_L_0603F000_1 :     6001A5C C |
 LITERAL_L_0603FFF8_1 :     6000500 C |  LITERAL_L_06040000_1 :     60018C0 C |
 LITERAL_L_20004000_1 :     60004F0 C |  LITERAL_L_20004000_2 :     6000630 C |
 LITERAL_L_20004000_3 :     6000714 C |  LITERAL_L_20004000_4 :     6001758 C |
 LITERAL_L_20004000_5 :     60018D0 C |  LITERAL_L_20004000_6 :     6001A50 C |
 LITERAL_L_20004016_1 :     60004E0 C |  LITERAL_L_20004016_2 :     600062C C |
 LITERAL_L_20004018_1 :     60004DC C |  LITERAL_L_20004018_2 :     6000628 C |
 LITERAL_L_2000401A_1 :     60004CC C |  LITERAL_L_2000401A_2 :     6000618 C |
 LITERAL_L_2000401C_1 :     60004C8 C |  LITERAL_L_2000401C_2 :     6000614 C |
 LITERAL_L_20004020_1 :     60018C4 C |  LITERAL_L_20004020_2 :     6001A54 C |
 LITERAL_L_20004022_1 :     6001A78 C |  LITERAL_L_20004024_1 :     60016E4 C |
 LITERAL_L_20004026_1 :     6001C54 C |  LITERAL_L_20004028_1 :     60004D4 C |
 LITERAL_L_20004028_2 :     6000620 C |  LITERAL_L_2000402E_1 :     60004D8 C |
 LITERAL_L_2000402E_2 :     60018E8 C |  LITERAL_L_2000402E_3 :     6001AA4 C |
 LITERAL_L_2000402F_1 :     6000624 C |  LITERAL_L_2000402F_2 :     6001A70 C |
 LITERAL_L_20004034_1 :     60016DC C |  LITERAL_L_20004036_1 :     60016E0 C |
 LITERAL_L_20004038_1 :     60004C0 C |  LITERAL_L_20004038_2 :     60016D8 C |
 LITERAL_L_20004100_1 :     60004E4 C |  LITERAL_L_20004100_2 :     6000718 C |
 LITERAL_L_20004100_3 :     6000EAC C |
 LITERAL_L_20004100_4 :                                    FFFFFFFFC0000054 C |
 LITERAL_L_20004100_5 :                                    FFFFFFFFC0000354 C |
 LITERAL_L_20004100_6 :     6001908 C |  LITERAL_L_20004100_7 :     6001C0C C |
 LITERAL_L_20004200_1 :     60004EC C |  LITERAL_L_24000000_1 :     600071C C |
 LITERAL_L_24020200_1 :                                    FFFFFFFFC0000350 C |
 LITERAL_L_36385550_1 :     60004F4 C |  LITERAL_L_36385550_2 :     6000634 C |
 LITERAL_L_3FFFFFFF_1 :     6000CB4 C |  LITERAL_L_40000000_1 :     6000A84 C |
 LITERAL_L_4D5F4F4B_1 :     60004FC C |  LITERAL_L_4D5F4F4B_2 :     600063C C |
 LITERAL_L_534C4156_1 :     60018C8 C |  LITERAL_L_534C4156_2 :     6001A58 C |
 LITERAL_L_535F4F4B_1 :     60004F8 C |  LITERAL_L_535F4F4B_2 :     6000638 C |
 LITERAL_L_7FFFFFFF_1 :     6000CBC C |
 LITERAL_L_7FFFFFFF_2 :                                    FFFFFFFFC00004B0 C |
 LITERAL_L_FFFFFFFFC0000000_1 :                                     60018D8 C |
 LITERAL_L_FFFFFFFFC0000000_2 :                                     6001A68 C |
 LITERAL_L_FFFFFFFFC0000376_1 :                                     6001904 C |
 LITERAL_L_FFFFFFFFFF000000_1 :                                     6001764 C |
 LITERAL_L_FFFFFFFFFFE00000_1 :                                     6000A8C C |
 LITERAL_L_FFFFFFFFFFF00000_1 :                                     60007A8 C |
 LITERAL_L_FFFFFFFFFFF00000_2 :                                     6000A88 C |
 LITERAL_W_0080_1 :         6000724 C |
 LITERAL_W_00A0_1 :                                        FFFFFFFFC000005E C |
 LITERAL_W_00A0_2 :                                        FFFFFFFFC00004BC C |
 LITERAL_W_00A1_1 :         6000EB4 C |  LITERAL_W_00E0_1 :         6000EB2 C |
 LITERAL_W_00E0_2 :                                        FFFFFFFFC0000124 C |
 LITERAL_W_00E0_3 :                                        FFFFFFFFC000036C C |
 LITERAL_W_00E0_4 :                                        FFFFFFFFC00004BE C |
 LITERAL_W_00F0_1 :         600050A C |  LITERAL_W_00F0_2 :         600064A C |
 LITERAL_W_00F0_3 :         6000728 C |  LITERAL_W_00F0_4 :         6001912 C |
 LITERAL_W_00F0_5 :         6001AB4 C |  LITERAL_W_00FF_1 :         600072A C |
 LITERAL_W_00FF_2 :                                        FFFFFFFFC000036A C |
 LITERAL_W_0100_1 :         6000726 C |  LITERAL_W_0100_2 :         6000CC4 C |
 LITERAL_W_0100_3 :         6001918 C |  LITERAL_W_0100_4 :         6001B2C C |
 LITERAL_W_0105_1 :         600176A C |
 LITERAL_W_013F_1 :                                        FFFFFFFFC000036E C |
 LITERAL_W_0140_1 :                                        FFFFFFFFC0000364 C |
 LITERAL_W_01D8_1 :         6001916 C |  LITERAL_W_02C0_1 :         6000AA8 C |
 LITERAL_W_0415_1 :         6001768 C |  LITERAL_W_07FF_1 :         6000EB0 C |
 LITERAL_W_1FFF_1 :         6000A90 C |  LITERAL_W_1FFF_2 :         6000CC6 C |
 LITERAL_W_1FFF_3 :         6000E28 C |
 LITERAL_W_1FFF_4 :                                        FFFFFFFFC0000368 C |
 LITERAL_W_44E0_1 :         600050C C |  LITERAL_W_44E0_2 :         600064C C |
 LITERAL_W_5A00_1 :                                        FFFFFFFFC0000374 C |
 LITERAL_W_5A10_1 :                                        FFFFFFFFC0000064 C |
 LITERAL_W_5A7F_1 :         6001AB0 C |  LITERAL_W_5A7F_2 :         6001C5E C |
 LITERAL_W_5AFF_1 :         6000EB8 C |  LITERAL_W_8000_1 :         60007AC C |
 LITERAL_W_A518_1 :                                        FFFFFFFFC0000062 C |
 LITERAL_W_A518_2 :                                        FFFFFFFFC0000372 C |
 LITERAL_W_A518_3 :         600191C C |  LITERAL_W_A518_4 :         6001C5C C |
 LITERAL_W_A538_1 :         6000EBA C |  LITERAL_W_A538_2 :         6001AB2 C |
 LITERAL_W_FE10_1 :         6000508 C |  LITERAL_W_FE10_2 :         6000648 C |
 LITERAL_W_FE10_3 :                                        FFFFFFFFC000005C C |
 LITERAL_W_FE10_4 :         600190C C |  LITERAL_W_FE10_5 :         6001AA8 C |
 LITERAL_W_FE10_6 :         6001C58 C |  LITERAL_W_FE80_1 :         6000EB6 C |
 LITERAL_W_FE80_2 :                                        FFFFFFFFC0000060 C |
 LITERAL_W_FE80_3 :                                        FFFFFFFFC0000370 C |
 LITERAL_W_FE80_4 :         600191A C |  LITERAL_W_FE80_5 :         6001AAE C |
 LITERAL_W_FE80_6 :         6001C5A C |  LITERAL_W_FE92_1 :         6001914 C |
 LITERAL_W_FE92_2 :         6001AB6 C |  LITERAL_W_FEE2_1 :         600190E C |
 LITERAL_W_FEE2_2 :         6001AAA C |  LITERAL_W_FEE4_1 :         6001910 C |
 LITERAL_W_FEE4_2 :         6001AAC C |  LITERAL_W_FF00_1 :         6000E2A C |
 LITERAL_W_FF00_2 :                                        FFFFFFFFC0000366 C |
 LITERAL_W_FF00_3 :                                        FFFFFFFFC00005E8 C |
 LITERAL_W_FF60_1 :         6000CC8 C | *MACEXP :                         7 - |
 MAINDRW_TASKS :   FFFFFFFFC0000066 C |
 MAINDRW_TASKS.LIST :                                      FFFFFFFFC0000070 C |
*MARS :                           1 - | *MARSCD :                         0 - |
 MARSGBL_CURRFACEPOS :            C C |  MARSGBL_CURRFB :                22 C |
 MARSGBL_CURRZLIST :              8 C |  MARSGBL_DIVREQ_M :              20 C |
 MARSGBL_DRWTASK :               1A C |  MARSGBL_MDLFACESCNTR :          14 C |
*MARSGBL_MDTASKLIST_RQ :         12 C | *MARSGBL_MDTASKLIST_SW :         10 C |
 MARSGBL_PALDMAMIDWR :           24 C |  MARSGBL_PLYPZLIST_R :            0 C |
 MARSGBL_PLYPZLIST_W :            4 C |  MARSGBL_POLYBUFFNUM :           16 C |
 MARSGBL_PZLISTCNTR :            18 C |  MARSGBL_VINTFLAG_M :            1C C |
 MARSGBL_VINTFLAG_S :            1E C |  MARSLAY_DRAW :             60007C2 C |
 MARSLAY_DRAW.BLANK_MDL :   6000952 C |  MARSLAY_DRAW.CENTER_VAL :  6000820 C |
 MARSLAY_DRAW.CLROLD :      60007CC C |  MARSLAY_DRAW.DOWN :        60009F4 C |
 MARSLAY_DRAW.DOWN_LEFT :   6000A1C C |  MARSLAY_DRAW.DO_PIECE :    6000924 C |
 MARSLAY_DRAW.FRONT :       600097C C |  MARSLAY_DRAW.FRONT_FR :    60009A4 C |
 MARSLAY_DRAW.FRONT_LF :    6000A44 C |  MARSLAY_DRAW.LIST :        6000824 C |
 MARSLAY_DRAW.NXT_ONE :     600092A C |  MARSLAY_DRAW.RIGHT_DW :    60009CC C |
 MARSLAY_DRAW.XROTLIST :    600096C C |  MARSLAY_MAKE :             60007AE C |
 MARSLAY_READ :             600072C C |  MARSLAY_READ.NO_LAY :      6000796 C |
 MARSLAY_READ.NO_XR_UPD :   600078E C |  MARSLAY_READ.NO_X_UPD :    600077C C |
 MARSLAY_READ.NO_Y_UPD :    600076A C |  MARSLAY_READ.NO_Z_UPD :    6000758 C |
 MARSMDL_INIT :             6000A92 C |  MARSMDL_INIT.CLNUP :       6000A98 C |
 MARSMDL_READMODEL :        6000AAA C |
 MARSMDL_READMODEL.ALLFCSDONE :                                     6000C3C C |
 MARSMDL_READMODEL.ALLUVDONE :                                      6000B6E C |
 MARSMDL_READMODEL.CAMLIMIT :                                       6000C70 C |
 MARSMDL_READMODEL.CAN_BUILD :                                      6000B10 C |
 MARSMDL_READMODEL.EXIT_MODEL :                                     6000CAE C |
*MARSMDL_READMODEL.FACE_OK :                                        6000C90 C |
 MARSMDL_READMODEL.FACE_OUT :                                       6000C9E C |
 MARSMDL_READMODEL.FINISH_THIS :                                    6000CA6 C |
 MARSMDL_READMODEL.GO_FACES :                                       6000B9E C |
 MARSMDL_READMODEL.NEXT_FACE :                                      6000B04 C |
 MARSMDL_READMODEL.NO_ANIM :                                        6000AF0 C |
 MARSMDL_READMODEL.ON_FRAMES :                                      6000AC6 C |
 MARSMDL_READMODEL.REVRSCAM :                                       6000C68 C |
 MARSMDL_READMODEL.SET_TRI :                                        6000B1E C |
 MARSMDL_READMODEL.SOLID_TYPE :                                     6000B90 C |
 MARSMDL_READMODEL.WAIT_CAMANIM :                                   6000AEE C |
 MARSOBJ_SMOK :             6011260 C |  MARSOBJ_SMOK.FACE :        60112A4 C |
 MARSOBJ_SMOK.MTRL :        60112D4 C |  MARSOBJ_SMOK.VERT :        6011274 C |
 MARSOBJ_SMOK.VRTX :        60112C4 C |  MARSOBJ_TEST :             600FAB8 C |
 MARSOBJ_TEST.FACE :        600FC70 C |  MARSOBJ_TEST.MTRL :        600FED0 C |
 MARSOBJ_TEST.VERT :        600FACC C |  MARSOBJ_TEST.VRTX :        600FDE0 C |
 MARSOBJ_TEST2 :            600FED8 C |  MARSOBJ_TEST2.FACE :       601039C C |
 MARSOBJ_TEST2.MTRL :       6010E3C C |  MARSOBJ_TEST2.VERT :       600FEEC C |
 MARSOBJ_TEST2.VRTX :       601095C C |  MARSOBJ_TEST3 :            6010E44 C |
 MARSOBJ_TEST3.FACE :       6011008 C |  MARSOBJ_TEST3.MTRL :       6011258 C |
 MARSOBJ_TEST3.VERT :       6010E58 C |  MARSOBJ_TEST3.VRTX :       6011148 C |
 MARSRAM_SOUND :            60223A0 C |  MARSRAM_SYSTEM :           6011508 C |
 MARSRAM_VIDEO :            6011554 C |  MARSSND_PWMCHNLS :         60223A0 C |
 MARSSOUND_INIT :           60016E8 C |  MARSSOUND_INIT.CLR_ENBL :  6001708 C |
 MARSSOUND_PWM :            6001640 C |  MARSSOUND_PWM.CHNOFF :     600169E C |
 MARSSOUND_PWM.FULL :       60016A6 C |  MARSSOUND_PWM.KEEP :       600169C C |
 MARSSOUND_PWM.NOEND :      600167C C |  MARSSOUND_PWM.NOL :        6001698 C |
 MARSSOUND_PWM.NOR :        6001692 C |  MARSSOUND_PWM.NXTCHN :     6001656 C |
 MARSSOUND_PWM.READ :       6001682 C | *MARSSOUND_RUN :            6001638 C |
 MARSSOUND_SETCHANNEL :     6001718 C |
 MARSSOUND_SETCHANNEL.ENDMRK :                                      6001740 C |
*MARSVIDEO_CLEARFRAME :     600069C C |
 MARSVIDEO_CLEARFRAME.LOOP :                                        60006B0 C |
 MARSVIDEO_CLEARFRAME.WAIT :                                        60006BE C |
 MARSVIDEO_CLEARFRAME.WAIT2 :                                       600069E C |
*MARSVIDEO_FRAMESWAP :      60006D0 C |
 MARSVIDEO_FRAMESWAP.WAIT_FB :                                      60006D2 C |
 MARSVIDEO_FRAMESWAP.WAIT_RESULT :                                  60006E2 C |
 MARSVIDEO_INIT :           600064E C |  MARSVIDEO_INIT.FB_WAIT1 :  600067E C |
 MARSVIDEO_INIT.LOOP :      6000674 C |  MARSVIDEO_INIT.THIS_FB :   600066C C |
 MARSVIDEO_INIT.WAIT_RESULT :                                       600068E C |
 MARSVIDEO_LOADPAL :        60006F0 C |  MARSVIDEO_LOADPAL.LOOP :   6000700 C |
 MARSVIDEO_MAKEPOLYGON :                                   FFFFFFFFC0000376 C |
 MARSVIDEO_MAKEPOLYGON.DONTRESET :                         FFFFFFFFC000047C C |
 MARSVIDEO_MAKEPOLYGON.EXIT :                              FFFFFFFFC000049C C |
 MARSVIDEO_MAKEPOLYGON.FIND_TOP :                          FFFFFFFFC000042E C |
 MARSVIDEO_MAKEPOLYGON.IS_HIGH :                           FFFFFFFFC0000440 C |
 MARSVIDEO_MAKEPOLYGON.IS_LOW :                            FFFFFFFFC0000436 C |
 MARSVIDEO_MAKEPOLYGON.LEFTH2 :                            FFFFFFFFC0000494 C |
 MARSVIDEO_MAKEPOLYGON.NEXT_PZ :                           FFFFFFFFC0000462 C |
 MARSVIDEO_MAKEPOLYGON.PLGN_PNTS :                         FFFFFFFFC00003F6 C |
 MARSVIDEO_MAKEPOLYGON.SETPNTS :                           FFFFFFFFC00003FC C |
*MARSVIDEO_MAKEPOLYGON.SPR_PNTS :                          FFFFFFFFC0000394 C |
 MARSVIDEO_MAKEPOLYGON.SRC_PNTS :                          FFFFFFFFC0000410 C |
 MARSVIDEO_MAKEPOLYGON.START_MATH :                        FFFFFFFFC000041E C |
 MARSVIDEO_MAKEPOLYGON.TRINGL :                            FFFFFFFFC0000388 C |
 MARSVIDEO_MAKEPOLYGON.YTRINGL :                           FFFFFFFFC0000426 C |
 MARSVIDEO_SETWATCHDOG :    6000E64 C |
 MARSVIDEO_SETWATCHDOG.WAIT_FB :                                    6000E82 C |
 MARS_ENTRY :                   800 C |  MARS_ENTRY.ADAPTERENABLE :     872 C |
 MARS_ENTRY.CLRRAM :            8F0 C |  MARS_ENTRY.COPYME :            90C C |
 MARS_ENTRY.HOTSTART :          8BE C |  MARS_ENTRY.INIT :              880 C |
 MARS_ENTRY.NO_MARS :           918 C |  MARS_ENTRY.RAMCODE :           84A C |
 MARS_ENTRY.RESTARTICD :        85A C |  MARS_ENTRY.WAITFRAME :         8D0 C |
 MARS_ENTRY.WM :                892 C |  MARS_ENTRY.WS :                89C C |
 MARS_RAMDATA :                3C68 C |  MARS_RAMDATA_E :             15170 C |
 MASTER_IRQ :               6000248 C |  MASTER_LOOP :              6001802 C |
 MASTER_LOOP.CONT_PLGN :    6001878 C |  MASTER_LOOP.DRAW_OBJECTS : 6001856 C |
 MASTER_LOOP.INVALID :      600188E C |  MASTER_LOOP.LOOP :         600187E C |
 MASTER_LOOP.MD_REQ :       6001824 C |  MASTER_LOOP.NEXT_REQ :     600182E C |
 MASTER_LOOP.NO_TASK :      600183E C |  MASTER_LOOP.PAGE_2 :       6001874 C |
 MASTER_LOOP.SKIP :         6001898 C |  MASTER_LOOP.WAIT_PZ :      6001898 C |
 MASTER_LOOP.WAIT_TASK :    600189E C |  MAX_FACES :                    100 - |
 MAX_MDERAM :                   800 - |  MAX_MDTASKS :                   10 - |
 MAX_MDTSKARG :                   8 - |  MAX_MODELS :                    40 - |
 MAX_PWMCHNL :                   10 - |  MAX_SVDP_PZ :                  180 - |
 MAX_ZDIST :       FFFFFFFFFFFFE000 - | *MBOXES :                       A40 C |
*MCD :                            0 - |  MCHNSND_BANK :                   8 C |
 MCHNSND_ENBL :                   0 C |  MCHNSND_END :                   10 C |
 MCHNSND_FLAGS :                 1C C |  MCHNSND_LOOP :                  14 C |
 MCHNSND_PITCH :                 18 C |  MCHNSND_READ :                   4 C |
 MCHNSND_START :                  C C |  MCHNSND_VOL :                   20 C |
 MDLLAY_DATA :                    0 C |  MDLLAY_X :                       4 C |
 MDLLAY_XR_LAST :                1C C |  MDLLAY_X_LAST :                 10 C |
 MDLLAY_Y :                       8 C |  MDLLAY_Y_LAST :                 14 C |
 MDLLAY_Z :                       C C |  MDLLAY_Z_LAST :                 18 C |
 MDLRD_ROTATE :             6000E2C C |  MDLRD_SETPOINT :           6000CCC C |
 MDLRD_SETPOINT.INSIDE :    6000DC4 C |  MDLRD_SETPOINT.LAY_MOVE :  6000D3C C |
 MDLRD_SETPOINT.SAVE_Z :    6000DFC C |  MDLRD_SETPOINT.SAVE_Z2 :   6000DF6 C |
 MDLRD_SETPOINT.X_LW :      6000E02 C |  MDLRD_SETPOINT.X_RW :      6000E08 C |
 MDLRD_SETPOINT.Y_LW :      6000E0E C |  MDLRD_SETPOINT.Y_RW :      6000E14 C |
 MDLRD_SETPOINT.ZMULTI :    6000DE2 C |  MDL_ANIMDATA :                  1C C |
 MDL_ANIMFRAME :                 20 C | *MDL_ANIMSPD :                   28 C |
 MDL_ANIMTIMER :                 24 C |  MDL_DATA :                       0 C |
 MDL_X_POS :                      4 C |  MDL_X_ROT :                     10 C |
 MDL_Y_POS :                      8 C |  MDL_Y_ROT :                     14 C |
 MDL_Z_POS :                      C C |  MDL_Z_ROT :                     18 C |
*MDMDL1_USERCONTROL :        FF30DA C |  MDMDL1_USERCONTROL.NO_A :   FF3152 C |
 MDMDL1_USERCONTROL.NO_B :   FF3172 C |  MDMDL1_USERCONTROL.NO_DW :  FF3112 C |
 MDMDL1_USERCONTROL.NO_LF :  FF3122 C |  MDMDL1_USERCONTROL.NO_RG :  FF3132 C |
 MDMDL1_USERCONTROL.NO_UP :  FF30FE C |  MDMDL1_USERCONTROL.NO_X :   FF3188 C |
 MDMDL1_USERCONTROL.NO_Y :   FF319E C | *MDMDL_CAMANIMATE :          FF307A C |
 MDMDL_CAMANIMATE.NO_CAMANIM :                                       FF30D8 C |
 MDMDL_CAMANIMATE.ON_FRAMES :                                        FF30AA C |
 MDMDL_UPDATE :              FF305E C |  MDMDL_UPDATE.MOD0 :         FF3070 C |
 MDRAM_START :             FFFF8800 - |  MD_BANK_SRAM :              A130F1 - |
 MD_ERRADDR :                   930 C |  MD_ERRBUS :                    930 C |
 MD_ERRCHK :                    930 C |  MD_ERRILL :                    930 C |
 MD_ERROREX :                   930 C |  MD_ERRORTRAP :                 930 C |
 MD_ERRPRIVL :                  930 C |  MD_ERRTRAPV :                  930 C |
 MD_ERRZDIV :                   930 C | *MD_GMMODE0 :                FF2E4A C |
*MD_GMMODE0.LIST :           FF2ECE C |  MD_GMMODE0.LOOP :           FF2E8C C |
 MD_GMMODE0.MODE0 :          FF2ED6 C |  MD_GMMODE0.MODE0_LOOP :     FF2F38 C |
 MD_GMMODE0.NOC :            FF2F62 C |  MD_GMMODE0.NOD :            FF2FBA C |
 MD_GMMODE0.NOL :            FF2F78 C |  MD_GMMODE0.NOR :            FF2F8E C |
 MD_GMMODE0.NOU :            FF2FA4 C |  MD_GMMODE0.NOX :            FF3012 C |
 MD_GMMODE0.UPDATE :         FF3044 C |  MD_LINE1010 :                  930 C |
 MD_LINE1111 :                  930 C |  MD_MAIN :                   FF2E3E C |
*MD_MARS_ID :                A130EC - |  MD_TRACE :                     930 C |
 MODE :                          18 - |  MODE_INIT :                 FF033C C |
 MODE_INIT.CLR :             FF0348 C |  MOMCPU :                     68000 - |
*MOMCPUNAME :                 68000 - |  MONOWIDTH :                     38 - |
 M_IRQ_BAD :                6000314 C |  M_IRQ_CMD :                600033C C |
 M_IRQ_CMD.FINISH :         6000386 C |  M_IRQ_CMD.NEXT_COMM :      6000356 C |
 M_IRQ_CMD.WAIT_MD_B :      600035A C |  M_IRQ_CMD.WAIT_MD_C :      600036A C |
 M_IRQ_CUSTOM :    FFFFFFFFC0000000 C |
 M_IRQ_CUSTOM.ON_CLR :                                     FFFFFFFFC000004C C |
 M_IRQ_CUSTOM.WAIT_FB :                                    FFFFFFFFC000001C C |
 M_IRQ_CUSTOM.WAIT_FRMSWP :                                FFFFFFFFC0000016 C |
 M_IRQ_H :                  60003A4 C |  M_IRQ_PWM :                6000318 C |
 M_IRQ_PWM.EXIT :           600032A C |  M_IRQ_V :                  60003C0 C |
 M_IRQ_V.COPY_PAL :         60003EA C | *M_IRQ_V.MID_PWRITE :       600045A C |
 M_IRQ_V.WAIT :             60003CE C |  M_IRQ_VRES :               6000464 C |
 M_IRQ_VRES.MARS_RESET :    60004AE C |  M_IRQ_VRES.MD_RESET :      600047C C |
 M_IRQ_VRES.SH_WAIT :       6000484 C |  M_IRQ_VRES.VRESLOOP :      60004B6 C |
*NESTMAX :                      100 - |  ON_HOLD :                        2 C |
 ON_PRESS :                       4 C | *PACKING :                        0 - |
*PADDING :                        0 - | *PADDINGSOFAR :                   0 - |
 PAD_ID :                         0 C |  PAD_VER :                        1 C |
 PALETTE_MAP :              6004660 C |  PALETTE_PUYO :             6004460 C |
*PATCH_DATA :                   EC0 C | *PEN :                           20 - |
 PLGN_SPRITE :                   20 - |  PLGN_TEXURE :                   80 - |
 PLGN_TRI :                      40 - |  PLYPZ_MTRL :                    34 C |
 PLYPZ_MTRLOPT :                 38 C |  PLYPZ_SRC_XL :                  14 C |
 PLYPZ_SRC_XL_DX :               18 C |  PLYPZ_SRC_XR :                  24 C |
 PLYPZ_SRC_XR_DX :               28 C |  PLYPZ_SRC_YL :                  1C C |
 PLYPZ_SRC_YL_DX :               20 C |  PLYPZ_SRC_YR :                  2C C |
 PLYPZ_SRC_YR_DX :               30 C |  PLYPZ_XL :                       4 C |
 PLYPZ_XL_DX :                    8 C |  PLYPZ_XR :                       C C |
 PLYPZ_XR_DX :                   10 C |  PLYPZ_YPOS :                     0 C |
 POLYGN_MTRL :                    4 C |  POLYGN_POINTS :                  8 C |
 POLYGN_SRCPNTS :                28 C |  POLYGN_TYPE :                    0 C |
*PSGALV :                       D99 C | *PSGATK :                       D7D C |
 PSGCOM :                       D75 C | *PSGDEC :                       D81 C |
*PSGDTH :                       D95 C | *PSGDTL :                       D91 C |
*PSGENV :                       D8D C | *PSGFREQ_LIST :                 720 C |
*PSGINS_00 :                    EA0 C | *PSGINS_01 :                    EA2 C |
*PSGINS_02 :                    EA8 C | *PSGINS_03 :                    EAB C |
*PSGINS_04 :                    EB7 C | *PSGLEV :                       D79 C |
*PSGRRT :                       D89 C | *PSGSLV :                       D85 C |
*PSGVTBL :                      DCC C | *PSGVTBLNG :                    DE2 C |
 PSGVTBLTG3 :                   DDA C | *PSG_CTRL :                  C00011 - |
 PSG_ENV :                      37C C |  PSG_ENV.ATKEND :               409 C |
 PSG_ENV.CHK2 :                 413 C |  PSG_ENV.CHK4 :                 447 C |
 PSG_ENV.CKOF :                 3AE C |  PSG_ENV.CKON :                 3C1 C |
 PSG_ENV.DKADD :                431 C |  PSG_ENV.DKSAV :                439 C |
 PSG_ENV.DKYEND :               43E C |  PSG_ENV.ENVPROC :              3DF C |
 PSG_ENV.FLGOFF :               4A3 C |  PSG_ENV.KILLENV :              45C C |
*PSG_ENV.MODE1 :                3ED C |  PSG_ENV.NEXTPSG :              48A C |
 PSG_ENV.NSKIP :                3D7 C |  PSG_ENV.VEDLP :                46D C |
 PSG_ENV.VLOOP :                38B C |  PUT_PIECE :       FFFFFFFFC00005EA C |
 PUT_PIECE.BAD_PIECE :                                     FFFFFFFFC000069A C |
 PUT_PIECE.DONTRESET_PZ :                                  FFFFFFFFC0000692 C |
 PUT_PIECE.LEFTH : FFFFFFFFC00005FA C |
 PUT_PIECE.TOP_NEG :                                       FFFFFFFFC000067C C |
*PWMCTL :                        31 - |  PWMINTCLR :                     1C - |
 PWMIRQ_ON :                      1 - |  PWM_LEFT :                 204000C C |
 PWM_LEFT_E :               20C000C C |  PWM_RIGHT :                20C000C C |
 PWM_RIGHT_E :              214000C C |  RAM_BGCAMCURR :   FFFFFFFFFFFF882E C |
 RAM_BGCAMERA :    FFFFFFFFFFFF882C C |  RAM_EXRAMSUB :    FFFFFFFFFFFF9806 C |
 RAM_FIFOMARSWRT : FFFFFFFFFFFF964C C |  RAM_FRAMECOUNT :  FFFFFFFFFFFF9638 C |
 RAM_INITFLUG :    FFFFFFFFFFFF9644 C |  RAM_INPUTDATA :   FFFFFFFFFFFF9000 C |
*RAM_MARS_FBDRWNBUFF :      601EA9C C |  RAM_MARS_GLOBAL :          6011508 C |
 RAM_MARS_MDTASKSFIFO_M :   6021D9C C |  RAM_MARS_MDTASKSFIFO_S :   6021F9C C |
 RAM_MARS_OBJCAMERA :       6011554 C |  RAM_MARS_OBJECTS :         601159C C |
 RAM_MARS_OBJLAYOUT :       601157C C |  RAM_MARS_PALETTE :         602219C C |
 RAM_MARS_PLGNLIST_0 :      6020D9C C |  RAM_MARS_PLGNLIST_1 :      602119C C |
 RAM_MARS_PLGNNUM_0 :       602239C C |  RAM_MARS_PLGNNUM_1 :       602239E C |
 RAM_MARS_PLGN_ZLIST :      602159C C |  RAM_MARS_POLYGONS_0 :      601209C C |
 RAM_MARS_POLYGONS_1 :      601589C C |  RAM_MARS_VDPDRWLIST :      601909C C |
 RAM_MARS_VDPDRWLIST_E :    6020D9C C |  RAM_MDCAMERA :    FFFFFFFFFFFF8800 C |
 RAM_MDGLOBAL :    FFFFFFFFFFFF9E06 C |  RAM_MDLCURRMD :   FFFFFFFFFFFF8828 C |
 RAM_MDMARSHINT :  FFFFFFFFFFFF9656 C |  RAM_MDMARSTCNTM : FFFFFFFFFFFF9648 C |
 RAM_MDMARSTCNTS : FFFFFFFFFFFF964A C |  RAM_MDMARSTSKM :  FFFFFFFFFFFF9218 C |
 RAM_MDMARSTSKS :  FFFFFFFFFFFF9418 C |  RAM_MDMARSTSSGL : FFFFFFFFFFFF9618 C |
 RAM_MDMARSVINT :  FFFFFFFFFFFF9650 C |  RAM_MDSOUND :     FFFFFFFFFFFF965C C |
 RAM_MDSYSTEM :    FFFFFFFFFFFF9000 C |  RAM_MDVIDEO :     FFFFFFFFFFFF966C C |
 RAM_MODEBUFF :    FFFFFFFFFFFF8800 C |  RAM_ROTX :        FFFFFFFFFFFF8824 C |
*RAM_SAVEDATA :    FFFFFFFFFFFF9018 C |  RAM_SNDPITCH :    FFFFFFFFFFFF882A C |
 RAM_SOUNDLASTREG :                                        FFFFFFFFFFFF965C C |
*RAM_SYSFLAGS :    FFFFFFFFFFFF964E C |  RAM_SYSRANDSEED : FFFFFFFFFFFF9640 C |
 RAM_SYSRANDVAL :  FFFFFFFFFFFF963C C |  RAM_VDPREGS :     FFFFFFFFFFFF97EE C |
 RAM_VIDPRNTLIST : FFFFFFFFFFFF966E C |  RAM_VIDPRNTVRAM : FFFFFFFFFFFF966C C |
 RCHWIDTH :                      36 - | *RELAXED :                        0 - |
 ROM_END :                   14000C C |  RRT :                           14 - |
 SBEATACC :                     D65 C |  SBEATPTCK :                    D63 C |
 SCREEN_HEIGHT :                 E0 - |  SCREEN_WIDTH :                 140 - |
 SET_LEFT :        FFFFFFFFC00004C0 C |  SET_LEFT.LFT_OK : FFFFFFFFC00004E2 C |
 SET_LEFT.LFT_SKIP :                                       FFFFFFFFC0000542 C |
 SET_RIGHT :       FFFFFFFFC0000548 C |
 SET_RIGHT.RGT_OK :                                        FFFFFFFFC000056A C |
 SET_RIGHT.RGT_SKIP :                                      FFFFFFFFC00005CA C |
*SET_TEMPO :                    23B C |  SH2_ERROR :                600030C C |
 SH2_MASTER :               6000000 C |  SH2_M_ENTRY :              600176C C |
 SH2_M_ENTRY.WAIT_MD :      600179C C |  SH2_M_ENTRY.WAIT_SLAVE :   60017A6 C |
 SH2_M_HOTSTART :           60017B2 C |  SH2_M_HOTSTART.COPY :      60017D2 C |
 SH2_RAM :                  6011508 C |  SH2_SLAVE :                6000124 C |
 SH2_S_ENTRY :              6001920 C |  SH2_S_ENTRY.WAIT_MD :      6001952 C |
 SH2_S_HOTSTART :           6001968 C |  SH2_S_HOTSTART.COPY :      6001988 C |
*SHIFT :                          3 - |  SIN_TABLE :                6001C60 C |
 SIZEOF_CAMERA :                 28 C |  SIZEOF_INPUT :                   6 C |
 SIZEOF_LAYOUT :                 20 C |  SIZEOF_MARSGBL :                26 C |
*SIZEOF_MARSRAM :           60225E0 C |  SIZEOF_MARSRAM.HERE :      60225E0 C |
 SIZEOF_MARSSND :           60225E0 C |  SIZEOF_MARSSYS :           6011554 C |
 SIZEOF_MARSVID :           60223A0 C |  SIZEOF_MDCAM :                  24 C |
 SIZEOF_MDGLBL :   FFFFFFFFFFFF8830 C |  SIZEOF_MDLOBJ :                 2C C |
 SIZEOF_MDRAM :    FFFFFFFFFFFF8830 C |  SIZEOF_MDSND :    FFFFFFFFFFFF966C C |
 SIZEOF_MDSYS :    FFFFFFFFFFFF965C C |  SIZEOF_MDVID :    FFFFFFFFFFFF9806 C |
 SIZEOF_PLYPZ :                  3C C |  SIZEOF_POLYGN :                 38 C |
 SIZEOF_SNDCHN :                 24 C |  SLAVE_IRQ :                60002AC C |
 SLAVE_LOOP :               60019A6 C |  SLAVE_LOOP.GO_MDL :        60019EC C |
 SLAVE_LOOP.INVLID :        6001A0E C |  SLAVE_LOOP.LOOP :          60019FE C |
 SLAVE_LOOP.NEXT_REQ :      60019B4 C |  SLAVE_LOOP.NO_REQ :        60019D6 C |
 SLAVE_LOOP.NO_TASK :       60019C4 C |  SLAVE_LOOP.PAGE_2 :        6001A26 C |
*SLAVE_LOOP.SKIP :          6001A14 C |  SLAVE_LOOP.STILL_DRWING :  6001A4A C |
 SLAVE_LOOP.SWAP_NOW :      6001A2E C | *SLAVE_LOOP.WAIT_MASTER :   6001A30 C |
 SLV :                           10 - |  SLV_SORT_Z :               6001AB8 C |
 SLV_SORT_Z.NEXT_FACE :     6001B08 C |  SLV_SORT_Z.NO_FACE :       6001B18 C |
 SLV_SORT_Z.Z_END :         6001B20 C |  SLV_SORT_Z.Z_FEWFACES :    6001B02 C |
 SLV_SORT_Z.Z_HIGH :        6001AF8 C |  SLV_SORT_Z.Z_INNER :       6001AE4 C |
*SLV_SORT_Z.Z_NORMAL :      6001ACA C |  SLV_SORT_Z.Z_OUTER :       6001AE0 C |
 SLV_SORT_Z.Z_RANOUT :      6001AD2 C |  SNDDRV_FMSET_1 :               4AC C |
*SNDDRV_FMSET_2 :               4B7 C |  SNDLOCKZ80 :                FF1A42 C |
 SNDLOCKZ80.WAIT :           FF1A4A C |  SNDREQ_ENTER :              FF1A62 C |
 SNDREQ_ENTER.WAIT :         FF1A88 C |  SNDREQ_EXIT :               FF1A98 C |
 SNDREQ_SADDR :              FF1AC0 C |  SNDREQ_SBYTE :              FF1AC8 C |
 SNDREQ_SCMD :               FF1AAE C | *SNDREQ_SLONG :              FF1ABC C |
 SNDREQ_SWORD :              FF1AC4 C | *SNDSENDCMD :                FF1A60 C |
 SNDUNLOCKZ80 :              FF1A56 C |  SOUNDREQ_SETSAMPLE :        FF1A10 C |
*SOUND_DMA_PAUSE :           FF19BC C |  SOUND_DMA_PAUSE.RETRY :     FF19C2 C |
 SOUND_DMA_PAUSE.SAFE :      FF19F6 C |  SOUND_DMA_PAUSE.WAIT :      FF19CA C |
*SOUND_DMA_RESUME :          FF19FA C |  SOUND_INIT :                FF1962 C |
 SOUND_INIT.CLEANUP :        FF1988 C |  SOUND_INIT.COPY :           FF199E C |
 SOUND_INIT.WAIT :           FF1972 C |  SOUND_REQUEST :             FF1A34 C |
 STANDBY :                        2 - | *STRC_XPOS :                      0 C |
*STRC_YPOS :                      2 C |  STR_MODE0 :                 FF31B8 C |
 STR_MODE1 :                 FF324E C |  STR_STATUS :                FF32EC C |
 STR_STATUSPTCH :            FF32E4 C |  STR_TITLE :                 FF31A0 C |
*SYSMARS_ID :                A130EC - |  SYSMARS_REG :               A15100 - |
 SYSMDMARS_INSTASK :         FF02C8 C |  SYSMDMARS_INSTASK.RAN_OUT : FF02E4 C |
 SYSMDMARS_TRANSFER :        FF02E6 C |  SYSMDMARS_TRANSFER.EXIT :   FF0334 C |
 SYSMDMARS_TRANSFER.LOOP :   FF030C C |
*SYSMDMARS_TRANSFER.MID_WRITE :                                      FF033A C |
 SYSMDMARS_TRANSFER.WAIT_CMD :                                       FF0304 C |
 SYSTEM_INIT :               FF0000 C |  SYSTEM_INIT.CLRINPUT :      FF003C C |
 SYSTEM_INIT.WAIT :          FF000C C |  SYSTEM_INPUT :              FF0082 C |
 SYSTEM_INPUT.EXIT :         FF00B0 C |  SYSTEM_INPUT.GET_ID :       FF0182 C |
 SYSTEM_INPUT.ID_0D :        FF00D6 C |  SYSTEM_INPUT.LIST :         FF00B6 C |
 SYSTEM_INPUT.OLDPAD :       FF0134 C |  SYSTEM_INPUT.PICK_ID :      FF016C C |
 SYSTEM_INPUT.STEP_1 :       FF018E C |  SYSTEM_INPUT.STEP_2 :       FF019A C |
 SYSTEM_INPUT.THIS_ONE :     FF0096 C | *SYSTEM_INPUT.WAIT :         FF0082 C |
 SYSTEM_MDMARS_MSTADDTASK :  FF0230 C | *SYSTEM_MDMARS_MSTCALL :     FF0248 C |
 SYSTEM_MDMARS_MSTCALL.WAIT_M :                                      FF0256 C |
 SYSTEM_MDMARS_MSTSENDALL :  FF0288 C |
 SYSTEM_MDMARS_MSTSENDALL.WAIT_M :                                   FF0296 C |
 SYSTEM_MDMARS_SLVADDTASK :  FF023C C | *SYSTEM_MDMARS_SLVCALL :     FF0268 C |
 SYSTEM_MDMARS_SLVCALL.WAIT_S :                                      FF0276 C |
 SYSTEM_MDMARS_SLVSENDALL :  FF02A8 C |
 SYSTEM_MDMARS_SLVSENDALL.WAIT_S :                                   FF02B6 C |
*SYSTEM_RANDOM :             FF019C C | *SYSTEM_SAVEINIT :           FF01E0 C |
 SYSTEM_SAVEINIT.INITSAVE :  FF01F4 C |  SYSTEM_SETINTS :            FF01BA C |
 SYSTEM_SETINTS.NOHINT :     FF01DE C |  SYSTEM_SETINTS.NOVINT :     FF01CC C |
 SYSTEM_VSYNC :              FF0208 C |  SYSTEM_VSYNC.INSIDE :       FF0222 C |
 SYS_CTRL_1 :                A10009 - |  SYS_CTRL_2 :                A1000B - |
 SYS_CTRL_3 :                A1000D - | *SYS_DATA_1 :                A10003 - |
*SYS_DATA_2 :                A10005 - | *SYS_DATA_3 :                A10007 - |
*SYS_EXRAM :                 200000 - | *SYS_IO :                    A10001 - |
*SYS_TMSS :                  A14000 - |  S_IRQ_BAD :                600050E C |
 S_IRQ_CMD :                6000530 C |  S_IRQ_CMD.FINISH :         6000574 C |
 S_IRQ_CMD.NEXT_COMM :      6000544 C |  S_IRQ_CMD.WAIT_MD_B :      6000548 C |
 S_IRQ_CMD.WAIT_MD_C :      6000558 C |  S_IRQ_CUSTOM :             6001C28 C |
 S_IRQ_H :                  600058C C |  S_IRQ_PWM :                6000514 C |
 S_IRQ_V :                  60005A8 C |  S_IRQ_VRES :               60005BC C |
 S_IRQ_VRES.MARS_RESET :    6000606 C |  S_IRQ_VRES.MD_RESET :      60005D4 C |
 S_IRQ_VRES.SH_WAIT :       60005E0 C |  S_IRQ_VRES.VRESLOOP :      600060E C |
*TESTVAL1 :                       8 C | *TESTVAL2 :                       A C |
*TEST_LAYOUT :              60112DC C |  TEST_LAYOUT.BLOCKS :       60114E0 C |
*TEST_LAYOUT.OBJECTS :      60114F8 C |  TEST_WAV :                  918054 C |
 TEST_WAV_E :                938054 C |  TEXTR_MARSCITY :           600DE98 C |
 TEXTR_SMOK :               60046FC C |  TH :                      20000000 - |
 TICKCNT :                      D62 C |  TICKFLAG :                     D60 C |
*TIME :                     3:40:40 - |  TIMERCTL :                      30 - |
 TRANSFERROM :                  2B7 C |  TRANSFERROM.DOUBLE :           2D8 C |
 TRANSFERROM.TRANSFER :         2FB C |  TRANSFERROM.X68KLAST :         33E C |
 TRANSFERROM.X68KLOOP :         32A C |  TRANSFERROM.X68KLPCONT :       332 C |
 TRANSFERROM.X68KLPWT :         352 C |  TRANSFERROM.X68KLSTCONT :      348 C |
 TRANSFERROM.X68KLSTWT :        367 C |  TRANSFERROM.X68KLSTWTLP :      36B C |
 TRANSFERROM.X68KNOCARRY :      2F5 C |  TRANSFERROM.X68KPWTLP :        356 C |
 TRUE :                           1 - | *TVMODE :                         0 - |
*UPDSEQ :                       260 C |  UPDSEQ.UPDSEQDOIT :            2A7 C |
 UPDSEQ.UPDSEQLOOP :            277 C |  UPDSEQ.UPDSEQLOOP1 :           291 C |
 UPDSEQ.UPDSEQLOOP2 :           2B1 C |  UPDSEQ.UPDSEQSFX :             2A3 C |
 VARNULLVRAM :                  7FF - |  VAR_MOVESPD :                 2000 - |
*VBLK :                          80 - |  VDPSTS :                         A - |
 VDP_CTRL :                  C00004 - |  VDP_DATA :                  C00000 - |
*VERSION :                     142F - | *VIDEO_AUTOMAP_VERT :        FF0514 C |
 VIDEO_AUTOMAP_VERT.XLOOP :  FF0524 C |  VIDEO_AUTOMAP_VERT.YLOOP :  FF0536 C |
 VIDEO_CLEAR :               FF03B4 C | *VIDEO_COPY :                FF07C2 C |
 VIDEO_COPY.DMAW :           FF07D6 C |  VIDEO_COPY.DMAWE :          FF0830 C |
 VIDEO_FILL :                FF074E C |  VIDEO_FILL.DMAW :           FF0762 C |
 VIDEO_FILL.DMAWE :          FF07AA C |  VIDEO_INIT :                FF036A C |
 VIDEO_INIT.CLRRAM :         FF0374 C |  VIDEO_INIT.COPY :           FF03AA C |
*VIDEO_INIT.EXIT :           FF039E C |  VIDEO_INIT.LOOP :           FF0390 C |
 VIDEO_LOADART :             FF0848 C | *VIDEO_LOADMAP :             FF044C C |
 VIDEO_LOADMAP.CONT :        FF0472 C |  VIDEO_LOADMAP.NODBLE :      FF0492 C |
 VIDEO_LOADMAP.NONULL :      FF0470 C |  VIDEO_LOADMAP.XLOOP :       FF0462 C |
 VIDEO_LOADMAP.YLOOP :       FF0458 C | *VIDEO_LOADMAP_VERT :        FF04A4 C |
 VIDEO_LOADMAP_VERT.CONT :   FF04D8 C |  VIDEO_LOADMAP_VERT.NODBLE : FF04FA C |
 VIDEO_LOADMAP_VERT.NONULL : FF04D6 C | *VIDEO_LOADMAP_VERT.OUTDBL : FF0504 C |
 VIDEO_LOADMAP_VERT.XLOOP :  FF04B2 C |  VIDEO_LOADMAP_VERT.YLOOP :  FF04C4 C |
 VIDEO_LOADPAL :             FF0422 C |  VIDEO_LOADPAL.LOOP :        FF0444 C |
 VIDEO_LOADPAL.OUTV :        FF043A C |  VIDEO_PRINT :               FF057A C |
 VIDEO_PRINT.DONIBL :        FF0694 C |  VIDEO_PRINT.EXIT :          FF0604 C |
 VIDEO_PRINT.ISBYTE :        FF05CE C |  VIDEO_PRINT.ISLONG :        FF05F2 C |
 VIDEO_PRINT.ISWORD :        FF05E0 C |  VIDEO_PRINT.LNGLOOP :       FF0684 C |
 VIDEO_PRINT.LOOP :          FF058E C |  VIDEO_PRINT.LOWR :          FF06A4 C |
 VIDEO_PRINT.NEWJUMP :       FF0588 C |  VIDEO_PRINT.NEXT :          FF05B0 C |
 VIDEO_PRINT.NEXTV :         FF060E C |  VIDEO_PRINT.NOTHING :       FF06B0 C |
 VIDEO_PRINT.PUTTEXT :       FF05A2 C |  VIDEO_PRINT.SPECIAL :       FF05B4 C |
 VIDEO_PRINT.VBYTE :         FF0640 C |  VIDEO_PRINT.VLONG :         FF068C C |
 VIDEO_PRINT.VWORD :         FF0662 C |  VIDEO_PRINTINIT :           FF0556 C |
 VIDEO_RAMCODE :             FF084E C |  VIDEO_RAMCODE.FROM_RAM :    FF091E C |
 VIDEO_RAMCODE.LOAD_ART :    FF085E C |  VIDEO_RAMCODE.WAIT :        FF08D0 C |
 VIDEO_RAMCODE_E :           FF092E C |  VIDEO_UPDATE :              FF0402 C |
*VIDEO_UPDATE.EXIT :         FF0420 C |  VIDEO_UPDATE.LOOP :         FF0414 C |
 VID_PICKLAYER :             FF06B2 C |  VID_PICKLAYER.GOLYR :       FF0702 C |
 VID_PICKLAYER.NOWD :        FF06EC C |  VID_PICKLAYER.PLAWND :      FF06DA C |
 VID_PICKLAYER.THISSZ :      FF0722 C |  VID_PICKLAYER.THISSZJ :     FF074A C |
 VINTCLR :                       16 - | *VINTENBL :                      20 - |
 VINT_DEFAULT :              FF0350 C |  VIRQ_ON :                        8 - |
 VRESINTCLR :                    14 - |  WAVE_END :                     E97 C |
 WAVE_LOOP :                    E9A C |  WAVE_PITCH :                   E9D C |
 WAVE_START :                   E94 C | *WAVFREQ_LIST :                 618 C |
 WAV_FLAGS :                    E9F C | *WHDFLG :                       D9D C |
 X68KSRCLSB :                   D6F C |  X68KSRCMID :                   D70 C |
*YM_CTRL_1 :                 A04000 - | *YM_CTRL_2 :                 A04002 - |
*YM_DATA_1 :                 A04001 - | *YM_DATA_2 :                 A04003 - |
 Z80_BUS :                   A11100 - |  Z80_CODE :                  FF1BCE C |
 Z80_CODE_END :              FF2E3E C |  Z80_CPU :                   A00000 - |
 Z80_INIT :                      3E C |  Z80_RESET :                 A11200 - |
*ZBANK :                       6000 - | *ZOPCEX :                         8 - |
 ZOPCEXX :                       D9 - | *ZOPCNOP :                        0 - |
 ZOPCPUSHAF :                    F5 - |  ZOPCRET :                       C9 - |
 ZPSG_CTRL :                   7F11 - | *ZVDP_CTRL :                   7F04 - |
*ZVDP_DATA :                   7F00 - |  ZYM_CTRL_1 :                  4000 - |
 ZYM_CTRL_2 :                  4002 - |  ZYM_DATA_1 :                  4001 - |
 ZYM_DATA_2 :                  4003 - |  _CCR :                    FFFFFE92 - |
 _DMACHANNEL0 :            FFFFFF8C - | *_DMACHANNEL1 :            FFFFFF9C - |
*_DMACOUNT0 :              FFFFFF88 - | *_DMACOUNT1 :              FFFFFF98 - |
*_DMADEST0 :               FFFFFF84 - | *_DMADEST1 :               FFFFFF94 - |
 _DMAOPERATION :           FFFFFFB0 - | *_DMAREQACK0 :             FFFFFFB4 - |
*_DMAREQACK1 :             FFFFFFB8 - | *_DMASOURCE0 :             FFFFFF80 - |
*_DMASOURCE1 :             FFFFFF90 - | *_DMAVECTORE0 :            FFFFFFA4 - |
*_DMAVECTORE1 :            FFFFFFAC - | *_DMAVECTORN0 :            FFFFFFA0 - |
*_DMAVECTORN1 :            FFFFFFA8 - |  _FRAMEBUFFER :            24000000 - |
*_FRC_H :                         2 - | *_FRC_L :                         3 - |
 _FRT :                    FFFFFE10 - | *_HRH :                    FFFFFF10 - |
*_HRL :                    FFFFFF14 - | *_HRL32 :                  FFFFFF04 - |
 _JR :                     FFFFFF00 - | *_OCR_H :                         4 - |
*_OCR_L :                         5 - |  _OVERWRITE :              24020000 - |
 _PALETTE :                20004200 - | *_SERIAL :                 FFFFFE00 - |
 _SYSREG :                 20004000 - | *_TCR :                           6 - |
*_TCSR :                          1 - | *_TIER :                          0 - |
 _TOCR :                          7 - |  _VDPREG :                 20004100 - |

   1263 symbols
    257 unused symbols

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 3 - 2/19/2021 3:40:41


  defined macros:
  ---------------

DACSTREAM                             | FINISH                               
ORG                                   | STRUCT                               

      4 macros

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 4 - 2/19/2021 3:40:41


  defined functions:
  ------------------

NOTZ80                                | LOCATE                               
MAPSIZE                               | DOUBLEWORD                           

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 5 - 2/19/2021 3:40:41


  codepages:
  ----------

STANDARD (0 changed characters)


0.13 seconds assembly time

   8842 lines source file
   9222 lines incl. macro expansions
      6 passes
      0 errors
      0 warnings
